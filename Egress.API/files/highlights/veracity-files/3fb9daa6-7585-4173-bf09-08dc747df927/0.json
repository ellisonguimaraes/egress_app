{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"1508ac0b-ecc6-4535-8607-0980520c8d50","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8be6a854-25e0-437a-9bb1-0abe822404c7","$connId":"con_3","$id":"4ee55283-b84b-46e1-90cf-e998a3c86286","conditions":[{"source":"context","comparison":"approximateTo","values":["sim"],"variable":"config.avisoManutencaoAtivo"}],"$invalid":false},{"stateId":"abcf33d4-6b8e-4e48-b15e-68a202a32549","$connId":"con_8","conditions":[{"source":"input","comparison":"matches","values":["inicio"]}],"$invalid":false,"$id":"1cbb60f2-9a48-42fc-a1ff-100543ba1caf"},{"stateId":"dc77a58f-2dab-4c20-8d83-f31a03ba2270","$connId":"con_13","conditions":[{"source":"input","comparison":"equals","values":["#retornoDeErro"]}],"$invalid":false,"$id":"7c85a6b5-9bd2-40c1-9be5-5fcfcf389ac1"},{"stateId":"e747b47e-e9b7-401e-b515-e8a3c89d0f4a","typeOfStateId":"state","$connId":"con_18","$id":"d88ff8e2-fdea-4a14-b617-bf37aa3c69f7","conditions":[{"source":"input","comparison":"equals","values":["A.1","#F.1.0.0"]}],"$invalid":false},{"stateId":"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7","$connId":"con_23","conditions":[{"source":"input","comparison":"equals","values":["#A.1.1"]}],"$invalid":false,"$id":"007f8bbd-8bbb-46f3-8486-a3850995a514"},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","$connId":"con_28","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.1"]}],"$invalid":false,"$id":"6a8249af-9287-42f4-9729-8fdbb018610c"},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","$connId":"con_33","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.2"]}],"$invalid":false,"$id":"f5904ccb-1f3e-491b-91db-3fec8de7b02e"},{"stateId":"b434339f-dd01-41f8-a242-318de8db7a1c","$connId":"con_38","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.1"]}],"$invalid":false,"$id":"4f2603bf-fda5-491d-a56a-36b83f8db988"},{"stateId":"332f5478-463c-42cd-9f3c-da92d2ffefc7","$connId":"con_43","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.2"]}],"$invalid":false,"$id":"949e38ca-09e7-4fa9-adfc-245d1369fb88"},{"stateId":"2df23b8d-35a1-40ca-a18a-b10a5692cd8c","$connId":"con_48","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.1"]}],"$invalid":false,"$id":"0915139e-0f33-42d5-8cb2-9b1746c85b8e"},{"stateId":"2b5affcc-9e73-4afe-abca-aa0b2cf8b3c7","$connId":"con_53","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2"]}],"$invalid":false,"$id":"6ed7db51-c2e6-45a4-8168-a4070bb9a7a3","typeOfStateId":"state"},{"stateId":"193ca9f8-d159-42cd-9794-bf2279c2ec7b","$connId":"con_58","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.1"]}],"$invalid":false,"$id":"3bce4b26-3e99-4a7a-9dde-87e455bd3e99"},{"stateId":"6c6c86ef-3eb8-4fc8-8b5d-4957f77a4d52","$connId":"con_63","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.3"]}],"$invalid":false,"$id":"81a5cae2-1030-442a-a4f7-bc90189a006b"},{"stateId":"6b853631-c790-462f-b2fb-dd6c3414b920","$connId":"con_68","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.2.1.1"]}],"$invalid":false,"$id":"a4cbfcb1-8b68-48f5-a4ca-e4d69ff8807c"},{"stateId":"welcome","$connId":"con_73","conditions":[{"source":"input","comparison":"equals","values":["#A.1"]}],"$invalid":false,"$id":"f54dd221-2b77-480e-8b3f-e559f383301b"},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","$connId":"con_78","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.2"]}],"$invalid":false,"$id":"824bc0d0-2278-41fe-b376-a58a314c8783"},{"stateId":"4130f339-6a5c-46d8-a500-3f1cb8eb5e10","$connId":"con_83","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.2.1"]}],"$invalid":false,"$id":"538d132f-6ffd-458c-bcaf-c54ffc821796"},{"stateId":"23e2724c-154c-48bd-9b8f-c9cafb346fb6","$connId":"con_88","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.2.2"]}],"$invalid":false,"$id":"6286e1a2-eafb-45c6-bf85-19dcc377b148","typeOfStateId":"state"},{"stateId":"a8938eab-98a7-4bae-a642-167ff1628bc9","$connId":"con_93","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.2.1.1"]}],"$invalid":false,"$id":"41d207fa-92e5-4801-a6bd-3e3fcb0d7b24"},{"stateId":"2b854d9e-fd7d-4644-939e-736fb64dab17","$connId":"con_98","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.2.1.1.2"]}],"$invalid":false,"$id":"e3332787-f59c-4aa1-9e11-56372d748fb5"},{"stateId":"fbb48055-374c-4d94-bab4-3b1f8202555d","$connId":"con_103","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.2.1.1.2.1"]}],"$invalid":false,"$id":"95696aa9-a447-47cf-bdf0-4aeedccd87b0"},{"stateId":"388e0007-29d8-415f-b1bd-9820f710afe3","$connId":"con_108","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.2.1.1.2.1.1"]}],"$invalid":false,"$id":"1e51481a-bee2-47f5-83b6-68d610dade18"},{"stateId":"349b8147-05a1-4301-aab5-2702abd6a295","$connId":"con_113","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.1"]}],"$invalid":false,"$id":"aec9a8b3-a6bf-4737-96af-46f730e7b477"},{"stateId":"23e2724c-154c-48bd-9b8f-c9cafb346fb6","$connId":"con_118","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.2"]}],"$invalid":false,"$id":"5b5182f3-ebe0-4642-b34a-bec39e967aa4","typeOfStateId":"state"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"numericOptionsRegex","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return JSON.stringify([\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*1\\\\s*?)|um|(primei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*2\\\\s*?)|dois|(segund[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*3\\\\s*?)|tr[eê]s|(tercei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*4\\\\s*?)|quatro|(quart[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*5\\\\s*?)|cinco|(quint[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*6\\\\s*?)|seis|(sext[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*7\\\\s*?)|sete|(s[eé]tim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*8\\\\s*?)|oito|(oitav[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*9\\\\s*?)|nove|(non[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*10\\\\s*?)|dez|(d[eé]cim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*11\\\\s*?)|onze|(d[eé]cim[ao]\\\\s*primei?ra))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*12\\\\s*?)|doze|(d[eé]cim[ao])\\\\s*segunda)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*13\\\\s*?)|treze|(d[eé]cim[ao])\\\\s*tercei?ra)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*14\\\\s*?)|catorze|(d[eé]cim[ao])\\\\s*quarta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*15\\\\s*?)|quinze|(d[eé]cim[ao])\\\\s*quinta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*16\\\\s*?)|dezesseis|(d[eé]cim[ao])\\\\s*sexta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*17\\\\s*?)|dezessete|(d[eé]cim[ao])\\\\s*s[eé]tima)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*18\\\\s*?)|dezoit|(d[eé]cim[ao])\\\\s*oitava)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*19\\\\s*?)|dezenove|(d[eé]cim[ao])nona)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n    \"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*20\\\\s*?)|vinte|(vig[eé]sima))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n  ]);\n}","inputVariables":[],"outputVariable":"numericOptionsRegex","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"onboarding - fatura residencial\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5060d84c-a084-405c-a168-770ae1200239","$typeOfContent":"","type":"SetVariable","$title":"loginTestB","$invalid":false,"settings":{"variable":"loginTestB","value":"true"},"conditions":[]},{"$id":"0edf28bf-4152-4153-8739-b2df9f4fe419","$typeOfContent":"","type":"ExecuteScript","$title":"Set userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f4becd88-722a-402f-88e8-cd66f5021813","$typeOfContent":"","type":"ExecuteScript","$title":"Set channelBoldTags","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"userChannel"},{"source":"context","comparison":"notExists","values":[],"variable":"channelBoldTags"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1efa6226-1aa5-4384-9039-f1982dbd96c1","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-2ac74a8d-d29b-4ead-bea1-4a22e68462e9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cc557bf9-b89f-4d5f-824b-907e9cbcad8a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6aca61a4-6423-49f9-9fb2-a974665df53b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$position":{"top":"198px","left":"2631px"},"$title":"Início","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b922a8f7-50ca-4237-9ab0-130d2cddcce2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$connId":"con_123","$invalid":false,"$id":"f9d80ab4-8413-48e5-b615-bfe65730c383"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Set OrigemErro","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(botName, previousId) {\n                return { sub_bot: botName, state_id: previousId };\n            }","inputVariables":["config.botname","state.previous.id"],"outputVariable":"origemErro","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-de5c0409-1850-4bfb-ad8e-b812aed5464a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$position":{"top":"181.5px","left":"2951px"},"$title":"Exceções","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f8bf43a9-a44e-425b-a31a-41076a45e52a","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to principal","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{input.content}}"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-65de497a-ba7b-4630-b593-d0fc6e0b0b55","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"error","$position":{"top":"0px","left":"2951px"},"$title":"Redireciona para o principal (roteamento de input)","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"02cac0e4-7a1c-42a6-9678-5a516263394c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"02cac0e4-7a1c-42a6-9678-5a516263394c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"ba7d7c47-1bc9-4d99-a23d-37b245c35d98","type":"text/plain","content":"{{message}}"},"$cardContent":{"document":{"id":"ba7d7c47-1bc9-4d99-a23d-37b245c35d98","type":"text/plain","content":"{{message}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"b47b1e66-d148-476c-a161-03e3071de205","type":"text/plain","content":"cpfInformado"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"cpfInformado"},"$invalid":false}],"$conditionOutputs":[{"stateId":"b290aa9b-f2f6-4a8c-ad4c-1a13a95e9e93","$connId":"con_128","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"9d5116c4-c420-41ec-ac8f-971a5ab552d4"}],"$enteringCustomActions":[{"type":"SetVariable","$title":"Tentativa CPF","$invalid":false,"settings":{"value":"0","variable":"tentativaCpf"},"conditions":[]},{"$id":"5dd9bcf7-7792-464c-88f7-ad85faacea7b","$typeOfContent":"","type":"TrackEvent","$title":"Fatura origem","$invalid":false,"settings":{"extras":{},"category":"Fatura origem","action":"{{lastState}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"lastState"}]},{"$id":"e9372729-8034-4310-8ba4-59355567326b","$typeOfContent":"","type":"TrackEvent","$title":"Fatura exibicao","$invalid":false,"settings":{"extras":{},"category":"Fatura exibicao","action":"Exibicao"},"conditions":[]},{"type":"TrackEvent","$title":"Codigo barras residencial origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Codigo barras residencial origem","action":"{{lastFeature@channel}} | {{lastState}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"lastState"}]},{"type":"TrackEvent","$title":"Codigo barras residencial exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Codigo barras residencial exibicao","action":"Exibicao"},"conditions":[]},{"type":"ExecuteScript","$title":"message","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    if(input == \"confirmacao\"){\n        return \"\";\n    }\n    else{\n        return `Por favor, digite para mim *apenas os números do seu CPF ou CNPJ* para que eu consiga buscar o código de barras da sua fatura. 😊\n\n_Ex: 11122233300_`;\n    }\n}","inputVariables":["lastState"],"outputVariable":"message","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(chooseAnswer) {\n    try {\n        var channel = 'Claro Residencial';\n        if (JSON.parse(chooseAnswer).content.toLowerCase().indexOf('tv') != -1) {\n            channel = 'Claro TV';\n        }\n        var date = new Date();\n        return {\n            name: 'Código de barras',\n            channel: channel,\n            text: 'com o código de barras',\n            date: new Date()\n        }\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["chooseAnswer"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"fatura residencial\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Verifica se CPF e numero","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n  try{\n    if (isNaN(input)) {\n        return false;\n    } else {\n        return true;\n    }\n  }catch (e){\n      return false;\n  }\n}","inputVariables":["input.content"],"outputVariable":"isDocumentNumber","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b5dffa58-9cea-465e-a855-abc77c5e61e8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d86bccb1-dccf-4ee6-bebe-35498d13e8ba","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e5d88fed-984c-4a97-a931-eeb0feb80654","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-68548cae-ce48-428d-a7f5-3efe4318535f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-8038a711-a5fa-4b33-86af-dd3990084ad3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7","root":false,"$title":"[CBR.0.0.0] Codigo Barras","$position":{"top":"268px","left":"212px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2df23b8d-35a1-40ca-a18a-b10a5692cd8c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"16c735f4-6b40-4503-a0f8-0927357fd2ae","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"fatura digital claro tv exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"fatura digital claro tv exibicao","action":"Exibicao"},"conditions":[]},{"type":"Redirect","$title":"Redirect to \"{{config.servicoFaturaTv}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"inicio"},"address":"{{config.servicoFaturaTv}}"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"cancelar fatura claro\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-4109090c-fcaf-4813-bf50-ac03e9c4e7c4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b60519a9-ee33-4319-9bd7-fb50d919176a","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-1ec506be-a004-4881-b78c-e60bad314799","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"2df23b8d-35a1-40ca-a18a-b10a5692cd8c","root":false,"$title":"[A.1.3.1] fatura digital claro tv","$position":{"top":"365px","left":"4350px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7482a23b-d90f-4476-840a-7f1f1a076702":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"39aba8f6-230f-4ca0-8c9b-d53c4a6f4727","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to F.0","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#finalizacao"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-f3ae5368-72b5-47b2-aa09-47aa30f392be","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"7482a23b-d90f-4476-840a-7f1f1a076702","root":false,"$title":"Redireciona para finalizacao F.0","$position":{"top":"0px","left":"3168.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1a112d4e-707e-477b-8660-ca5524e37e45":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"1810549b-d936-484d-8c49-ea162296dae3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"conditions":[{"source":"input","comparison":"equals","values":["#finalizacao"]}],"$invalid":false,"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_133","$id":"6ce909ea-f09f-4004-9825-d0ca57346352"},{"conditions":[{"source":"input","comparison":"equals","values":["#menu"]}],"$invalid":false,"stateId":"07e22cc5-0aca-4f74-8296-d99e6eaa6a5f","$connId":"con_138","$id":"a25144aa-8011-45f9-8fa7-11facceeb709"},{"conditions":[{"source":"input","comparison":"equals","values":["#AjudaAutenticacao"]}],"$invalid":false,"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_143","$id":"502b2023-da3b-4407-9c08-285ce51218fe"},{"conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false,"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_148","$id":"14073c4f-4367-4fe8-ab2f-ffdd70fc3ef2"},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","typeOfStateId":"state","$connId":"con_153","$id":"3850fb68-667f-4be5-8ffc-861dc2cbc9a0","conditions":[{"source":"context","comparison":"equals","values":["Ir para Segunda Via de Fatura"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7","typeOfStateId":"state","$connId":"con_158","$id":"ef761762-b102-4a76-9430-cc2ace16c5d1","conditions":[{"source":"context","comparison":"equals","values":["Pegar o codigo de barras"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","typeOfStateId":"state","$connId":"con_163","$id":"b7ef80d7-35fc-4ddd-bd96-a9fa05d0be4c","conditions":[{"source":"context","comparison":"equals","values":["Ajuda com login"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","typeOfStateId":"state","$connId":"con_168","$id":"c65bcc9f-4faa-4d31-a523-0bdb1b598aca","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","typeOfStateId":"state","$connId":"con_173","$id":"4dbc3087-2ea7-4893-bf11-a6becebc053b","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5ea031eb-d440-4dab-a5bf-3a8e1e8f2345","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var date = new Date();\n    return {\n        name: 'Fatura digital',\n        channel: 'Faturamento Residencial',\n        text: 'com a sua fatura digital',\n        date: date\n    }\n}","inputVariables":[],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"da4414e3-1676-4dc7-84a4-9950aee9f383","$typeOfContent":"","type":"ExecuteScript","$title":"loginOptions","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return {\n        templateText: 'Para se cadastrar ou alterar seu cadastro',\n        menu: `Ou, *se preferir*, escolha uma das opções:\\n\\n*1-* Ir para Segunda Via de Fatura\\n*2-* Pegar o código de barras (sem login)\\n*3-* Ajuda com login\\n*4-* Voltar ao Menu anterior\\n*5-* Sair`,\n        options: [\n            {\n                content: 'Ir para Segunda Via de Fatura',\n                regex: 'segund[ao]?\\s?(via)?\\s?(d[aei])?\\s?(fatura)?',\n            },\n            {\n                content: 'Pegar o codigo de barras',\n                regex: 'c[oó]digo(\\\\s*(de\\\\s*)?barras)?',\n            },\n            {\n                content: 'Ajuda com login',\n                regex: 'ajuda',\n            },\n            {\n                content: `Voltar ao menu`,\n                regex: 'voltar?|menu',\n            },\n            {\n                content: 'Sair',\n                regex: 'sair?',\n            },\n        ],\n        trackingExhibition: 'exibicao',\n        trackingOption: 'selecao',\n        trackingInput: 'input',\n    };\n}\n","inputVariables":[],"outputVariable":"loginOptions","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"Redirect","$title":"Redirecionar Bot Autenticacao","$invalid":false,"settings":{"address":"{{config.servicoAutenticacao}}","context":{"type":"text/plain","value":"#faturaNet#loginWithOptions#v2"}},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"input","comparison":"equals","values":["#ajudaAutenticacao"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"71985007-21d4-4857-a4e2-b12b5dbbbfc0","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-2f5d78fc-cbee-48f9-aa14-e2a3d90f5d1e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8c03de2b-0e9c-4f09-82d4-925e3a4da507","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-5910ba58-419a-40ab-bd89-f38454c6b4af","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1a112d4e-707e-477b-8660-ca5524e37e45","root":false,"$title":"Redireciona login fatura digital","$position":{"top":"578px","left":"3824px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"07e22cc5-0aca-4f74-8296-d99e6eaa6a5f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5ef16060-e802-4aef-ba4b-f2317c660d35","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to \"{{config.servicoPrincipal}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#menu"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-9b900217-7e70-473f-b149-1fb7f0df86e2","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"07e22cc5-0aca-4f74-8296-d99e6eaa6a5f","root":false,"$title":"Redireciona para menu","$position":{"top":"0px","left":"3392px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f2fe48ca-e06c-4701-a1da-be6b569ee7f9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e80908da-e64d-471c-a394-ca9f8460bc5e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to \"{{config.servicoPrincipal}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#erro"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-b3c2e8eb-d591-4c2e-9699-d77adc8684b0","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","root":false,"$title":"Redireciona para Erro Api","$position":{"top":"9px","left":"3623.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b434339f-dd01-41f8-a242-318de8db7a1c":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"b3f78aca-f679-41ff-9ca8-227e672cb4c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b3f78aca-f679-41ff-9ca8-227e672cb4c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"7bad3a9e-23d8-43a7-9ae6-5ef958b3d7d8","type":"text/plain","content":"Você pode cadastrar o débito automático da sua fatura Claro Tv acessando:\n\nhttp://bit.ly/clarolog  "},"$cardContent":{"document":{"id":"7bad3a9e-23d8-43a7-9ae6-5ef958b3d7d8","type":"text/plain","content":"Você pode cadastrar o débito automático da sua fatura Claro Tv acessando:\n\nhttp://bit.ly/clarolog  "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b27e481d-5a74-494d-9774-258f4d9d68d6","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Debito automatico claro tv exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Debito automatico claro tv exibicao","action":"Exibicao"},"conditions":[]},{"$id":"f24d8693-6d7d-42db-b4b5-c40748306236","$typeOfContent":"","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento) {\n    var channel = 'Claro Residencial';\n    if(tipoAtendimento == 'tv') {\n        channel = 'Claro TV';\n    }\n\n    var date = new Date();\n    return {\n        name: 'Débito automático',\n        channel: channel,\n        text: 'com Débito automático',\n        date: date\n    }\n}","inputVariables":["tipoAtendimento"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"tv debito automatico\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-187d538c-49d3-40c5-8c12-8017c1759137","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1823158c-1107-42e5-a437-c2b9179705d7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ff6d810b-0fee-4cfa-bc17-6b658e210efb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b434339f-dd01-41f8-a242-318de8db7a1c","root":false,"$title":"[A.1.4.1]Claro Tv Debito Automatico","$position":{"top":"495px","left":"6066px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"53d7e972-d324-49a1-97fa-df51250f389e":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"2947b62c-273e-4834-805f-2dc447e2db61","type":"text/plain","content":"Fazendo o cadastro no débito automático, o valor da fatura é descontado automaticamente da sua conta, todo mês, sempre na data do vencimento 😉"},"$cardContent":{"document":{"id":"2947b62c-273e-4834-805f-2dc447e2db61","type":"text/plain","content":"Fazendo o cadastro no débito automático, o valor da fatura é descontado automaticamente da sua conta, todo mês, sempre na data do vencimento 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2e924f4b-3171-4b41-af3e-2a7738b72dfe","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"13aa440d-8c74-4b32-9840-ae709005291e","type":"TrackEvent","$title":"Debito automatico net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"action":"Exibicao","category":"Debito automatico net exibicao"},"conditions":[]},{"$id":"ade67161-55f6-460a-aa14-c66ea48390d4","$typeOfContent":"","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento) {\n    var channel = 'Claro Residencial';\n    if(tipoAtendimento == 'tv') {\n        channel = 'Claro TV';\n    }\n\n    var date = new Date();\n    return {\n        name: 'Débito automático',\n        channel: channel,\n        text: 'com Débito automático',\n        date: date\n    }\n}","inputVariables":["tipoAtendimento"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"debito automatico net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ec3bf851-2c33-462b-bbe5-1b027fe47da4","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-6c7f55e1-7289-4d8f-a41e-c24acf1ce2b4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-75b51f83-97dc-4959-9857-0974cdbbe187","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a386f466-d185-455d-9bfa-0d0e0d3118e7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"53d7e972-d324-49a1-97fa-df51250f389e","root":false,"$title":"[A.1.4.2] Debito automatico net","$position":{"top":"269px","left":"5788.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"193ca9f8-d159-42cd-9794-bf2279c2ec7b":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"fd712bc6-e9bd-48ce-8df7-8d346a408ce0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fd712bc6-e9bd-48ce-8df7-8d346a408ce0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a3c8858a-6cb1-484d-81fa-1e1dc1c00078","type":"text/plain","content":"O titular da conta que você vai cadastrar para débito automático é o mesmo titular do contrato conosco?\n\n*1-* Sim\n*2-* Não\n*3-* Voltar ao Menu anterior","metadata":{}},"$cardContent":{"document":{"id":"a3c8858a-6cb1-484d-81fa-1e1dc1c00078","type":"text/plain","content":"O titular da conta que você vai cadastrar para débito automático é o mesmo titular do contrato conosco?\n\n*1-* Sim\n*2-* Não\n*3-* Voltar ao Menu anterior"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a117aee7-3480-4ffd-a5fa-edd111c913e0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"23e2724c-154c-48bd-9b8f-c9cafb346fb6","$connId":"con_178","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"34895dec-102f-465e-a12a-c0272bd305b4"},{"stateId":"0b282c77-fe04-464b-baa6-aa3ae2554c2f","$connId":"con_183","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"1f2f9be1-ee2a-4cce-9606-a5c07f7a387a"},{"stateId":"53d7e972-d324-49a1-97fa-df51250f389e","$connId":"con_188","$id":"2d5c50cd-2b2b-4bb1-a9e0-afd753f8a052","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Cadastrar debito automatico net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Cadastrar debito automatico net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Choose Answer","$invalid":false,"settings":{"function":"run","source":"/**\nO titular da conta que você vai cadastrar para débito automático é o mesmo titular do contrato conosco?\n\n1- Sim\n2- Não\n3- Voltar ao Menu anterior\n\n**/\n\nfunction run(input) {\n    let regex = /((1)|(\\s*1\\s*)|(.*sim.*))$/i;\n    if (regex.test(input))\n        return { option: \"1\", content: \"Sim\" }\n\n    regex = /((2)|(\\s*2\\s*)|(.*n[aã]o.*))$/i;\n    if (regex.test(input))\n        return { option: \"2\", content: \"Nao\" };\n\n    regex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|[eé]\\s*[ao]?)\\s*)?((0*3\\s*)|(tr[êe]s)|(terceir[ao]\\s*(op[cç][aã]o?)?)|((0*3\\s*)?(voltar?|(menu)?\\s*anterior)\\s*(ao?)?\\s*((menu)?\\s*anterior)?))\\s*$/i;\n    if (regex.test(input))\n        return { option: \"3\", content: \"Voltar ao Menu anterior\" };\n\n    return { option: \"invalid\", content: \"input inesperado\" };\n\n}\n","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Cadastrar debito automatico net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Cadastrar debito automatico net selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Cadastrar debito automatico net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Cadastrar debito automatico net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"confirmacao titular da conta\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.4.2.1"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-620b1dde-e9b4-4188-a00f-50533b7aa7e6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-de8e3786-6611-4472-87b8-c10ecf0da147","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d26c009d-5f61-43b4-912f-4a3bb5d6f13d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c702e5c9-8b9c-481f-adc6-07956a185c17","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-d1111fc9-cf65-4fed-a210-642ee0548493","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"193ca9f8-d159-42cd-9794-bf2279c2ec7b","root":false,"$title":"[A.1.4.2.1] Confirmacao Titular da Conta","$position":{"top":"531px","left":"5788px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"332f5478-463c-42cd-9f3c-da92d2ffefc7":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"ad002d93-ec1c-4585-8c56-a3b01312c690","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","typeOfStateId":"state","$connId":"con_193","$id":"54d439c9-7682-4747-8d2f-95f8e86a5d18","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false},{"stateId":"1721c199-eecf-4ce4-a700-822d0b0d308a","typeOfStateId":"state","$connId":"con_198","$id":"dc4c4125-f6d3-479f-a4d0-4270e3209669","conditions":[{"source":"input","comparison":"equals","values":["false"]}],"$invalid":false},{"stateId":"ce967266-c793-4e80-91ac-97bf3584d129","typeOfStateId":"state","$connId":"con_203","$id":"cebba7d9-7957-4ef3-815b-9a75286b6dc1","conditions":[{"source":"input","comparison":"equals","values":["true"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1a8d74a3-4e50-4164-86c4-026942a13502","type":"Redirect","$title":"#faturaNet#clienteLogado","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#clienteLogado"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"41ca9d05-948b-4eb4-8d37-5e833b0570ef","type":"SetVariable","$title":"fluxoDcc","$invalid":false,"settings":{"value":"alterar","variable":"fluxoDcc"},"conditions":[]},{"$id":"cd1c8691-52f0-461d-a3d6-f1e053ce1d85","type":"SetVariable","$title":"cliente logado nao","$invalid":false,"settings":{"variable":"logado","value":"nao"},"conditions":[]},{"$id":"a805cc58-b41f-4b13-ab38-72c149aa1087","type":"SetVariable","$title":"cliente logado sim","$invalid":false,"settings":{"variable":"logado","value":"sim"},"conditions":[{"source":"input","comparison":"equals","values":["true"]}]},{"$id":"2fa0916a-848c-4969-aa88-c50e75e7894e","type":"TrackEvent","$title":"Validacao de cliente ja logado alterar debito","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao de cliente ja logado alterar debito","action":"{{logado}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"altera dados bancarios verif logado\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}},{"$id":"01f204a5-455a-48ab-8853-7cb80fa58066","type":"SetVariable","$title":"dccAttempts","$invalid":false,"settings":{"value":"0","variable":"dccAttempts"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-f60134c0-f1ef-4860-b7d9-f9df9e0872b2","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-c2c7c1a5-ac93-4190-8ec6-be339f699307","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-86b5eca0-600d-4f77-9d99-ce2e6c0dfac5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-678e6bad-4b3d-4f54-877a-73fdc4dafe65","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cee2a7d0-af8f-4357-b323-a852df6a45ff","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"332f5478-463c-42cd-9f3c-da92d2ffefc7","root":false,"$title":"[A.1.4.2.2.0] Altera dados bancarios verif logado","$position":{"top":"262px","left":"6708.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6c6c86ef-3eb8-4fc8-8b5d-4957f77a4d52":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9bac885b-3573-4c01-b7d8-3b7ae80b1628","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ce967266-c793-4e80-91ac-97bf3584d129","typeOfStateId":"state","$connId":"con_208","$id":"3001edcf-081a-4fc8-8b59-528fd2c59114","conditions":[{"source":"input","comparison":"equals","values":["true"]}],"$invalid":false},{"stateId":"1721c199-eecf-4ce4-a700-822d0b0d308a","typeOfStateId":"state","$connId":"con_213","$id":"f97dda0d-5c55-4582-b76c-013f423f95ea","conditions":[{"source":"input","comparison":"equals","values":["false"]}],"$invalid":false},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","typeOfStateId":"state","$connId":"con_218","$id":"ad5c3693-093a-4862-936e-5404ba0f7c71","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6097f8a9-74ea-493c-a7bb-0d74645d4247","type":"Redirect","$title":"#faturaNet#clienteLogado","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#clienteLogado"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"de07ffe8-16af-4f07-af1a-ee861ca1bb11","type":"SetVariable","$title":"fluxoDcc","$invalid":false,"settings":{"value":"cancelar","variable":"fluxoDcc"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"cancela dcc verif logado\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}},{"$id":"c77423e5-de59-4b02-8069-f455d3130554","type":"SetVariable","$title":"logado NAO","$invalid":false,"settings":{"value":"nao","variable":"logado"},"conditions":[]},{"$id":"c30b91ea-f9df-415e-87dd-3b1fc479d73d","type":"SetVariable","$title":"logado SIM","$invalid":false,"settings":{"variable":"logado","value":"sim"},"conditions":[{"source":"input","comparison":"equals","values":["true"]}]},{"$id":"7cc57d40-4d5d-414b-ab04-af5ed22fabd5","type":"TrackEvent","$title":"Validacao login cancelar dados debito","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao login cancelar dados debito","action":"{{logado}}"},"conditions":[]},{"$id":"257dffc1-96a4-42cf-864f-33639ae20ba7","type":"TrackEvent","$title":"Validacao retorno de login debito automatico cancelar","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao retorno de login debito automatico cancelar","action":"{{tokenPayload}}"},"conditions":[{"source":"input","comparison":"equals","values":["true"]},{"source":"context","comparison":"exists","values":[],"variable":"tokenPayload"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-50dcb299-9846-4aa0-810c-8739da4ab62e","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-219e854d-a2ea-49bc-bd11-b7a3848fa4e7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d32946a1-7af9-427c-88c7-39f13b988ffc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-22ee38bc-02ce-4e51-a791-86376097a7b2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0ab7230d-fba6-4fe7-9deb-5d5c23ddfbfd","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"6c6c86ef-3eb8-4fc8-8b5d-4957f77a4d52","root":false,"$title":"[A.1.4.2.3.0.0] Cancela DCC verif logado","$position":{"top":"258.667px","left":"6911.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"23e2724c-154c-48bd-9b8f-c9cafb346fb6":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"eddcf922-9eed-4399-9c39-4db293fedcda","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"eddcf922-9eed-4399-9c39-4db293fedcda","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"f5aecf26-1b70-4a1c-8001-bc3ef5958f98","type":"text/plain","content":"⚠️ Importante:\n\nDependendo do dia do fechamento da sua fatura, é possível que o débito automático só seja ativado para o próximo mês"},"$cardContent":{"document":{"id":"f5aecf26-1b70-4a1c-8001-bc3ef5958f98","type":"text/plain","content":"⚠️ Importante:\n\nDependendo do dia do fechamento da sua fatura, é possível que o débito automático só seja ativado para o próximo mês"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"06be8f73-d770-4b26-a3a3-4fd9d15562dc","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c34400fa-7e75-4be1-9866-0a3b460e363a","$connId":"con_223","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"edb338a9-dd8f-4c46-8db5-615fde1399a7","typeOfStateId":"state"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Login debito automatico net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Login debito automatico net exibicao","action":"Exibicao"},"conditions":[{"source":"context","comparison":"equals","variable":"isBusinessClient","values":["false"]}]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"login debito automatico\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-56fa189a-df73-45fe-8855-70026c8e25bc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-958ba354-9b2d-4309-b58f-58bab5efa3ff","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-89309cc3-a465-405c-ac46-1dd2ea169a4e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"23e2724c-154c-48bd-9b8f-c9cafb346fb6","root":false,"$title":"[A.1.4.2.1.1] Login Debito Automatico","$position":{"top":"691.444px","left":"5617.56px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0b282c77-fe04-464b-baa6-aa3ae2554c2f":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"742219b4-a12f-4ef3-92e6-eccc1c5501c2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"742219b4-a12f-4ef3-92e6-eccc1c5501c2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"1194b614-09b9-42f9-bb28-cd8b2a25610a","type":"text/plain","content":"⚠️ Importante:\nPara fazer o cadastro no débito automático, *é necessário que o titular da conta corrente seja o mesmo do contrato* conosco, caso contrário, não conseguimos fazer essa operação."},"$cardContent":{"document":{"id":"1194b614-09b9-42f9-bb28-cd8b2a25610a","type":"text/plain","content":"⚠️ Importante:\nPara fazer o cadastro no débito automático, *é necessário que o titular da conta corrente seja o mesmo do contrato* conosco, caso contrário, não conseguimos fazer essa operação."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"8217127f-efa8-4df6-8d25-bb381ed4604c","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mensagem cadastro debito automatico\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-f65f5f52-2807-44ef-9eb6-08816d817c77","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8d5b16b6-f5b9-4c36-ad0f-a67856c182ed","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0b282c77-fe04-464b-baa6-aa3ae2554c2f","root":false,"$title":"[A.1.4.2.1.2] Mensagem cadastro debito automatico","$position":{"top":"671px","left":"5928px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fc5bb3b7-0e81-4998-b17d-afc7307524ec":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"c28c31ad-2603-4e47-93dc-8db32bb8c71a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c28c31ad-2603-4e47-93dc-8db32bb8c71a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3adb14fb-f166-4eb0-a13d-905096b87e97","type":"text/plain","content":"Vou precisar pedir suas informações bancárias agora mas, não se preocupe, este é um canal oficial da Claro!\nPara ter certeza de que um canal no WhatsApp é oficial, basta conferir se possui este símbolo ✅ ao lado do nome oficial do contato."},"$cardContent":{"document":{"id":"3adb14fb-f166-4eb0-a13d-905096b87e97","type":"text/plain","content":"Vou precisar pedir suas informações bancárias agora mas, não se preocupe, este é um canal oficial da Claro!\nPara ter certeza de que um canal no WhatsApp é oficial, basta conferir se possui este símbolo ✅ ao lado do nome oficial do contato."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"af1b330d-6d45-4435-8ef4-ff104b96e626","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"af1b330d-6d45-4435-8ef4-ff104b96e626","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"67d88e8b-45e2-4a45-a474-38ddc1eb1637","type":"application/vnd.lime.media-link+json","content":{"title":"","text":"","type":"image/png","uri":"https://s3-sa-east-1.amazonaws.com/i.imgtake.takenet.com.br/i53ncrqs7n/i53ncrqs7n.png","aspectRatio":"2:1"}},"$cardContent":{"document":{"id":"67d88e8b-45e2-4a45-a474-38ddc1eb1637","type":"application/vnd.lime.media-link+json","content":{"title":"","text":"","type":"image/png","uri":"https://s3-sa-east-1.amazonaws.com/i.imgtake.takenet.com.br/i53ncrqs7n/i53ncrqs7n.png","aspectRatio":"2:1"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4b27ef4-f43d-4ae5-94bd-62ec1bd4ed31","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_228","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"bcc6f56f-f9f8-4ec1-9be7-4f79ba97c12f"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"canal oficial claro\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.4.2.1.1.1"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"75a8d48b-cb2c-49a7-b117-d235feff9bb7","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-cbc06547-b9f2-47bb-8015-3ae41d7f785d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-597d164d-9d06-4ad0-a752-eb29cabdad41","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-10bf7ccc-a4df-4e00-a501-1e4ef1ec6d4d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"fc5bb3b7-0e81-4998-b17d-afc7307524ec","root":false,"$title":"[A.1.4.2.1.1.1] Debito automatico cadastrado nao","$position":{"top":"1281.56px","left":"5634.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75a8d48b-cb2c-49a7-b117-d235feff9bb7":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"67c24fe6-0817-45ed-b550-89cd731a60a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"$cardContent":{"document":{"id":"67c24fe6-0817-45ed-b550-89cd731a60a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"6cdef690-1b4c-4a2f-82df-ebaf15f24976","type":"text/plain","content":"Selecione o seu banco:\n\n*1-* Itaú \n*2-* Banco do Brasil️\n*3-* Bradesco \n*4-* Caixa Econômica \n*5-* Santander \n*6-* Safra \n*7-* Ver mais bancos"},"$cardContent":{"document":{"id":"6cdef690-1b4c-4a2f-82df-ebaf15f24976","type":"text/plain","content":"Selecione o seu banco:\n\n*1-* Itaú \n*2-* Banco do Brasil️\n*3-* Bradesco \n*4-* Caixa Econômica \n*5-* Santander \n*6-* Safra \n*7-* Ver mais bancos"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"17cf6192-08f6-4ef4-98c2-4d43ca7ed030","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"77e2e7e8-fd7a-4dba-b103-3c89c3e306cb","$connId":"con_233","conditions":[{"source":"context","comparison":"equals","values":["7"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"b1c7438a-a8a2-450b-aed0-a09836455450"},{"stateId":"bf1caf46-a2e9-452e-a088-81e4c8ba5ef3","$connId":"con_238","conditions":[{"source":"context","comparison":"equals","values":["1","2","3","4","5","6"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"dd31fdd3-22d9-4b6d-af5c-bb28603d826c"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Retorno login debito automatico net cadastro origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Retorno login debito automatico net cadastro origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Retorno login debito automatico net cadastro exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Retorno login debito automatico net cadastro exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Choose Answer","$invalid":false,"settings":{"function":"run","source":"/**\nSelecione o seu banco:\n\n1- Itaú \n2- Banco do Brasil️\n3- Bradesco \n4- Caixa Econômica \n5- Santander \n6- Safra \n7- Ver mais bancos\n            **/\nfunction run(input) {\n    var firstRegex = new RegExp(\"((1)|(\\s*1\\s*)|(.*Ita[u|ú].*))$\", 'i');\n    if (firstRegex.test(input))\n        return { option: \"1\", content: \"Itau\" , codBanco:\"341\", nomeDoBanco:\"BANCO ITAU S.A\"}\n\n    var secondRegex = new RegExp(\"((2)|(\\s*2\\s*)|(.*Banco do brasil.*)|(.*brasil.*))$\", 'i');\n    if (secondRegex.test(input))\n        return { option: \"2\", content: \"Banco do Brasil\", codBanco:\"1\", nomeDoBanco:\"BANCO DO BRASIL S.A.\" };\n\n    var thirdRegex = new RegExp(\"((3)|(\\s*3\\s*)|(.*bradesco.*))$\", 'i');\n    if (thirdRegex.test(input))\n        return { option: \"3\", content: \"Bradesco\", codBanco:\"237\", nomeDoBanco:\"BANCO BRADESCO S.A.\" }\n\n    var fourthRegex = new RegExp(\"((4)|(\\s*4\\s*)|(.*caixa econ[o|ô]mica.*)|(.*caixa.*))$\", 'i');\n    if (fourthRegex.test(input))\n        return { option: \"4\", content: \"Caixa economica\", codBanco:\"104\", nomeDoBanco:\"CAIXA ECONOMICA FEDERAL\" };\n\n    var fithRegex = new RegExp(\"((5)|(\\s*5\\s*)|(.*Santander.*))$\", 'i');\n    if (fithRegex.test(input))\n        return { option: \"5\", content: \"Santander\", codBanco:\"33\", nomeDoBanco:\"BANCO SANTANDER\" }\n\n    var sixthRegex = new RegExp(\"((6)|(\\s*6\\s*)|(.*Safra.*))$\", 'i');\n    if (sixthRegex.test(input))\n        return { option: \"6\", content: \"Safra\", codBanco:\"422\", nomeDoBanco:\"BANCO SAFRA S/A\" };\n\n    var seventhRegex = new RegExp(\"((7)|(\\s*7\\s*)|(.*ver.*)|(.*mais.*)|(.*outros.*))$\", 'i');\n    if (seventhRegex.test(input))\n        return { option: \"7\", content: \"Ver mais bancos\" };\n\n    return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir Codigo Banco","$invalid":false,"settings":{"variable":"codBanco","value":"{{chooseAnswer@codBanco}}"},"conditions":[]},{"type":"SetVariable","$title":"Definir Nome do Banco","$invalid":false,"settings":{"variable":"nomeDoBanco","value":"{{chooseAnswer@nomeDoBanco}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"selectedBank","$invalid":false,"settings":{"variable":"selectedBank","value":"{{chooseAnswer@option}}"},"conditions":[]},{"type":"TrackEvent","$title":"Retorno login debito automatico net cadastro input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Retorno login debito automatico net cadastro input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"TrackEvent","$title":"Retorno login debito automatico net cadastro selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Retorno login debito automatico net cadastro selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - remover numeroDaConta","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return null;\n}","inputVariables":[],"outputVariable":"numeroDaConta","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - remover numeroDaAgencia","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return null;\n}","inputVariables":[],"outputVariable":"numeroDaAgencia","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"selecionar banco lista 1\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-6618742a-db36-439e-9765-cd52af231f43","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d9d6f63f-c08a-4d55-9898-25b329d6bc50","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b06f8efb-9884-497c-942c-81acefef3b9d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e9020ba5-036f-4a77-857a-13866da37bfa","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-1af9f3f5-d567-44c6-8db4-d8b1fd78ca26","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"75a8d48b-cb2c-49a7-b117-d235feff9bb7","root":false,"$title":"[A.1.4.2.1.1.1]Debito automatico cadastrado nao","$position":{"top":"1702.67px","left":"6399px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bf1caf46-a2e9-452e-a088-81e4c8ba5ef3":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"fdb2e243-b9aa-45f4-b8e2-6fd67f3aa37e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fdb2e243-b9aa-45f4-b8e2-6fd67f3aa37e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a08b7c85-ec8e-4ab6-a703-1eeb27051c85","type":"text/plain","content":"Me informa o número da sua *agência*:"},"$cardContent":{"document":{"id":"a08b7c85-ec8e-4ab6-a703-1eeb27051c85","type":"text/plain","content":"Me informa o número da sua *agência*:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c7327aac-2e9c-4501-98e7-fe589fe193d7","type":"text/plain","textContent":"Entrada do usuário","content":"numeroDaAgencia"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"numeroDaAgencia"},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_243","$id":"fba31a83-600e-42dc-84cd-446fc671802f","conditions":[{"source":"input","comparison":"matches","values":["(?i)(sair?)"]}],"$invalid":false},{"stateId":"11cf25aa-7dd5-439c-a9db-ff15f48d6a76","$connId":"con_248","conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"notExists","values":[],"variable":"numeroDaConta"}],"$invalid":false,"$id":"877b1dd8-ccce-4a7c-826c-ad80bbc9255d"},{"stateId":"6edd9aba-5818-48ec-a9e5-a97d7a6ffc5f","$connId":"con_253","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"numeroDaConta"}],"$invalid":false,"$id":"6301bf48-e1e2-42bc-90e7-ff8588249c66"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"agencia da\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-3e798579-7ef2-4478-963e-f1233eb378a7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cb09bbe1-c035-4deb-8ef4-0d7d75db15bf","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-5dfd623e-0365-4a72-a534-6c80621cf39e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bf1caf46-a2e9-452e-a088-81e4c8ba5ef3","root":false,"$title":"[A.1.4.2.1.1.1.1] Agencia DA","$position":{"top":"1863px","left":"6225px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"11cf25aa-7dd5-439c-a9db-ff15f48d6a76":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"8e5a348d-df87-41eb-9fd6-d57ed8652b88","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8e5a348d-df87-41eb-9fd6-d57ed8652b88","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"bc5fca98-3d5e-4854-b5b0-6a75065803fe","type":"text/plain","content":"Me informa o número da sua *conta*:"},"$cardContent":{"document":{"id":"bc5fca98-3d5e-4854-b5b0-6a75065803fe","type":"text/plain","content":"Me informa o número da sua *conta*:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a1489eb5-0650-4b4b-80a7-b4dd5cca1587","type":"text/plain","textContent":"Entrada do usuário","content":"numeroDaConta"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"numeroDaConta"},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_258","$id":"72ad9e6a-eb1a-458f-8f68-cbe2d18a8b54","conditions":[{"source":"input","comparison":"matches","values":["(?i)(sair?)"]}],"$invalid":false},{"stateId":"6edd9aba-5818-48ec-a9e5-a97d7a6ffc5f","$connId":"con_263","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"65fb6ac8-1976-4387-9242-dfff9df788ee"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"b04963c3-e011-4615-9e4a-8cf9bc18db1e","type":"ExecuteScript","$title":"conta","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n    try {\n        var conta = inputContent.split('-');\n        if (conta.length == 0 || conta.length > 2) {\n            return null;\n        }\n\n        if (conta.length == 1) {\n            return JSON.stringify({\n                numero: conta[0].substr(0, conta[0].length - 1),\n                digito: conta[0].substr(conta[0].length - 1, conta[0].length)\n            });\n        }\n\n        return JSON.stringify({\n            numero: conta[0],\n            digito: conta[1]\n        });\n    } catch (e) {\n        return null;\n    }\n\n}","inputVariables":["input.content"],"outputVariable":"conta","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"conta da\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-5b8c34ff-bd9e-4145-be8c-571e15fca5b4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9d5c3d1b-9fce-49dc-8a4f-6b668094118c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-a5b9a87b-9c18-498b-abaa-a1640ebbd8eb","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"11cf25aa-7dd5-439c-a9db-ff15f48d6a76","root":false,"$title":"[A.1.4.2.1.1.1.1.1] Conta DA","$position":{"top":"2030px","left":"6220px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6edd9aba-5818-48ec-a9e5-a97d7a6ffc5f":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"3524dc1e-041c-464c-bf0f-cf8a44e1328b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3524dc1e-041c-464c-bf0f-cf8a44e1328b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"17933f5f-9e5c-480a-8706-93f8f21bd4d6","type":"text/plain","content":"Confirma pra mim se os dados bancários estão corretos:\n\n*Agência: {{numeroDaAgencia}}*\n*Conta: {{conta@numero}}-{{conta@digito}}*\n\n*1-* Tudo certo, pode cadastrar!\n*2-* Corrigir o número da agência\n*3-* Corrigir o número da conta\n*4-* Sair","metadata":{}},"$cardContent":{"document":{"id":"17933f5f-9e5c-480a-8706-93f8f21bd4d6","type":"text/plain","content":"Confirma pra mim se os dados bancários estão corretos:\n\n*Agência: {{numeroDaAgencia}}*\n*Conta: {{conta@numero}}-{{conta@digito}}*\n\n*1-* Tudo certo, pode cadastrar!\n*2-* Corrigir o número da agência\n*3-* Corrigir o número da conta\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"d82cd942-3121-4739-84e0-f88ad3b8dd11","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"stateId":"1d072f34-9ce8-43ef-b3a9-8c710c85c89d","$connId":"con_268","$id":"31def94d-745f-43af-9dfc-bc4689e7fea7"},{"stateId":"bf1caf46-a2e9-452e-a088-81e4c8ba5ef3","$connId":"con_273","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"26fbdd53-0ac1-4fa0-98d4-2094bc6726d1"},{"stateId":"11cf25aa-7dd5-439c-a9db-ff15f48d6a76","$connId":"con_278","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"41248dda-412a-420e-a9f8-f5d4c63d6508"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_283","$id":"82143cf5-4baa-41cf-aa4c-20f8312290cd","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_288","conditions":[{"source":"context","comparison":"equals","values":["invalid"],"variable":"chooseAnswer@option"},{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"0c133472-1757-442b-9136-6b6b0ef7f01a"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Choose Answer","$invalid":false,"settings":{"function":"run","source":"/**\nConfirma pra mim se os dados bancários estão corretos:\n\n1- Tudo certo, pode cadastrar!\n2- Corrigir o número da agência\n3- Corrigir o número da conta\n            **/\nfunction run(input) {\n    var firstRegex = new RegExp(\"((1)|(\\s*1\\s*)|(.*pode.*)|(.*cadastrar.*)|(.*tudo certo.*)|(.*ok.*))$\", 'i');\n    if (firstRegex.test(input))\n        return { option: \"1\", content: \"Tudo certo, pode cadastrar!\" }\n\n    var secondRegex = new RegExp(\"((2)|(\\s*2\\s*)|(.*ag[e|ê]ncia.*))$\", 'i');\n    if (secondRegex.test(input))\n        return { option: \"2\", content: \"Corrigir o número da agência\" };\n\n    var thirdRegex = new RegExp(\"((3)|(\\s*3\\s*)|(.*conta.*))$\", 'i');\n    if (thirdRegex.test(input))\n        return { option: \"3\", content: \"Corrigir o número da conta\" };\n\n    var fourthRegex = new RegExp(\"((4)|(\\s*4\\s*)|(sair?))$\", 'i');\n    if (fourthRegex.test(input))\n        return { option: \"4\", content: \"Sair\" };\n     \n\n    return { option: \"invalid\", content: \"input inesperado\" };\n\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"confirmacao dados bancarios\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.4.2.1.1.1.1.1.1"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-ad4fcdf7-f8a2-4556-96eb-8c1a011ef9c3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f387e86b-ee49-44d4-a195-376631b61c10","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7af0bb8e-02a3-4163-b41e-20cceafee060","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-2984dcfd-18c7-429b-812d-c5ee4d3be438","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"6edd9aba-5818-48ec-a9e5-a97d7a6ffc5f","root":false,"$title":"[A.1.4.2.1.1.1.1.1.1] Confirmacao Dados Bancarios","$position":{"top":"2030px","left":"5996px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"369492f1-4368-4286-82e3-e4bd257cf2de":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"dcc2b512-e218-4a0e-b5f7-334edb05e807","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"dcc2b512-e218-4a0e-b5f7-334edb05e807","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"ddd03ce4-7ed5-42be-83a5-cadc7691f92b","type":"text/plain","content":"Pronto, a solicitação de débito automático foi enviada para o seu banco!"},"$cardContent":{"document":{"id":"ddd03ce4-7ed5-42be-83a5-cadc7691f92b","type":"text/plain","content":"Pronto, a solicitação de débito automático foi enviada para o seu banco!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"4ffd0ac1-1d7e-4105-8fd7-85f079e36dd2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"$cardContent":{"document":{"id":"4ffd0ac1-1d7e-4105-8fd7-85f079e36dd2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"ae2af4e9-60b2-4054-bce0-cbe73f9dc323","type":"text/plain","content":"Lembrando que o banco sempre checa as informações cadastrais antes de aprovar tudo.\nSe houver diferença entre o CPF do titular da conta bancária e do contrato conosco, essa operação não será autorizada!"},"$cardContent":{"document":{"id":"ae2af4e9-60b2-4054-bce0-cbe73f9dc323","type":"text/plain","content":"Lembrando que o banco sempre checa as informações cadastrais antes de aprovar tudo.\nSe houver diferença entre o CPF do titular da conta bancária e do contrato conosco, essa operação não será autorizada!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3786eeb0-c271-43b9-aed2-7bef8fd8eb63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"$cardContent":{"document":{"id":"3786eeb0-c271-43b9-aed2-7bef8fd8eb63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"05887798-9974-43b7-8786-e7f44dbc9f40","type":"text/plain","content":"Não esqueça de acompanhar o débito em conta da sua próxima fatura para ter certeza que deu tudo certo 😉"},"$cardContent":{"document":{"id":"05887798-9974-43b7-8786-e7f44dbc9f40","type":"text/plain","content":"Não esqueça de acompanhar o débito em conta da sua próxima fatura para ter certeza que deu tudo certo 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c8a152eb-9a3b-426f-86c7-2d024aac181f","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2002fa9d-f0a4-44d6-ad35-7c84f3b4d222","$connId":"con_293","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"1ba034f2-a2fd-46e3-bd25-5106429166b1"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"debito automatico alterado\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-51c30384-61a4-46e9-a4b5-3e87486accb1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a7d25f9f-a2cf-461e-bace-b222dc2650b8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"369492f1-4368-4286-82e3-e4bd257cf2de","root":false,"$title":"[A.1.4.2.1.1.1.1.1.1.1] Debido Alterado Outros","$position":{"top":"2043px","left":"5539px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"77e2e7e8-fd7a-4dba-b103-3c89c3e306cb":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"15943491-6233-4dd2-81a6-0a1d2f7f531c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"15943491-6233-4dd2-81a6-0a1d2f7f531c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d11453c5-14e7-40cf-a9e8-4e6d309a550d","type":"text/plain","content":"Selecione o seu banco:\n\n*1-* Citibank\n*2-* Banrisul\n*3-* Banpará \n*4-* Mercantil do Brasil\n*5-* Banese \n*6-* Banestes\n*7-* Voltar ao Menu anterior"},"$cardContent":{"document":{"id":"d11453c5-14e7-40cf-a9e8-4e6d309a550d","type":"text/plain","content":"Selecione o seu banco:\n\n*1-* Citibank\n*2-* Banrisul\n*3-* Banpará \n*4-* Mercantil do Brasil\n*5-* Banese \n*6-* Banestes\n*7-* Voltar ao Menu anterior"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"0435aa21-fa35-4c03-8f69-a14cdbfdd8e1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bf1caf46-a2e9-452e-a088-81e4c8ba5ef3","$connId":"con_298","conditions":[{"source":"context","comparison":"equals","values":["1","2","3","4","5","6"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"2cb3934a-cbc1-4528-9c47-57bc3ed99d12"},{"stateId":"75a8d48b-cb2c-49a7-b117-d235feff9bb7","$connId":"con_303","conditions":[{"source":"context","comparison":"equals","values":["7"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"06ca79bd-6d23-492a-86f0-98f06345c5ad"},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_308","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"d451bfd2-4a2c-426d-bdbd-e091cc9ad409"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Retorno login debito automatico net cadastro origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Retorno login debito automatico net cadastro origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Retorno login debito automatico net cadastro exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Retorno login debito automatico net cadastro exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Choose Answer","$invalid":false,"settings":{"function":"run","source":"/**\nSelecione o seu banco:\n\n1- Citibank\n2- Banrisul\n3- Banpará \n4- Mercantil do Brasil\n5- Banese \n6- Banestes\n7- Voltar ao Menu anterior\n            **/\nfunction run(input) {\n    var firstRegex = new RegExp(\"((1)|(\\s*1\\s*)|(.*citibank.*))$\", 'i');\n    if (firstRegex.test(input))\n        return { option: \"1\", content: \"Citibank\", codBanco:\"745\", nomeDoBanco:\"CITIBANK\" }\n\n    var secondRegex = new RegExp(\"((2)|(\\s*2\\s*)|(.*banrisul.*))$\", 'i');\n    if (secondRegex.test(input))\n        return { option: \"2\", content: \"Banrisul\", codBanco:\"41\", nomeDoBanco:\"BANRISUL\" };\n\n    var thirdRegex = new RegExp(\"((3)|(\\s*3\\s*)|(.*banpar[a|á].*))$\", 'i');\n    if (thirdRegex.test(input))\n        return { option: \"3\", content: \"Banpará\", codBanco:\"37\", nomeDoBanco:\"BANCO DO ESTADO DO PARA\" }\n\n    var fourthRegex = new RegExp(\"((4)|(\\s*4\\s*)|(.*mercantil.*))$\", 'i');\n    if (fourthRegex.test(input))\n        return { option: \"4\", content: \"Mercantil do Brasil\", codBanco:\"389\", nomeDoBanco:\"BANCO MERCANTIL DO BRASIL S.A.\" };\n\n    var fithRegex = new RegExp(\"((5)|(\\s*5\\s*)|(.*Banese.*))$\", 'i');\n    if (fithRegex.test(input))\n        return { option: \"5\", content: \"Banese\", codBanco:\"47\", nomeDoBanco:\"BANESE\" }\n\n    var sixthRegex = new RegExp(\"((6)|(\\s*6\\s*)|(.*Banestes.*))$\", 'i');\n    if (sixthRegex.test(input))\n        return { option: \"6\", content: \"Banestes\", codBanco:\"21\", nomeDoBanco:\"BANESTES S/A\" };\n\n    var seventhRegex = new RegExp(\"((7)|(\\s*7\\s*)|(.*voltar.*)|(.*menu.*)|(.*anterior.*)|(.*sair.*))$\", 'i');\n    if (seventhRegex.test(input))\n        return { option: \"7\", content: \"Voltar ao Menu anterior\" };\n\n    return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir Codigo Banco","$invalid":false,"settings":{"variable":"codBanco","value":"{{chooseAnswer@codBanco}}"},"conditions":[]},{"type":"SetVariable","$title":"Definir NOME DO BANCO","$invalid":false,"settings":{"variable":"nomeDoBanco","value":"{{chooseAnswer@nomeDoBanco}}"},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.4.2.1.1.1.2"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Retorno login debito automatico net cadastro selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Retorno login debito automatico net cadastro selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Retorno login debito automatico net cadastro input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Retorno login debito automatico net cadastro input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"selecionar banco lista 2\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-dc0a567e-f75e-47aa-b27e-1462d93b4999","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-82af1619-a550-4e19-b271-423d4cd4cf20","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-12245984-00cb-4160-a36d-a5112c621d5e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b7a85c21-9f2b-40e6-8027-096582ef9a63","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-aa031b83-88e3-4b8b-85ed-c921e6623784","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"77e2e7e8-fd7a-4dba-b103-3c89c3e306cb","root":false,"$title":"[A.1.4.2.1.1.1.1] Debito automatic cadast nao mais","$position":{"top":"1899px","left":"6584px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"349b8147-05a1-4301-aab5-2702abd6a295":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"82237055-335c-44bd-8690-04ca6cfcb555","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"82237055-335c-44bd-8690-04ca6cfcb555","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"45fa7021-a22b-425d-a094-59529999fc21","type":"text/plain","content":"Identifiquei que você ainda não possui cadastro na fatura digital.\nFazendo o cadastro, você passa a receber *sua fatura, todo mês, direto no seu e-mail!*"},"$cardContent":{"document":{"id":"45fa7021-a22b-425d-a094-59529999fc21","type":"text/plain","content":"Identifiquei que você ainda não possui cadastro na fatura digital.\nFazendo o cadastro, você passa a receber *sua fatura, todo mês, direto no seu e-mail!*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"5045c1a5-08c4-4f8e-bbf7-cc2bf229f368","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5045c1a5-08c4-4f8e-bbf7-cc2bf229f368","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3cfa1193-e1c1-44f8-a34f-7ed0dcab62d1","type":"text/plain","content":"Lembrando que, ao cadastrar a fatura digital, você *deixa de receber a fatura pelos correios*"},"$cardContent":{"document":{"id":"3cfa1193-e1c1-44f8-a34f-7ed0dcab62d1","type":"text/plain","content":"Lembrando que, ao cadastrar a fatura digital, você *deixa de receber a fatura pelos correios*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"10df4b70-3fdc-41a6-bd4a-9076fda1de4f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"10df4b70-3fdc-41a6-bd4a-9076fda1de4f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"ad016d9b-374f-454b-97a5-111fc29043ac","type":"text/plain","content":"Vamos fazer o cadastro?\n\n*1-* Sim\n*2-* Agora não"},"$cardContent":{"document":{"id":"ad016d9b-374f-454b-97a5-111fc29043ac","type":"text/plain","content":"Vamos fazer o cadastro?\n\n*1-* Sim\n*2-* Agora não"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"08b581cc-d03d-40d7-bcd4-aa3d655b52ac","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0cfaf197-5b33-44a7-bc9a-7c6d961334ed","$connId":"con_313","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"add35fe3-8165-447f-a1ec-05f59c4e47ec"},{"stateId":"7be0dffc-e309-4793-9ef0-45263746501f","$connId":"con_318","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"96dca8a8-1d29-45e6-85d9-44ccc6426800"},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_323","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"confirmationCounter"}],"$invalid":false,"$id":"853b482a-9ce5-4354-a8ab-e219cd0d0353"}],"$enteringCustomActions":[{"type":"SetVariable","$title":"seta origem troca forma de envio","$invalid":false,"settings":{"variable":"origem","value":"TrocaFormaEnvio"},"conditions":[]},{"type":"TrackEvent","$title":"sem fatura digital net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"sem fatura digital net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar Script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    var  firstRegex  = /^\\s*((1\\s*-?\\s*|1|um|primeir[oa])|((1\\s*-?\\s*)?sim[,.]?(\\s*quero)?)|(quero(\\s*sim)?))\\s*$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Sim\"};\n    var secondRegex = /^\\s*((2\\s*-?\\s*|2|dois|segund[oa])|((2\\s*-?\\s*)?(agora\\s*)?n[aã]o(\\s*quero)?))\\s*$/i;\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Nao\"}\n    return {option:\"invalid\", content:\"input inesperado\"};\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"sem fatura digital net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"action":"{{chooseAnswer@content}}","category":"sem fatura digital net selecao"},"conditions":[]},{"type":"TrackEvent","$title":"sem fatura digital net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"sem fatura digital net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"sem fatura digital net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.3.2.1.1"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-17e82893-cb63-4dcf-b320-dfb39a4fcce9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a54e2ec1-96bd-4503-a020-875b52530bb3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bfe8a8d8-bc76-44d4-be0c-2460a72dbdca","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-56a6de16-03c3-492e-af4c-5db29413225d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-97b4a0e1-8fbc-443a-af15-179e74abb09c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"349b8147-05a1-4301-aab5-2702abd6a295","root":false,"$title":"[A.1.3.2.1.1] sem fatura digital net","$position":{"top":"1061.25px","left":"3404px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0cfaf197-5b33-44a7-bc9a-7c6d961334ed":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"94fab24f-34f6-41a1-b322-80b21cc8ec0d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"94fab24f-34f6-41a1-b322-80b21cc8ec0d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"6759c204-52fb-4cff-a984-a1d23c321929","type":"text/plain","content":"Ótima escolha, a fatura digital é uma opção super prática! 😊"},"$cardContent":{"document":{"id":"6759c204-52fb-4cff-a984-a1d23c321929","type":"text/plain","content":"Ótima escolha, a fatura digital é uma opção super prática! 😊"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"49015a30-9416-4759-b903-982c6631a31d","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"90bef3f0-3496-44ff-a5aa-28d4ff1d3ff8","$connId":"con_328","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"1c9aa367-9dd5-43f6-bf49-6385357a40fb"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"cadastro fatura digital net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"cadastro fatura digital net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"cadastro fatura digital net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"90bef3f0-3496-44ff-a5aa-28d4ff1d3ff8","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-ce8e90d7-4640-4be1-99cb-35530704dc3d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-24a8e518-5398-47ef-8f5a-3d066db448ac","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b417bb6a-3c03-42a6-b6b0-2765c2bcd451","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0cfaf197-5b33-44a7-bc9a-7c6d961334ed","root":false,"$title":"[A.1.3.2.1.1.1] cadastro fatura digital net","$position":{"top":"1216px","left":"3157px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"90bef3f0-3496-44ff-a5aa-28d4ff1d3ff8":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"a8e16e97-6b11-486a-84de-de01b2ec3b95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a8e16e97-6b11-486a-84de-de01b2ec3b95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"9b503da3-74e5-4097-84c8-ca1eea13a66e","type":"text/plain","content":"Digita o e-mail que você quer cadastrar para receber sua fatura todo mês:"},"$cardContent":{"document":{"id":"9b503da3-74e5-4097-84c8-ca1eea13a66e","type":"text/plain","content":"Digita o e-mail que você quer cadastrar para receber sua fatura todo mês:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a001974a-0942-44d6-95a8-f984b6ac4413","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c292aac2-0bdd-4612-944a-31331fc66e64","$connId":"con_333","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isEmailValido"}],"$invalid":false,"$id":"ed00102e-e538-432f-84f8-6b1882acd2b3"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Script - Valida Email","$invalid":false,"settings":{"function":"run","source":"function run(input) \n{\n    return (/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(input))\n}\n","inputVariables":["input.content"],"outputVariable":"isEmailValido","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"emailNovo= INPUT.CONTENT","$invalid":false,"settings":{"variable":"emailNovo","value":"{{input.content}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}\n\t","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"cadastro fatura digital net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"cadastro fatura digital net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"TrackEvent","$title":"cadastro fatura digital net validacao - valido","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"cadastro fatura digital net validacao","action":"email correto"},"conditions":[{"source":"context","comparison":"equals","variable":"isEmailValido","values":["true"]}]},{"type":"TrackEvent","$title":"cadastro fatura digital net validacao - invalido","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"action":"email invalido","category":"cadastro fatura digital net validacao"},"conditions":[{"source":"context","comparison":"equals","variable":"isEmailValido","values":["false"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"Digita o e-mail cadastro\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e03ee77e-b110-48b9-a807-f9b32a10e2b6","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-52970b9c-6412-492a-8051-5e923fc82a2d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9a8c1114-2fd9-4dee-a6ed-0250bcb372e2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-385bba7a-73bd-4cf0-8341-b47d75e9ddb9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-602cb4ba-3ba9-4a9d-9cad-c631d4678105","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-9365c52a-8362-46e5-803b-bf3227883ab3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"90bef3f0-3496-44ff-a5aa-28d4ff1d3ff8","root":false,"$title":"[A.1.3.2.1.1.1.1] Digita o e-mail cadastro","$position":{"top":"1381px","left":"3079px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c292aac2-0bdd-4612-944a-31331fc66e64":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"21c40c76-36a3-43d6-b90e-e40ed5b50b41","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"21c40c76-36a3-43d6-b90e-e40ed5b50b41","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"186988ad-f357-45f7-926e-07e2a49a8990","type":"text/plain","content":"Ok, agora confirma pra mim se eu entendi certo, seu e-mail é:\n\n{{emailNovo}}\n\n*1-* O e-mail está certo\n*2-* Preciso alterar o e-mail\n"},"$cardContent":{"document":{"id":"186988ad-f357-45f7-926e-07e2a49a8990","type":"text/plain","content":"Ok, agora confirma pra mim se eu entendi certo, seu e-mail é:\n\n{{emailNovo}}\n\n*1-* O e-mail está certo\n*2-* Preciso alterar o e-mail\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"408dba50-d5aa-4b79-9606-18cbad1787f1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f4cf9bb4-b1dd-411d-ad65-88551bcb0bc8","$connId":"con_338","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"781ac9b4-37b8-4566-9a58-7c9c5f57ce5e"},{"stateId":"90bef3f0-3496-44ff-a5aa-28d4ff1d3ff8","$connId":"con_343","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"90164ff9-53fe-4148-8398-ec88c62eb804"},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_348","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"ae6953b4-ecb4-4cd9-9fff-de7872b05002"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Confirmacao cadastro fatura digital net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Confirmacao cadastro fatura digital net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    var firstRegex = /^((1)|(\\s*1\\s*)|(um)|(primeir[ao])|((1\\s*-?\\s*)?(o?\\s*e-?mail\\s*est[aá])?\\s*certo))$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"O e-mail está certo\"}\n\n    var secondRegex = /^((2)|(\\s*2\\s*)|(dois)|(segund[ao])|((2\\s*-?\\s*)?preciso\\s*alterar\\s*(o?\\s*e-?mail)?))$/i;\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Preciso alterar o e-mail\"};\n \n    return {option:\"invalid\", content:\"input inesperado\"};\n    \n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Confirmacao cadastro fatura digital net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Confirmacao cadastro fatura digital net selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Confirmacao cadastro fatura digital net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Confirmacao cadastro fatura digital net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"confirmacao cadastro fatura\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.3.2.1.1.1.1.3"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-24f761b1-107d-42e2-bfa1-22e91353b744","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-63a44d8c-d2e2-4d68-ac01-901cdc4d20e6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f1e6a851-d996-44f5-bf90-17335d9635bc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-10f274f6-5bc8-45ad-b7c4-1464c8bf6c9e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-9c9b8baf-4a92-4f1e-b2e1-079bd140ed64","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c292aac2-0bdd-4612-944a-31331fc66e64","root":false,"$title":"[A.1.3.2.1.1.1.1.3] Confirmacao cadastro fatura","$position":{"top":"1476.33px","left":"3301.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e03ee77e-b110-48b9-a807-f9b32a10e2b6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2edf6c5a-5275-41fa-b13d-71e6b0079694","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"31c79186-3618-4c3d-b039-db8b77e7981e","$connId":"con_353","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"25e110d7-05a2-46b1-916d-d9b5e8d5cfec"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executa Script - Encode Input Content","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n    return encodeURI(inputContent.trim());\n}","inputVariables":["input.content"],"outputVariable":"encodedInput","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessHttp","$title":"Process \"smalltalksBody\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"{{config.smalltalksApiUrl}}/analysis?checkDate=false&infoLevel=3&text={{encodedInput}}","responseStatusVariable":"smalltalksStatus","responseBodyVariable":"smalltalksBody"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Check If Has Small talk","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(smalltalksBody) {\n                try{\n                    var smallTalks = JSON.parse(smalltalksBody)\n                    if(smallTalks.analysis.matchesCount || smallTalks.analysis.cursed) return true\n                    return false\n                }\n                catch(e){\n                    return false\n                }\n            }","inputVariables":["smalltalksBody"],"outputVariable":"isSmallTalk","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"28e740a9-bb1a-49c4-80b4-809ee56afc1f","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.smalltalksApiUrl}}/analysis?checkDate=false&infoLevel=3&text={{encodedInput}}';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Validar Small Talks ou NLP fatura\",\n            status: status,\n            response: response,\n            request: {\n                url: url,\n                encodedInput: \"{{encodedInput}}\"\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["smalltalksStatus","smalltalksBody"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"smalltalksStatus","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"31c79186-3618-4c3d-b039-db8b77e7981e","$invalid":false},"$tags":[{"id":"blip-tag-23659a99-b074-41ef-b051-bc0537a27052","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c53acbc7-b545-4e17-be4b-fbbcbec28467","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"e03ee77e-b110-48b9-a807-f9b32a10e2b6","root":false,"$title":"Validar Small Talks ou NLP fatura","$position":{"top":"1497.57px","left":"2884.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"31c79186-3618-4c3d-b039-db8b77e7981e":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"6b5f4df4-ac47-4a78-983e-fdc547156c44","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6b5f4df4-ac47-4a78-983e-fdc547156c44","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"8b243e4c-3acd-46cb-8214-b8d96c05a5c9","type":"text/plain","content":"O que você digitou não corresponde a um e-mail válido, tenta novamente, por favor:"},"$cardContent":{"document":{"id":"8b243e4c-3acd-46cb-8214-b8d96c05a5c9","type":"text/plain","content":"O que você digitou não corresponde a um e-mail válido, tenta novamente, por favor:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"bb9048e7-fd21-474a-9e94-052dd3e2690e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c292aac2-0bdd-4612-944a-31331fc66e64","$connId":"con_358","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isEmailValido"}],"$invalid":false,"$id":"dc647095-af66-437c-86e2-7b9e7f0c3280"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar Script - Valida Email","$invalid":false,"settings":{"function":"run","source":"function run(input) \n{\n    return (/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(input))\n}","inputVariables":["input.content"],"outputVariable":"isEmailValido","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"emailNovo= INPUT.CONTENT","$invalid":false,"settings":{"variable":"emailNovo","value":"{{input.content}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"validar email pela segunda vez\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e03ee77e-b110-48b9-a807-f9b32a10e2b6","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-a21abb35-da02-40d4-9bfc-ea56c55e5d88","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-00ef380f-bbc5-4f65-a999-9a10308ed84c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5b54ccfe-9405-4b5e-afa6-3f63b034a8b1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-39c84ecd-07e0-4a41-a6c3-c943259da8d8","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"31c79186-3618-4c3d-b039-db8b77e7981e","root":false,"$title":"[A.1.3.2.1.1.1.1.2] Validar email pela segunda vez","$position":{"top":"1620.14px","left":"2726.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f4cf9bb4-b1dd-411d-ad65-88551bcb0bc8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"191e9ba6-ecd5-4ed5-a546-879087fea4e0","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"987a8d46-f09b-424a-82ae-44d152fa545d","$connId":"con_363","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"respHabilitarFatura"}],"$invalid":false,"$id":"4f707f36-7167-4f53-b43a-f90173ca464d"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"cadastro Fatura Digital","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"PUT","uri":"{{config.apiUrl}}/v1/intermediate/AccountManagement/billing-datas","responseStatusVariable":"respHabilitarFatura","responseBodyVariable":"respBodyHabilitarFatura","body":"{\n    \"AccessToken\": \"{{tokenAccessFormated}}\",\n    \"Document\": \"{{tokenPayload@cpf}}\",\n    \"ContractNumber\": \"{{tokenPayload@contrato}}\",\n    \"OperatorCode\": \"{{tokenPayload@codigoOperadora}}\",\n    \"data\": {\n        \"isEmail\": true,\n        \"email\": \"{{emailNovo}}\"\n    }\n}"},"conditions":[],"$id":"b37dc343-de68-4a10-b527-c6046b499493"},{"type":"SetVariable","$title":"set numero de protocolo","$invalid":false,"settings":{"variable":"nrprotocolo","value":"{{respBodyHabilitarFatura@data.number}}"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - encoded habilitarFatura","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return encodeURI(input)\n            }","inputVariables":["respBodyHabilitarFatura"],"outputVariable":"respBodyHabilitarFaturaEncoded","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"respHabilitarFatura","values":["200"]}]},{"$id":"e3110db0-0fdf-4f9f-a572-5ed741fa5971","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/AccountManagement/billing-datas';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Cadastra Fatura Digital e Altera Email Cadastro\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["respHabilitarFatura","respBodyHabilitarFatura"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"respHabilitarFatura","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$invalid":false},"$tags":[{"id":"blip-tag-db2f98e8-3f7c-4470-81e0-194b2a67a20c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-88305cbf-eb75-467e-bef4-283f6ddf81dd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3088a423-af79-4f01-8c11-88c9adb8daff","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"f4cf9bb4-b1dd-411d-ad65-88551bcb0bc8","root":false,"$title":"Cadastra Fatura Digital e Altera Email Cadastro","$position":{"top":"1652.67px","left":"3300px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"987a8d46-f09b-424a-82ae-44d152fa545d":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"cb8f42fe-d8b3-4b9a-b7bb-53fe61ccb4c0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cb8f42fe-d8b3-4b9a-b7bb-53fe61ccb4c0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"555f5663-6985-4412-b243-a07e16df0370","type":"text/plain","content":"Prontinho, agora você vai receber sua fatura todo mês no e-mail cadastrado\nParabéns pela sua escolha, o meio ambiente agradece! 🌳"},"$cardContent":{"document":{"id":"555f5663-6985-4412-b243-a07e16df0370","type":"text/plain","content":"Prontinho, agora você vai receber sua fatura todo mês no e-mail cadastrado\nParabéns pela sua escolha, o meio ambiente agradece! 🌳"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"980ceff8-aaca-40d0-b9a5-ccb099292060","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"980ceff8-aaca-40d0-b9a5-ccb099292060","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"34bb69e0-e89f-41a7-bc2a-1e574008a8c6","type":"text/plain","content":"{{msgRetornoProtocolo}}","metadata":{}},"$cardContent":{"document":{"id":"34bb69e0-e89f-41a7-bc2a-1e574008a8c6","type":"text/plain","content":"{{msgRetornoProtocolo}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c51e1455-6b0f-42be-8443-9d19584b8ec9","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_368","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"2d5175a5-3122-49aa-945e-b37a2e330a80"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Defini mensagem","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(inputVariable) {\n                return \"O número do seu protocolo para esta solicitação é:\\n {{nrprotocolo}}\";\n           }","inputVariables":[],"outputVariable":"msgRetornoProtocolo","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Confirmacao cadastro fatura digital sucesso exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Confirmacao cadastro fatura digital sucesso exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"exibe protocolo\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-bc468733-3660-49d6-86e9-7ebae5b7bb9b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a109a3e3-744b-4e1f-9355-5dddfcd452af","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f7c9f4d8-3c0a-4f83-809a-01a64e08afe8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"987a8d46-f09b-424a-82ae-44d152fa545d","root":false,"$title":"[A.1.3.2.1.1.1.1.3.1] Exibe Protocolo","$position":{"top":"1813px","left":"2998px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7be0dffc-e309-4793-9ef0-45263746501f":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"ad9f0985-2bfb-4ec5-a6f1-32f5e848d377","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ad9f0985-2bfb-4ec5-a6f1-32f5e848d377","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"be185f8b-919f-4217-beb0-c456cf62ce50","type":"text/plain","content":"Ok, se você mudar de ideia, já sabe que pode contar comigo! 😉"},"$cardContent":{"document":{"id":"be185f8b-919f-4217-beb0-c456cf62ce50","type":"text/plain","content":"Ok, se você mudar de ideia, já sabe que pode contar comigo! 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"bc6c2e82-78c3-4593-8e23-8d2b9454400d","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mensagem pode contar comigo\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-6ce21f6a-15e2-4302-a59e-d9dcaa15a945","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4495e5dd-688b-4aa9-b675-21c739d0c86d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7be0dffc-e309-4793-9ef0-45263746501f","root":false,"$title":"[A.1.3.2.1.1.2] Mensagem pode contar comigo","$position":{"top":"1220px","left":"3540px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"57fea87f-de6d-4e71-af4c-ce1bb5799003":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"ad3f1b93-e537-4e8a-ace4-38f77df6f182","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ad3f1b93-e537-4e8a-ace4-38f77df6f182","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"de2a1ac2-1a5c-4446-936a-614afa36c04f","type":"text/plain","content":"Identifiquei que você já possui cadastro na fatura digital, como eu posso te ajudar?\n\n*1-* Não estou recebendo a fatura\n*2-* Quero alterar o e-mail cadastrado\n*3-* Quero cancelar o cadastro"},"$cardContent":{"document":{"id":"de2a1ac2-1a5c-4446-936a-614afa36c04f","type":"text/plain","content":"Identifiquei que você já possui cadastro na fatura digital, como eu posso te ajudar?\n\n*1-* Não estou recebendo a fatura\n*2-* Quero alterar o e-mail cadastrado\n*3-* Quero cancelar o cadastro"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"6c120936-1781-405f-8303-6837ff193989","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ebbca9da-9b54-4a9d-beaa-ffe984336d84","$connId":"con_373","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"26c6059b-cf1f-44e4-8114-a3c34f4b85b3"},{"conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"stateId":"511dc13d-d1e2-40de-9754-1e8871cd29dd","$connId":"con_378","$id":"92715b10-7b3b-442e-8baa-65ad3992753a"},{"conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"stateId":"dbcf710c-9513-43a3-8299-c9f9b8a113ea","$connId":"con_383","$id":"3fc4e8dd-9ecc-473f-9ffa-6ab5f0f8f427"}],"$enteringCustomActions":[{"type":"SetVariable","$title":"Definir variável TrocaOrigemEnvio","$invalid":false,"settings":{"variable":"origem","value":"TrocaOrigemEnvio"},"conditions":[]},{"type":"TrackEvent","$title":"com fatura digital net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"com fatura digital net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar Script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/*\nIdentifiquei que você já possui cadastro na fatura digital, como eu posso te ajudar?\n\n1- Não estou recebendo a fatura\n2- Quero alterar o e-mail cadastrado\n3- Quero cancelar o cadastro\n\n */\nfunction run(input) {\n    var firstRegex = /^((1)|(um)|(primeira)|(n[aã]o estou recebendo)|(n[aã]o estou recebendo a fatura)|(n[aã]o estou recebendo fatura))$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Nao estou recebendo a fatura\"}\n\n    var secondRegex = /^((2)|(dois)|(segunda)|(alterar)|(cadastrado)|(quero alterar email)|(quero alterar o e-mail cadastrado)|(quero alterar o email cadastrado))$/i;\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Quero alterar o e-mail cadastrado\"};\n       \n    var thirdRegex = /^((3)|(\\s*3\\s*)|(três)|(terceira)|(cancelar)|(quero cancelar o cadastro)|(cancelar cadastro))$/i;\n    if (thirdRegex.test(input))\n        return {option:\"3\", content:\"Quero cancelar o cadastro\"};\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n    \n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"com fatura digital net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"com fatura digital net selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"com fatura digital net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"com fatura digital net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"com fatura digital net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-598b8ee6-4d0f-49d1-9db8-71665314ab29","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-0e1bd4b5-53ca-45fb-9179-0f98be300359","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6c638a35-19d8-4043-ad43-527ce371659e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3bfa514a-63a4-4fbb-9575-209552bdfdca","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-44a00c28-fc77-4b55-ab0b-9b6fbf4364e8","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"57fea87f-de6d-4e71-af4c-ce1bb5799003","root":false,"$title":"[A.1.3.2.1.2] com fatura digital net","$position":{"top":"1056.5px","left":"4230px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ebbca9da-9b54-4a9d-beaa-ffe984336d84":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"4dc37a22-1017-4353-9932-8af5a437506a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4dc37a22-1017-4353-9932-8af5a437506a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"2f39894e-b04b-444f-a0fc-f630773a7aa4","type":"text/plain","content":"Confirma pra mim se o e-mail que eu tenho aqui no seu cadastro está correto:\n\n{{getRespostaFaturasPorCodigo@data.email}}\n\n*1-* Está correto\n*2-* Preciso alterar","metadata":{}},"$cardContent":{"document":{"id":"2f39894e-b04b-444f-a0fc-f630773a7aa4","type":"text/plain","content":"Confirma pra mim se o e-mail que eu tenho aqui no seu cadastro está correto:\n\n{{getRespostaFaturasPorCodigo@data.email}}\n\n*1-* Está correto\n*2-* Preciso alterar"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c6787ce1-9f1e-4193-9593-f777fc486e1d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6b853631-c790-462f-b2fb-dd6c3414b920","$connId":"con_388","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"dd97a5dd-9f7a-485d-8fd4-b77594f279d9"},{"stateId":"1586dfa3-8ebe-4ca0-b854-7681a890d3eb","$connId":"con_393","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"9b5f455b-fd02-446a-9e23-bc88e183e2c8"},{"stateId":"c292aac2-0bdd-4612-944a-31331fc66e64","$connId":"con_398","conditions":[{"source":"input","comparison":"matches","values":["(?i)([a-z0-9.]+@[a-z0-9]+\\.[a-z]+.[a-z]*)"]}],"$invalid":false,"$id":"b5ec3813-d540-48b8-9b4b-711f473ef183"},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_403","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"04b7784d-0a21-4e2a-969d-1ed56a3e971a"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"sem receber fatura digital net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"sem receber fatura digital net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\nfunction run(input) {\n    var firstRegex = /((1)|(\\s*1\\s*)|((\\s*1\\s*-?\\s*)?(est[aá])?\\s*correto\\s*))$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Sim\"}\n\n    var secondRegex = /((2)|(\\s*2\\s*)|(dois)|(segund[ao])|((\\s*2\\s*-?\\s*)?preciso\\s*alterar))$/i;\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Nao\"};\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n    \n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"sem receber fatura digital net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"sem receber fatura digital net selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"sem receber fatura digital net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"sem receber fatura digital net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"sem receber fatura digital net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.3.2.1.2.1"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - emailNovo","$invalid":false,"settings":{"variable":"emailNovo","value":"{{input.content}}"},"conditions":[{"source":"input","comparison":"matches","values":["(?i)([a-z0-9.]+@[a-z0-9]+\\.[a-z]+.[a-z]*)"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-d1f1b97a-3eee-45b7-879b-cee485eee473","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-441e6d74-c046-47bc-b14e-bc932979d15b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ebf785b1-9e7d-4ba5-931f-0f03b6250f49","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4a3b120c-959d-470a-9688-d03b2fb98612","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-16ae8d66-ba36-4e1c-a054-cc1f5812cea8","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"ebbca9da-9b54-4a9d-beaa-ffe984336d84","root":false,"$title":"[A.1.3.2.1.2.1] sem receber fatura digital net","$position":{"top":"1176px","left":"3866px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6b853631-c790-462f-b2fb-dd6c3414b920":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"3666fd3a-27a3-40cd-b5be-5afbeff008be","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3666fd3a-27a3-40cd-b5be-5afbeff008be","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"cdb7c83c-7844-44d0-80fd-fbc671e48d87","type":"text/plain","content":"Nesse caso, você pode aguardar que a sua fatura será enviada sempre antes do vencimento!"},"$cardContent":{"document":{"id":"cdb7c83c-7844-44d0-80fd-fbc671e48d87","type":"text/plain","content":"Nesse caso, você pode aguardar que a sua fatura será enviada sempre antes do vencimento!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"1cd9b37a-d97a-4f13-9a85-90f208d17b10","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1cd9b37a-d97a-4f13-9a85-90f208d17b10","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a530b853-6b52-4120-a341-5a3c3b68d305","type":"text/plain","content":"Agora, se você preferir, eu posso te passar por aqui mesmo o código de barras ou a segunda via da sua fatura 😉"},"$cardContent":{"document":{"id":"a530b853-6b52-4120-a341-5a3c3b68d305","type":"text/plain","content":"Agora, se você preferir, eu posso te passar por aqui mesmo o código de barras ou a segunda via da sua fatura 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d64415dc-08e5-402c-bd61-ae17f2502395","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"$cardContent":{"document":{"id":"d64415dc-08e5-402c-bd61-ae17f2502395","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"f1ebd95b-42ac-4239-88fb-79ec82c4b7bb","type":"text/plain","content":"Você prefere:\n\n*1-* Pegar o código de barras\n*2-* Pegar a segunda via \n*3-* Não precisa"},"$cardContent":{"document":{"id":"f1ebd95b-42ac-4239-88fb-79ec82c4b7bb","type":"text/plain","content":"Você prefere:\n\n*1-* Pegar o código de barras\n*2-* Pegar a segunda via \n*3-* Não precisa"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"1763fa69-6479-4b2a-be23-9638b549feac","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7","$connId":"con_408","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"576c9b98-5bee-4548-a16a-55eef86a42a7"},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","$connId":"con_413","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"a014ecb4-8a7c-4566-8e73-e80e866845f4","typeOfStateId":"state"},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$connId":"con_418","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"cb83c5fb-3812-4fe7-a98c-0e892bc47d07","typeOfStateId":"state"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"confirma email fatura digital net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"confirma email fatura digital net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar Script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/*1- Pegar o código de barras\n2- Pegar a segunda via\n3- Não precisa*/\n\n\nfunction run(input) {\n    try{\n        var firstRegex = /^((1)|(um)|(c[o|ó]digo)|(c[o|ó]digo de barras)|(Pegar o c[o|ó]digo de barras))$/i;\n        if (firstRegex.test(input))\n            return {option:\"1\", content:\"Pegar o codigo de barras\"}\n\n        var secondRegex = new RegExp(\"^((2)|(dois)|(segunda)|(via)|(segunda via)|(Pegar a segunda via)|(pegar segunda via))$\", 'i');\n        if (secondRegex.test(input))\n            return {option:\"2\", content:\"Pegar a segunda via\"};\n    \n        var thirdRegex = new RegExp(\"^((3)|(tr[e|ê]s)|(terceira)|(terceiro)|(n[a|â]o precisa))$\", 'i');\n        if (thirdRegex.test(input))\n            return { option: \"3\", content: \"Nao precisa\" };\n\n        return {option:\"invalid\", content:\"input inesperado\"};\n    }catch(e){\n        return {option:\"invalid\", content:\"input inesperado\"};\n    }\n   \n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"confirma email fatura digital net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"confirma email fatura digital net selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"confirma email fatura digital net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"confirma email fatura digital net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"confirma email fatura digital\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-27650295-6408-47fd-8d02-6a2107efefe3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-46ba1820-52a2-42f9-b399-e4e503d87f2e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7b240206-b827-44dd-8805-38c17c8cf74b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-f5746c0d-266f-4b2b-a13f-31d13361f1c1","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"6b853631-c790-462f-b2fb-dd6c3414b920","root":false,"$title":"[A.1.3.2.1.2.1.1] confirma email fatura digital","$position":{"top":"1422.11px","left":"3689.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1586dfa3-8ebe-4ca0-b854-7681a890d3eb":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"6ea73295-a99d-4b98-b41e-01667568b6ed","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6ea73295-a99d-4b98-b41e-01667568b6ed","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"6c201c3b-18fe-4acf-b701-364fecb5fb52","type":"text/plain","content":"Você pode substituir esse e-mail por outro, nesse caso, *só será válido o seu novo e-mail* cadastrado!"},"$cardContent":{"document":{"id":"6c201c3b-18fe-4acf-b701-364fecb5fb52","type":"text/plain","content":"Você pode substituir esse e-mail por outro, nesse caso, *só será válido o seu novo e-mail* cadastrado!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"56991481-cc51-44fd-b7f3-4553a41a7a91","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"56991481-cc51-44fd-b7f3-4553a41a7a91","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"0cc8dc1b-676e-4086-9a67-dac68ea951f3","type":"text/plain","content":"Você prefere:\n\n*1-* Substituir o e-mail do cadastro\n*2-* Manter o e-mail atual"},"$cardContent":{"document":{"id":"0cc8dc1b-676e-4086-9a67-dac68ea951f3","type":"text/plain","content":"Você prefere:\n\n*1-* Substituir o e-mail do cadastro\n*2-* Manter o e-mail atual"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"592ed924-98f7-4b05-ac76-a5c50d17e883","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"90bef3f0-3496-44ff-a5aa-28d4ff1d3ff8","$connId":"con_423","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"a918ac71-e452-4fa6-8c1d-20d5fc9c3953"},{"stateId":"b0ac254c-93cb-4296-8f00-6dafb3854edd","$connId":"con_428","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"a23e9cf4-23e2-483e-a70e-bc58402fff4c"},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_433","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"63b7165d-7f71-4b5c-a9bc-72cbf02d2561"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"substituir email fatura digital net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"substituir email fatura digital net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":" /* 1- Substituir o e-mail do cadastro\n2- Manter o e-mail atual*/\nfunction run(input) {\n    var firstRegex = new RegExp(\"((1)|(\\s*1\\s*)|(um)|(primeira)|(.*atual.*))$\", 'i');\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Substituir o e-mail do cadastro\"}\n\n    var secondRegex = new RegExp(\"((2)|(\\s*2\\s*)|(dois)|(segunda)|(.*atual.*)|(.*manter.*))$\", 'i');\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Manter o e-mail atual\"};\n       \n    return {option:\"invalid\", content:\"input inesperado\"};\n    \n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"substituir email fatura digital net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"substituir email fatura digital net selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"substituir email fatura digital net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"substituir email fatura digital net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"substituir email fatura digital\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.3.2.1.2.1.2"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-c9c91b3f-9a44-4f93-9784-9387429c9b7c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5ce94076-93b9-4736-9225-c7edd56f3871","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8b55a831-33b5-4675-a24b-043324ef7354","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c2d1db3f-11a5-4280-a45e-3feeedb79aef","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-6fc40b3f-3d2e-4171-a838-dbdb0526ec3b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1586dfa3-8ebe-4ca0-b854-7681a890d3eb","root":false,"$title":"[A.1.3.2.1.2.1.2] substituir email fatura digital","$position":{"top":"1556px","left":"3979px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"511dc13d-d1e2-40de-9754-1e8871cd29dd":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"88b1507a-6c6d-4907-99cf-a00ba428f022","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"88b1507a-6c6d-4907-99cf-a00ba428f022","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"c942d3de-5e22-4a4e-9596-f764e1165c4b","type":"text/plain","content":"O e-mail que eu tenho cadastrado é:\n\n{{emailFaturaDigital}}\n\nVocê pode substituir esse e-mail por outro, nesse caso, só será válido o seu novo e-mail cadastrado!","metadata":{}},"$cardContent":{"document":{"id":"c942d3de-5e22-4a4e-9596-f764e1165c4b","type":"text/plain","content":"O e-mail que eu tenho cadastrado é:\n\n{{emailFaturaDigital}}\n\nVocê pode substituir esse e-mail por outro, nesse caso, só será válido o seu novo e-mail cadastrado!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"ec12672c-2b23-4e56-bcca-41a183bc8714","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ec12672c-2b23-4e56-bcca-41a183bc8714","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3416d3fd-c62e-4b75-83e0-8dd50661aeaa","type":"text/plain","content":"Você prefere:\n\n*1-* Substituir o e-mail do cadastro\n*2-* Manter o e-mail atual"},"$cardContent":{"document":{"id":"3416d3fd-c62e-4b75-83e0-8dd50661aeaa","type":"text/plain","content":"Você prefere:\n\n*1-* Substituir o e-mail do cadastro\n*2-* Manter o e-mail atual"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a6a96cb3-3388-4322-a16f-b0bbe46cecfa","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"90bef3f0-3496-44ff-a5aa-28d4ff1d3ff8","$connId":"con_438","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"1f0d77a2-e654-4b44-8117-54f78300d79c"},{"stateId":"d9a2bb26-79ae-4be8-a684-02e79e515ae8","$connId":"con_443","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"f245482b-ad1c-4cd7-967c-d5f660ac3345"},{"stateId":"c292aac2-0bdd-4612-944a-31331fc66e64","$connId":"con_448","conditions":[{"source":"input","comparison":"matches","values":["(?i)([a-z0-9.]+@[a-z0-9]+\\.[a-z]+.[a-z]*)"]}],"$invalid":false,"$id":"bcc24ff5-3828-494b-a77d-cb2379a5270c"},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_453","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"76233719-611f-4aa5-afff-e44739a5692d"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"alterar email fatura digital net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"alterar email fatura digital net exibicao","action":"Exibicao"},"conditions":[]},{"type":"ProcessHttp","$title":"Get Metodo Envio de fatura","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/AccountManagement/billing-datas?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","responseStatusVariable":"statusRespostaFaturasPorCodigo","responseBodyVariable":"getRespostaFaturasPorCodigo"},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"emailFaturaDigital"}],"$id":"02c0b25a-f8d8-4b33-9122-f0a76952c6e3"},{"$id":"d02ec78a-6244-40b1-8432-124963a7ee37","$typeOfContent":"","type":"SetVariable","$title":"emailFaturaDigital","$invalid":false,"settings":{"variable":"emailFaturaDigital","value":"{{getRespostaFaturasPorCodigo@data.email}}"},"conditions":[{"source":"context","comparison":"equals","variable":"statusRespostaFaturasPorCodigo","values":["200"]},{"source":"context","comparison":"notExists","values":[],"variable":"emailFaturaDigital"}]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar Script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n\n1- Substituir o e-mail do cadastro\n2- Manter o e-mail atual\n\n            **/\nfunction run(input) {\n    var firstRegex = /^\\s*((1\\s*-?\\s*|um|primeir[oa])|((1\\s*-?\\s*)?substituir\\s*o?(\\s*e-?mail)?(\\s*do)?\\s*(cadastro)?))\\s*$/i\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Substituir o e-mail do cadastro\"}\n\n    var secondRegex = /^\\s*((2\\s*-?\\s*|2|dois|segund[oa])|((2\\s*-?\\s*)?manter\\s*(o\\s*)?e-?mail\\s*(atual)?))\\s*$/i\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Manter o e-mail atual\"};\n       \n    return {option:\"invalid\", content:\"input inesperado\"};\n    \n}\n","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"alterar email fatura digital net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"alterar email fatura digital net selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"alterar email fatura digital net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"alterar email fatura digital net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"alterar email fatura digital net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.3.2.1.2.2"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - emailNovo","$invalid":false,"settings":{"variable":"emailNovo","value":"{{input.content}}"},"conditions":[{"source":"input","comparison":"matches","values":["(?i)([a-z0-9.]+@[a-z0-9]+\\.[a-z]+.[a-z]*)"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-c2d3b909-64c2-4d9e-b3ba-85a352b103a0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-37283c78-26fb-4dfc-a83d-6571c3d4a757","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-26613ea7-9a34-496a-a819-e04cb9a1c2e9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3b230f57-23b1-466a-8d2e-288414d79ee8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1edb9c65-f233-4f84-a453-64dde75c93ff","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-ca2f750a-aa79-4ea8-b1a1-a657482b7821","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"511dc13d-d1e2-40de-9754-1e8871cd29dd","root":false,"$title":"[A.1.3.2.1.2.2] alterar email fatura digital net","$position":{"top":"1246px","left":"4260px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dbcf710c-9513-43a3-8299-c9f9b8a113ea":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"560d8395-b710-4bb9-941a-8186a6d131ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"560d8395-b710-4bb9-941a-8186a6d131ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"9a264134-03e6-4fdb-873a-0d46188cb36f","type":"text/plain","content":"Cancelando seu cadastro na fatura digital, você *deixa de receber sua fatura por e-mail* todo mês e passa a recebê-la *via correios*","metadata":{}},"$cardContent":{"document":{"id":"9a264134-03e6-4fdb-873a-0d46188cb36f","type":"text/plain","content":"Cancelando seu cadastro na fatura digital, você *deixa de receber sua fatura por e-mail* todo mês e passa a recebê-la *via correios*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"eddaa9a0-d65e-4bf8-876f-1fbab7b4790e","type":"SendMessage","settings":{"id":"52cb61e3-da48-48ed-b2c7-818c5988d6ee","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"52cb61e3-da48-48ed-b2c7-818c5988d6ee","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a68a189c-c2ca-4ce7-99a5-7121ccb210d5","type":"SendMessage","settings":{"id":"9cb8d791-1cbf-4ffd-907c-67ea1bbbaad6","type":"text/plain","content":"⚠️ Atenção:\n\nSe você ganha um *desconto mensal em sua fatura* por ter escolhido receber por email, *você perderá esse benefício* ao cancelar a fatura digital","metadata":{}},"$cardContent":{"document":{"id":"9cb8d791-1cbf-4ffd-907c-67ea1bbbaad6","type":"text/plain","content":"⚠️ Atenção:\n\nSe você ganha um *desconto mensal em sua fatura* por ter escolhido receber por email, *você perderá esse benefício* ao cancelar a fatura digital"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"df079685-8af5-4d74-9a14-016ce09ff262","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{}},"$cardContent":{"document":{"id":"df079685-8af5-4d74-9a14-016ce09ff262","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"230990f4-fb65-4dfb-bfcd-2e9ae0757f32","type":"text/plain","content":"Além disso, a *fatura digital* é mais *segura, prática e sustentável* 🌳 e garante que você receba sua fatura, todo mês, sem nenhum atraso","metadata":{}},"$cardContent":{"document":{"id":"230990f4-fb65-4dfb-bfcd-2e9ae0757f32","type":"text/plain","content":"Além disso, a *fatura digital* é mais *segura, prática e sustentável* 🌳 e garante que você receba sua fatura, todo mês, sem nenhum atraso"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"eddc119d-4f5e-4e7c-940d-fb6611e25595","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{}},"$cardContent":{"document":{"id":"eddc119d-4f5e-4e7c-940d-fb6611e25595","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"8eec8caf-e2f5-4033-8aab-7b9b80963c47","type":"text/plain","content":"Você prefere:\n\n*1-* Manter a fatura digital\n*2-* Cancelar a fatura digital"},"$cardContent":{"document":{"id":"8eec8caf-e2f5-4033-8aab-7b9b80963c47","type":"text/plain","content":"Você prefere:\n\n*1-* Manter a fatura digital\n*2-* Cancelar a fatura digital"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"d20433a8-a2fb-4c2c-ba9c-c8671a53c84d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e12f51b5-a3a8-4c0f-8f0a-00c573074e5e","$connId":"con_458","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"2e0fc670-5512-449b-b11d-69b13beb1084"},{"stateId":"2d71a3ee-2689-43af-ad4a-8fb2f0bb09a8","$connId":"con_463","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"27054113-e434-4722-abfc-04dadf9f310c"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"cancelar fatura digital net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"cancelar fatura digital net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/*\nVocê prefere:\n\n1- Manter a fatura digital\n2- Cancelar a fatura digital \n*/\n\nfunction run(input) {\n\t\n\tvar firstRegex = /^((1)|(\\s*1\\s*)|(um)|(primeir[ao])|((1\\s*-?\\s*)?manter\\s*a?(\\s*fatura\\s*digital)?))$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Manter a fatura digital\"};\n\t\n    var secondRegex = /^((2)|(\\s*2\\s*)|(dois)|(segund[ao])|((2\\s*-?\\s*)?cancelar\\s*(a?\\s*fatura\\s*digital)?))$/i;\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Cancelar a fatura digital\"};\n    return {option:\"invalid\", content:\"input inesperado\"};\n    \n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"cancelar email fatura digital net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"cancelar email fatura digital net selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"cancelar email fatura digital net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"cancelar email fatura digital net input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"cancelar fatura digital net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.3.2.1.2.3"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-518c21e4-98e4-447a-ac47-8915a3199727","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f05191a9-2a1d-4afe-878b-8b9a5575e2ee","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5b9ff1e2-19ca-4ea5-b398-2b1c326ded30","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d36b9295-2e12-4429-b349-2f200bf2e956","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-6a85c5ae-af19-41ed-b7f9-cca7e30953bd","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"dbcf710c-9513-43a3-8299-c9f9b8a113ea","root":false,"$title":"[A.1.3.2.1.2.3] cancelar fatura digital net","$position":{"top":"1331px","left":"4608px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d9a2bb26-79ae-4be8-a684-02e79e515ae8":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"0c3717c5-82c5-47b3-967a-28211a37499b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0c3717c5-82c5-47b3-967a-28211a37499b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a426df09-7c7a-4d05-aaa3-e58452f4bc8c","type":"text/plain","content":"Ok então, não fiz *nenhuma alteração no seu e-mail cadastrado.*\nSe você precisar alterar, a qualquer momento, basta voltar a falar comigo 😉"},"$cardContent":{"document":{"id":"a426df09-7c7a-4d05-aaa3-e58452f4bc8c","type":"text/plain","content":"Ok então, não fiz *nenhuma alteração no seu e-mail cadastrado.*\nSe você precisar alterar, a qualquer momento, basta voltar a falar comigo 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"4122ad23-0dd2-41bb-b64f-4a60ad4ff678","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mensagem sem alteracoes\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-02ef5834-ffaa-47e4-beab-76b767e1a785","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-81d9d00c-222b-4bef-a99c-a1b575f085f5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d9a2bb26-79ae-4be8-a684-02e79e515ae8","root":false,"$title":"[A.1.3.2.1.2.2.1] Mensagem sem alteracoes","$position":{"top":"1542px","left":"4270px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e12f51b5-a3a8-4c0f-8f0a-00c573074e5e":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"bde655b0-41f2-40b7-a624-fc608b50ff82","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bde655b0-41f2-40b7-a624-fc608b50ff82","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"6e2d199f-57be-47fb-a79e-d0382a5cf5f7","type":"text/plain","content":"Ok então, você vai continuar recebendo sua fatura, todo mês, no seu e-mail\nParabéns pela sua escolha, o meio ambiente agradece! 🌳"},"$cardContent":{"document":{"id":"6e2d199f-57be-47fb-a79e-d0382a5cf5f7","type":"text/plain","content":"Ok então, você vai continuar recebendo sua fatura, todo mês, no seu e-mail\nParabéns pela sua escolha, o meio ambiente agradece! 🌳"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"53c378a9-b703-40bd-a5c7-20a9d94bd40f","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mensagem parabens pela escolha\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-26a6d81b-bba6-4d0b-b45a-16d51010d922","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8de4d53d-0169-46fc-b790-1912aa1ff482","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e12f51b5-a3a8-4c0f-8f0a-00c573074e5e","root":false,"$title":"[A.1.3.2.1.2.3.1] Mensagem parabens pela escolha","$position":{"top":"1534px","left":"4525px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"39d1c7c7-05e2-4ffa-830f-b87d658a1d4c":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"6d132f64-d625-4d65-ab51-4f0634d1b806","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6d132f64-d625-4d65-ab51-4f0634d1b806","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"92f3c19c-ec26-4202-8661-ec0cdb4aa428","type":"text/plain","content":"Prontinho, já solicitei o cancelamento da sua fatura digital\nVocê vai passar a receber sua fatura via correios ✉️"},"$cardContent":{"document":{"id":"92f3c19c-ec26-4202-8661-ec0cdb4aa428","type":"text/plain","content":"Prontinho, já solicitei o cancelamento da sua fatura digital\nVocê vai passar a receber sua fatura via correios ✉️"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"dc4d0fb7-d88f-4a69-8718-82b0e4d64950","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"dc4d0fb7-d88f-4a69-8718-82b0e4d64950","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"ff889c9b-fee0-4538-bf21-8defef618452","type":"text/plain","content":"O número do seu protocolo para esta solicitação é:\n\n{{respBodyCancelaFatura@data.number}}","metadata":{}},"$cardContent":{"document":{"id":"ff889c9b-fee0-4538-bf21-8defef618452","type":"text/plain","content":"O número do seu protocolo para esta solicitação é:\n\n{{respBodyCancelaFatura@data.number}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"dccf1c26-c7c1-45de-b5b9-10802eafdacb","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"já solicitei o cancelamento\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-4a4b475f-01d5-4f9b-813d-1a4121c2bea0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1cfc8550-6403-4740-aab2-e34a7693b937","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"39d1c7c7-05e2-4ffa-830f-b87d658a1d4c","root":false,"$title":"[A.1.3.2.1.2.3.2] Já solicitei o cancelamento","$position":{"top":"1530.5px","left":"4856px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b0ac254c-93cb-4296-8f00-6dafb3854edd":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"0c4e75bd-de64-410e-877a-771ba11c32e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0c4e75bd-de64-410e-877a-771ba11c32e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"f56dbba3-45a2-42d3-9d32-83832be85609","type":"text/plain","content":"Ok então, não fiz nenhuma alteração no seu e-mail cadastrado. \nSe você precisar alterar, a qualquer momento, basta voltar a falar comigo 😉"},"$cardContent":{"document":{"id":"f56dbba3-45a2-42d3-9d32-83832be85609","type":"text/plain","content":"Ok então, não fiz nenhuma alteração no seu e-mail cadastrado. \nSe você precisar alterar, a qualquer momento, basta voltar a falar comigo 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f17406be-2b20-4755-9a2d-c8016b63f326","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mensagem sem alteraçoes\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-eed954fd-6a0b-44af-b57e-2fcc5762b9aa","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b1329e2b-e748-49ee-a4b4-6c68cac817eb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b0ac254c-93cb-4296-8f00-6dafb3854edd","root":false,"$title":"[A.1.3.2.1.2.1.2.1] Mensagem sem alteraçoes","$position":{"top":"1781.43px","left":"3995px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"be1a84c6-a52a-43d9-afc1-61d5321ff8af":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e0cf5e67-a007-43b3-8c11-8012102c2d5e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"origemAjudaAutenticacao"}]},{"type":"Redirect","$title":"Redirecionar autenticacao","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#ajudaAutenticacao"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-7cf9e012-5be4-4162-b7fc-106d9fd82a80","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-11ef2e69-89c6-4385-85be-55a6225bbaaf","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","root":false,"$title":"Redireciona para esqueci login e senha","$position":{"top":"0px","left":"3839px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"34347643-ab7c-4809-a53e-cd7b1f2be325":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9e562e85-2db9-4314-a816-263a3b024a0b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3500a05d-f5a3-42fe-9f89-379afa692592","typeOfStateId":"state","$connId":"con_468","$id":"a7b65eb7-d431-45b4-90d2-15e965feafc5","conditions":[{"source":"input","comparison":"equals","values":["true"]}],"$invalid":false},{"stateId":"914291a2-24b3-40ba-91a1-992e7abbb076","typeOfStateId":"state","$connId":"con_473","$id":"8a0b8df5-c6c6-41da-98f7-c981c81c8b1b","conditions":[{"source":"input","comparison":"equals","values":["false"]}],"$invalid":false},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","typeOfStateId":"state","$connId":"con_478","$id":"7d00cb7c-6fef-4132-a8fc-080bc0dd7ada","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"49ce7c1d-3981-41c4-8498-397cc56db870","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#clienteLogado"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"segunda via net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"loginTestB","values":["true"]}]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"loginTestB","values":["true"]}]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.2.2"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]},{"source":"context","comparison":"notEquals","variable":"loginTestB","values":["true"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"loginTestB","values":["true"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-ba6974ef-9947-4b67-a77a-a12fd786371e","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-faa9d182-45e2-4d71-a421-19bfc4fc858b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b0039087-1e69-4cdd-829c-77c23dcf5c14","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f889b7a6-993c-40b1-85ec-6ffbc1b9f06a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"34347643-ab7c-4809-a53e-cd7b1f2be325","root":false,"$title":"[A.1.2.2] Segunda via: verifica usuário logado","$position":{"top":"716px","left":"1747px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4130f339-6a5c-46d8-a500-3f1cb8eb5e10":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"6bb1d001-067e-4702-8b2f-fe35e5f3f735","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6bb1d001-067e-4702-8b2f-fe35e5f3f735","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"c2de7f36-5cb1-45a2-94cb-30e6e7c7a330","type":"text/plain","content":"Selecione uma fatura para ver os detalhes:\n\n{{mensagemFatura}}","metadata":{}},"$cardContent":{"document":{"id":"c2de7f36-5cb1-45a2-94cb-30e6e7c7a330","type":"text/plain","content":"Selecione uma fatura para ver os detalhes:\n\n{{mensagemFatura}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"5905c322-6476-4e84-880d-56df1b7753e5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_483","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"35edc1c3-0cc2-48d7-a3f1-2ac5d2be4712"},{"stateId":"a8938eab-98a7-4bae-a642-167ff1628bc9","$connId":"con_488","conditions":[{"source":"context","comparison":"notEquals","values":["invalido"],"variable":"faturaSelecionada"}],"$invalid":false,"$id":"08642b49-78ae-47cc-b24c-35f10c86a946"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"selecao fatura exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"selecao fatura exibicao","action":"Exibicao"},"conditions":[]},{"type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento) {\n    var channel = 'Claro Residencial';\n    if(tipoAtendimento == 'tv') {\n        channel = 'Claro TV';\n    }\n\n    var date = new Date();\n    return {\n        name: 'Segunda via de fatura',\n        channel: channel,\n        text: 'com a sua segunda via',\n        date: new Date()\n    }\n}","inputVariables":["tipoAtendimento"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Obtem Detalhes Fatura","$invalid":false,"settings":{"function":"run","source":"function run(menuFatura, inputUsuario) {\n  menuFatura = JSON.parse(menuFatura);\n\n  if (/^\\d$/g.test(inputUsuario)) {\n    if (0 < inputUsuario && inputUsuario < menuFatura.lista.length) {\n      return menuFatura.detalhes[inputUsuario];\n    }\n  }\n\n  return 'invalido';\n}","inputVariables":["menuFatura","input.content"],"outputVariable":"detalhesFatura","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"faturaSelecionada","$invalid":false,"settings":{"function":"run","source":"function run(menuFatura, inputUsuario) {\n  menuFatura = JSON.parse(menuFatura);\n\n  if (/^\\d$/g.test(inputUsuario)) {\n    if (0 < inputUsuario && inputUsuario < menuFatura.lista.length) {\n      return menuFatura.lista[inputUsuario];\n    }\n  }\n\n  return 'invalido';\n}","inputVariables":["menuFatura","input.content"],"outputVariable":"faturaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"selecao de fatura\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.2.2.1"},"conditions":[{"source":"context","comparison":"equals","variable":"faturaSelecionada","values":["invalido"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalido\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"selecao fatura selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"selecao fatura selecao","action":"{{faturaSelecionada}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"selecao fatura input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"selecao fatura input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"faturaSelecionada","values":["invalido"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-70f5d10d-e0c8-447a-a3e5-5c1835c5a0c2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ae85d944-9d69-4a07-bfae-13185c995cb9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bf0bcfd5-e8ed-45c8-9ff4-502bfcd1dd44","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-be8dd77a-9386-41a3-ac28-a8d1bd005dd1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-7a39baa7-7e7d-445e-9216-030743909736","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"4130f339-6a5c-46d8-a500-3f1cb8eb5e10","root":false,"$title":"[A.1.2.2.1] Selecao de fatura","$position":{"top":"1445px","left":"1724px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a8938eab-98a7-4bae-a642-167ff1628bc9":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"1c686247-3f9b-4b48-8313-3400362e6cdd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1c686247-3f9b-4b48-8313-3400362e6cdd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"1dbe8aaa-1460-45ae-9f72-aa74f76664d1","type":"text/plain","content":"Detalhes da fatura:\n\nVencimento: {{detalhesFatura@vencimento}} 🗓️\n\nValor: {{detalhesFatura@valor}}  💵\n\nSituação: {{detalhesFatura@status}}","metadata":{}},"$cardContent":{"document":{"id":"1dbe8aaa-1460-45ae-9f72-aa74f76664d1","type":"text/plain","content":"Detalhes da fatura:\n\nVencimento: {{detalhesFatura@vencimento}} 🗓️\n\nValor: {{detalhesFatura@valor}}  💵\n\nSituação: {{detalhesFatura@status}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"47272bd8-3373-44e4-8dbd-33dd78098c43","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"47272bd8-3373-44e4-8dbd-33dd78098c43","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d3b0b076-9cc0-4c87-9166-a5690152f82c","type":"text/plain","content":"Você gostaria de:\n\n*1-* Receber essa fatura por aqui\n*2-* Receber essa fatura por e-mail  \n*3-* Ver outra fatura\n*4-* Sair","metadata":{}},"$cardContent":{"document":{"id":"d3b0b076-9cc0-4c87-9166-a5690152f82c","type":"text/plain","content":"Você gostaria de:\n\n*1-* Receber essa fatura por aqui\n*2-* Receber essa fatura por e-mail  \n*3-* Ver outra fatura\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"2c87c1b3-9341-4694-9da4-de2b90921972","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6f51de6b-a36f-40a7-9d56-fdb121e68e7a","$connId":"con_493","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"28d87ad6-21e2-4297-a68e-34236fb4a8bb"},{"stateId":"2b854d9e-fd7d-4644-939e-736fb64dab17","$connId":"con_498","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"cbf6dc89-e9a2-47be-9a4a-7152b5bd41e1"},{"stateId":"4130f339-6a5c-46d8-a500-3f1cb8eb5e10","$connId":"con_503","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"daecc69e-5ca5-4fc5-9958-6c4da21a2b51"},{"stateId":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","$connId":"con_508","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"0d269df1-35f3-4dd6-9d10-2e18ff5bfe69","typeOfStateId":"state"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Selecao fatura detalhes exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura detalhes exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"chooseAnswer","$invalid":false,"settings":{"function":"run","source":"/*\nVocê gostaria de:\n\n1- Receber essa fatura por aqui\n2- Receber essa fatura por e-mail  \n3- Ver outra fatura\n4- Sair\n\n*/\nfunction run(input) {\n    let strRegex = /^\\s*((1 ?-?)|(um)|(primeir[oa])|(aqui)|(1\\s*-?\\s*)?(receber\\s*((essa\\s*)?fatura\\s*)?((por\\s*)?aqui)?))\\s*$/i;\n    if (strRegex.test(input)) return { option: \"1\", content: \"Receber essa fatura por aqui\" };\n\n    strRegex = /^\\s*((2 ?-?)|(dois)|(segund[oa])|(e-?mail)|(2\\s*-?\\s*)?(receber\\s*((essa\\s*)?fatura\\s*)?((por\\s*)?e-?mail)?))\\s*$/i;\n    if (strRegex.test(input)) return { option: \"2\", content: \"Receber essa fatura por e-mail\" };\n\n    strRegex = /^\\s*((3\\s*?-?\\s*)|(tr[eê]s)|(terceir[oa])|((3\\s*?-?\\s*)?ver\\s*(a\\s*)?(outra\\s*)?fatura)|(outra\\s*fatura))\\s*$/i;\n    if (strRegex.test(input)) return { option: \"3\", content: \"Ver outra fatura\" };\n\n    strRegex = /^\\s*((4)|(quatro)|(quart[ao])|((\\s*4\\s*-?\\s*)?\\s*sair))\\s*$/i;\n    if (strRegex.test(input)) return { option: \"4\", content: \"Sair\" };\n\n    return { option: \"invalid\", content: \"input inesperado\" };   \n}\n","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Selecao fatura detalhes selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura detalhes selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"selecao fatura detalhes\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.2.2.1.1"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\")\n            return null;\n\n        if(confirmationCounter == null || confirmationCounter >= 3)\n            return 1\n        else\n            return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return 1\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Selecao fatura detalhes input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura detalhes input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-e63b9568-2057-4f2b-a52e-da95fddcddc8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a5895c2e-bab8-4ce0-aa92-514878b6d887","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-22e4d816-47f4-4b74-84bc-d69daa7de415","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-71104704-4584-4231-a566-b2d723b65488","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-eb63f9cd-760e-43dc-a0c6-be78a454efdf","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a8938eab-98a7-4bae-a642-167ff1628bc9","root":false,"$title":"[A.1.2.2.1.1] Selecao fatura detalhes","$position":{"top":"1569px","left":"1719px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2b854d9e-fd7d-4644-939e-736fb64dab17":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"35ac58e1-1c8e-4989-adfc-713f1fc44904","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"35ac58e1-1c8e-4989-adfc-713f1fc44904","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"35200a28-3425-433f-a56e-28815eedb153","type":"text/plain","content":"Vou enviar a fatura para o e-mail {{chosenEmail}}:\n\n*1-* Está correto, pode enviar!\n*2-* Preciso corrigir o e-mail","metadata":{}},"$cardContent":{"document":{"id":"35200a28-3425-433f-a56e-28815eedb153","type":"text/plain","content":"Vou enviar a fatura para o e-mail {{chosenEmail}}:\n\n*1-* Está correto, pode enviar!\n*2-* Preciso corrigir o e-mail"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"7d4998f5-7309-4515-b527-aef1ea9771da","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"65b4a31a-6bdc-4f4d-b849-88964a1dc1e9","$connId":"con_513","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"32a4d19f-75d0-40bc-9e10-b1cb0bb3949b"},{"stateId":"dd0ec906-c9b5-44db-909d-9b7c7d60e7c4","$connId":"con_518","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"4eace6d6-aba7-4327-9805-1117eef5d18b"},{"stateId":"f2bc8d9f-e053-4086-a1ab-814e47d62a58","$connId":"con_523","conditions":[{"source":"input","comparison":"matches","values":["(?i)([a-z0-9.]+@[a-z0-9]+\\.[a-z]+.[a-z]*)"]}],"$invalid":false,"$id":"2b783825-6784-4def-a2b0-dacfc05eb4d0"},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_528","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"55e9251a-28b8-44b8-9395-d5df8311ac0b"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Selecao fatura receber email exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura receber email exibicao","action":"Exibicao"},"conditions":[]},{"$id":"aa7c5d5c-afb8-4205-a407-748ea50e8cd1","$typeOfContent":"","type":"SetVariable","$title":"Set \"chosenEmail\" to \"tokenPayload@email\"","$invalid":false,"settings":{"value":"{{tokenPayload@email}}","variable":"chosenEmail"},"conditions":[{"values":["Redefinir e-mail segunda via"],"source":"context","comparison":"notEquals","variable":"state.previous.name"}]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    var firstRegex = /^\\s*((1\\s*-?\\s*|1|um|primeir[oa])|((1\\s*-?\\s*)?((es)?t[aá]\\s*)?correto[,.]?(\\s*pode\\s*enviar!?)?)|(pode\\s*enviar!?))\\s*$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Esta correto pode enviar\"}\n\n    var secondRegex = /^\\s*((2\\s*?-?\\s*)|(dois)|(segunda)|((2\\s*?-?\\s*)?(preciso\\s*)?corrigir\\s*((o\\s*)?e-?mail)?)|())\\s*$/i;\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Preciso corrigir o email\"};\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Selecao fatura receber email selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura receber email selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"selecao fatura receber email\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.2.2.1.1.2"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Selecao fatura receber email input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura receber email input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-8caf9816-7a62-4728-befb-e4ad1933e6d5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-497a2692-52cf-4bdd-95f7-3c3ea662a514","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-19ee7d54-3a09-4087-a22e-cbe518e473a6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7c85ad09-73bf-45d6-a033-804a8a040d73","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-b71fa7cf-f2d5-4839-836a-2292782310e5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2b854d9e-fd7d-4644-939e-736fb64dab17","root":false,"$title":"[A.1.2.2.1.1.2] Selecao fatura receber email","$position":{"top":"1656px","left":"1484px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dd0ec906-c9b5-44db-909d-9b7c7d60e7c4":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"940f0992-8c29-465d-8ea5-e0154677ff1d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"940f0992-8c29-465d-8ea5-e0154677ff1d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"17ed365c-7587-4a99-8c0c-098a4146b629","type":"text/plain","content":"Ok, então digita o e-mail correto aqui pra mim"},"$cardContent":{"document":{"id":"17ed365c-7587-4a99-8c0c-098a4146b629","type":"text/plain","content":"Ok, então digita o e-mail correto aqui pra mim"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"652ff439-6a83-4b2f-9f3a-489718fa3773","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2bc8d9f-e053-4086-a1ab-814e47d62a58","$connId":"con_533","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"isValidEmailString"},{"values":["true"],"source":"context","comparison":"equals","variable":"isValidEmailString"}],"$invalid":false,"$id":"603ecc08-b592-4acd-8d20-6f8952237819"},{"stateId":"9ea190f7-4dc6-4c90-8c96-da8223e8d93e","$connId":"con_538","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"f605b0c8-e12d-4a3d-ba8e-cb777ea1503b"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Selecao fatura email corrigir exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura email corrigir exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bc2b4d72-5627-47f8-916d-e68ca5b1421a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"isValidEmailString\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n\ttry {\n\t\tvar emailRegex = /(?i)([a-z0-9.]+@[a-z0-9]+\\.[a-z]+.[a-z]*)/gi;\n\n\t\tif (emailRegex.test(input))\n\t\t\treturn true\n\n\t\treturn false\n\t} catch (e) {\n\t\treturn false\n\t}\n}","inputVariables":["inputContentSubstring"],"outputVariable":"isValidEmailString","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Selecao fatura email corrigir input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura email corrigir input","action":"{{inputContentSubstring}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"selecao fatura email corrigir\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-d301dd47-1d9f-4f2b-bfae-a5392e578a47","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-70b1beb5-6a40-4066-b5e8-09f8dce0c295","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f75231e0-0651-42d9-ac72-466a7d23a870","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-2d0ec172-0120-46e6-a0e5-0d1c4813c0a6","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"dd0ec906-c9b5-44db-909d-9b7c7d60e7c4","root":false,"$title":"[A.1.2.2.1.1.2.2] Selecao fatura email corrigir","$position":{"top":"1807px","left":"1704px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9ea190f7-4dc6-4c90-8c96-da8223e8d93e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"70a52166-e5f6-492f-9cf4-94e4dfbdb024","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"602e38a7-c274-4035-94a3-0dc834901012","$connId":"con_543","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"5672476b-aa51-43e8-9518-06499d9d6054"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"9ea190f7-4dc6-4c90-8c96-da8223e8d93e","root":false,"$title":"Valida NLP e SmallTalks segunda via","$position":{"top":"1968px","left":"1512px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"602e38a7-c274-4035-94a3-0dc834901012":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"0e64fd29-5da3-4ebe-bb4e-8b688f262f6a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0e64fd29-5da3-4ebe-bb4e-8b688f262f6a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"14054dfb-6ed4-4ceb-86ff-21068de3f66a","type":"text/plain","content":"O que você digitou não corresponde a um e-mail válido, tenta novamente, por favor:"},"$cardContent":{"document":{"id":"14054dfb-6ed4-4ceb-86ff-21068de3f66a","type":"text/plain","content":"O que você digitou não corresponde a um e-mail válido, tenta novamente, por favor:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"766fae99-9be8-4662-8f8c-584704e85e7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2bc8d9f-e053-4086-a1ab-814e47d62a58","$connId":"con_548","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"isValidEmailString"},{"values":["true"],"source":"context","comparison":"equals","variable":"isValidEmailString"}],"$invalid":false,"$id":"adb00bd8-c992-4aee-9bb5-5558b7237b75"},{"stateId":"9ea190f7-4dc6-4c90-8c96-da8223e8d93e","$connId":"con_553","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"616e74ee-3e42-495f-a197-8c361282b818"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"14a7af69-5d73-4457-9d46-ed54c3e28d09","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"isValidEmailString\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n\ttry {\n\t\tvar emailRegex = /(?i)([a-z0-9.]+@[a-z0-9]+\\.[a-z]+.[a-z]*)/gi;\n\n\t\tif (emailRegex.test(input))\n\t\t\treturn true\n\n\t\treturn false\n\t} catch (e) {\n\t\treturn false\n\t}\n}","inputVariables":["inputContentSubstring"],"outputVariable":"isValidEmailString","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Selecao fatura email corrigir 2 tentativa input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura email corrigir 2 tentativa input","action":"{{inputContentSubstring}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"email corrigir 2 tentativa\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-b6dc4b2c-5025-453d-b584-5c9517380880","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a94ea5d3-5da2-4be4-b787-e9e3baecae8d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a50aeeb0-ffbf-4c2d-a9b2-90615e4a768c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-0a5f35b2-c5b6-42b5-81e2-39964b674260","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"602e38a7-c274-4035-94a3-0dc834901012","root":false,"$title":"[A.1.2.2.1.1.2.2.1.1] Email corrigir 2 tentativa","$position":{"top":"2157px","left":"1497px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f2bc8d9f-e053-4086-a1ab-814e47d62a58":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"cac55a5f-2f97-4de6-8565-af3085e43fbc","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"SetVariable","$title":"Set \"chosenEmail\" to \"input.content\"","$invalid":false,"settings":{"variable":"chosenEmail","value":"{{input.content}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2b854d9e-fd7d-4644-939e-736fb64dab17","$invalid":false},"$tags":[{"id":"blip-tag-eea6add3-3a47-4c85-98b5-eedec648fb38","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"f2bc8d9f-e053-4086-a1ab-814e47d62a58","root":false,"$title":"Redefinir e-mail segunda via","$position":{"top":"1985px","left":"1888px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fbb48055-374c-4d94-bab4-3b1f8202555d":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"24a6596c-60ed-4b48-ad47-310512c50237","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"24a6596c-60ed-4b48-ad47-310512c50237","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"12bd0ba6-6bd1-43f9-bdcf-a135ea96d4c3","type":"text/plain","content":"Prontinho, enviei a fatura no seu e-mail! 😉\nAh, se não chegar em alguns minutos, dê uma olhadinha na sua caixa de SPAM."},"$cardContent":{"document":{"id":"12bd0ba6-6bd1-43f9-bdcf-a135ea96d4c3","type":"text/plain","content":"Prontinho, enviei a fatura no seu e-mail! 😉\nAh, se não chegar em alguns minutos, dê uma olhadinha na sua caixa de SPAM."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d2347219-f38f-4357-b58e-9bf7160f5ae5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"$cardContent":{"document":{"id":"d2347219-f38f-4357-b58e-9bf7160f5ae5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a0f40f6a-b299-4ce8-a5e7-cdf7137e5053","type":"text/plain","content":"Você quer consultar mais alguma fatura?\n\n*1-* Sim\n*2-* Não"},"$cardContent":{"document":{"id":"a0f40f6a-b299-4ce8-a5e7-cdf7137e5053","type":"text/plain","content":"Você quer consultar mais alguma fatura?\n\n*1-* Sim\n*2-* Não"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"59c0e671-f14b-4213-87f8-a7b193bba80c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4130f339-6a5c-46d8-a500-3f1cb8eb5e10","$connId":"con_558","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"8d734caf-3f19-4f6a-9b6c-11971f94b8e5"},{"stateId":"267e786b-dd6e-45ba-a2c2-b3f58dd1727e","$connId":"con_563","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"f5d4a0ba-e9ed-42ce-b4bc-d8205e61c25c"},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_568","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"9934040c-6899-4e9e-99fc-7334436e4b0b"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Selecao fatura email correto exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura email correto exibicao","action":"Exibicao"},"conditions":[{"source":"context","comparison":"equals","variable":"isBusinessClient","values":["false"]}]},{"type":"TrackEvent","$title":"Selecao fatura email correto claro residencial exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura email correto claro residencial exibicao","action":"Exibicao"},"conditions":[{"source":"context","comparison":"equals","variable":"isBusinessClient","values":["false"]}],"$id":"06b79b88-614f-4c2e-9db8-b3c1f614b15a"},{"type":"TrackEvent","$title":"Selecao fatura email correto claro empresas exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura email correto claro empresas exibicao","action":"Exibicao"},"conditions":[{"source":"context","comparison":"equals","variable":"isBusinessClient","values":["true"]}],"$id":"16b5428e-5b2e-4b7b-90c5-b8501e9a6a8c"}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"\n\t\t\t\n\t\t\t\nfunction run(input) {\n\n    var firstRegex = /^\\s*((1\\s*-?\\s*|1|um|primeir[oa])|((1\\s*-?\\s*)?sim[,.]?(\\s*quero)?)|(quero(\\s*sim)?))\\s*$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Sim\"};\n\n    var secondRegex = /^\\s*((2\\s*-?\\s*|2|dois|segund[oa])|((2\\s*-?\\s*)?n[aã]o(\\s*quero)?))\\s*$/i;\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Nao\"}\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n}\n","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Selecao fatura email correto selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura email correto selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"selecao fatura email correto\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.2.2.1.1.2.1"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-b59aad8e-dc9e-40a3-b9db-03c102a5b905","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-aa9a92da-7c73-40a2-89f6-66b2f00f2c45","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2c385c0a-e525-40c3-9c4c-2d75b1b8a64b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a4c9c249-e0de-4516-ad41-e02f507c0799","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-faa7a4a6-e927-40fa-875d-19780a63972e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"fbb48055-374c-4d94-bab4-3b1f8202555d","root":false,"$title":"[A.1.2.2.1.1.2.1] Selecao fatura email correto","$position":{"top":"1831px","left":"1259px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"267e786b-dd6e-45ba-a2c2-b3f58dd1727e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4cc662b1-02e9-49ae-a558-cb03cac89bab","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_573","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"tipoFaturaStatus"}],"$invalid":false,"$id":"93102406-3b34-481f-801e-b0140468ee46"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_578","conditions":[{"source":"context","comparison":"notEquals","values":["CORREIO"],"variable":"tipoFatura@data.postType"}],"$invalid":false,"$id":"20171f14-8291-4502-b65a-6875eb001629"},{"stateId":"388e0007-29d8-415f-b1bd-9820f710afe3","$connId":"con_583","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"ae574109-45d0-4cca-8e41-7e7ff4a459ab"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Get Metodo Envio de fatura","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/AccountManagement/billing-datas?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","responseStatusVariable":"tipoFaturaStatus","responseBodyVariable":"tipoFatura"},"conditions":[],"$id":"d4df4db2-5952-456a-8fa5-f8250aa281ca"}],"$leavingCustomActions":[{"$id":"8b2eafb6-e8af-446e-b5ac-23446dc71366","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/AccountManagement/billing-datas?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Valida cadastro fatura digital\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["tipoFaturaStatus","tipoFatura"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"tipoFaturaStatus","values":["200"]},{"source":"context","comparison":"notEquals","variable":"tipoFaturaStatus","values":["202"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-3aef7f74-afe7-4155-b72c-233b83c33141","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-0446e326-e6fe-459e-a5fe-6f1465411926","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"267e786b-dd6e-45ba-a2c2-b3f58dd1727e","root":false,"$title":"Valida cadastro fatura digital","$position":{"top":"2135.75px","left":"1221px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"388e0007-29d8-415f-b1bd-9820f710afe3":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f792f02d-212f-4c8a-a374-c3cefb5b30d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f792f02d-212f-4c8a-a374-c3cefb5b30d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"8706c3fd-c722-4ba8-82a0-a83d26d4ccad","type":"text/plain","content":"Se preferir receber sua fatura completa todo mês no seu e-mail, posso te ajudar a fazer seu cadastro no serviço de fatura digital da Claro"},"$cardContent":{"document":{"id":"8706c3fd-c722-4ba8-82a0-a83d26d4ccad","type":"text/plain","content":"Se preferir receber sua fatura completa todo mês no seu e-mail, posso te ajudar a fazer seu cadastro no serviço de fatura digital da Claro"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"52093deb-fd9e-44d4-a3c8-addbc14461be","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"52093deb-fd9e-44d4-a3c8-addbc14461be","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"e141a983-4a68-4702-8df8-c1ede1a940dc","type":"text/plain","content":"Lembrando que, ao cadastrar a fatura digital, você *deixa de receber a fatura pelos correios*"},"$cardContent":{"document":{"id":"e141a983-4a68-4702-8df8-c1ede1a940dc","type":"text/plain","content":"Lembrando que, ao cadastrar a fatura digital, você *deixa de receber a fatura pelos correios*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"099751d8-e8ed-4dbd-b3ec-74426ec10f51","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"$cardContent":{"document":{"id":"099751d8-e8ed-4dbd-b3ec-74426ec10f51","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"0a9a731d-f4f0-4be0-a573-c3cf6d2f2a87","type":"text/plain","content":"Quer fazer seu cadastro?\n\n*1-* Sim\n*2-* Não"},"$cardContent":{"document":{"id":"0a9a731d-f4f0-4be0-a573-c3cf6d2f2a87","type":"text/plain","content":"Quer fazer seu cadastro?\n\n*1-* Sim\n*2-* Não"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"1c7e22b6-3360-4051-b7dd-3bc81fb02496","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0cfaf197-5b33-44a7-bc9a-7c6d961334ed","$connId":"con_588","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"12131009-a5b6-44df-8fe5-e1c0ceaf2602"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_593","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"7e8be7c4-b0cf-4ede-a05f-428e8100c2ae"},{"stateId":"e311cb07-ce3f-467a-827f-8b7316ff95e8","$connId":"con_598","conditions":[{"source":"context","comparison":"equals","variable":"confirmationCounter","values":["1"]}],"$invalid":false,"$id":"22513974-0dd9-4310-a593-4d4894bd80a4"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Selecao fatura no email exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura no email exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    var firstRegex = /^\\s*((1\\s*-?\\s*|1|um|primeir[oa])|((1\\s*-?\\s*)?sim[,.]?(\\s*quero)?)|(quero(\\s*sim)?))\\s*$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Sim\"}\n\n    var secondRegex = /^\\s*((2\\s*-?\\s*|2|dois|segund[oa])|((2\\s*-?\\s*)?n[aã]o(\\s*quero)?))\\s*$/i;\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Nao\"};\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n}\n","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"selecao fatura no email\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável -redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.2.2.1.1.2.1.1"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Selecao fatura no email selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Selecao fatura no email selecao","action":"{{chooseAnswer@content}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-d5a6f854-b1e6-47a3-991c-f2f77df6cd25","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6244ff66-1e6f-4d94-a080-720e2ec4f94b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e47d2646-62ba-4764-9fa9-4ac62582f9d9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5abc1795-79bf-468f-920c-41cf2829b729","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-0598d151-4958-432e-bd71-12a1ec882010","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"388e0007-29d8-415f-b1bd-9820f710afe3","root":false,"$title":"[A.1.2.2.1.1.2.1.1] Selecao fatura no email","$position":{"top":"2293.67px","left":"1040px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3500a05d-f5a3-42fe-9f89-379afa692592":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4f28d46-b9ad-46be-86b4-e4d7dadd9897","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_603","conditions":[{"source":"context","comparison":"notEquals","variable":"obterFaturasStatus","values":["200"]}],"$invalid":false,"$id":"bbbd398c-fd87-41ab-a10f-f0ab8532698f"},{"stateId":"6593bea0-cca3-47e3-ab7e-3144db0a38fb","$connId":"con_608","conditions":[{"source":"context","comparison":"equals","values":["0"],"variable":"quantidadeFaturas"}],"$invalid":false,"$id":"e1c66fc1-173d-4354-b9af-da4b9ace71ec"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Validacao de fatura existente para exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao de fatura existente para exibicao","action":"Exibicao"},"conditions":[],"$id":"3aaf6707-a6d2-48a0-b312-fcfb5bdb8150"},{"type":"TrackEvent","$title":"Validacao retorno de login segunda via","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao retorno de login segunda via","action":"{{token}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"token"}],"$id":"e9aa59fa-8be2-497d-b99b-4b3066ddea25"},{"type":"TrackEvent","$title":"Validacao retorno 2 via mais de um contrato","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao retorno 2 via mais de um contrato","action":"nao"},"conditions":[]},{"type":"ExecuteScript","$title":"formatar contrato (min digitos)","$invalid":false,"settings":{"function":"run","source":"function run(contrato) {\n    return contrato.padStart(9, \"0\");\n}","inputVariables":["contrato"],"outputVariable":"contratoFormatado","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessHttp","$title":"Obter Faturas","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/customerbill/invoices?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}&limit=3","responseStatusVariable":"obterFaturasStatus","responseBodyVariable":"faturas"},"conditions":[]},{"type":"ExecuteScript","$title":"quantidadeFaturas","$invalid":false,"settings":{"function":"run","source":"function run(faturas) {\n    try {\n    faturas = JSON.parse(faturas).data.data.invoices;\n    return faturas.length;\n  } catch (e) {\n    return 'error';\n  }\n}","inputVariables":["faturas"],"outputVariable":"quantidadeFaturas","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"menuFatura","$invalid":false,"settings":{"function":"run","source":"function run(faturas) {\n  faturas = JSON.parse(faturas).data.data.invoices;\n  let retorno = { lista: [], mensagem: '', detalhes: [] };\n\n  const monthNames = [\n    'Jan',\n    'Fev',\n    'Mar',\n    'Abr',\n    'Mai',\n    'Jun',\n    'Jul',\n    'Ago',\n    'Set',\n    'Out',\n    'Nov',\n    'Dez',\n  ];\n\n  const currencyFormatter = value => {\n    return ('R$ ' + value.toFixed(2)).replace('.', ',');\n  };\n\n  for (i = 0; i < faturas.length; i++) {\n    j = i + 1;\n\n    const [year, month, day] = faturas[i].dueDate.split('-');\n    let date = new Date(year, month - 1, day);\n\n    if (faturas[i].statusDescription == 'Pago') {\n      retorno.mensagem =\n        retorno.mensagem +\n        '*' +\n        j +\n        '-* ' +\n        monthNames[date.getMonth()] +\n        '/' +\n        date.getFullYear() +\n        ' (Paga)' +\n        '\\n';\n\n      retorno.detalhes[j] = {\n        vencimento:\n          '*' +\n          date.getUTCDate() +\n          '/' +\n          (date.getMonth() + 1) +\n          '/' +\n          date.getFullYear() +\n          '*',\n        valor: '*' + currencyFormatter(faturas[i].amount) + '*',\n        status: '*Paga* ✅',\n      };\n\n      retorno.lista[j] = faturas[i];\n    } else {\n      retorno.mensagem =\n        retorno.mensagem +\n        '*' +\n        j +\n        '-* ' +\n        monthNames[date.getMonth()] +\n        '/' +\n        date.getFullYear() +\n        ' (Em aberto)' +\n        '\\n';\n\n      retorno.detalhes[j] = {\n        vencimento:\n          '*' +\n          date.getUTCDate() +\n          '/' +\n          (date.getMonth() + 1) +\n          '/' +\n          date.getFullYear() +\n          '*',\n        valor: '*' + currencyFormatter(faturas[i].amount) + '*',\n        status: '*Em aberto* ⏳',\n      };\n\n      retorno.lista[j] = faturas[i];\n    }\n  }\n\n  return retorno;\n}","inputVariables":["faturas"],"outputVariable":"menuFatura","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"obterFaturasStatus","values":["200"]},{"source":"context","comparison":"greaterThan","variable":"quantidadeFaturas","values":["0"]}]},{"$id":"469b5300-c0ff-4009-a0e0-03edda87a9d6","$typeOfContent":"","type":"ExecuteScript","$title":"mensagemFatura","$invalid":false,"settings":{"function":"run","source":"function run(menuFatura) {\n    return JSON.parse(menuFatura).mensagem;\n}","inputVariables":["menuFatura"],"outputVariable":"mensagemFatura","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"obterFaturasStatus","values":["200"]},{"source":"context","comparison":"greaterThan","variable":"quantidadeFaturas","values":["0"]}]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"encode Response","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return encodeURI(input);\n            }","inputVariables":["faturas"],"outputVariable":"faturasEncoded","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"obterFaturasStatus","values":["202"]},{"source":"context","comparison":"notEquals","variable":"obterFaturasStatus","values":["200"]}]},{"type":"ExecuteScript","$title":"Perfil Residencial","$invalid":false,"settings":{"function":"run","source":"function run(tokenPayload, isBusinessClient) {\n    try{\n        var codigoOperadora = JSON.parse(tokenPayload).codigoOperadora;\n        if (codigoOperadora == '021') {\n            return 'Claro TV';\n        }\n        else if (codigoOperadora == '003') {\n            if (isBusinessClient) {\n                return 'Claro Empresas';\n            }\n            else {\n                return 'Claro Residencial';\n            }\n        }\n    }\n    catch (e) {\n        return 'perfil invalido';\n    }\n}","inputVariables":["tokenPayload","isBusinessClient"],"outputVariable":"perfilResidencial","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4f35370e-f47a-4ed0-a274-a3dd389194b8","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.minhaNetUrl}}/ecare-api-payment-history/api/v1/client/payment/history/NET/{{contratoFormatado}}/{{codigoOperadora}}/3';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Obter faturas segunda via\",\n            status: status,\n            response: response,\n            request: {\n                url: url,\n                cpf: \"{{tokenPayload@cpf}}\"\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["obterFaturasStatus","faturas"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"obterFaturasStatus","values":["200"]},{"source":"context","comparison":"notEquals","variable":"obterFaturasStatus","values":["202"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"4130f339-6a5c-46d8-a500-3f1cb8eb5e10","$invalid":false},"$tags":[{"id":"blip-tag-0b005b4e-c5a2-4d4d-ac01-907e9dbe9384","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-26be5582-d5b0-49e3-885b-890085d8e746","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-649e312c-3f57-4523-8582-d4e8eead4a60","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"3500a05d-f5a3-42fe-9f89-379afa692592","root":false,"$title":"Obter faturas segunda via","$position":{"top":"1301px","left":"1735px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"65b4a31a-6bdc-4f4d-b849-88964a1dc1e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5a83dd86-820d-45d1-a591-4e20e808cf98","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_613","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"envioEmailStatus"}],"$invalid":false,"$id":"5f28c77b-e904-4678-ab88-c87cc6d8eeb8"},{"stateId":"fbb48055-374c-4d94-bab4-3b1f8202555d","$connId":"con_618","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"5ad390c7-1603-4ef0-9afa-dc59e7c09179"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Enviar Email","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"POST","body":"{\r\n    \"AccessToken\": \"{{tokenAccessFormated}}\",\r\n    \"Document\": \"{{tokenPayload@cpf}}\",\r\n    \"ContractNumber\": \"{{tokenPayload@contrato}}\",\r\n    \"OperatorCode\": \"{{tokenPayload@codigoOperadora}}\",\r\n    \"data\": {\r\n        \"invoiceId\": {{faturaSelecionada@invoiceId}},\r\n        \"emailData\": {\r\n            \"documentType\":\"invoice\",\r\n            \"email\":\"{{chosenEmail}}\"\r\n        }\r\n    }\r\n}","uri":"{{config.apiUrl}}/v1/intermediate/customerbill/bills","responseStatusVariable":"envioEmailStatus","responseBodyVariable":"envioEmail"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"encode envioEmail","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return encodeURI(input); \n            }","inputVariables":["envioEmail"],"outputVariable":"envioEmailEncoded","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"envioEmailStatus","values":["200"]},{"source":"context","comparison":"notEquals","variable":"envioEmailStatus","values":["202"]}]},{"$id":"2239ee9f-1fa4-49d5-b7df-92070ac15bf5","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/customerbill/bills';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Enviar e-mail\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["envioEmailStatus","envioEmail"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"envioEmailStatus","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-90373244-a5a0-4f7b-9011-2aafbec7472f","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-2fb2e372-43ea-4595-8de0-1b1c54684fa3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"65b4a31a-6bdc-4f4d-b849-88964a1dc1e9","root":false,"$title":"Enviar e-mail","$position":{"top":"1840px","left":"1480px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c1822311-3d36-42d2-a8b7-6d5c7bae0555":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"502fc8e9-7c0c-4325-ae2d-6e7bccd01d81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_623","conditions":[{"source":"input","comparison":"equals","values":["#finalizacao"]}],"$invalid":false,"$id":"6593322d-61b7-4a58-bfd8-bc4fa7cc7689"},{"stateId":"07e22cc5-0aca-4f74-8296-d99e6eaa6a5f","$connId":"con_628","conditions":[{"source":"input","comparison":"equals","values":["#menu"]}],"$invalid":false,"$id":"bf655b60-e07d-47ae-b207-8247915e3d0b"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_633","conditions":[{"source":"input","comparison":"equals","values":["#AjudaAutenticacao"]}],"$invalid":false,"$id":"0b26515d-88e2-42d9-b157-a8294ab7b66a"},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_638","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false,"$id":"110f1298-ea5d-4de7-a254-51da76b06d31"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","typeOfStateId":"state","$connId":"con_643","$id":"9d49873a-9f0d-4ea1-a340-53a9a3bddcaa","conditions":[{"source":"context","comparison":"equals","values":["Ajuda com login"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"ec3bf851-2c33-462b-bbe5-1b027fe47da4","typeOfStateId":"state","$connId":"con_648","$id":"2b9d3a54-e318-4288-9eb2-af106aa879df","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","typeOfStateId":"state","$connId":"con_653","$id":"fa297966-edc0-403e-8215-9914834fe626","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6bcdcd3f-aafd-4c9f-ab92-9021edff8158","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var date = new Date();\n    return {\n        name: 'Débito automático',\n        channel: 'Faturamento Residencial',\n        text: 'com o seu débito automático',\n        date: date\n    }\n}","inputVariables":[],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"907a475c-a58c-46fa-b053-5cce0a489e1c","$typeOfContent":"","type":"ExecuteScript","$title":"loginOptions","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return {\n        templateText: 'Para te ajudar com esse assunto',\n        menu: 'Ou, *se preferir*, escolha uma das opções:\\n\\n*1-* Ajuda com o login\\n*2-* Voltar ao Menu anterior\\n*3-* Sair',\n        options: [\n            {\n                content: 'Ajuda com login',\n                regex: 'ajuda',\n            },\n            {\n                content: `Voltar ao menu`,\n                regex: 'voltar?|menu',\n            },\n            {\n                content: 'Sair',\n                regex: 'sair?',\n            },\n        ],\n        trackingExhibition: 'exibicao',\n        trackingOption: 'selecao',\n        trackingInput: 'input',\n    };\n}\n","inputVariables":[],"outputVariable":"loginOptions","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"Redirect","$title":"Redirect to \"{{config.servicoAutenticacao}}\"","$invalid":false,"settings":{"address":"{{config.servicoAutenticacao}}","context":{"type":"text/plain","value":"#faturaNet#loginWithOptions#v2"}},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5e11a338-7db9-4223-bac6-e0ff5abc72a3","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-15739444-609f-4bcd-861f-0d85ebf68d23","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ccdadbf4-27d3-4efe-910b-6ef30e718a67","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-c22e178c-4c53-4aff-94f4-9b8184508ff4","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c1822311-3d36-42d2-a8b7-6d5c7bae0555","root":false,"$title":"Redireciona login debito automatico","$position":{"top":"1016px","left":"5784px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"71985007-21d4-4857-a4e2-b12b5dbbbfc0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9bbd568-fc71-4a0a-84f3-879380671fcf","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"349b8147-05a1-4301-aab5-2702abd6a295","$connId":"con_658","conditions":[{"source":"context","comparison":"approximateTo","values":["CORREIO"],"variable":"getRespostaFaturasPorCodigo@data.postType"}],"$invalid":false,"$id":"dcc7967d-86f7-4ee1-9d02-38d890f2f89b"},{"stateId":"57fea87f-de6d-4e71-af4c-ce1bb5799003","$connId":"con_663","conditions":[{"source":"context","comparison":"approximateTo","values":["EMAIL"],"variable":"getRespostaFaturasPorCodigo@data.postType"}],"$invalid":false,"$id":"b1cdfac7-86c3-4372-b32a-6a2e12d101ad"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Get Metodo Envio de fatura","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/AccountManagement/billing-datas?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","responseStatusVariable":"statusRespostaFaturasPorCodigo","responseBodyVariable":"getRespostaFaturasPorCodigo"},"conditions":[],"$id":"d371b32c-938c-4537-9d77-6a0b8c681c3f"},{"type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento) {\n    var channel = 'Claro Residencial';\n    if(tipoAtendimento == 'tv') {\n        channel = 'Claro TV';\n    }\n    \n    var date = new Date();\n    return {\n        name: 'Fatura digital',\n        channel: 'Claro Residencial',\n        text: 'com fatura digital',\n        date: new Date()\n    }\n}","inputVariables":["tipoAtendimento"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Validacao retorno de login fatura digital NET","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao retorno de login fatura digital NET","action":"{{token}}"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"verficar se tem fatura digital\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Enconde getRespostaFaturasPorCodigo","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return encodeURIComponent(input);\n            }","inputVariables":["getRespostaFaturasPorCodigo"],"outputVariable":"encodedGetRespostaFaturasPorCod","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusRespostaFaturasPorCodigo","values":["200"]}]},{"$id":"6d2831a1-b8c9-4732-b685-c5b4fe1972dc","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/AccountManagement/billing-datas?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Verificar se tem fatura digital\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["statusRespostaFaturasPorCodigo","getRespostaFaturasPorCodigo"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusRespostaFaturasPorCodigo","values":["200"]}]},{"$id":"f4b81ad4-ad1c-4dad-a0f6-78873be94847","$typeOfContent":"","type":"SetVariable","$title":"emailFaturaDigital","$invalid":false,"settings":{"variable":"emailFaturaDigital","value":"{{getRespostaFaturasPorCodigo@data.email}}"},"conditions":[{"source":"context","comparison":"equals","variable":"statusRespostaFaturasPorCodigo","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-11b0245c-6719-417b-aad9-358f5e0cefd9","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-346f5c55-1c64-48c7-b7d5-b52341dd00d4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6e68c010-c64f-46f0-9ee7-c7fd380c0767","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0107959f-8fd4-451b-897a-423112e06435","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"71985007-21d4-4857-a4e2-b12b5dbbbfc0","root":false,"$title":"[A.1.3.2.1] Verificar se tem Fatura Digital","$position":{"top":"715.5px","left":"3790.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2d71a3ee-2689-43af-ad4a-8fb2f0bb09a8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"191e9ba6-ecd5-4ed5-a546-879087fea4e0","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_668","$id":"3ec53dbc-f75f-481f-b406-91f0788d1e44","conditions":[{"source":"context","comparison":"notEquals","variable":"respCancelaFatura","values":["200"]}],"$invalid":false}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Cancelar fatura Digital","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"PUT","uri":"{{config.apiUrl}}/v1/intermediate/AccountManagement/billing-datas","responseStatusVariable":"respCancelaFatura","responseBodyVariable":"respBodyCancelaFatura","body":"{\n    \"AccessToken\": \"{{tokenAccessFormated}}\",\n    \"Document\": \"{{tokenPayload@cpf}}\",\n    \"ContractNumber\": \"{{tokenPayload@contrato}}\",\n    \"OperatorCode\": \"{{tokenPayload@codigoOperadora}}\",\n    \"data\": {\n        \"isEmail\": false,\n        \"email\": \"{{emailFaturaDigital}}\"\n    }\n}"},"conditions":[],"$id":"28050d9c-f15f-42c2-9931-3b15d251b9da"}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Process \"respBodyCancelaFaturaEncoded\"","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return encodeURI(input)\n            }","inputVariables":["respBodyCancelaFatura"],"outputVariable":"respBodyCancelaFaturaEncoded","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e4fd9f1e-34d6-463f-b5f4-a7baf1d3e35e","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/AccountManagement/billing-datas';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Cancela Fatura por E-mail\",\n            status: status,\n            response: response,\n            request: {\n                url: url,\n                body: {\n                    \"isEmail\": false,\n                    \"email\": \"{{email}}\"\n                }\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["respCancelaFatura","respBodyCancelaFatura"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"respCancelaFatura","values":["202"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"39d1c7c7-05e2-4ffa-830f-b87d658a1d4c","$invalid":false},"$tags":[{"id":"blip-tag-d6c9619f-d788-499e-b503-7b4213eec494","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-5a6bac37-35a3-42d5-a9d7-a9b4ade76694","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"2d71a3ee-2689-43af-ad4a-8fb2f0bb09a8","root":false,"$title":"Cancela Fatura por E-mail","$position":{"top":"1385px","left":"4858px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1d072f34-9ce8-43ef-b3a9-8c710c85c89d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"191e9ba6-ecd5-4ed5-a546-879087fea4e0","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3a7d3209-9650-4ec2-b299-420f3fbcbb0a","$connId":"con_673","$id":"35a99262-afc0-4fc7-872d-a3a1e09aa499","conditions":[{"source":"context","comparison":"equals","values":["400"],"variable":"statusCadastraDcc"},{"source":"context","comparison":"contains","variable":"responseCadastraDcc","values":["Unprocessable Entity"]}],"$invalid":false},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_678","$id":"78778172-e566-4c0e-b14f-fb3c38c4bf96","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusCadastraDcc"}],"$invalid":false},{"stateId":"69391e65-79b0-489d-9893-84fc627a7c35","$connId":"con_683","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"selectedBank"}],"$invalid":false,"$id":"b2aa054c-98b8-47b8-824a-1879b5be78a5"},{"stateId":"69391e65-79b0-489d-9893-84fc627a7c35","$connId":"con_688","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"selectedBank"}],"$invalid":false,"$id":"a303b48d-b7c3-4b93-812a-fbcaffd38399"},{"stateId":"369492f1-4368-4286-82e3-e4bd257cf2de","$connId":"con_693","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"e658e59a-8493-4700-ba23-ce9fa11729b2"}],"$enteringCustomActions":[{"$id":"130d7c24-c054-443c-be50-c3b51ede8966","type":"ProcessHttp","$title":"PUT Cadastra Dcc","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"PUT","body":"{\n    \"AccessToken\": \"{{tokenAccessFormated}}\",\n    \"Document\": \"{{tokenPayload@cpf}}\",\n    \"ContractNumber\": \"{{tokenPayload@contrato}}\",\n    \"OperatorCode\": \"{{tokenPayload@codigoOperadora}}\",\n    \"Data\": {\n        \"bank\": {{codBanco}},\n        \"agency\": \"{{numeroDaAgencia}}\",\n        \"accountNumber\": \"{{conta@numero}}\",\n        \"accountDigit\": \"{{conta@digito}}\"\n    }\n}","uri":"{{config.apiUrl}}/v1/intermediate/paymentmethods/dcc","responseStatusVariable":"statusCadastraDcc","responseBodyVariable":"responseCadastraDcc"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - encode respBodyHabilitarDebito","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return encodeURI(input)\n            }","inputVariables":["respBodyHabilitarDebito"],"outputVariable":"respBodyHabilitarDebitoEncoded","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"respHabilitarDebito","values":["200"]},{"source":"context","comparison":"notEquals","variable":"respHabilitarDebito","values":["202"]}]},{"$id":"8e9bddec-817b-4bf1-8cd3-8d6ea81b7c81","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/paymentmethods/dcc';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Cadastra Débito Automático\",\n            status: status,\n            response: response,\n            request: {\n                url: url,\n                body: {\n                    \"banco\": \"{{nomeDoBanco}}\",\n                    \"codigoBanco\": \"{{codBanco}}\",\n                    \"agencia\": \"{{numeroDaAgencia}}\",\n                    \"contaCorrente\": \"{{conta@numero}}-{{conta@digito}}\",\n                    \"confirmacaoBanco\": true\n                }\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["statusCadastraDcc","responseCadastraDcc"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusCadastraDcc","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"369492f1-4368-4286-82e3-e4bd257cf2de","$invalid":false},"$tags":[{"id":"blip-tag-241026ba-bf99-4c61-9a16-b458835bf215","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-d98393b5-ad1c-40d0-99ee-01774b90304b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1d072f34-9ce8-43ef-b3a9-8c710c85c89d","root":false,"$title":"Cadastra Débito Automático","$position":{"top":"2046px","left":"5782px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5e11a338-7db9-4223-bac6-e0ff5abc72a3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4c8ff8b4-41a8-427f-b5ef-8d8aba473394","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fc5bb3b7-0e81-4998-b17d-afc7307524ec","$connId":"con_698","conditions":[{"source":"context","comparison":"notEquals","values":["DEBITO EM CONTA"],"variable":"tokenPayload@formaPagamento"}],"$invalid":false,"$id":"b070f914-d851-4ba1-91b8-fb5f8e3b7c09"},{"stateId":"a367020e-6886-4b85-9ac6-5d2a6a082b4b","$connId":"con_703","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"52ecd391-0d88-49c3-87b0-565344ff4722"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Validacao retorno de login debito automatico NET","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao retorno de login debito automatico NET","action":"{{token}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-84736afd-6fc3-4180-8c75-ec8727b1322f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5e11a338-7db9-4223-bac6-e0ff5abc72a3","root":false,"$title":"Verificar se tem débito cadastrado","$position":{"top":"1167.56px","left":"5776.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a367020e-6886-4b85-9ac6-5d2a6a082b4b":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"b6baf7be-fa1c-40c9-af0f-2307026e16d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b6baf7be-fa1c-40c9-af0f-2307026e16d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"4ecea51f-51b5-4c02-a752-75a56aaa6505","type":"text/plain","content":"Identifiquei que você já possui o débito automático cadastrado como forma de pagamento, como eu posso te ajudar?\n\n*1-* Alterar o cadastro\n*2-* Cancelar débito automático\n*3-* Voltar ao Menu  de faturas\n*4-* Sair","metadata":{}},"$cardContent":{"document":{"id":"4ecea51f-51b5-4c02-a752-75a56aaa6505","type":"text/plain","content":"Identifiquei que você já possui o débito automático cadastrado como forma de pagamento, como eu posso te ajudar?\n\n*1-* Alterar o cadastro\n*2-* Cancelar débito automático\n*3-* Voltar ao Menu  de faturas\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"2e924f4b-3171-4b41-af3e-2a7738b72dfe","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"332f5478-463c-42cd-9f3c-da92d2ffefc7","$connId":"con_708","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"d04df009-4721-4ce7-baa9-19636ab8d406"},{"stateId":"6c6c86ef-3eb8-4fc8-8b5d-4957f77a4d52","$connId":"con_713","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"047af330-2d0b-4892-a387-dc12f63ebcc0"},{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","$connId":"con_718","$id":"22d84ea1-9282-42fd-8cc4-98a7a70e64a6","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"typeOfStateId":"state"},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$connId":"con_723","$id":"464c747d-8a0e-4548-8572-c2aa3a8d2e56","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Retorno login debito automatico net cadastradro exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Retorno login debito automatico net cadastradro exibicao","action":"Exibicao"},"conditions":[],"$id":"85197c52-bfbc-49eb-ba09-1b3324d6e1a0"}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Choose Answer","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    let regex = /^\\s*((1)|(alterar)|(cadastro)|(Alterar(\\s*o?) cadastro))\\s*$/gmi;\n    if (regex.test(input))\n        return { option: \"1\", content: \"Alterar o cadastro\" }\n\n    regex = /^\\s*((2)|(cancelar)|(cancelar d[e|é]bito autom[a|á]tico)|(d[e|é]bito autom[a|á]tico))$/i;\n    if (regex.test(input))\n        return { option: \"2\", content: \"Cancelar debito automatico\" };\n\n    regex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|[eé]\\s*[ao]?)\\s*)?((0*3\\s*)|(tr[êe]s)|voltar|(terceir[ao]\\s*(op[cç][aã]o?)?)|((0*3\\s*)?(voltar (ao?)?|(menu)?\\s*?de fatura[s]?)\\s*\\s*((menu)?\\s*?de fatura?s)?))\\s*$/i;\n    if (regex.test(input))\n        return { option: \"3\", content: \"Voltar ao Menu de Faturas\" };\n\n    regex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*4\\s*)|quatro|(quart[ao]\\s*(op[cç][aã]o?)?)|((0*4\\s*)?sair))\\s*$/i\n    if (regex.test(input))\n        return { option: \"4\", content: \"Sair\" };\n\n    return { option: \"invalid\", content: \"input inesperado\" };\n\n}\n","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"debito ja cadastrado\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}},{"$id":"2cb142bb-34a1-45f2-8d00-95bd3abf4ee8","$typeOfContent":"","type":"TrackEvent","$title":"Retorno login debito automatico net cadastradro selecao","$invalid":false,"settings":{"extras":{},"category":"Retorno login debito automatico net cadastradro selecao","action":"{{input.content}}"},"conditions":[]},{"$id":"6d9f9ca6-df4e-4907-afa0-9c7d9c66c290","$typeOfContent":"","type":"TrackEvent","$title":"Retorno login debito automatico net cadastradro input","$invalid":false,"settings":{"extras":{},"category":"Retorno login debito automatico net cadastradro input","action":"{{chooseAnswer@content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-315251b2-af1f-46e1-b275-3506fcf1c961","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3b5f15fd-6660-4147-815d-d3a915cddbb6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9d9b6ae0-9e98-4cd1-924b-0e190fcabf5a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-e49578d4-2513-44bd-a495-50204ac05f57","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a367020e-6886-4b85-9ac6-5d2a6a082b4b","root":false,"$title":"[A.1.4.2.1.1.2] Debito ja cadastrado","$position":{"top":"1384.33px","left":"6038px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b290aa9b-f2f6-4a8c-ad4c-1a13a95e9e93":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8bd01feb-c37c-4032-ada2-5973bc800926","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d249b398-2f12-4491-9659-387a9c056dd1","$connId":"con_728","$id":"706942ee-721c-4e39-ad96-309dac4c2dd1","conditions":[{"source":"context","comparison":"equals","values":["404"],"variable":"documentCheckStatus"},{"source":"context","comparison":"equals","variable":"tentativaCpf","values":["0"]}],"$invalid":false},{"stateId":"f42dc5d7-1eb1-47b0-bb11-ecb31aa9c752","typeOfStateId":"state","$connId":"con_733","$id":"fc6202d1-3e42-43a9-95c7-aa3bb4d4fba2","conditions":[{"source":"context","comparison":"equals","values":["404"],"variable":"documentCheckStatus"},{"source":"context","comparison":"equals","variable":"tentativaCpf","values":["1"]}],"$invalid":false},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_738","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"documentCheckStatus"},{"source":"context","comparison":"notEquals","variable":"documentCheckStatus","values":["404"]}],"$invalid":false,"$id":"a7acfd81-cefb-4690-bb51-c3d3b2fa3346"},{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","$connId":"con_743","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"documentCheckBody@isValid"}],"$invalid":false,"$id":"ffeb3852-ab43-4fff-ad39-7a49e4c21877"},{"stateId":"fallback","$connId":"con_748","conditions":[{"source":"context","comparison":"equals","values":["None"],"variable":"documentCheckBody@type"}],"$invalid":false,"$id":"879fe288-d15e-449e-82e9-7e97a2b550de"},{"stateId":"fallback","$connId":"con_753","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"documentCheckBody"}],"$invalid":false,"$id":"5339d04b-3724-4b9c-b9f1-276d017884c4"},{"stateId":"d249b398-2f12-4491-9659-387a9c056dd1","$connId":"con_758","conditions":[{"source":"context","comparison":"equals","values":["0"],"variable":"tentativaCpf"}],"$invalid":false,"$id":"a5b194fa-71f8-48f8-972c-5492f110a35a"},{"stateId":"f42dc5d7-1eb1-47b0-bb11-ecb31aa9c752","$connId":"con_763","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"tentativaCpf"}],"$invalid":false,"$id":"bc18f537-b1e0-41df-9a43-7c79eb446983"},{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","typeOfStateId":"state","$connId":"con_768","$id":"44379368-b8da-472a-ba12-a6088e8e2c4f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"type":"SetVariable","$title":"documentCheckBody = false","$invalid":false,"settings":{"variable":"documentCheckBody","value":"false"},"conditions":[]},{"type":"ExecuteScript","$title":"Remove Non Digits From CPF","$invalid":false,"settings":{"function":"run","source":"            function run(input) {\n                return input.replace(/\\D/g,'');\n            }","inputVariables":["cpfinformado"],"outputVariable":"cpfInformado","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4f6f9dca-c1c5-4bba-aa4f-2665397cd816","$typeOfContent":"","type":"ExecuteScript","$title":"isCpfAttempt","$invalid":false,"settings":{"function":"run","source":"function run(cpfInformado) {\r\n    return String(cpfInformado).length > 8;\r\n}","inputVariables":["cpfInformado"],"outputVariable":"isCpfAttempt","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessHttp","$title":"Requisição HTTP - check cpf","$invalid":false,"settings":{"headers":{"x-application-id":"whatsapp"},"method":"GET","uri":"{{config.apiUrl}}/document/check/{{cpfInformado}}","responseStatusVariable":"documentCheckStatus","responseBodyVariable":"documentCheckBody"},"conditions":[]},{"type":"ExecuteScript","$title":"Verifica se é cpnj ou cpf","$invalid":false,"settings":{"function":"run","source":"function run(input) {\r\n    try {\r\n        const lenInput = String(input).length;\r\n        if (lenInput === 11) {\r\n            return \"cpf\";\r\n        } else if (lenInput === 14) {\r\n            return \"cnpj\";\r\n        } else {\r\n            return \"invalid\";\r\n        }\r\n    } catch (e) {\r\n        return \"invalid\";\r\n    }\r\n}","inputVariables":["cpfInformado"],"outputVariable":"tipoDocumento","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"documentCheckBody@isValid","values":["true"]},{"values":["200"],"source":"context","comparison":"equals","variable":"documentCheckStatus"}]}],"$leavingCustomActions":[{"$id":"2f640a91-257f-4fc7-8954-e0a2531d7dce","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/document/check/{{cpfInformado}}';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Validar CPF\",\n            status: status,\n            response: response,\n            request: {\n                url: url,\n                cpf: \"{{cpfInformado}}\"\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["documentCheckStatus","documentCheckBody"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"comparison":"notEquals","source":"context","variable":"documentCheckStatus","values":["200"]},{"source":"context","comparison":"notEquals","variable":"documentCheckStatus","values":["202"]},{"source":"context","variable":"documentCheckStatus","values":["404"],"comparison":"notEquals"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-37bb3b72-665b-4874-9364-f8181bf9c9ea","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4610e4de-a437-49b9-8e84-c545cc796c5e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c2a14d95-839b-4a78-a669-dd47e32aef83","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"b290aa9b-f2f6-4a8c-ad4c-1a13a95e9e93","root":false,"$title":"Validar CPF","$position":{"top":"412.75px","left":"217px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9d3a8018-0997-4fc6-b5c6-cc008416af8c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"08b3042c-176b-404d-b1ca-6c5aac5267a7","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_773","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"getInvoicesStatus"},{"source":"context","comparison":"notEquals","variable":"getInvoicesStatus","values":["422"]}],"$invalid":false,"$id":"2694538b-4816-4d31-bea5-bec63f032572"},{"stateId":"5e84bd2e-c9e9-4ac8-afec-838929e6df75","$connId":"con_778","conditions":[{"source":"context","comparison":"equals","values":["422"],"variable":"getInvoicesStatus"},{"source":"context","comparison":"contains","variable":"getInvoicesBody@error.detailedMessage","values":["NET"]}],"$invalid":false,"$id":"8b4956e9-c05a-4fee-a259-aa6ad15d4313"},{"stateId":"d5dac5eb-2d52-4c06-80c0-4f96e8f618d1","$connId":"con_783","conditions":[{"source":"context","comparison":"equals","values":["422"],"variable":"getInvoicesStatus"}],"$invalid":false,"$id":"52cad384-beed-4ee0-8090-843e974c7bd9"},{"stateId":"d5dac5eb-2d52-4c06-80c0-4f96e8f618d1","$connId":"con_788","conditions":[{"source":"context","comparison":"equals","values":["null"],"variable":"getInvoicesBody@data"},{"source":"context","comparison":"equals","variable":"getInvoicesStatus","values":["200"]}],"$invalid":false,"$id":"de6386df-cd62-4f7b-a844-2bbbfdaee63d"},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_793","$id":"713789ac-bd9d-433b-80bf-b30387d5bd07","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"scriptErrorInfo"}],"$invalid":false},{"stateId":"4a128f07-979f-47cb-9dc6-b85e6320669e","$connId":"con_798","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"faturas"},{"source":"context","comparison":"equals","variable":"faturas@count","values":["1"]}],"$invalid":false,"$id":"5fd07490-e16c-40ad-8012-678b6b2dbf2c"},{"stateId":"e9546479-ce90-4b00-86f0-b26450d04f02","$connId":"con_803","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"faturas"}],"$invalid":false,"$id":"faf54aa6-450d-4948-97e9-355becf3558b"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Obter faturas","$invalid":false,"settings":{"headers":{"api-key":"{{config.apiKeyInvoice}}","QueryString":"partyIdentificationNumber={{cpfInformado}}&company=residencial"},"method":"POST","uri":"{{config.apiUrl}}/invoices/apigee","responseStatusVariable":"getInvoicesStatus","responseBodyVariable":"getInvoicesBody","body":"{\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\"\n}"},"conditions":[]},{"type":"TrackEvent","$title":"Validacao cpf fatura","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao cpf fatura","action":"Sim"},"conditions":[]},{"type":"ExecuteScript","$title":"faturas em aberto","$invalid":false,"settings":{"function":"run","source":"function run(getInvoicesBody) {\n    try {\n        var faturas = JSON.parse(getInvoicesBody).data;\n        faturas['count'] = faturas.invoices.length\n        return JSON.stringify(faturas);\n    } catch (e) {\n        return \"ScriptError:\" + e;\n    }\n}","inputVariables":["getInvoicesBody"],"outputVariable":"faturas","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - encode getInvoicesBody","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return encodeURI(input);\n            }","inputVariables":["getInvoicesBody"],"outputVariable":"getInvoicesBodyEncoded","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"getInvoicesStatus","values":["200"]},{"source":"context","comparison":"notEquals","variable":"getInvoicesStatus","values":["202"]}]},{"$id":"125928fb-e361-4aca-a3fc-a90fa3fcd78c","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/invoices/apigee';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Obter faturas Cod Barras\",\n            status: status,\n            response: response,\n            request: {\n                url: url,\n                queryString: 'partyIdentificationNumber={{cpfInformado}}&company=residencial',\n                cpf: \"{{cpfInformado}}\"\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["getInvoicesStatus","getInvoicesBody"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"getInvoicesStatus","values":["200"]},{"source":"context","comparison":"notEquals","variable":"getInvoicesStatus","values":["202"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-ebe29158-3f8f-453d-8115-6f33261f7c0d","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-0226ebd5-ef4a-4cfa-aa42-e6fdb9ec766b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-da072d94-5707-457a-8da1-2324d912793e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","root":false,"$title":"Obter faturas Cod Barras","$position":{"top":"543px","left":"220px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d249b398-2f12-4491-9659-387a9c056dd1":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"4c4e0975-a605-4382-a2b5-36be6d236ec0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4c4e0975-a605-4382-a2b5-36be6d236ec0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"872c2bd4-efac-451f-ac6a-19c952525509","type":"text/plain","content":"{{message}}"},"$cardContent":{"document":{"id":"872c2bd4-efac-451f-ac6a-19c952525509","type":"text/plain","content":"{{message}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"99281c11-94ac-4dd6-bd9a-1b74a89c94b7","type":"text/plain","textContent":"Entrada do usuário","content":"cpfInformado"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"cpfInformado"},"$invalid":false}],"$conditionOutputs":[{"stateId":"b290aa9b-f2f6-4a8c-ad4c-1a13a95e9e93","$connId":"con_808","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"57f5cdb1-d9f3-448f-8bc3-5f1794f30b9b"}],"$enteringCustomActions":[{"$id":"b4cd6d27-6b79-416f-bc9a-6b642768e506","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"inputContentSubstring"}]},{"$id":"4e4aab5f-9506-4306-8f0a-4259a854b8d0","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial cpf prim erro sim exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial cpf prim erro sim exibicao","action":"Exibicao"},"conditions":[]},{"type":"SetVariable","$title":"Tentativa CPF","$invalid":false,"settings":{"variable":"tentativaCpf","value":"1"},"conditions":[]},{"type":"ExecuteScript","$title":"Get Message","$invalid":false,"settings":{"function":"run","source":" function run(input) {\n    if(input == \"confirmacao\"){\n        return \"\"\n    }else{\n        return `Oops... você me enviou uma mensagem que não condiz com o que era esperado. 😅\n\nMe informe por favor o *seu CPF ou CNPJ com apenas os números.*`\n    }\n}","inputVariables":["lastState"],"outputVariable":"message","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2a3b4261-ca0a-4514-b4b8-37d9e2857b5e","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial cpf valido validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial cpf valido validacao","action":"nao"},"conditions":[]},{"$id":"8cfc5804-2b13-4402-b06c-617b1be82e26","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial cpf prim erro validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial cpf prim erro validacao","action":"Sim"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"cpf invalido\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$invalid":false},"$tags":[{"id":"blip-tag-6774967e-d81d-4f8e-8356-697bb90c9095","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-df67de37-ad58-4484-afbb-42590c9930f0","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f66836a2-d0c8-4802-af54-84a9f9c5cfd5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5bd36b0b-58ac-4235-aa15-a515663fd0ee","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-ae0f53d0-859a-4c6f-8049-e50d9039c388","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"d249b398-2f12-4491-9659-387a9c056dd1","root":false,"$title":"[CBR.0.0.2] CPF Inválido 1 Vez","$position":{"top":"411.75px","left":"528px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f42dc5d7-1eb1-47b0-bb11-ecb31aa9c752":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"40cdae00-5e72-4741-a830-71068a356f45","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"40cdae00-5e72-4741-a830-71068a356f45","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"85beb313-c07b-4b4a-a4d1-af4a43b8f046","type":"text/plain","content":"Infelizmente, eu não estou conseguindo validar o seu CPF ou CNPJ. 😔\n\nMas sem problemas! Toque no link abaixo para obter sua(s) fatura(s) de outra maneira. 👇\n\nbit.ly/RESFAT2","metadata":{}},"$cardContent":{"document":{"id":"85beb313-c07b-4b4a-a4d1-af4a43b8f046","type":"text/plain","content":"Infelizmente, eu não estou conseguindo validar o seu CPF ou CNPJ. 😔\n\nMas sem problemas! Toque no link abaixo para obter sua(s) fatura(s) de outra maneira. 👇\n\nbit.ly/RESFAT2"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"4c7ac8bb-6907-4b0c-9fce-a29f2771b4d1","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bdd2f2dc-6f59-4b25-aab9-31fc43796ae9","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"action":"{{inputContentSubstring}}","category":"Codigo barras residencial inesperado"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"inputContentSubstring"}]},{"$id":"1c5f135d-7895-4238-a641-870217c52429","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial cpf prim erro validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial cpf prim erro validacao","action":"nao"},"conditions":[]},{"$id":"e9cf9675-6dba-4bfe-baa9-1bc29974d5ef","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial cpf segu erro validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial cpf segu erro validacao","action":"Sim"},"conditions":[]},{"$id":"b5b2a6d6-4e3b-42ec-932d-1610457b89b6","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial cpf segu erro sim exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial cpf segu erro sim exibicao","action":"Exibicao"},"conditions":[]},{"$id":"76267200-b065-4cef-be44-34936218f0ce","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial cpf prim erro sim inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial cpf prim erro sim inesperado","action":"{{input.content}}"},"conditions":[]},{"$id":"f9b60407-328d-4d6c-8279-481627c09f07","$typeOfContent":"","type":"ExecuteScript","$title":"invalidCpfMessageWebLink","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var link = encodeURI(\"https://bit.ly/RESFAT2\");\n    var message = `*Clique no link* abaixo para obter sua(s) fatura(s) ⬇️\\n\\n${link}`;\n\n    var template = {\n        content: {\n            preview_url: true,\n            recipient_type: \"individual\",\n            type: \"text\",\n            text: {\n                body: message\n            }\n        },\n        mimeType: \"application/json\"\n    }\n\n    return template;\n}\n","inputVariables":[],"outputVariable":"invalidCpfMessageWebLink","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"cpf invalido 2 vez\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-ca351779-cd1d-41ff-a368-e83402d2b458","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b447b8c9-e866-4272-bd57-e6922c229835","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f7c03dde-60bd-44a4-bb0f-f955be5371e7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f42dc5d7-1eb1-47b0-bb11-ecb31aa9c752","root":false,"$title":"CPF Inválido 2 Vez","$position":{"top":"685px","left":"57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5e84bd2e-c9e9-4ac8-afec-838929e6df75":{"$contentActions":[{"action":{"$id":"bb1affd4-766f-4c9e-af09-d717c60b1dbc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"123dd6c9-dc25-4269-9fd7-2d5ab3d6a8c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"123dd6c9-dc25-4269-9fd7-2d5ab3d6a8c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"67cb632b-a9fc-4361-b751-53894e363322","$typeOfContent":"text","type":"SendMessage","settings":{"id":"314ddf0a-0fe7-4420-93a3-79a6fcb80f54","type":"text/plain","content":"Hmm... infelizmente eu não consegui encontrar o seu contrato. 😔\n\nPara outras solicitações, acesse o link abaixo. 👇\nbit.ly/RESFAT2","metadata":{}},"$cardContent":{"document":{"id":"314ddf0a-0fe7-4420-93a3-79a6fcb80f54","type":"text/plain","content":"Hmm... infelizmente eu não consegui encontrar o seu contrato. 😔\n\nPara outras solicitações, acesse o link abaixo. 👇\nbit.ly/RESFAT2"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"73801115-acbe-458e-b15a-b71dcec35894","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a8781eef-76d7-4b41-abed-a77f9def1801","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial contr encont validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial contr encont validacao","action":"nao"},"conditions":[]},{"$id":"f567ccd0-0dda-4eb9-ae12-3d3bad469e0b","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial contr encont nao exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial contr encont nao exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"cliente não encontrado\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-85b5903b-1c8a-4f9f-a387-541bea81a065","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c0cd375f-56eb-460f-9d84-a25adc6b9909","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d5d32236-8d4e-4b19-acf8-2694c2624d9c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5e84bd2e-c9e9-4ac8-afec-838929e6df75","root":false,"$title":"[CBR.0.0.3] Contrato não encontrado","$position":{"top":"613px","left":"830px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d5dac5eb-2d52-4c06-80c0-4f96e8f618d1":{"$contentActions":[{"action":{"$id":"58269661-66d8-4755-9172-dfff63499405","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"64df84f8-3baa-4d5b-aed8-d4f5d969f772","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"64df84f8-3baa-4d5b-aed8-d4f5d969f772","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2fa09512-c130-4a93-83d5-f63abbe9f013","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"1d9a1c38-0e9f-4bbb-b713-e3cd9a720b64","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","$connId":"con_813","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"dd3190a6-9f68-405d-a759-45087b084c29"},{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","$connId":"con_818","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"},{"source":"context","comparison":"equals","variable":"tipoAtendimento","values":["residencial"]}],"$invalid":false,"$id":"abe37c89-d030-4c77-b124-92a02af4a380","typeOfStateId":"state"},{"stateId":"baa81344-c705-43c3-8fb7-05f4a89cf5c3","$connId":"con_823","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"},{"source":"context","comparison":"equals","variable":"tipoAtendimento","values":["tv"]}],"$invalid":false,"$id":"4da561c4-7a25-457e-b2f2-558c5fc77db6","typeOfStateId":"state"},{"stateId":"584e6c88-8a10-4d1c-8c6f-6247385ae02c","typeOfStateId":"state","$connId":"con_828","$id":"db695020-c71d-43b9-8fb3-e57a8b8581c0","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$connId":"con_833","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"8b27a982-08b2-4281-9594-e488495437f8","typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"8ad9f405-152a-4009-b028-4ed2f6d812ab","$typeOfContent":"","type":"ExecuteScript","$title":"Set userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1bc8d535-9911-4967-9cff-ba7b498c581d","$typeOfContent":"","type":"ExecuteScript","$title":"Set channelBoldTags","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5bc0d006-185a-4f36-ab86-2642661faf87","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return options = JSON.stringify([\n        {\n            content: \"Faturas anteriores\",\n            regex: \"fatura(|s).anterior(es|)\",\n        },\n        {\n            content: \"Menu anterior\",\n            regex: \"menu.anterior\",\n        },\n        {\n            content: \"Sair\",\n            regex: \"sai(|r)\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8302e248-94da-4b7d-803d-ffe9a1b87dd2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        text: `${channelBoldTags.open}Todas as suas faturas${channelBoldTags.close} estão em dia! 🎉\n\nCom isso, não há faturas pendentes para pagamento. 😉\n\nCaso queira ver ${channelBoldTags.open}faturas anteriores${channelBoldTags.close}, eu consigo te entregar uma 2ª via.\n\nO que deseja fazer?`,\n        //footer: 'Ou digite “voltar” para retornar ao menu anterior.',\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: true,\n        hasWppListMenu: false,\n        isBlipImmediateMenu: true,\n    };\n\n    let menu = createMenu(props, config);\n    \n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a4acdad4-4034-448a-90ee-fa1d8371a105","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numericOptionsRegex\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn JSON.stringify([\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*1\\\\s*?)|um|(primei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*2\\\\s*?)|dois|(segund[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*3\\\\s*?)|tr[eê]s|(tercei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*4\\\\s*?)|quatro|(quart[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*5\\\\s*?)|cinco|(quint[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*6\\\\s*?)|seis|(sext[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*7\\\\s*?)|sete|(s[eé]tim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*8\\\\s*?)|oito|(oitav[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*9\\\\s*?)|nove|(non[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*10\\\\s*?)|dez|(d[eé]cim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*11\\\\s*?)|onze|(d[eé]cim[ao]\\\\s*primei?ra))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*12\\\\s*?)|doze|(d[eé]cim[ao])\\\\s*segunda)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*13\\\\s*?)|treze|(d[eé]cim[ao])\\\\s*tercei?ra)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*14\\\\s*?)|catorze|(d[eé]cim[ao])\\\\s*quarta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*15\\\\s*?)|quinze|(d[eé]cim[ao])\\\\s*quinta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*16\\\\s*?)|dezesseis|(d[eé]cim[ao])\\\\s*sexta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*17\\\\s*?)|dezessete|(d[eé]cim[ao])\\\\s*s[eé]tima)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*18\\\\s*?)|dezoit|(d[eé]cim[ao])\\\\s*oitava)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*19\\\\s*?)|dezenove|(d[eé]cim[ao])nona)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*20\\\\s*?)|vinte|(vig[eé]sima))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t]);\n}","inputVariables":[],"outputVariable":"numericOptionsRegex","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e78a874d-cf46-4a78-8303-7f334a3c4ffa","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial contr encont validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial contr encont validacao","action":"Sim"},"conditions":[]},{"$id":"0f3ea230-21fe-4828-8a14-51089a26b866","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas abertas validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas abertas validacao","action":"nao"},"conditions":[]},{"$id":"52e5709c-4ff6-4f8d-aa88-5509ba24581e","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas abertas nao exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas abertas nao exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"nenhuma fatura\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n\n  if (options && options.length > 0) {\n    numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    if (input != '') {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const contentRegex = new RegExp(options[i].regex, 'i');\n\n        if (numericRegex.test(input) || contentRegex.test(input)) {\n          return {\n            option: numericOption.toString(),\n            content: options[i].content,\n          };\n        }\n      }\n    }\n  }\n\n  return { option: 'invalid', content: 'input inesperado' };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Codigo barras residencial faturas abertas nao selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Codigo barras residencial faturas abertas nao selecao","action":"{{chooseAnswer@content}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"chooseAnswer"}]},{"type":"TrackEvent","$title":"Codigo barras residencial faturas abertas nao inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Codigo barras residencial faturas abertas nao inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]},{"source":"context","comparison":"exists","values":[],"variable":"inputContentSubstring"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-99d6ac17-8bb2-4364-b5d7-8de569231202","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f056b333-764f-4479-afe9-31c8b6f7d8de","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d2c0701a-dc65-44a7-b328-120273f03686","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-fcd90c52-6353-4c66-87c4-0dbd9fd54470","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"d5dac5eb-2d52-4c06-80c0-4f96e8f618d1","root":false,"$title":"[CBR.0.0.4] Nenhuma Fatura","$position":{"top":"774px","left":"829.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dc77a58f-2dab-4c20-8d83-f31a03ba2270":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"49090ba8-2089-4176-87f2-1070eb89a254","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"ProcessCommand","$title":"Redirecionar Retorno de Erro","$invalid":false,"settings":{"method":"set","to":"postmaster@msging.net","resource":"{{origemErro@state_id}}","type":"text/plain","uri":"/contexts/{{contact.identity}}/stateid%40{{config.flowidentifier}}","variable":"redirectError"},"conditions":[]},{"type":"SetVariable","$title":"remove origemErro","$invalid":false,"settings":{"variable":"origemErro","value":"null","expiration":1},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-4adb74f9-b766-4140-9b6b-5a530754df27","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-4f6d037c-4f6d-4d49-b859-e98294d65588","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-cb1ef62b-7b3d-4efd-ba4f-a43b0d93b166","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"dc77a58f-2dab-4c20-8d83-f31a03ba2270","root":false,"$title":"Retorno de erro - Redirecionar","$position":{"top":"147px","left":"2360px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2002fa9d-f0a4-44d6-ad35-7c84f3b4d222":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"45414666-7a60-4a31-a148-233692b548ae","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"596d203c-985e-4122-9c8f-623c7dee1c55","$connId":"con_838","$id":"b0edb5db-64f5-4647-920e-77f038704661","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"type":"SetVariable","$title":"remove selectedBank","$invalid":false,"settings":{"variable":"selectedBank","value":"null","expiration":1},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"id":"blip-tag-7883f31b-5011-4493-adef-b43a8954b4c2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"2002fa9d-f0a4-44d6-ad35-7c84f3b4d222","root":false,"$title":"Carrega Numero de Protocolo","$position":{"top":"2260px","left":"5555px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"abcf33d4-6b8e-4e48-b15e-68a202a32549":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f99fe662-4423-4935-a05d-1de7646f310e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9e6b570f-23d6-419f-a60e-0ea4bd24bc89","$connId":"con_843","conditions":[{"source":"input","comparison":"equals","values":["#menuPromessa"]},{"source":"context","comparison":"equals","variable":"tipoAtendimento","values":["residencial"]}],"$invalid":false,"$id":"443eb5ed-fc0d-48ed-a3dc-c937e32c7e0d","typeOfStateId":"state"},{"stateId":"e747b47e-e9b7-401e-b515-e8a3c89d0f4a","typeOfStateId":"state","$connId":"con_848","$id":"08ac7272-9800-47bc-adcc-1fcc3caef168","conditions":[{"source":"context","comparison":"equals","values":["combo multi","combo multi controle"],"variable":"mobileClientType"},{"values":["movel"],"source":"context","comparison":"equals","variable":"tipoAtendimento"}],"$invalid":false},{"stateId":"e747b47e-e9b7-401e-b515-e8a3c89d0f4a","$connId":"con_853","conditions":[{"source":"context","comparison":"equals","values":["residencial"],"variable":"tipoAtendimento"}],"$invalid":false,"$id":"51428f89-f374-4de7-bef8-8c3266a050b6","typeOfStateId":"state"},{"stateId":"45e97fbb-c71b-44d4-957b-ea62ff8ac193","$connId":"con_858","conditions":[{"source":"context","comparison":"equals","values":["tv"],"variable":"tipoAtendimento"}],"$invalid":false,"$id":"df9d97f5-2b2c-4889-aa0f-1e0082c709e9"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$invalid":false},"$tags":[],"id":"abcf33d4-6b8e-4e48-b15e-68a202a32549","root":false,"$title":"Verifica tipo de Atendimento","$position":{"top":"320.222px","left":"2631px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"596d203c-985e-4122-9c8f-623c7dee1c55":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"be1c2a88-c358-45d3-bda6-e6841297d44f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"be1c2a88-c358-45d3-bda6-e6841297d44f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"367e5133-ba29-43b7-b303-c95f6e4cb670","type":"text/plain","content":"O número do seu protocolo para esta solicitação é:\n\n{{responseCadastraDcc@data.protocol}}","metadata":{}},"$cardContent":{"document":{"id":"367e5133-ba29-43b7-b303-c95f6e4cb670","type":"text/plain","content":"O número do seu protocolo para esta solicitação é:\n\n{{responseCadastraDcc@data.protocol}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6bc95ce3-3cc1-4515-9cb6-468365de3bda","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Sucesso debito automatico exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Sucesso debito automatico exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"id":"blip-tag-ef994844-731b-4363-a501-1633fdf2b76e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fe7fafc3-dcbf-4992-9f42-8fea1557e584","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"596d203c-985e-4122-9c8f-623c7dee1c55","root":false,"$title":"Exibe numero protocolo","$position":{"top":"2442px","left":"5545px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e311cb07-ce3f-467a-827f-8b7316ff95e8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de8f3d6a-4017-4823-8f40-7b66e4f091d5","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to \"{{config.servicoPrincipal}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#confirmacao"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-13cb8fd6-2526-415a-8c67-647a5fe186c1","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"e311cb07-ce3f-467a-827f-8b7316ff95e8","root":false,"$title":"Redirecionar para Confirmacao","$position":{"top":"3.28571px","left":"4057.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1efa6226-1aa5-4384-9039-f1982dbd96c1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"18bd0eaa-3728-4d45-a290-d3f009d1fa46","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"57fea87f-de6d-4e71-af4c-ce1bb5799003","$connId":"con_863","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.2"]}],"$invalid":false,"$id":"11ac94d1-b9f4-4ab6-a6e1-5a5a042516bf"},{"stateId":"511dc13d-d1e2-40de-9754-1e8871cd29dd","$connId":"con_868","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.2.2"]}],"$invalid":false,"$id":"8279771b-1265-458b-a537-952a7bacfb09"},{"stateId":"dbcf710c-9513-43a3-8299-c9f9b8a113ea","$connId":"con_873","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.2.3"]}],"$invalid":false,"$id":"a30501e3-42de-4cc5-b027-24c8b05993f9"},{"stateId":"ebbca9da-9b54-4a9d-beaa-ffe984336d84","$connId":"con_878","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.2.1"]}],"$invalid":false,"$id":"5676d03d-2825-4615-a954-e23df2897dce"},{"stateId":"1586dfa3-8ebe-4ca0-b854-7681a890d3eb","$connId":"con_883","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.2.1.2"]}],"$invalid":false,"$id":"82145256-c187-4a16-894b-a7fcb2a2d577"},{"stateId":"6b853631-c790-462f-b2fb-dd6c3414b920","$connId":"con_888","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.2.1.1"]}],"$invalid":false,"$id":"4ce82e3a-9c5a-4d27-bae7-a89c2c0ff795"},{"stateId":"c292aac2-0bdd-4612-944a-31331fc66e64","$connId":"con_893","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.1.1.1.3"]}],"$invalid":false,"$id":"f0039498-c4fd-4a9c-98f2-254d4faf11c6"},{"stateId":"53d7e972-d324-49a1-97fa-df51250f389e","$connId":"con_898","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2"]}],"$invalid":false,"$id":"707dc8a5-8d13-4e3f-96b8-8f864c985803"},{"stateId":"193ca9f8-d159-42cd-9794-bf2279c2ec7b","$connId":"con_903","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.1"]}],"$invalid":false,"$id":"726cc037-2cb9-435a-8180-2ccf0b9cf977"},{"stateId":"23e2724c-154c-48bd-9b8f-c9cafb346fb6","$connId":"con_908","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.1.1"]}],"$invalid":false,"$id":"d77b1671-762b-42d0-a8dc-6601f5733e2f"},{"stateId":"fc5bb3b7-0e81-4998-b17d-afc7307524ec","$connId":"con_913","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.1.1.1"]}],"$invalid":false,"$id":"5c5cba71-5b64-4e4a-a5a3-0591bef64f6a"},{"stateId":"75a8d48b-cb2c-49a7-b117-d235feff9bb7","$connId":"con_918","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.1.1.2"]}],"$invalid":false,"$id":"cef24cd3-4f85-4b65-9361-934bc1dc9746"},{"stateId":"77e2e7e8-fd7a-4dba-b103-3c89c3e306cb","$connId":"con_923","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.1.1.1.2"]}],"$invalid":false,"$id":"39b9a498-6ed3-468f-96da-ad535f2a1ca2"},{"stateId":"6edd9aba-5818-48ec-a9e5-a97d7a6ffc5f","$connId":"con_928","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.1.1.1.1.1.1"]}],"$invalid":false,"$id":"f7845c75-1c2a-469b-b2a9-9c240f4c37a4"},{"stateId":"45e97fbb-c71b-44d4-957b-ea62ff8ac193","$connId":"con_933","conditions":[{"source":"input","comparison":"equals","values":["#A.1.5"]}],"$invalid":false,"$id":"cb6fe63d-979c-47a3-9f56-9166eadb3b3c"},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","$connId":"con_938","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.1"]}],"$invalid":false,"$id":"186ad37c-832e-41cb-9ac4-47832e4db12f"},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","$connId":"con_943","conditions":[{"source":"input","comparison":"equals","values":["#A.1.2.2"]}],"$invalid":false,"$id":"3a73082e-cc67-446f-abd2-2f5eb6e79d6f"},{"stateId":"9e6b570f-23d6-419f-a60e-0ea4bd24bc89","$connId":"con_948","conditions":[{"source":"input","comparison":"equals","values":["#A.1.5.1"]}],"$invalid":false,"$id":"91a3d111-f706-43f3-a383-0e86a3a30e51","typeOfStateId":"state"},{"stateId":"9e6b570f-23d6-419f-a60e-0ea4bd24bc89","$connId":"con_953","conditions":[{"source":"input","comparison":"equals","values":["#verificarAdimplencia"]}],"$invalid":false,"$id":"653bea6d-8b8f-4296-a77b-aab0712d00ba","typeOfStateId":"state"},{"stateId":"abb88e75-3519-4223-bc9a-0c319583ed2e","$connId":"con_958","conditions":[{"source":"input","comparison":"equals","values":["#retornoAjudaAutenticacao"]}],"$invalid":false,"$id":"472a6199-670d-46e3-b38d-3c36232c3760"},{"stateId":"188960e0-a8b3-4da5-8c2a-d60e6edc77f4","$connId":"con_963","conditions":[{"source":"input","comparison":"equals","values":["#A.1.7.1"]}],"$invalid":false,"$id":"4658ae37-e36a-4f6d-bb36-ebed3e42d6e8","typeOfStateId":"state"},{"stateId":"dfc0020b-2f68-4ab9-b500-6b96afdd8548","$connId":"con_968","conditions":[{"source":"input","comparison":"equals","values":["#A.1.7"]}],"$invalid":false,"$id":"58df9b05-87eb-4e4e-a586-980ab2295ad5"},{"stateId":"b4148ec6-cb64-4868-bf16-769b9e13652e","$connId":"con_973","conditions":[{"source":"input","comparison":"equals","values":["#RN.0"]}],"$invalid":false,"$id":"6639c20e-c3d6-4b09-8f48-93b1fbd33a1f"},{"stateId":"887150cc-f756-455f-aad4-54097ff02040","$connId":"con_978","conditions":[{"source":"input","comparison":"equals","values":["#segundaViaOutroNumero"]}],"$invalid":false,"$id":"dce1836c-bf60-416e-9cc0-c7210728a954"},{"stateId":"332f5478-463c-42cd-9f3c-da92d2ffefc7","$connId":"con_983","$id":"febde29c-df7c-4f42-b856-d7e04d684801","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.2.2"]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"b3b2de0e-4fde-4360-809e-19ca9f50450b","$invalid":false},"$tags":[],"id":"1efa6226-1aa5-4384-9039-f1982dbd96c1","root":false,"$title":"Roteamento Inicio","$position":{"top":"121.333px","left":"2636px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"69391e65-79b0-489d-9893-84fc627a7c35":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"4e3904a6-9b45-4ffb-9dbc-cea033229d16","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"}},"$cardContent":{"document":{"id":"4e3904a6-9b45-4ffb-9dbc-cea033229d16","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"106cd7ed-0051-430d-880c-8337610ca9e3","type":"text/plain","content":"Pronto, a solicitação de débito automático foi enviada para o seu banco!"},"$cardContent":{"document":{"id":"106cd7ed-0051-430d-880c-8337610ca9e3","type":"text/plain","content":"Pronto, a solicitação de débito automático foi enviada para o seu banco!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"13926312-fea1-4e7e-ad2a-47e8a56c74d6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"$cardContent":{"document":{"id":"13926312-fea1-4e7e-ad2a-47e8a56c74d6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"f40730b3-aaa4-4003-99b6-4150ada80549","type":"text/plain","content":"⚠️ Atenção:\n\nVocê precisa agora *entrar em contato com o seu banco* e pedir para que ele *autorize o débito em conta da Claro Residencial!*\n\nAté que você faça isso, a solicitação que eu enviei para o banco permanece pendente"},"$cardContent":{"document":{"id":"f40730b3-aaa4-4003-99b6-4150ada80549","type":"text/plain","content":"⚠️ Atenção:\n\nVocê precisa agora *entrar em contato com o seu banco* e pedir para que ele *autorize o débito em conta da Claro Residencial!*\n\nAté que você faça isso, a solicitação que eu enviei para o banco permanece pendente"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"b0eb7bbb-50c6-4f2d-ad27-7546339b11e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"$cardContent":{"document":{"id":"b0eb7bbb-50c6-4f2d-ad27-7546339b11e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"7419f1ba-7da4-4b63-9665-51efc7ecb6a3","type":"text/plain","content":"Não esqueça de acompanhar o débito em conta da sua próxima fatura para ter certeza que deu tudo certo 😉"},"$cardContent":{"document":{"id":"7419f1ba-7da4-4b63-9665-51efc7ecb6a3","type":"text/plain","content":"Não esqueça de acompanhar o débito em conta da sua próxima fatura para ter certeza que deu tudo certo 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6adbdc23-6152-4b65-ba3d-68c652ed3225","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2002fa9d-f0a4-44d6-ad35-7c84f3b4d222","$connId":"con_988","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"ee47a084-4900-4f29-8c6f-cdd0e9f5fc12"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Debito automatico cadastrado nao mais bancos origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Debito automatico cadastrado nao mais bancos origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Debito automatico cadastrado nao mais bancos exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Debito automatico cadastrado nao mais bancos exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"debito alterado bb/caixa\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-647004ad-f495-4bf3-aaa8-405c3b4a836e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-12329d1c-5186-49ff-8e1c-fc8adced5631","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ee6627c1-e0be-404d-9495-e6960727e7d8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"69391e65-79b0-489d-9893-84fc627a7c35","root":false,"$title":"[A.1.4.2.1.1.1.1.1.1.2] Debito Alterado BB/Caixa","$position":{"top":"2198px","left":"5799px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f0c999b6-0441-4cdc-958e-b097ed7fa503":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"7d1c5b94-ecfb-4cc7-bd7e-120b4f394a5f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7d1c5b94-ecfb-4cc7-bd7e-120b4f394a5f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"b513e48f-414e-4dc7-aba7-518abfb4735e","type":"text/plain","content":"Ok, primeiro preciso checar se a Promessa de Pagamento está disponível para o seu contrato.","metadata":{}},"$cardContent":{"document":{"id":"b513e48f-414e-4dc7-aba7-518abfb4735e","type":"text/plain","content":"Ok, primeiro preciso checar se a Promessa de Pagamento está disponível para o seu contrato."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2baf2d6f-a42e-4eb8-b995-3bfcfc917dec","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1455caae-fafe-4956-a2b5-3b9a1b1637f9","$connId":"con_993","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"0efba871-d074-445d-a2cf-a8b6b01dc3ae","typeOfStateId":"state"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento exibicao","action":"Exibicao"},"conditions":[]},{"$id":"6db50326-9a4e-45d3-81f0-710435c9867f","$typeOfContent":"","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento) {\n    var channel = 'Claro Residencial';\n    if(tipoAtendimento == 'tv') {\n        channel = 'Claro TV';\n    }\n\n    var date = new Date();\n    return {\n        name: 'Promessa de pagamento NET',\n        channel: channel,\n        text: 'com Promessa de pagamento NET',\n        date: date\n    }\n}","inputVariables":["tipoAtendimento"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"login promessa de pagamento\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1455caae-fafe-4956-a2b5-3b9a1b1637f9","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-93dba9ea-35dd-4ad1-8f02-cb363faac218","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1c8b5bb0-3ea2-4b3b-b4a2-e9caeb3dbe80","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-dc869de2-d671-44ba-9898-91adf8ea3cf1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f0c999b6-0441-4cdc-958e-b097ed7fa503","root":false,"$title":"[A.1.5.1] Login Promessa de pagamento","$position":{"top":"477px","left":"7751px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1455caae-fafe-4956-a2b5-3b9a1b1637f9":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"73464c4c-c386-4ce6-afee-6be1893b8556","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_998","conditions":[{"source":"input","comparison":"equals","values":["#finalizacao"]}],"$invalid":false,"$id":"7d696989-e317-4194-a79d-af348808c81a"},{"stateId":"07e22cc5-0aca-4f74-8296-d99e6eaa6a5f","$connId":"con_1003","conditions":[{"source":"input","comparison":"equals","values":["#menu"]}],"$invalid":false,"$id":"3add2891-199d-43f1-8a30-8c7c7080029b"},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1008","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false,"$id":"95f017a3-dafa-4e37-a6c4-15edd636bf7e"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1013","conditions":[{"source":"input","comparison":"equals","values":["#ajudaAutenticacao"]}],"$invalid":false,"$id":"68622a8d-c991-488d-bc30-5a59adff6594"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","typeOfStateId":"state","$connId":"con_1018","$id":"a0165448-2191-4550-a1ec-5a5d4ebc4c1f","conditions":[{"source":"context","comparison":"equals","values":["Ajuda com login"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","typeOfStateId":"state","$connId":"con_1023","$id":"8c2ec0b3-e27d-4927-8eaf-46df4a2850ae","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","typeOfStateId":"state","$connId":"con_1028","$id":"42fb4d8f-53a0-4f28-a3b7-9af5fe8a1cd5","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"73b7a40a-f0ed-4be7-9422-0fff57f87da3","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var date = new Date();\n    return {\n        name: 'Promessa de Pagamento',\n        channel: 'Faturamento Residencial',\n        text: 'com a promessa de pagamento',\n        date: date\n    }\n}","inputVariables":[],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"606c61ee-b412-43de-a943-e7464eb542a4","$typeOfContent":"","type":"ExecuteScript","$title":"loginOptions","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return {\n        templateText: 'Para te ajudar com esse assunto',\n        menu: `Ou, *se preferir*, escolha uma das opções:\\n\\n*1-* Ajuda com o login\\n*2-* Voltar ao Menu anterior\\n*3-* Sair`,\n        options: [\n            {\n                content: 'Ajuda com login',\n                regex: 'ajuda',\n            },\n            {\n                content: `Voltar ao menu`,\n                regex: 'voltar?|menu',\n            },\n            {\n                content: 'Sair',\n                regex: 'sair?',\n            },\n        ],\n        trackingExhibition: 'exibicao',\n        trackingOption: 'selecao',\n        trackingInput: 'input',\n    };\n}\n","inputVariables":[],"outputVariable":"loginOptions","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"Redirect","$title":"Redirect to \"{{config.servicoAutenticacao}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#loginWithOptions#v2"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"16202832-fe0f-4061-a87d-979df4ff9e2d","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-720d11c8-12bd-4377-8698-ade330caa4b5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-17a96e8f-ce52-4835-8fec-2e30cca494f3","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-3bdfa9b9-bac9-4848-af6a-fc9dc0a3e577","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1455caae-fafe-4956-a2b5-3b9a1b1637f9","root":false,"$title":"Redireciona login promessa de pagamento","$position":{"top":"681px","left":"7747.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d13b3011-139d-46e2-951b-d359176de825":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"6776b65b-ac55-444f-847e-f0f59fd8c654","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6776b65b-ac55-444f-847e-f0f59fd8c654","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"dfe1d7da-7b6d-43b1-bd4a-6bd0a870700b","type":"text/plain","content":"Verifiquei no meu sistema e não consta *nenhuma fatura em atraso...* \nNesse caso, *não é necessário fazer a promessa de pagamento*\n\nNormalmente, o prazo para baixa do seu pagamento no nosso sistema é de *2 a 4 dias* corridos."},"$cardContent":{"document":{"id":"dfe1d7da-7b6d-43b1-bd4a-6bd0a870700b","type":"text/plain","content":"Verifiquei no meu sistema e não consta *nenhuma fatura em atraso...* \nNesse caso, *não é necessário fazer a promessa de pagamento*\n\nNormalmente, o prazo para baixa do seu pagamento no nosso sistema é de *2 a 4 dias* corridos."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"11dba0eb-3d57-470a-bd89-2fd43f37951f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"$cardContent":{"document":{"id":"11dba0eb-3d57-470a-bd89-2fd43f37951f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"cb30fb86-1a5a-46f9-b1fc-225daf8d550d","type":"text/plain","content":"Você está com algum problema técnico?\n\n*1-* Sim\n*2-* Não"},"$cardContent":{"document":{"id":"cb30fb86-1a5a-46f9-b1fc-225daf8d550d","type":"text/plain","content":"Você está com algum problema técnico?\n\n*1-* Sim\n*2-* Não"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"4d3ac567-938f-4c19-ad97-9a8a811c03e8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6274756d-31d5-49e9-8d4e-006c022207c5","$connId":"con_1033","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"8507ef2d-71cb-4494-bc15-923f308f6690"},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$connId":"con_1038","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"8219327b-0091-4fe5-9559-393d2378b1db","typeOfStateId":"state"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento adimplente origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento adimplente origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento adimplente exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento adimplente exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Choose Answer","$invalid":false,"settings":{"function":"run","source":"/**\n1 - Sim\n2 - Não\n**/\nfunction run(input) {\n    try{\n        var firstRegex = /^((\\s*1\\s*)|(um)|(primeir[ao])|((\\s*1\\s*-?\\s*)?sim))$/i;\n        if(firstRegex.test(input))\n            return {option: \"1\", content:\"Sim\"}\n        \n        var secondRegex = /^((\\s*2\\s*)|(dois)|(segund[ao])|((\\s*2\\s*-?\\s*)?n[aã]o)|([nñ]))$/i;\n        if(secondRegex.test(input))\n            return {option: \"2\", content: \"Nao\"}\n        return {option:\"invalid\", content:\"input inesperado\"}\n\n    }catch(e){\n        return {option:\"invalid\", content:\"input inesperado\"}\n    }\n    return \"Hello BLiP\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255)\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento adimplente selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento adimplente selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento adimplente input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento adimplente input","action":"{{inputContentSubstring}}"},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - suporteNetRedirectMessage","$invalid":false,"settings":{"variable":"suporteNetRedirectMessage","value":"#suporteNet;#outage"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["1"]}]},{"type":"ExecuteScript","$title":"Executar script - userToken for SuporteNet","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return {token:input}\n            }","inputVariables":["token"],"outputVariable":"userToken","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"usuario adimplente\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-47bc2fd0-3632-4fdb-a87d-1388e6dd4883","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f1157661-ece3-4d71-86b7-af88dee53ad2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4c7bf002-ce0f-4f17-a69a-49e36ee30057","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b5f40b38-0808-479b-b019-648885d447c6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-06b79bb5-05cb-4acc-b1cb-fd776fc75fdf","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"d13b3011-139d-46e2-951b-d359176de825","root":false,"$title":"[A.1.5.1.2] Usuario Adimplente","$position":{"top":"1087px","left":"7533px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"16202832-fe0f-4061-a87d-979df4ff9e2d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"04f838ab-f6f4-406c-b87e-ae5a5123420e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1043","$id":"0b8859ab-a16d-406e-895b-366180f3a66c","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"paymentPromisseStatus"}],"$invalid":false},{"stateId":"d13b3011-139d-46e2-951b-d359176de825","$connId":"con_1048","conditions":[{"source":"context","comparison":"notEquals","values":["eligible"],"variable":"userPaymentStatus"}],"$invalid":false,"$id":"3c3dd755-e4e7-4261-9c7c-442c8ab686f9"},{"stateId":"32c569ee-8982-43bc-8fd3-35d7f9650189","$connId":"con_1053","conditions":[{"source":"context","comparison":"equals","values":["eligible"],"variable":"userPaymentStatus"}],"$invalid":false,"$id":"e643b871-3713-4f3a-bf71-3d50d649a84d"},{"stateId":"28829157-b1fe-4ec7-a475-04fd6eea55b3","$connId":"con_1058","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"userPaymentStatus"}],"$invalid":false,"$id":"1106204b-2eba-4789-adcb-7cc63424b97e"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Promessa de Pagamento Status","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/paymentpromises/eligible?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","responseStatusVariable":"paymentPromisseStatus","responseBodyVariable":"paymentPromisse"},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - userPaymentStatus","$invalid":false,"settings":{"variable":"userPaymentStatus","value":"{{paymentPromisse@data.statusPaymentPromise}}"},"conditions":[]},{"type":"ExecuteScript","$title":"encode result","$invalid":false,"settings":{"function":"run","source":"\n            function run(inputVariable1) {\n                return encodeURI(inputVariable1)\n            }","inputVariables":["paymentPromisse"],"outputVariable":"encodedResult","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Set logMessage","$invalid":false,"settings":{"variable":"logMessage","value":"[PaymentPromise] - User {contactId} called the validate endpoint of the payment promise API. This is the entity result: {entityResult} the http status response was {status} and this is the whole result: {result}"},"conditions":[]},{"type":"SetVariable","$title":"Set logParameters","$invalid":false,"settings":{"value":"\"{{contact.identity}}\",\"{{userPaymentStatus}}\",\"{{paymentPromisseStatus}}\",\"{{encodedResult}}\"","variable":"logParameters"},"conditions":[]},{"type":"SetVariable","$title":"tokenPayload","$invalid":false,"settings":{"variable":"tokenPayload","value":"{{decryptToken}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"decryptToken"}]},{"type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var date = new Date();\n    return {\n        name: 'Promessa de pagamento',\n        channel: 'Claro Residencial',\n        text: 'com o serviço de Promessa de Pagamento',\n        date: new Date()\n    }\n}","inputVariables":[],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Validacao retorno de login fatura digital NET","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao retorno de login fatura digital NET","action":"{{token}}"},"conditions":[]},{"type":"TrackEvent","$title":"Validacao retorno de login promessa de pagamento NET","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao retorno de login promessa de pagamento NET","action":"{{tokenPayload}}"},"conditions":[],"$id":"4eb0313a-a8bc-4f9e-9703-420571bbcaff"}],"$leavingCustomActions":[{"type":"ProcessHttp","$title":"Log Error","$invalid":false,"settings":{"headers":{"x-application-id":"whatsapp"},"method":"POST","body":"{\n    \"LogLevel\": 0,\n    \"MessageTemplate\": \"{{logMessage}}\",\n    \"PropertyValue\": [\n        {{logParameters}}\n    ]\n}","uri":"{{config.apiUrl}}/Logger/WriteLog","responseStatusVariable":"paymentPromisseLogStatus","responseBodyVariable":"paymentPromisseLog"},"conditions":[{"source":"context","comparison":"notEquals","variable":"paymentPromisseStatus","values":["200"]}]},{"$id":"10800ba5-cb3a-41c3-a827-ee8130fd5cf9","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/paymentpromises/eligible?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Verificar Adimplencia\",\n            status: status,\n            response: response,\n            request: {\n                url: url,\n                cpf: '{{tokenPayload@cpf}}'\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["paymentPromisseStatus","paymentPromisse"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"paymentPromisseStatus","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-616a0d01-5c8f-43c4-99cf-fd09d1e3d373","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-715a0e31-4755-4541-a570-e3d948ac0e12","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9fbb20ba-a4af-4ee6-96d5-b419e4216f2f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8ef4194c-432f-4fd7-96dd-d52faa362d8d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"16202832-fe0f-4061-a87d-979df4ff9e2d","root":false,"$title":"Verificar Adimplencia","$position":{"top":"881px","left":"7750px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"32c569ee-8982-43bc-8fd3-35d7f9650189":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"9f0b4eb8-8e62-4130-bca8-1ef8888eed1c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9f0b4eb8-8e62-4130-bca8-1ef8888eed1c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"87dd1747-6f53-4340-a1a6-bfc0b8568b45","type":"text/plain","content":"Verifiquei que você possui fatura(s) em aberto, mas *o seu sinal não foi bloqueado* por motivos de pagamento...\n \nNesse caso, *não é necessário* usar o serviço de promessa, basta *efetuar o pagamento* da sua fatura no próximo dia útil"},"$cardContent":{"document":{"id":"87dd1747-6f53-4340-a1a6-bfc0b8568b45","type":"text/plain","content":"Verifiquei que você possui fatura(s) em aberto, mas *o seu sinal não foi bloqueado* por motivos de pagamento...\n \nNesse caso, *não é necessário* usar o serviço de promessa, basta *efetuar o pagamento* da sua fatura no próximo dia útil"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"aba7016b-01fe-4857-8966-beab6481feb9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"$cardContent":{"document":{"id":"aba7016b-01fe-4857-8966-beab6481feb9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"dbaa68cc-d05d-41d5-b49b-1618a4726e24","type":"text/plain","content":"Se você já fez o pagamento, o prazo para baixa no nosso sistema é de *2 a 4 dias* corridos."},"$cardContent":{"document":{"id":"dbaa68cc-d05d-41d5-b49b-1618a4726e24","type":"text/plain","content":"Se você já fez o pagamento, o prazo para baixa no nosso sistema é de *2 a 4 dias* corridos."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"144c6b96-7367-44ef-a0c9-393ab76754f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"144c6b96-7367-44ef-a0c9-393ab76754f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"7bb471ed-4391-4ba2-ab99-6e3602585d10","type":"text/plain","content":"Como posso continuar te ajudando?\n\n*1-* Suporte técnico\n*2-* Segunda via da fatura\n*3-* Código de barras\n*4-* Sair"},"$cardContent":{"document":{"id":"7bb471ed-4391-4ba2-ab99-6e3602585d10","type":"text/plain","content":"Como posso continuar te ajudando?\n\n*1-* Suporte técnico\n*2-* Segunda via da fatura\n*3-* Código de barras\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f7dc1e3c-04ee-4f0a-a828-220a53a59f2b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8ecbb96d-c0f9-4503-a24e-9a28c27b0214","$connId":"con_1063","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"7103980c-7284-40a7-98ae-0352ac535e1c"},{"stateId":"4130f339-6a5c-46d8-a500-3f1cb8eb5e10","$connId":"con_1068","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"3ba14f87-7f77-4ee4-afc3-b274e5e4eb91"},{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","$connId":"con_1073","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"3b384620-9ac1-4af3-b60c-73372f5786cf"},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$connId":"con_1078","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"51f086ca-21d8-43be-a918-6c60cf38f2da","typeOfStateId":"state"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento inadimplente origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento inadimplente origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento inadimplente exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento inadimplente exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    return input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"/**\nComo posso continuar te ajudando?\n\n*1-* Suporte técnico\n*2-* Segunda via da fatura\n*3-* Código de barras\n*4-* Sair\n**/\nfunction run(input) {\n    var firstRegex = /^((\\s*1\\s*)|(um)|(primeir[ao]|((\\s*1\\s*-?\\s*)?suporte\\s*t[eé]cnico)))$/i;\n    if(firstRegex.test(input))\n        return {option:\"1\", content:\"Suporte tecnico\"}\n\n    var secondRegex = /^((\\s*2\\s*)|(dois)|(segund[ao])|((\\s*2\\s*-?\\s*)?segunda\\s*via\\s*(da?fatura)?))$/i;\n    if(secondRegex.test(input))\n        return {option:\"2\", content:\"Segunda via da fatura\"}\n\n    var thirdRegex = /^((\\s*3\\s*)|(tr[eê]s)|(terceir[ao])|((\\s*3\\s*-?\\s*)?c[oó]digo\\s*de\\s*barras?))$/i;\n    if(thirdRegex.test(input))\n        return {option:\"3\", content:\"Codigo de barras\"}\n\n    var fourthRegex = /^((\\s*4\\s*)|(quatro)|(quart[ao])|((\\s*4\\s*-?\\s*)?sair))$/i;\n    if(fourthRegex.test(input))\n        return {option:\"4\", content:\"Sair\"}\n\n    return {option:\"invalid\", content: \"input inesperado\"}\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento inadimplente selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento inadimplente selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento inadimplente input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento inadimplente input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"inadimplente\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-16bb64b9-d41d-4479-b25e-f3210ee7a25e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e39541c1-f6f0-49d2-afea-6b5097f47b17","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e1d82b5a-7aa9-4a74-80a0-aeb2e90554a7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-73b241b5-ced3-4628-b1a9-da488f74a475","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"32c569ee-8982-43bc-8fd3-35d7f9650189","root":false,"$title":"[A.1.5.1.3]Usuario Inadimplente","$position":{"top":"1091px","left":"7932px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"04e81a58-89c0-4300-9592-fab47b78fe2d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2a717173-a97b-4280-b412-d738e3c44797","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"outtageStatus"}],"$invalid":false,"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1083","$id":"caed5703-6605-420d-a7d8-3f12ec2f606a"},{"stateId":"b2050434-6a64-4c7b-9cda-ff42215ef008","$connId":"con_1088","conditions":[{"source":"context","comparison":"equals","values":["0"],"variable":"qtdServicos"}],"$invalid":false,"$id":"b660a73e-847e-44ee-8d22-19309e6846a2"},{"stateId":"4d908fdb-b294-4c7d-a465-3e631ac5fc7e","$connId":"con_1093","conditions":[{"source":"context","comparison":"greaterThanOrEquals","values":["1"],"variable":"qtdServicos"}],"$invalid":false,"$id":"7a014e20-5d91-4548-9974-599b3b3a14a5"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Requisição HTTP - Outtage","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"uri":"{{config.apiUrl}}/v1/intermediate/outage?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","method":"GET","responseStatusVariable":"outtageStatus","responseBodyVariable":"outtage"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - qtdServicos","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                try{\n                    var outtage = JSON.parse(input).data\n                    if(!outtage){\n                        return JSON.stringify(0)\n                    }else{\n                        return JSON.stringify(outtage.length)\n                    }\n                }catch(e){\n                    return \"invalid\"\n                }\n            }","inputVariables":["outtage"],"outputVariable":"qtdServicos","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Get Message","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                try{\n                    var outtage = JSON.parse(input).data\n\n                    if(outtage.length == 1){\n                        var problem = outtage[0];\n                        return problem.symptomText;\n                    }\n\n                    for(var i = 0; i < outtage.length; i++){\n                        var problem = outtage[i];\n                        if(problem.defaultMessage){\n                            return problem.symptomText;\n                        }\n                    }\n                    \n                }catch(e){\n                    return \"invalid\"\n                }\n            }","inputVariables":["outtage"],"outputVariable":"message","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"qtdServicos","values":["0"]},{"source":"context","comparison":"equals","variable":"outtageStatus","values":["200"]}]},{"type":"ExecuteScript","$title":"encode result","$invalid":false,"settings":{"function":"run","source":"\n            function run(outtage) {\n                return encodeURI(outtage);\n            }","inputVariables":[],"outputVariable":"encodedResult","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Set logMessage","$invalid":false,"settings":{"variable":"logMessage","value":"[PaymentPromise] - User {contactId} called the Outage API. Qty of Services: {qty} the http status response was {status} and this is the whole result: {result}"},"conditions":[]},{"type":"SetVariable","$title":"Set logParameters","$invalid":false,"settings":{"variable":"logParameters","value":"\"{{contact.identity}}\",\"{{qtdServicos}}\",\"{{outtageStatus}}\",\"{{encodedResult}}\""},"conditions":[]}],"$leavingCustomActions":[{"$id":"a13e6ef3-2de1-49bd-b994-432ca546a5ed","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/outage?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}';\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Verifica Outage\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["outtageStatus","outtage"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"outtageStatus","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-7d4c7e47-f174-495d-8f9d-c6a9b18ff098","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-0f053c10-e550-4acb-bfbc-b03fd09d8356","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a1938b2a-4e74-47b9-98f3-b6f47c063ad6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"04e81a58-89c0-4300-9592-fab47b78fe2d","root":false,"$title":"Verifica Outage","$position":{"top":"1279px","left":"7785px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6274756d-31d5-49e9-8d4e-006c022207c5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ca5350-ee1b-4e6f-a24e-124eeff7583f","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to \"{{config.servicoPrincipal}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{suporteNetRedirectMessage}}"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-d078f58c-9c8e-4047-8873-7f200407547f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"6274756d-31d5-49e9-8d4e-006c022207c5","root":false,"$title":"Redireciona para suporte tecnico","$position":{"top":"7px","left":"4260px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4d908fdb-b294-4c7d-a465-3e631ac5fc7e":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"c8573d26-6d9c-4bcb-a7f6-80a28548f1fe","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c8573d26-6d9c-4bcb-a7f6-80a28548f1fe","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3b6d6edb-9206-445d-8d25-6f60b2eb6d37","type":"text/plain","content":"{{message}}"},"$cardContent":{"document":{"id":"3b6d6edb-9206-445d-8d25-6f60b2eb6d37","type":"text/plain","content":"{{message}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"5ee8624e-a42a-4b7b-be67-0a8a0b2a0a3f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5ee8624e-a42a-4b7b-be67-0a8a0b2a0a3f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"42ef3ddf-48bc-4246-bc69-0a64f9db9fa5","type":"text/plain","content":"Você está com algum problema técnico além desse que identifiquei?\n\n*1-* Sim\n*2-* Não"},"$cardContent":{"document":{"id":"42ef3ddf-48bc-4246-bc69-0a64f9db9fa5","type":"text/plain","content":"Você está com algum problema técnico além desse que identifiquei?\n\n*1-* Sim\n*2-* Não"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"98c4a71d-9a5e-42a6-bea2-729e8e0076ef","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6274756d-31d5-49e9-8d4e-006c022207c5","$connId":"con_1098","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"62cca838-293c-4f9d-8ddf-3df8d06544d9"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1103","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"ca7ccbe0-3626-45e6-a35e-1c45edd86261"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Message Serviço","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                try{\n                    var outtage = JSON.parse(input)\n                    var message = \"Verifiquei no meu sistema que o seu serviço foi desabilitado devido a uma instabilidade de sinal na sua região para\"\n                    if(outtage.listOfResult.length == 1){\n                        var problem = outtage.listOfResult[0]\n                        message = message + \" \" + problem.product.productType + \".\"\n                        message = message + \"\\n\\nJá estamos trabalhando nisso! 🔧\"\n                        message = message + \"\\n\\nA previsão é que o serviço normalize até \" + problem.dtEnd + \", às \" + problem.dtHrsEnd + \".\"\n                    }\n                    if(outtage.listOfResult.length == 2){\n                        var firstProblem = outtage.listOfResult[0]\n                        var secondProblem = outtage.listOfResult[1]\n                        message = message + \" \" + firstProblem.product.productType + \" e \" + secondProblem.product.productType + \".\"\n                        message = message + \"\\n\\nJá estamos trabalhando nisso! 🔧\"\n                        message = message + \"\\n\\n➡️ Para \" + firstProblem.product.productType + \", a previsão é que até \" + firstProblem.dtEnd + \", às \" + firstProblem.dtHrsEnd + \", o sinal volte ao normal.\"\n                        message = message + \"\\n\\n➡️ No caso de \" + secondProblem.product.productType + \", a previsão é que até \" + secondProblem.dtEnd + \", às \" + secondProblem.dtHrsEnd + \", o sinal esteja normalizado.\"\n                    }\n                    if(outtage.listOfResult.length >= 3){\n                        var firstProblem = outtage.listOfResult[0]\n                        var secondProblem = outtage.listOfResult[1]\n                        var thirdProblem = outtage.listOfResult[2]\n                        message = message + \" \" + firstProblem.product.productType + \", \" + secondProblem.product.productType + \" e \" + thirdProblem.product.productType + \".\"\n                        message = message + \"\\n\\nJá estamos trabalhando nisso! 🔧\"\n                        message = message + \"\\n\\n➡️ Para \" + firstProblem.product.productType + \", a previsão é que até \" + firstProblem.dtEnd + \", às \" + firstProblem.dtHrsEnd + \", o sinal volte ao normal.\"\n                        message = message + \"\\n\\n➡️ Para \" + secondProblem.product.productType + \", a previsão é que até \" + secondProblem.dtEnd + \", às \" + secondProblem.dtHrsEnd + \", o sinal esteja normalizado.\"\n                        message = message + \"\\n\\n➡️ No caso de \" + thirdProblem.product.productType + \", a previsão é que até \" + thirdProblem.dtEnd + \", às \" + thirdProblem.dtHrsEnd + \", o sinal normalize.\"\n                    }\n                    return message\n                }catch(e){\n                    return \"invalid\"\n                }\n            }","inputVariables":["outtage"],"outputVariable":"servicesMessage","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento outage origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento outage origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento outage exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento outage exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                var firstRegex = /^((\\s*1\\s*)|(um)|(primeir[ao])|((\\s*1\\s*-?\\s*)?sim))$/i;\n                if(firstRegex.test(input))\n                    return {option:\"1\", content:\"Sim\"}\n                    \n                var secondRegex = /^((\\s*2\\s*)|(dois)|(segund[ao])|((\\s*2\\s*-?\\s*)?n[aã]o)|([nñ]))$/i;\n                if(secondRegex.test(input))\n                    return {option:\"2\", content:\"Nao\"}\n\n                return {option:\"invalid\", content:\"input inesperado\"}\n            }","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - suporteNetRedirectMessage","$invalid":false,"settings":{"variable":"suporteNetRedirectMessage","value":"#suporteNet;#outage"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento outage selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento outage selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento outage input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento outage input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"SetVariable","$title":"Definir variável - suporteNetRedirectMessage","$invalid":false,"settings":{"variable":"suporteNetRedirectMessage","value":"#suporteNet;#A.4.0.1.1.1.4.0"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["1"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"de pagamento outage\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-d5b750a3-400c-4fdf-8bf6-2f14547efce8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-157fd79b-8519-4135-89f3-8061d9db9dbf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c76e41d6-130f-4608-a7cf-e77c483ab7a4","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-145099f9-4d4e-4efd-931a-a9ede9ae04c6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-119d75bf-cf99-452a-9a2d-b9b11854fef9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"4d908fdb-b294-4c7d-a465-3e631ac5fc7e","root":false,"$title":"[A.1.5.1.4]Promessa de pagamento outage","$position":{"top":"1296px","left":"8019px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"87ef947a-2d92-4ac4-8045-a48bb709e01c":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"d3250bfb-3a43-4f81-8f3f-eb6b5e25514e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d3250bfb-3a43-4f81-8f3f-eb6b5e25514e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"5fde1ae5-c5b6-4146-8a99-e2b2c8078e48","type":"text/plain","content":"Verifiquei aqui e, no momento, o serviço de promessa de pagamento *não está disponível* para o seu contrato 🙁"},"$cardContent":{"document":{"id":"5fde1ae5-c5b6-4146-8a99-e2b2c8078e48","type":"text/plain","content":"Verifiquei aqui e, no momento, o serviço de promessa de pagamento *não está disponível* para o seu contrato 🙁"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b15420fc-3e47-4fa8-8558-7c39fdcf7d50","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1501cebc-4483-4b55-8725-7bba5aa836fc","$connId":"con_1108","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isBusinessClient"}],"$invalid":false,"$id":"f81ed8a2-91e7-4554-a956-9ec2d1c581f4"},{"stateId":"17c00d4c-072b-41f2-a751-3ceb6547412e","$connId":"con_1113","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isBusinessClient"}],"$invalid":false,"$id":"39c1f111-6c7f-4548-a1f0-de7c3c30deb6"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento nao apto origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao apto origem","action":"{{lastState}}"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"de pagamento nao apto\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-9d0c9ce4-10ec-423e-a15d-4f01739b5762","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ef2bfb51-09f8-47ad-9bf1-6c3894258cb1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-702724aa-9925-4beb-b28c-4234462713ab","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"87ef947a-2d92-4ac4-8045-a48bb709e01c","root":false,"$title":"[A.1.5.1.7]Promessa de pagamento nao apto","$position":{"top":"1435px","left":"7393px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9391b4c1-9586-4693-bdfc-f25e4f1b92f9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"19a815c3-2cb4-4c74-a88e-977930d524ac","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1118","conditions":[{"source":"context","comparison":"equals","values":["erro"],"variable":"isPromisseOfPaymentSuccessfull"}],"$invalid":false,"$id":"298de02b-ce84-4086-a55a-1862611cf9e8"},{"stateId":"87ef947a-2d92-4ac4-8045-a48bb709e01c","$connId":"con_1123","conditions":[{"source":"context","comparison":"equals","values":["nao-apto"],"variable":"isPromisseOfPaymentSuccessfull"}],"$invalid":false,"$id":"75cba339-400f-408a-ad38-3a0e11292067"},{"stateId":"7a4d9c5c-92a0-4c29-af16-c7ac103e46b4","$connId":"con_1128","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"},{"source":"context","comparison":"equals","variable":"userPaymentStatus","values":["combo-multi-ready"]}],"$invalid":false,"$id":"83e3c620-4194-469f-9fd9-0372b302d087"},{"stateId":"64708bcb-8194-4255-a0b8-cc29d58e2e74","$connId":"con_1133","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"},{"source":"context","comparison":"equals","variable":"userPaymentStatus","values":["combo-multi-unready"]}],"$invalid":false,"$id":"33d9ac47-aa78-49bb-b7b2-27f4c64bc7df"},{"stateId":"5a3d3013-3da2-4001-a5e5-18240e724386","$connId":"con_1138","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"},{"source":"context","comparison":"equals","variable":"userPaymentStatus","values":["combo-multi-ready"]}],"$invalid":false,"$id":"042c54d6-79b0-4b40-ad13-89ae72f4082a"},{"stateId":"94221ff8-061c-4ff2-88b7-7a078e593329","$connId":"con_1143","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"},{"source":"context","comparison":"equals","variable":"userPaymentStatus","values":["combo-multi-unready"]}],"$invalid":false,"$id":"08872ead-0414-457c-b443-c04ddaed863c"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Promgessa de Pagamento","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"POST","body":"{\n    \"AccessToken\": \"{{tokenAccessFormated}}\",\n    \"Document\": \"{{tokenPayload@cpf}}\",\n    \"ContractNumber\": \"{{tokenPayload@contrato}}\",\n    \"OperatorCode\": \"{{tokenPayload@codigoOperadora}}\"\n}","uri":"{{config.apiUrl}}/v1/intermediate/paymentpromises/create","responseStatusVariable":"promisseOfPaymentStatus","responseBodyVariable":"promisseOfPayment"},"conditions":[],"$id":"c6658d42-07cc-47ea-ab6d-ce659bc01a10"},{"type":"ExecuteScript","$title":"Executar script - isPromisseOfPaymentSucessfull","$invalid":false,"settings":{"function":"run","source":"function isStatusSucess(status){\n        return status == 200 || status == 202 || status == \"200\" || status == \"202\" \n}\n\nfunction run(promisseOfPaymentStatus, promisseOfPaymentBody) {\n    var promisseOfPayment = JSON.parse(promisseOfPaymentBody).data\n    if(!isStatusSucess(promisseOfPaymentStatus)){\n        return \"erro\"\n    }\n    if(promisseOfPayment.statusPaymentPromise != \"created\"){\n        return \"nao-apto\"\n    }\n    return true\n}\n","inputVariables":["promisseOfPaymentStatus","promisseOfPayment"],"outputVariable":"isPromisseOfPaymentSuccessfull","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - protocolNumber","$invalid":false,"settings":{"variable":"protocolNumber","value":"{{promisseOfPayment@data.protocolNumber}}"},"conditions":[{"source":"context","comparison":"equals","variable":"isPromisseOfPaymentSuccessfull","values":["true"]}]},{"type":"SetVariable","$title":"Set logMessageCreate","$invalid":false,"settings":{"variable":"logMessageCreate","value":"[PaymentPromise] - User {contactId} called the create endpoint of the payment promise API. This is the entity result: {entityResult} the http status response was {status} , this is the whole result: {result} and the statusContratoDescricao was {statusContratoDescricao} with the code {statusContrato}"},"conditions":[]},{"type":"ExecuteScript","$title":"encode ResultCreate","$invalid":false,"settings":{"function":"run","source":"\n            function run(inputVariable1) {\n                return encodeURI(inputVariable1);\n            }","inputVariables":["promisseOfPayment"],"outputVariable":"encodedResultCreate","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Set logParametersCreate","$invalid":false,"settings":{"variable":"logParametersCreate","value":"\"{{contact.identity}}\",\"\",\"{{promisseOfPaymentStatus}}\",\"{{encodedResultCreate}}\""},"conditions":[]},{"type":"SetVariable","$title":"Set logMessageProtocol","$invalid":false,"settings":{"variable":"logMessageProtocol","value":"[PaymentPromise] - User {contactId} called the promisse of Pament API and his protocol number is {protocolNumber}"},"conditions":[{"source":"context","comparison":"equals","variable":"isPromisseOfPaymentSuccessfull","values":["true"]}]},{"type":"ExecuteScript","$title":"encode result protocol","$invalid":false,"settings":{"function":"run","source":"\n            function run(inputVariable1) {\n                return encodeURI(inputVariable1);\n            }","inputVariables":["protocolNumberResponse"],"outputVariable":"encodedResultProtocol","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"isPromisseOfPaymentSuccessfull","values":["true"]}]},{"type":"SetVariable","$title":"Set logParametersProtocol","$invalid":false,"settings":{"variable":"logParametersProtocol","value":"\"{{contact.identity}}\",\"{{protocolNumber}}\""},"conditions":[{"source":"context","comparison":"equals","variable":"isPromisseOfPaymentSuccessfull","values":["true"]}]}],"$leavingCustomActions":[{"type":"ProcessHttp","$title":"Log Payment Promisse Error","$invalid":false,"settings":{"headers":{"x-application-id":"whatsapp"},"method":"POST","body":"{\n    \"LogLevel\": 0,\n    \"MessageTemplate\": \"{{logMessageCreate}}\",\n    \"PropertyValue\": [\n        {{logParametersCreate}}\n    ]\n}","uri":"{{config.apiUrl}}/Logger/WriteLog"},"conditions":[]},{"type":"ProcessHttp","$title":"Log Protocol Error","$invalid":false,"settings":{"headers":{"x-application-id":"whatsapp"},"method":"POST","body":"{\n    \"LogLevel\": 0,\n    \"MessageTemplate\": \"{{logMessageProtocol}}\",\n    \"PropertyValue\": [\n        {{logParametersProtocol}}\n    ]\n}","uri":"{{config.apiUrl}}/Logger/WriteLog"},"conditions":[{"source":"context","comparison":"equals","variable":"isPromisseOfPaymentSuccessfull","values":["true"]}]},{"$id":"6a0458e9-354e-4978-9eb4-e9d4ac90388b","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/paymentpromises/create';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Fazer Promessa de Pagamento\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["promisseOfPaymentStatus","promisseOfPayment"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"promisseOfPaymentStatus","values":["202"]},{"source":"context","comparison":"notEquals","variable":"promisseOfPaymentStatus","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-65b3dec2-ab9f-4fc6-8e8f-6d0027dc949a","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-275c12c6-b318-4aea-a1d7-763a3d050068","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-df926c7b-2d0b-457a-af1d-fb1d8b1ff058","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"9391b4c1-9586-4693-bdfc-f25e4f1b92f9","root":false,"$title":"Fazer Promessa de Pagamento","$position":{"top":"1731.57px","left":"7932px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b2050434-6a64-4c7b-9cda-ff42215ef008":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"36c94999-2abc-4a51-94e0-07cfe8c64891","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"87ef947a-2d92-4ac4-8045-a48bb709e01c","$connId":"con_1148","conditions":[{"source":"context","comparison":"equals","values":["nao-apto-a-promessa"],"variable":"userPaymentStatus"},{"source":"context","comparison":"equals","variable":"decryptToken@customerNetUno","values":["false"]}],"$invalid":false,"$id":"a7d239ae-cd0d-4d33-8c7a-bdbe4f7be542"},{"stateId":"5d9e81f0-45f5-40c5-9568-1dfaba576547","$connId":"con_1153","conditions":[{"source":"context","comparison":"equals","values":["nao-apto-a-promessa"],"variable":"userPaymentStatus"},{"source":"context","comparison":"equals","variable":"decryptToken@customerNetUno","values":["true"]}],"$invalid":false,"$id":"d1e80bb9-583e-4e2a-85a1-9be1f02ebf30"},{"stateId":"55b95271-f26a-4710-89f8-2f47b42a377d","$connId":"con_1158","conditions":[{"source":"context","comparison":"equals","values":["combo-multi-ready","combo-multi-unready"],"variable":"userPaymentStatus"}],"$invalid":false,"$id":"e2e060eb-91b2-4e30-91b7-8911825b7982"}],"$enteringCustomActions":[{"type":"SetVariable","$title":"Set logMessage","$invalid":false,"settings":{"variable":"logMessage","value":"[PaymentPromise] - Checking payment promisse eligibility for user {contactId}. PaymentStatus:{status} - NetUno: {customerNetUno}"},"conditions":[]},{"type":"SetVariable","$title":"Set logParameters","$invalid":false,"settings":{"variable":"logParameters","value":"\"{{contact.identity}}\",\"{{userPaymentStatus}}\",\"{{decryptToken@customerNetUno}}\""},"conditions":[]}],"$leavingCustomActions":[{"type":"ProcessHttp","$title":"LOG PAYMENT PROMISE","$invalid":false,"settings":{"headers":{"x-application-id":"whatsapp"},"method":"POST","body":"{\n    \"LogLevel\": 0,\n    \"MessageTemplate\": \"{{logMessage}}\",\n    \"PropertyValue\": [\n        {{logParameters}}\n    ]\n}","uri":"{{config.apiUrl}}/Logger/WriteLog"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-4bf3a9cb-0ddf-48f5-8200-7cdacde7b7c1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-02753455-4cdf-4e7c-a5ca-fcff16c15a38","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"b2050434-6a64-4c7b-9cda-ff42215ef008","root":false,"$title":"Verifica Eligibilidade","$position":{"top":"1333px","left":"7593px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5d9e81f0-45f5-40c5-9568-1dfaba576547":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"6e324323-6bab-4768-9845-ad15d2474b86","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6e324323-6bab-4768-9845-ad15d2474b86","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"77154af4-0eed-44e4-b80d-293c4a452a42","type":"text/plain","content":"Verifiquei no meu sistema e ainda não consigo fazer sua promessa de pagamento por aqui 🙁\n\nLigue na central *Minha Claro*, no número *10621*, que um especialista no seu caso poderá te ajudar!"},"$cardContent":{"document":{"id":"77154af4-0eed-44e4-b80d-293c4a452a42","type":"text/plain","content":"Verifiquei no meu sistema e ainda não consigo fazer sua promessa de pagamento por aqui 🙁\n\nLigue na central *Minha Claro*, no número *10621*, que um especialista no seu caso poderá te ajudar!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"bf00b961-f8ad-4c8c-befd-cbde9f47ec26","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d3d67cff-8a08-41e3-a00f-3dfdfeba8669","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"d3d67cff-8a08-41e3-a00f-3dfdfeba8669","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento net uno origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento net uno origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento net uno exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento net uno exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"de pagamento net uno\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-8dabb2a8-e356-4ac8-943e-0472f17e685d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0f0cebf4-fc9a-4b0e-938f-e2c1e5fe3f54","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4beeae0a-df75-410b-8b9b-50d3c0ad3306","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5d9e81f0-45f5-40c5-9568-1dfaba576547","root":false,"$title":"[A.1.5.1.8]Promessa de pagamento net uno","$position":{"top":"1489px","left":"7612px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"55b95271-f26a-4710-89f8-2f47b42a377d":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"a32644d6-10b8-4445-8442-b50027883647","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a32644d6-10b8-4445-8442-b50027883647","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"ce495a35-d959-4656-a97c-f2e3c09e32f5","type":"text/plain","content":"Para que eu possa te ajudar, me diz...\nVocê já fez o pagamento da fatura em atraso?\n\n*1-* Já paguei\n*2-* Vou pagar"},"$cardContent":{"document":{"id":"ce495a35-d959-4656-a97c-f2e3c09e32f5","type":"text/plain","content":"Para que eu possa te ajudar, me diz...\nVocê já fez o pagamento da fatura em atraso?\n\n*1-* Já paguei\n*2-* Vou pagar"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"ddcc89ba-662a-4f36-938a-8cfc44be8285","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9391b4c1-9586-4693-bdfc-f25e4f1b92f9","$connId":"con_1163","conditions":[{"source":"context","comparison":"equals","values":["1","2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"839a85d4-de02-4e01-8b98-123c435408a2"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento elegivel origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento elegivel origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento elegivel exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento elegivel exibicao","action":"Exibicao"},"conditions":[]},{"type":"SetVariable","$title":"Set logMessage","$invalid":false,"settings":{"variable":"logMessage","value":"[PaymentPromise] - User {contactId} is eligible for payment promises."},"conditions":[]},{"type":"SetVariable","$title":"Set logParameters","$invalid":false,"settings":{"variable":"logParameters","value":"\"{{contact.identity}}\""},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                var firstRegex = /^((\\s*1\\s*)|(um)|(primeir[ao])|((\\s*1\\s*-?\\s*)?j[aá]\\s*(paguei)?)|(sim))$/i;\n                if(firstRegex.test(input))\n                    return {option:\"1\", content:\"Ja paguei\"}\n                    \n                var secondRegex = /^((\\s*2\\s*)|(dois)|(segund[ao])|((\\s*2\\s*-?)?vou pagar)|((ainda)?\\s*n[aã]o))$/i;\n                if(secondRegex.test(input))\n                    return {option:\"2\", content:\"Vou pagar\"}\n\n                return {option:\"invalid\", content:\"input inesperado\"}\n            }","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255)\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento elegivel selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento elegivel selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento elegivel input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento elegivel input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"de pagamento elegivel\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}},{"type":"ProcessHttp","$title":"LOG PAYMENT PROMISE","$invalid":false,"settings":{"headers":{"x-application-id":"whatsapp"},"method":"POST","body":"{\n    \"LogLevel\": 0,\n    \"MessageTemplate\": \"{{logMessage}}\",\n    \"PropertyValue\": [\n        {{logParameters}}\n    ]\n}\n","uri":"{{config.apiUrl}}/Logger/WriteLog"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-0ba48f6b-15c3-4232-bfd0-5eae247fef57","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6abb8080-9fd1-48b5-80d6-7fa252de30f7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d1f2f623-9ff6-4cd5-98a7-a9d59f85c220","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4d11ed70-0ac0-4748-823a-1dd65be97730","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-03ab02cf-62e3-4f31-ac39-755d42614cc2","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-a041fbcc-3de9-4297-81d8-62b5c2b23857","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"55b95271-f26a-4710-89f8-2f47b42a377d","root":false,"$title":"[A.1.5.1.9]Promessa de Pagamento Elegivel","$position":{"top":"1558px","left":"7923px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6480aa60-f028-4650-a2b9-5d3a41a0fde5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e12e9a1a-41a7-4c1b-bea2-32ad0275a9a2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to \"{{config.servicoPrincipal}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#menuResidencial"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-a6c16bcb-5054-42ea-9d0c-359913c2cea5","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"6480aa60-f028-4650-a2b9-5d3a41a0fde5","root":false,"$title":"Redireciona Menu Residencial","$position":{"top":"0px","left":"4454.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7a4d9c5c-92a0-4c29-af16-c7ac103e46b4":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"52a1f764-a33c-4134-a4d4-ba8cde8f4684","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"52a1f764-a33c-4134-a4d4-ba8cde8f4684","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"bc6d9e68-13d0-4399-ada5-28b28fd722a5","type":"text/plain","content":"Prontinho, registrei a sua promessa de pagamento aqui! 😊\n\nSeus serviços de *TV e internet* serão reativados *em até 1h* e seu *telefone* em até *1 dia útil*\n"},"$cardContent":{"document":{"id":"bc6d9e68-13d0-4399-ada5-28b28fd722a5","type":"text/plain","content":"Prontinho, registrei a sua promessa de pagamento aqui! 😊\n\nSeus serviços de *TV e internet* serão reativados *em até 1h* e seu *telefone* em até *1 dia útil*\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c1366fcc-a861-443c-bdca-df20d143a016","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"0807d856-1dee-486b-8809-c403e8b2e375","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"0807d856-1dee-486b-8809-c403e8b2e375","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento pago origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento pago origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento pago exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento pago exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"de pagamento pago\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"072816bc-0042-45a2-9bc3-93feb5b89fb8","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-c4f16344-1038-4c75-94cb-9ae49515a7f7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8ed15cac-e0e3-4692-ae2a-c083490678aa","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b331a59a-8927-4592-ae4f-5b996a661202","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7a4d9c5c-92a0-4c29-af16-c7ac103e46b4","root":false,"$title":"[A.1.5.1.9.1]Promessa de pagamento pago","$position":{"top":"1869px","left":"7403px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"64708bcb-8194-4255-a0b8-cc29d58e2e74":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"2ad4af26-d939-48ab-be70-39a4d7fabafc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2ad4af26-d939-48ab-be70-39a4d7fabafc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"b8cabf09-eae1-49ac-8283-26ddc687b35c","type":"text/plain","content":"Prontinho, registrei a sua promessa de pagamento aqui! 😊\n\nSeus serviços de *TV e internet* serão reativados *em até 1h* e seu *telefone* em até *1 dia útil*. Seu serviço de *celular* será reativado assim que identificarmos o pagamento. Isso pode levar até *2 dias úteis.*\n"},"$cardContent":{"document":{"id":"b8cabf09-eae1-49ac-8283-26ddc687b35c","type":"text/plain","content":"Prontinho, registrei a sua promessa de pagamento aqui! 😊\n\nSeus serviços de *TV e internet* serão reativados *em até 1h* e seu *telefone* em até *1 dia útil*. Seu serviço de *celular* será reativado assim que identificarmos o pagamento. Isso pode levar até *2 dias úteis.*\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"30bfd121-833d-44cb-b477-72bd84d4ab78","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"f24af780-b792-40dc-a5b0-3e755f9f0e95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"f24af780-b792-40dc-a5b0-3e755f9f0e95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento pago combo origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento pago combo origem","action":"{[lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento pago combo exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento pago combo exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"de pagamento pago combo\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"072816bc-0042-45a2-9bc3-93feb5b89fb8","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-bbb220b6-e529-4090-b738-1d8f2f481da1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-dd3749dc-cfb9-40b9-be0e-76e54b0e5c51","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ca1ce8f1-dd5e-4de0-a3aa-b173adb0f821","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"64708bcb-8194-4255-a0b8-cc29d58e2e74","root":false,"$title":"[A.1.5.1.9.1.2]Promessa de pagamento pago combo","$position":{"top":"1866.57px","left":"7650px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"94221ff8-061c-4ff2-88b7-7a078e593329":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"97309de3-683e-46c6-b03a-1ba67e9ccadd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"97309de3-683e-46c6-b03a-1ba67e9ccadd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"5bf16475-ff19-4981-975a-a351661b5db4","type":"text/plain","content":"Prontinho, registrei a sua promessa de pagamento aqui! 😊\n\nSeus serviços de *TV e internet* serão reativados *em até 1h* e seu *telefone* em até *1 dia útil*. Seu serviço de *celular* será reativado assim que identificarmos o *seu pagamento*, o que pode levar até *2 dias úteis*.\n"},"$cardContent":{"document":{"id":"5bf16475-ff19-4981-975a-a351661b5db4","type":"text/plain","content":"Prontinho, registrei a sua promessa de pagamento aqui! 😊\n\nSeus serviços de *TV e internet* serão reativados *em até 1h* e seu *telefone* em até *1 dia útil*. Seu serviço de *celular* será reativado assim que identificarmos o *seu pagamento*, o que pode levar até *2 dias úteis*.\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"4f69fb6a-012c-4816-a25a-d63a6c337231","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"912d5345-0439-4e8e-813c-280996f4114d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"912d5345-0439-4e8e-813c-280996f4114d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento nao pago combo origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao pago combo origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento nao pago combo   exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao pago combo exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"de pgt nao pago combo\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"273dfde0-eacc-47c3-a944-2c31ed14fb3b","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-8f6666c2-fcd7-4d70-89b5-a4c25fba731c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9805ec93-ea2f-49d2-93d4-d57a863fc790","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c0b6134f-9da6-4bf8-8ae2-5922e3c5b5a7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"94221ff8-061c-4ff2-88b7-7a078e593329","root":false,"$title":"[A.1.5.1.9.2.2]Promessa de pgt nao pago combo","$position":{"top":"1928.86px","left":"8507.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5a3d3013-3da2-4001-a5e5-18240e724386":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"d4d633e3-becd-4069-8561-399666ff5567","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d4d633e3-becd-4069-8561-399666ff5567","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"9951500b-f36e-4391-8322-fc1d1a2b1763","type":"text/plain","content":"Prontinho, registrei a sua promessa de pagamento aqui! 😊\n\nSeus serviços de *TV e internet* serão reativados *em até 1h* e seu *telefone* em até *1 dia útil*\n"},"$cardContent":{"document":{"id":"9951500b-f36e-4391-8322-fc1d1a2b1763","type":"text/plain","content":"Prontinho, registrei a sua promessa de pagamento aqui! 😊\n\nSeus serviços de *TV e internet* serão reativados *em até 1h* e seu *telefone* em até *1 dia útil*\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"86ec4070-81f4-4ed7-bedb-ad58df0b47f6","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento nao pago origem","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao pago origem","action":"{{lastState}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento nao pago exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao pago exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"de pagamento nao pago\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"072816bc-0042-45a2-9bc3-93feb5b89fb8","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-de467230-8b14-42c4-9570-7be32bacb82f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4e642be7-6959-49dc-9f60-f0f2b9daa4ae","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8886236c-adf8-41c6-a2c5-ee19d3ae8904","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5a3d3013-3da2-4001-a5e5-18240e724386","root":false,"$title":"[A.1.5.1.9.2]Promessa de Pagamento Nao Pago","$position":{"top":"1930.29px","left":"8234.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"273dfde0-eacc-47c3-a944-2c31ed14fb3b":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"149da045-b85d-425d-8b48-81eb3c6f0b3e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"149da045-b85d-425d-8b48-81eb3c6f0b3e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"c580df9c-9608-440b-ad8c-a35421d33f27","type":"text/plain","content":"⚠ Atenção:\n\n➡ Efetue o pagamento da sua fatura em atraso até o *próximo dia útil* para continuar utilizando seus serviços!\n\n➡ Os juros e taxas gerados pelo atraso desse pagamento serão incluídos na sua próxima fatura"},"$cardContent":{"document":{"id":"c580df9c-9608-440b-ad8c-a35421d33f27","type":"text/plain","content":"⚠ Atenção:\n\n➡ Efetue o pagamento da sua fatura em atraso até o *próximo dia útil* para continuar utilizando seus serviços!\n\n➡ Os juros e taxas gerados pelo atraso desse pagamento serão incluídos na sua próxima fatura"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"eb00cced-36e4-468b-aa38-4ee60702c0fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"$cardContent":{"document":{"id":"eb00cced-36e4-468b-aa38-4ee60702c0fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d0de1f4f-ad5d-463d-bef9-0d5a36a8493a","type":"text/plain","content":"➡ Se o pagamento não for identificado em *{{numeroDias}} dias corridos*, seus serviços serão totalmente desabilitados \n\nO protocolo do atendimento é:\n","metadata":{}},"$cardContent":{"document":{"id":"d0de1f4f-ad5d-463d-bef9-0d5a36a8493a","type":"text/plain","content":"➡ Se o pagamento não for identificado em *{{numeroDias}} dias corridos*, seus serviços serão totalmente desabilitados \n\nO protocolo do atendimento é:\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"2f83a7ca-5dba-4dc6-86b1-180f4aec09c8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"$cardContent":{"document":{"id":"2f83a7ca-5dba-4dc6-86b1-180f4aec09c8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2b0730e4-ee2e-4021-bae1-aaae6c0d9e6d","type":"SendMessage","settings":{"id":"a4b28f16-8bf5-4e9b-b953-39f2e20cbd08","type":"text/plain","content":"{{protocolNumber}}","metadata":{}},"$cardContent":{"document":{"id":"a4b28f16-8bf5-4e9b-b953-39f2e20cbd08","type":"text/plain","content":"{{protocolNumber}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"add79428-1d2e-462a-a59b-5fa5ee89110f","type":"SendMessage","settings":{"id":"acc39cbe-d2c4-47f9-bc2c-f7217a75b730","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"acc39cbe-d2c4-47f9-bc2c-f7217a75b730","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"19678db3-8190-4651-a414-0d37519bb435","type":"text/plain","content":"Você pode efetuar o pagamento da fatura que você já tem. Mas, se te ajudar, eu consigo te mandar a *segunda via* ou o *código de barras* por aqui  \n\n1- Código de barras\n2- Segunda via da fatura\n3- Não precisa"},"$cardContent":{"document":{"id":"19678db3-8190-4651-a414-0d37519bb435","type":"text/plain","content":"Você pode efetuar o pagamento da fatura que você já tem. Mas, se te ajudar, eu consigo te mandar a *segunda via* ou o *código de barras* por aqui  \n\n1- Código de barras\n2- Segunda via da fatura\n3- Não precisa"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a9cb5b6f-3477-4b64-8277-1e98c0060911","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","$connId":"con_1168","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"6c275720-11ea-460b-8b97-364f9f6d321b"},{"stateId":"4130f339-6a5c-46d8-a500-3f1cb8eb5e10","$connId":"con_1173","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@optin"}],"$invalid":false,"$id":"8e8af638-f521-4f11-bef2-cab49938a30f"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1178","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"cf0e37ff-d110-41f7-b033-2a2c9b300b89"}],"$enteringCustomActions":[{"$id":"f882a55b-fcb2-4d9f-a7d4-4172714eec58","type":"SetVariable","$title":"Definir variável - numeroDias - 10","$invalid":false,"settings":{"variable":"numeroDias","value":"10"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"/**\nÓtimo, escolha um desses assuntos pra eu te ajudar:\n\n1- Código de barras\n2- Segunda via de fatura\n3- Fatura digital\n4- Débito automático\n            **/\nfunction run(input) {\n    var firstRegex = /^((\\s*1\\s*)|(um)|(primeir[ao])|((\\s*1\\s*-?\\s*)?c[oó]digo\\s*de\\s*barras?))$/i;\n    if (firstRegex.test(input))\n        return { option: \"1\", content: \"Codigo de barras\" }\n\n    var secondRegex = /^((\\s*2\\s*)|(dois)|(segund[ao])|((\\s*2\\s*-?\\s*)?segunda\\s*via\\s*(de\\s*fatura)?))$/i;\n    if (secondRegex.test(input))\n        return { option: \"2\", content: \"Segunda via de fatura\" };\n\n    var thirdRegex = /^((\\s*3\\s*)|(tr[êe]s)|(terceir[ao])|((\\s*3\\s*-?\\s*)?n[aã]o\\s*(precisa)?))$/i;\n    if(thirdRegex.test(input))\n        return {option:\"3\", content:\"Nao precisa\"}\n     \n    return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255)\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento nao pago selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao pago selecao","action":"{{chooseAnswer@content}}"},"conditions":[{"source":"context","comparison":"equals","variable":"userPaymentStatus","values":["combo-multi-unready"]}]},{"type":"TrackEvent","$title":"Promessa de pagamento nao pago input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao pago input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"userPaymentStatus","values":["combo-multi-unready"]}]},{"type":"TrackEvent","$title":"Promessa de pagamento nao pago combo selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao pago combo selecao","action":"{{chooseAnswer@content}}"},"conditions":[{"source":"context","comparison":"equals","variable":"userPaymentStatus","values":["combo-multi-ready"]}]},{"type":"TrackEvent","$title":"Promessa de pagamento nao pago combo input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao pago combo input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"userPaymentStatus","values":["combo-multi-ready"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"pagamento nao pago\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-1f775b5a-88e9-4000-9c99-d7b72c6b9039","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5819f468-2be6-446c-a481-3f4bb90b3c35","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4703ff72-ef09-4417-9b5e-255c4d3e185f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fd42e3c8-c9d2-422b-b08c-1a8b7b88744f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-ee6e0986-e34e-43e2-8f01-98f942f74f41","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"273dfde0-eacc-47c3-a944-2c31ed14fb3b","root":false,"$title":"[A.1.5.1.9.2.1]Protocolo Pagamento Nao Pago","$position":{"top":"2105.14px","left":"8233.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"072816bc-0042-45a2-9bc3-93feb5b89fb8":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"81e00cdd-5fb2-4c4a-a43c-390d978cde07","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"81e00cdd-5fb2-4c4a-a43c-390d978cde07","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d55dfaf3-6966-4c68-be64-af7dcd2a3fe1","type":"text/plain","content":"Vou te mandar um email com as informações da sua promessa de pagamento.\n\nO protocolo do atendimento é:"},"$cardContent":{"document":{"id":"d55dfaf3-6966-4c68-be64-af7dcd2a3fe1","type":"text/plain","content":"Vou te mandar um email com as informações da sua promessa de pagamento.\n\nO protocolo do atendimento é:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a7ad8904-0d7b-44d1-b82a-7699f176330b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a7ad8904-0d7b-44d1-b82a-7699f176330b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"cf43fc0c-4f40-4e5a-ac00-6defacd9d8f3","type":"text/plain","content":"{{protocolNumber}}"},"$cardContent":{"document":{"id":"cf43fc0c-4f40-4e5a-ac00-6defacd9d8f3","type":"text/plain","content":"{{protocolNumber}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6a8106cd-5a5a-421b-b3af-7940c46f8437","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1183","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"protocolNumberStatus"}],"$invalid":false,"$id":"e3871828-b57e-4048-bbb2-4294eac6db93"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"protocolo pagamento pago\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-a2c82627-57f3-4d99-bf2a-4336bc7ceda5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-28897bae-69f3-49a1-8dda-e46dcf11681e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"072816bc-0042-45a2-9bc3-93feb5b89fb8","root":false,"$title":"[A.1.5.1.9.1.1] Protocolo Pagamento pago","$position":{"top":"2047px","left":"7544px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"abb88e75-3519-4223-bc9a-0c319583ed2e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e665546f-4fb9-4cae-b50c-b2b41752d42f","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f1a530e5-603c-43e2-bd48-270ba952109e","$connId":"con_1188","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"previousMessagesStatus"}],"$invalid":false,"$id":"ae6e0a60-fa58-41de-981e-5b93898b763a"},{"stateId":"f1a530e5-603c-43e2-bd48-270ba952109e","$connId":"con_1193","conditions":[{"source":"context","comparison":"equals","values":["0"],"variable":"qtyPreviousMessages"}],"$invalid":false,"$id":"0d0a37e7-8e31-4e54-9825-e61456f8ea45"},{"stateId":"1858101e-16c5-4bb6-be92-705ca5212677","$connId":"con_1198","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"6e2ee197-2558-4738-8b92-a8ce45b2eb66"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Requisição HTTP - Get Previous Messages","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"{{config.authorizationKey}}","x-application-id":"whatsapp"},"method":"POST","body":"{\n   \t\"stateId\":\"{{origemAjudaAutenticacao@stateId}}\"\n}\n            ","uri":"{{config.apiUrl}}/Blip/messages","responseStatusVariable":"previousMessagesStatus","responseBodyVariable":"previousMessages"},"conditions":[]},{"type":"ExecuteScript","$title":"Obtem Quantidade de Mensagens","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(previousMessages) {\n                return JSON.parse(previousMessages).items.length\n            }","inputVariables":["previousMessages"],"outputVariable":"qtyPreviousMessages","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"previousMessagesStatus","values":["200"]}]}],"$leavingCustomActions":[{"$id":"fa3a7aef-3c9e-4b0e-bcae-2e9937aae8bd","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/Blip/messages';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Mensagem Retorno ajudaAutenticacao\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["previousMessagesStatus","previousMessages"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"previousMessagesStatus","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1858101e-16c5-4bb6-be92-705ca5212677","$invalid":false},"$tags":[{"id":"blip-tag-80b18379-4473-4e38-8dec-0f929d83a142","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-474c4330-d06b-4036-8f19-f34fd3195c92","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"abb88e75-3519-4223-bc9a-0c319583ed2e","root":false,"$title":"Mensagem Retorno ajudaAutenticacao","$position":{"top":"0px","left":"2135px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f1a530e5-603c-43e2-bd48-270ba952109e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"3ee8f6a5-beca-40b2-9200-c52cc84f6339","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"ProcessCommand","$title":"Processar comando - set stateId","$invalid":false,"settings":{"to":"postmaster@msging.net","method":"set","resource":"{{origemAjudaAutenticacao@stateId}}","type":"text/plain","uri":"/contexts/{{contact.identity}}/stateid%40{{config.flowidentifier}}","variable":"commandsReturnAjudaAutenticacao"},"conditions":[]},{"type":"SetVariable","$title":"remove origemAjudaAutenticacao","$invalid":false,"settings":{"variable":"origemAjudaAutenticacao","value":"nul","expiration":1},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-e5f45826-1b81-4d66-9827-0e207bda45e1","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-9377da8f-d3f4-4487-85e2-1471c7954895","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a79ef78e-e0a9-4a86-9c46-e797b579f419","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f1a530e5-603c-43e2-bd48-270ba952109e","root":false,"$title":"Redirecionar de volta - ajudaAutenticacao","$position":{"top":"148px","left":"2135px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a79bebc7-c116-478f-8d65-42408b0d716b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f8bf43a9-a44e-425b-a31a-41076a45e52a","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"0f6e703c-828f-4bc4-aa32-66f28ac833f6","$typeOfContent":"","type":"SetVariable","$title":"redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.6"},"conditions":[]},{"type":"Redirect","$title":"Redirect to principal","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-9b7d345d-d061-4482-9295-8235f10af114","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-23de3a6b-9d74-4184-b9fe-df63c2cd548f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"a79bebc7-c116-478f-8d65-42408b0d716b","$position":{"top":"1.66667px","left":"4658.67px"},"$title":"Redireciona para Como pagar sua fatura Claro","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"be74d156-dfcc-4e53-aa88-05e8bc4c628a":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"129a11a2-0488-4e65-8bad-655279e5bc3d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"129a11a2-0488-4e65-8bad-655279e5bc3d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"24a4d61d-6f59-4255-8336-8fc40dbee38e","type":"text/plain","content":"Você pode cancelar o serviço de débito automático da sua fatura Claro Empresas acessando:\n\nhttp://bit.ly/altcancelpgto"},"$cardContent":{"document":{"id":"24a4d61d-6f59-4255-8336-8fc40dbee38e","type":"text/plain","content":"Você pode cancelar o serviço de débito automático da sua fatura Claro Empresas acessando:\n\nhttp://bit.ly/altcancelpgto"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9bac885b-3573-4c01-b7d8-3b7ae80b1628","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Debito automatico claro empresas cancelamento exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Debito automatico claro empresas cancelamento exibicao","action":"Exibicao"},"conditions":[{"source":"context","comparison":"equals","variable":"isBussinesClient","values":["true"]}]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"cancelar debito automatico\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-f6364da0-9370-4aa5-8aea-e3ddcdcd9095","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4313799e-946c-42fc-ba1d-7bf298314a1c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fb1507f5-e09b-4e30-af19-f86d698d7b28","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"be74d156-dfcc-4e53-aa88-05e8bc4c628a","root":false,"$title":"[A.1.4.2.4] Cancelar Debito Automatico Empresas","$position":{"top":"314px","left":"7241px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1501cebc-4483-4b55-8725-7bba5aa836fc":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"9366d0c1-ab78-4b6f-a7f0-6f59899355c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9366d0c1-ab78-4b6f-a7f0-6f59899355c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"88fb59bb-f070-4a92-90fc-692753fdc14a","type":"text/plain","content":"Escolha como posso continuar te ajudando:\n\n*1-* Voltar para o menu de faturas\n*2-* Voltar para o menu Claro Residencial\n*3-* Suporte Técnico\n*4-* Sair\n"},"$cardContent":{"document":{"id":"88fb59bb-f070-4a92-90fc-692753fdc14a","type":"text/plain","content":"Escolha como posso continuar te ajudando:\n\n*1-* Voltar para o menu de faturas\n*2-* Voltar para o menu Claro Residencial\n*3-* Suporte Técnico\n*4-* Sair\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"b15420fc-3e47-4fa8-8558-7c39fdcf7d50","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","$connId":"con_1203","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"87636632-5ab0-4a9a-93ee-291461df66d6"},{"stateId":"6480aa60-f028-4650-a2b9-5d3a41a0fde5","$connId":"con_1208","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"fa0de762-49d9-48f9-a46f-63832979c0d1"},{"stateId":"6274756d-31d5-49e9-8d4e-006c022207c5","$connId":"con_1213","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"64509d9f-244b-403c-bf4a-3f8bb0fc6c47"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1218","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"61bd65c9-3ac6-4519-bcae-b0d803402b94"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento nao apto exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao apto exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"/**\nEscolha como posso continuar te ajudando:\n\n*1-* Voltar para o menu de faturas\n*2-* Voltar para o menu Claro Residencial\n*3-* Suporte Técnico\n*4-* Sair\n\n**/\nfunction run(input) {\n    var firstRegex = /^((\\s*1\\s*)|(um)|(primeir[ao])|((\\s*1\\s*-?\\s*)?(voltar\\s*para\\s*o?)?(\\s*menu\\s*de)?\\s*faturas?))$/i;\n    if(firstRegex.test(input))\n        return {option:\"1\", content:\"Voltar para o menu de faturas\"}\n\n    var secondRegex = /^((\\s*2\\s*)|(dois)|(segund[ao])|((\\s*2\\s*-?\\s*)?(voltar\\s*para\\s*o?)?(\\s*menu)?\\s*claro\\s*residencial))$/i\n    if(secondRegex.test(input))\n        return {option:\"2\", content:\"Voltar para o menu Claro Residencial\"}\n    \n    var thirdRegex = /^((\\s*3\\s*)|(tr[eê]s)|(terceir[ao])|((\\s*3\\s*-?)?\\s*suporte\\s*(t[eé]cnico)?))$/i;\n    if(thirdRegex.test(input))\n        return {option:\"3\", content:\"Suporte tecnico\"}\n    \n    var fourthRegex = /^((\\s*4\\s*)|(quatro)|(quart[ao])|((\\s*4\\s*-?\\s*)?)sair)$/i;\n    if(fourthRegex.test(input))\n        return {option:\"4\", content:\"Sair\"}\n\n    return {option:\"invalid\", content:\"input inesperado\"}\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n               return input.substring(0,255)\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento nao apto selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao apto selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento nao apto input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao apto input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"SetVariable","$title":"Definir variável - suporteNetRedirectMessage","$invalid":false,"settings":{"variable":"suporteNetRedirectMessage","value":"#suporteNet;#A.4.0.1.1"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-2f8be066-8c31-4d9d-8bd7-5eeadead457b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d4d87fc3-9331-4ae0-8ccf-b649b5b8bf44","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-02e0c499-ffbf-4fb4-8ca0-6d5a2bae8904","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-40ea3c49-977d-435c-bc0a-0ece9442161c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-a72a7ebd-f68b-4413-a80c-fda0dad90172","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1501cebc-4483-4b55-8725-7bba5aa836fc","root":false,"$title":"Menu promessa de pagamento nao apto residencial","$position":{"top":"1606px","left":"7224px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"17c00d4c-072b-41f2-a751-3ceb6547412e":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"9366d0c1-ab78-4b6f-a7f0-6f59899355c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9366d0c1-ab78-4b6f-a7f0-6f59899355c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"88fb59bb-f070-4a92-90fc-692753fdc14a","type":"text/plain","content":"Escolha como posso continuar te ajudando:\n\n*1-* Voltar para o menu de faturas\n*2-* Voltar para o menu Claro Empresas\n*3-* Suporte Técnico\n*4-* Sair\n"},"$cardContent":{"document":{"id":"88fb59bb-f070-4a92-90fc-692753fdc14a","type":"text/plain","content":"Escolha como posso continuar te ajudando:\n\n*1-* Voltar para o menu de faturas\n*2-* Voltar para o menu Claro Empresas\n*3-* Suporte Técnico\n*4-* Sair\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"b15420fc-3e47-4fa8-8558-7c39fdcf7d50","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","$connId":"con_1223","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"27ee3af9-013e-4c21-b188-c456069dd2ae"},{"stateId":"6480aa60-f028-4650-a2b9-5d3a41a0fde5","$connId":"con_1228","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"421613d1-4534-45c8-a483-57ba52eb0d5b"},{"stateId":"6274756d-31d5-49e9-8d4e-006c022207c5","$connId":"con_1233","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"a9305331-4942-4df7-85c1-46433daafc86"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1238","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"fed9d33a-69b0-4b58-89d9-856b452b9a60"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Promessa de pagamento nao apto empresas exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao apto empresas exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"/**\nEscolha como posso continuar te ajudando:\n\n*1-* Voltar para o menu de faturas\n*2-* Voltar para o menu Claro Residencial\n*3-* Suporte Técnico\n*4-* Sair\n\n**/\nfunction run(input) {\n    var firstRegex = /^((\\s*1\\s*)|(um)|(primeir[ao])|((\\s*1\\s*-?\\s*)?(voltar\\s*para\\s*o?)?(\\s*menu\\s*de)?\\s*faturas?))$/i;\n    if(firstRegex.test(input))\n        return {option:\"1\", content:\"Voltar para o menu de faturas\"}\n\n    var secondRegex = /^((\\s*2\\s*)|(dois)|(segund[ao])|((\\s*2\\s*-?\\s*)?(voltar\\s*para\\s*o?)?(\\s*menu)?\\s*cl[oa]r[iao]\\s*empre.*))$/i\n    if(secondRegex.test(input))\n        return {option:\"2\", content:\"Voltar para o menu Claro Residencial\"}\n    \n    var thirdRegex = /^((\\s*3\\s*)|(tr[eê]s)|(terceir[ao])|((\\s*3\\s*-?)?\\s*suporte\\s*(t[eé]cnico)?))$/i;\n    if(thirdRegex.test(input))\n        return {option:\"3\", content:\"Suporte tecnico\"}\n    \n    var fourthRegex = /^((\\s*4\\s*)|(quatro)|(quart[ao])|((\\s*4\\s*-?\\s*)?)sair)$/i;\n    if(fourthRegex.test(input))\n        return {option:\"4\", content:\"Sair\"}\n\n    return {option:\"invalid\", content:\"input inesperado\"}\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n               return input.substring(0,255)\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento nao apto selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao apto empresas selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Promessa de pagamento nao apto input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Promessa de pagamento nao apto empresas input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"SetVariable","$title":"Definir variável - suporteNetRedirectMessage","$invalid":false,"settings":{"variable":"suporteNetRedirectMessage","value":"#suporteNet;#A.4.0.1.1"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-437f49f0-e59a-4061-912f-e1a44cce61ed","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bb42ff2b-27bf-4d1a-bdef-6432adf0d178","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9b9772f9-0954-4ae8-965f-e30972a90760","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-52a64e44-678e-4fbc-963e-0bf5cb6402d8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-a0f2bb6e-b92f-4be7-86e2-423ecb4074b5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"17c00d4c-072b-41f2-a751-3ceb6547412e","root":false,"$title":"Menu promessa de pagamento nao apto empresas","$position":{"top":"1607px","left":"7413px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b1c8b866-4910-40db-923b-271defac1035":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"b3bd35ae-e27e-40f1-b44b-b65d3109d0fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b3bd35ae-e27e-40f1-b44b-b65d3109d0fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"82915aef-6685-4f41-b3fb-3d4c05d738a1","type":"text/plain","content":"É necessário *fazer login* para continuar com o seu atendimento sobre fatura digital\n\n✳️ (Mesmo login e senha do Minha Claro)"},"$cardContent":{"document":{"id":"82915aef-6685-4f41-b3fb-3d4c05d738a1","type":"text/plain","content":"É necessário *fazer login* para continuar com o seu atendimento sobre fatura digital\n\n✳️ (Mesmo login e senha do Minha Claro)"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"c2ab407a-3caf-485b-9a54-79490715099e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c2ab407a-3caf-485b-9a54-79490715099e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"5ad05b4c-c22b-4594-8d96-923a1a0b070d","type":"text/plain","content":"Como posso continuar te ajudando?\n\n*1-* Fazer login\n*2-* Esqueci meu login e senha\n*3-* Não tenho login e senha\n*4-* Ir para o Menu Empresas\n*5-* Sair"},"$cardContent":{"document":{"id":"5ad05b4c-c22b-4594-8d96-923a1a0b070d","type":"text/plain","content":"Como posso continuar te ajudando?\n\n*1-* Fazer login\n*2-* Esqueci meu login e senha\n*3-* Não tenho login e senha\n*4-* Ir para o Menu Empresas\n*5-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"e9ae2184-bf3d-4c90-aacf-51470a27e6b8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1a112d4e-707e-477b-8660-ca5524e37e45","$connId":"con_1243","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"226110f1-6778-4dca-a0c6-f1ec4858136f"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1248","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"8af3db6b-5d7a-4980-8691-affa76b36ce5"},{"stateId":"2990f4cd-ff90-4d67-ad93-549f067930cc","$connId":"con_1253","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"4aceebf2-f4bf-4859-bef3-dae836e11fc0"},{"stateId":"6480aa60-f028-4650-a2b9-5d3a41a0fde5","$connId":"con_1258","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"17131a33-6901-4278-bc5d-131d16832dcc"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1263","conditions":[{"source":"context","comparison":"equals","values":["5"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"1ce94c2f-ed70-4b83-b6d2-a74a8880d2f6"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"fatura digital claro empresas exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"fatura digital claro empresas exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/*\n1- Fazer login\n2- Esqueci meu login e senha\n3- Não tenho login e senha\n4- Ir para o Menu Empresas\n5- Sair\n*/\nfunction run(input) {\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    var firstRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|faz(er)?|[eé]\\s*[ao]?)\\s*)?((0*1\\s*)|um|(primei?r[ao]\\s*(op[cç][aã]o?)?)|((0*1\\s*)?(fazer)?\\s*login))\\s*$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Fazer login\"}\n\n    var secondRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*2\\s*)|dois|(segund[ao]\\s*(op[cç][aã]o?)?)|((0*2\\s*)?\\s*esqueci\\s*(meu|o)?((\\s*login)?\\s*[eao]?(\\s*senha)?)?))\\s*$/i\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Esqueci meu login e senha\"};\n        \n    var thirdRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*3\\s*)|tr[eê]s|(tercei?r[ao]\\s*(op[cç][aã]o?)?)|((0*3\\s*)?(n[ãa]o|ñ|n)\\s*tenho(\\s*login\\s*(e|nem)\\s*senha)?))\\s*$/i\n    if (thirdRegex.test(input))\n        return {option:\"3\", content:\"Nao tenho login e senha\"};\n        \n    var fourthRegex = /\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*4\\s*)|quatro|(quart[ao]\\s*(op[cç][aã]o?)?)|((0*4\\s*)?(ir para o)?\\s*(menu)?\\s*empresas?))$/i\n    if (fourthRegex.test(input))\n        return {option:\"4\", content:\"Pegar o código de barras\"};\n        \n    var fifthRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*5\\s*)|cinco|(quint[ao]\\s*(op[cç][aã]o?)?)|((0*5\\s*)?sair))\\s*$/i\n    if (fifthRegex.test(input))\n        return {option:\"5\", content:\"Sair\"};\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"fatura digital claro empresas selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"fatura digital claro empresas selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"fatura digital claro empresas input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"fatura digital claro empresas input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"fatura digital net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.3.2"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-0c6a07b3-9d70-4f69-8195-5a97cf77830c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-66826276-ec59-4ed8-87ab-d3255fc42f6b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fb5212a0-3746-42e7-ae8e-3e5f07fb24e6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9ab60d63-859e-476e-998f-d3571918f9e4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-30aac758-1fb0-484f-89d3-84bfbeba4811","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b1c8b866-4910-40db-923b-271defac1035","root":false,"$title":"[A.1.3.3] fatura digital claro empresas","$position":{"top":"338.5px","left":"4075.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d51e586a-f1ab-468a-86be-d4356ccf5d06":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e12e9a1a-41a7-4c1b-bea2-32ad0275a9a2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to \"{{config.servicoPrincipal}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#menuTV"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-7472861f-46a2-4464-85bd-fa81e2b42b7e","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"d51e586a-f1ab-468a-86be-d4356ccf5d06","root":false,"$title":"Redireciona Menu TV","$position":{"top":"440.857px","left":"3188px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7f115999-665e-4682-9751-389d2ae96718":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7446af30-27a3-4f6a-b5a2-616a21f4a61f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Alterar vencimento NET validacao - sim","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento NET validacao","action":"sim"},"conditions":[{"source":"context","comparison":"equals","variable":"mobileClientType","values":["combo multi"]}]},{"type":"TrackEvent","$title":"Alterar vencimento NET validacao - nao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"action":"nao","category":"Alterar vencimento NET validacao"},"conditions":[{"source":"context","comparison":"notEquals","variable":"mobileClientType","values":["combo multi"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"188960e0-a8b3-4da5-8c2a-d60e6edc77f4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-6b807d0f-0262-41e0-b911-894f85a61c61","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"7f115999-665e-4682-9751-389d2ae96718","root":false,"$title":"Data Vencimento - ( Desativado)","$position":{"top":"377px","left":"9223px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ecb44e13-a078-448a-a65e-6bec925fd244":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"779189ff-fb30-4a88-84c7-e1a72eda3e31","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"779189ff-fb30-4a88-84c7-e1a72eda3e31","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3ca69a89-3131-473f-8ebb-b587af33e1e8","type":"text/plain","content":"Por aqui eu consigo te ajudar a *consultar* e *alterar* a data de vencimento da sua fatura.","metadata":{}},"$cardContent":{"document":{"id":"3ca69a89-3131-473f-8ebb-b587af33e1e8","type":"text/plain","content":"Por aqui eu consigo te ajudar a *consultar* e *alterar* a data de vencimento da sua fatura."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a27b3c66-17d1-4038-94e3-af69ef1b970c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a6baad17-0813-423a-97a0-74409b9f89d4","$connId":"con_1268","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"a890938f-bef6-4400-b8ad-4ee6074f593c","typeOfStateId":"state"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Alterar vencimento NET nao combo exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento NET nao combo exibicao","action":"Exibicao"},"conditions":[]},{"$id":"275949f9-c30a-4b09-8da3-c9231fb83b31","$typeOfContent":"","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento) {\n    var channel = 'Claro Residencial';\n    if(tipoAtendimento == 'tv') {\n        channel = 'Claro TV';\n    }\n\n    var date = new Date();\n    return {\n        name: 'Alterar vencimento NET',\n        channel: channel,\n        text: 'com Alterar vencimento NET',\n        date: date\n    }\n}","inputVariables":["tipoAtendimento"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"login alterar vencimento\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-63f8dc10-a972-4428-b39e-83eddc139815","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fe700f2e-ad86-4c5d-96b3-d6dcfec85764","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2b965df9-622c-4bbd-983d-6c58c16b9005","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ecb44e13-a078-448a-a65e-6bec925fd244","root":false,"$title":"[A.1.7.1] Login alterar vencimento","$position":{"top":"717.5px","left":"9174px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a6baad17-0813-423a-97a0-74409b9f89d4":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"73464c4c-c386-4ce6-afee-6be1893b8556","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1273","conditions":[{"source":"input","comparison":"equals","values":["#finalizacao"]}],"$invalid":false,"$id":"0d12d252-1494-4033-b2ad-f2c68c27b28e"},{"stateId":"07e22cc5-0aca-4f74-8296-d99e6eaa6a5f","$connId":"con_1278","conditions":[{"source":"input","comparison":"equals","values":["#menu"]}],"$invalid":false,"$id":"a5470c25-705f-4e86-b54b-f9b634c6fd5e"},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1283","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false,"$id":"3335cc85-a597-41cd-8544-2cf2f9558481"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1288","conditions":[{"source":"input","comparison":"equals","values":["#ajudaAutenticacao"]}],"$invalid":false,"$id":"176eb8a9-4c1e-4b77-817e-fed1f1ce955b"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","typeOfStateId":"state","$connId":"con_1293","$id":"b5ddaa11-8f7f-445a-beed-f1df5e9b03c9","conditions":[{"source":"context","comparison":"equals","values":["Ajuda com login"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","typeOfStateId":"state","$connId":"con_1298","$id":"315419ed-208a-405c-a141-a2265eb504af","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","typeOfStateId":"state","$connId":"con_1303","$id":"0446e0c8-ae1e-467a-80c2-292e5dac6514","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"623439a2-a13c-448d-8b83-75b8d7a4aef6","$connId":"con_1308","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"809af60c-9391-4697-9098-c1ce30e73594"}],"$enteringCustomActions":[{"$id":"c5944651-d371-416d-8cc4-701f5dcfb0f7","$typeOfContent":"","type":"ExecuteScript","$title":"loginOptions","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return {\n        templateText: 'Para te ajudar com esse assunto',\n        menu: `Ou, *se preferir*, escolha uma das opções:\\n\\n*1-* Ajuda com o login\\n*2-* Voltar ao Menu anterior\\n*3-* Sair`,\n        options: [\n            {\n                content: 'Ajuda com login',\n                regex: 'ajuda',\n            },\n            {\n                content: `Voltar ao menu`,\n                regex: 'voltar?|menu',\n            },\n            {\n                content: 'Sair',\n                regex: 'sair?',\n            },\n        ],\n        trackingExhibition: 'exibicao',\n        trackingOption: 'selecao',\n        trackingInput: 'input',\n    };\n}\n","inputVariables":[],"outputVariable":"loginOptions","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"Redirect","$title":"Redirect to \"{{config.servicoAutenticacao}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#loginWithOptions#v2"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"00ac1a04-047f-4b67-ae78-516bc403b378","$invalid":false},"$tags":[{"id":"blip-tag-140f59e7-b93c-4879-a6c7-aa83d9503be6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d46086da-c2fc-4c2e-a981-57585c2f1742","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-aafc49a7-8a94-4ea5-9107-8e0a56ae6275","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a6baad17-0813-423a-97a0-74409b9f89d4","root":false,"$title":"Redireciona login data vencimento","$position":{"top":"900px","left":"9186px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0841ed1f-7672-4112-b148-511867eff942":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"72f7c025-cdc8-46ed-a4d3-725f644fc852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"72f7c025-cdc8-46ed-a4d3-725f644fc852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"4eaab727-11df-4266-bac9-96f2e4db9ccb","type":"text/plain","content":"O login e a senha são os *mesmos usados no site e no App do Minha Claro*, se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"$cardContent":{"document":{"id":"4eaab727-11df-4266-bac9-96f2e4db9ccb","type":"text/plain","content":"O login e a senha são os *mesmos usados no site e no App do Minha Claro*, se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"b200ead9-840b-43e4-a18b-bd0b313ea793","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"677fa416-ad39-4926-8c21-c1b1a069494f","$connId":"con_1313","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"07cf053e-a999-45dc-a6a8-1f1e62cfc7c4"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1318","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"58ce8430-a134-426a-a5e8-1bed70b435dd"},{"stateId":"a6baad17-0813-423a-97a0-74409b9f89d4","$connId":"con_1323","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"1bc15b75-d597-4621-b0b6-d8f11126c41e"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1328","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"f745a54b-1cf9-4339-b459-8949baafa07e"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Alterar vencimento não combo login senha exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento não combo login senha exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"/**\n1- Fazer cadastro no Minha Claro\n2- Esqueci meu login e senha\n3- Fazer Login\n4- Sair\n */\n\nfunction run() {\n    return options = JSON.stringify([\n        {\n            content: \"Fazer cadastro no Minha Claro\",\n            regex: \"(fazer)?\\\\s*cadast\\w*\",\n        },\n        {\n            content: \"Esqueci meu login e senha\",\n            regex: \"esqueci\\\\s*(meu|o)?((\\\\s*login)?\\\\s*[eao]?(\\\\s*senha)?)?\",\n        },\n        {\n            content: \"Fazer Login\",\n            regex: \"(fazer)?\\\\s*login\\w*\",\n        },\n        {\n            content: \"Sair\",\n            regex: \"sair?\",\n        },\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["1","2"]}]},{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Alterar vencimento não combo login senha selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento não combo login senha selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Alterar vencimento não combo login senha input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento não combo login senha input","action":"{{inputContentSubstring}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"nao tenho login e senha\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-1aa0c26a-d7f6-462f-ad92-016198ee8a8b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e32c4ec0-c49d-4fff-8739-ab1bb0bcb727","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8f38a53a-a5fd-47b1-b137-0f03835db5e9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-05b17e82-19ed-4ad6-8f57-1a7c77bbd99f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0841ed1f-7672-4112-b148-511867eff942","root":false,"$title":"[A.1.7.1.1] Nao tenho login e senha","$position":{"top":"881.25px","left":"8840.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"677fa416-ad39-4926-8c21-c1b1a069494f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e0cf5e67-a007-43b3-8c11-8012102c2d5e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"origemAjudaAutenticacao"}]},{"type":"Redirect","$title":"Redirecionar autenticacao","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#ajudaCadastro"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-20a5f543-25ec-4f84-8d9e-e6548aca95f3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ecb5420d-28d3-4e3b-8a8b-3001059f2577","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"677fa416-ad39-4926-8c21-c1b1a069494f","root":false,"$title":"Redireciona para fazer cadastro MInha Claro","$position":{"top":"136px","left":"3840px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9fafe589-377e-4ce5-b6af-8cf50beea4d9":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"cf3e31e9-fee4-4bb0-876d-b44cc3844e7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cf3e31e9-fee4-4bb0-876d-b44cc3844e7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendRawMessage","settings":{"metadata":{},"type":"{{updateDueDateMessageWebLink@mimeType}}","rawContent":"{{updateDueDateMessageWebLink@content}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0dd8e215-9a61-492a-9898-7ca35d134fc4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Alterar vencimento NET combo multi exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento NET combo multi exibicao","action":"Exibicao"},"conditions":[]},{"$id":"0be5267a-51c5-42fe-ac00-3e95dc8fdae0","$typeOfContent":"","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento) {\n    var channel = 'Claro Residencial';\n    if(tipoAtendimento == 'tv') {\n        channel = 'Claro TV';\n    }\n\n    var date = new Date();\n    return {\n        name: 'Alterar vencimento NET',\n        channel: channel,\n        text: 'com Alterar vencimento NET',\n        date: date\n    }\n}","inputVariables":["tipoAtendimento"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"73cc6733-c4f0-4846-9eeb-5c50d6e8e6f3","$typeOfContent":"","type":"ExecuteScript","$title":"updateDueDateMessageWebLink","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var link = encodeURI(\"https://minhanet.net.com.br/webcenter/portal/MinhaNet/pages_faleconosco\");\n    var message = `Para *consultar* e *alterar* a data de vencimento da sua fatura:\\n\\n➡️ *Clique no link* abaixo para acessar o site Minha Claro ⬇\\n\\n➡️ *Faça o login* no site\\n\\n➡️ Mande sua solicitação de data de vencimento no *Fale Conosco*\\n\\n${link}`;\n\n    var template = {\n        content: {\n            preview_url: true,\n            recipient_type: \"individual\",\n            type: \"text\",\n            text: {\n                body: message\n            }\n        },\n        mimeType: \"application/json\"\n    }\n\n    return template;\n}\n","inputVariables":[],"outputVariable":"updateDueDateMessageWebLink","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"alterar vencimento combo multi\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-41d88396-13c4-4a84-a555-9aa08ba4162c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8ce45ef1-2104-443a-bdd4-7d871fbad038","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7dd3507a-ec08-45cf-b01f-96902dbdae9f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9fafe589-377e-4ce5-b6af-8cf50beea4d9","root":false,"$title":"[A.1.7.2] Alterar vencimento combo multi","$position":{"top":"559.667px","left":"9590px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"00ac1a04-047f-4b67-ae78-516bc403b378":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e8889ff7-efc5-4ec9-ac2e-f9ef1572112a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1333","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusDataVencimento"}],"$invalid":false,"$id":"cb9e4ba5-c474-4d05-b771-2dbdb81a51ad"},{"stateId":"277b0a3a-27d1-4240-a496-26f97eef3835","$connId":"con_1338","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"794bd142-0c6e-4f80-a9d1-2ec5a0dc09ff"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"GET dataVencimento","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/accountmanagement/bill-expiration-days?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","responseBodyVariable":"responseDataVencimento","responseStatusVariable":"statusDataVencimento"},"conditions":[]}],"$leavingCustomActions":[{"$id":"db50960e-1337-4651-9f8f-bcfef001d494","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/accountmanagement/bill-expiration-days?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"HTTP GET data vencimento\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["statusDataVencimento","responseDataVencimento"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusDataVencimento"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-fd792efc-570b-47ed-8280-dd4ef5cfe7b4","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-fbfa849f-e408-41d2-9367-0674188add13","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"00ac1a04-047f-4b67-ae78-516bc403b378","root":false,"$title":"HTTP GET data vencimento","$position":{"top":"1052px","left":"9193px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"277b0a3a-27d1-4240-a496-26f97eef3835":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"fea497df-c554-4ede-84fb-6da6ff293a68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fea497df-c554-4ede-84fb-6da6ff293a68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"0d06938a-1cd5-45bc-ae37-e19ed65fbacb","type":"text/plain","content":"Atualmente sua fatura vence todo *dia {{responseDataVencimento@data.expirationDate}}*\n\nVocê prefere:\n\n*1-* Alterar o vencimento\n*2-* Manter como está","metadata":{}},"$cardContent":{"document":{"id":"0d06938a-1cd5-45bc-ae37-e19ed65fbacb","type":"text/plain","content":"Atualmente sua fatura vence todo *dia {{responseDataVencimento@data.expirationDate}}*\n\nVocê prefere:\n\n*1-* Alterar o vencimento\n*2-* Manter como está"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"e8889ff7-efc5-4ec9-ac2e-f9ef1572112a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cfa35b27-0769-47f2-9117-8066a29ddef3","$connId":"con_1343","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"d457b582-4b90-4a60-88f4-ba39481b3698"},{"stateId":"e46a00ba-77b1-40fc-88b1-55bd3d54f6f3","$connId":"con_1348","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"ac693479-7c99-40bc-b2d4-f4268bed33c2"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Alterar vencimento não combo login exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento não combo login exibicao","action":"Exibicao"},"conditions":[]},{"type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var date = new Date();\n    return {\n        name: 'Alterar vencimento',\n        channel: 'Claro Residencial',\n        text: 'com alteração de vencimento',\n        date: new Date()\n    }\n}","inputVariables":[],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"function run(inputVariable1, inputVariable2) {\n    return options = JSON.stringify([\n        {\n            content: \"Alterar o vencimento\",\n            regex: \"alterar?|mudar?\",\n        },\n        {\n            content: \"Manter como está\",\n            regex: \"mant[eé][rm]|deixar?|igual|mesm[oa]\",\n        },\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0, 255)\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Alterar vencimento não combo login selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento não combo login selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Alterar vencimento não combo login input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento não combo login input","action":"{{inputContentSubstring}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"exibe data vencimento\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-bff7b4ad-ab33-4e22-b33c-9a7f5434dcee","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-09f54a12-1e37-4ac8-88df-044b9c933d68","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-09d71188-d853-444f-98c4-355c216eb111","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-b6e3e308-d276-4583-86ad-6df84a68b373","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"277b0a3a-27d1-4240-a496-26f97eef3835","root":false,"$title":"[A.1.7.1.1.1] Exibe data vencimento","$position":{"top":"1181px","left":"9195px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e46a00ba-77b1-40fc-88b1-55bd3d54f6f3":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"219d21ff-f08d-4cbf-9972-3f4b8032692d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"219d21ff-f08d-4cbf-9972-3f4b8032692d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"0921e2b5-25be-44c7-9645-51b41b1ec6c7","type":"text/plain","content":"Ok, não fiz *nenhuma alteração* na data de vencimento da sua fatura\n\nSe mudar de ideia, é só voltar a falar comigo e digitar *Alterar data de vencimento* que eu te ajudo mais rápido! 😉","metadata":{}},"$cardContent":{"document":{"id":"0921e2b5-25be-44c7-9645-51b41b1ec6c7","type":"text/plain","content":"Ok, não fiz *nenhuma alteração* na data de vencimento da sua fatura\n\nSe mudar de ideia, é só voltar a falar comigo e digitar *Alterar data de vencimento* que eu te ajudo mais rápido! 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"afacc158-60d3-42d4-b2c1-cddb56ca143f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Nao alterar vencimento nao combo exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Nao alterar vencimento nao combo exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"nao fiz alteracao\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-ef97d618-a04a-4341-8b07-d64422797695","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5be7d897-c2c1-41d7-aa4f-57a1d93ed2c3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f8630995-9f6e-47b1-aabc-89eb468b0919","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e46a00ba-77b1-40fc-88b1-55bd3d54f6f3","root":false,"$title":"[A.1.7.1.1.1.2] Nao fiz alteracao","$position":{"top":"1198.11px","left":"9719.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cfa35b27-0769-47f2-9117-8066a29ddef3":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"8ec503dc-13c0-4bf4-be76-bc4dddca9346","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8ec503dc-13c0-4bf4-be76-bc4dddca9346","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"eae57c2c-285a-46b4-b9cb-b0a1da64c12b","type":"text/plain","content":"{{menuOpcoesDataVencimento}}"},"$cardContent":{"document":{"id":"eae57c2c-285a-46b4-b9cb-b0a1da64c12b","type":"text/plain","content":"{{menuOpcoesDataVencimento}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"edecb388-e47a-4ab3-9267-1eaf8bb03562","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e46a00ba-77b1-40fc-88b1-55bd3d54f6f3","$connId":"con_1353","conditions":[{"source":"context","comparison":"equals","values":["Desistir da alteração"],"variable":"chooseAnswer@content"}],"$invalid":false,"$id":"d4a2e3d8-12d3-4f28-9a62-f5b90b0870b9"},{"stateId":"c6180b08-f420-44d3-9cb9-bd728ff70daa","$connId":"con_1358","conditions":[{"source":"context","comparison":"equals","values":["invalid"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"62904530-3322-4ea6-b017-5fe48c96dc16"},{"stateId":"29a126d7-ef53-448f-a021-87eef0fe5646","$connId":"con_1363","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"e6bb3372-a17b-4f82-925d-44d1c4f9c51f"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"function run(responseDataVencimento) {\n    try {\n        const dataAtual = JSON.parse(responseDataVencimento).expirationDate;\n        const todasDatasPossiveis = [\"5\", \"8\", \"10\", \"15\", \"20\", \"25\"]\n        const datasSobrando = todasDatasPossiveis.filter(function (d) {\n            return d != dataAtual;\n        })\n\n        let options = [];\n        datasSobrando.forEach(function (d) {\n            let optionsDayRegex = \"\";\n            switch (d) {\n                case '8':\n                    optionsDayRegex = \"|8|oito\";\n                    break;\n                case '10':\n                    optionsDayRegex = \"|10|dez\";\n                    break;\n                case '15':\n                    optionsDayRegex = \"|15|quinze\";\n                    break;\n                case '20':\n                    optionsDayRegex = \"|20|vinte\";\n                    break;\n                case '25':\n                    optionsDayRegex = \"|25|vinte e cinco\";\n                    break;\n            }\n            options.push({\n                content: \"Vencimento dia \" + d,\n                regex: \"(vencim\\\\w*|dia)\\\\s*\" + d + optionsDayRegex\n            })\n        });\n\n        options.push({\n            content: \"Desistir da alteração\",\n            regex: \"desist\\\\w*|voltar?|cancelar?\"\n        })\n\n        return JSON.stringify(options);\n\n    } catch (e) {\n        return JSON.stringify([\n            {\n                content: \"Vencimento dia 5\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*5\",\n            },\n            {\n                content: \"Vencimento dia 8\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*8|8|oito\",\n            },\n            {\n                content: \"Vencimento dia 10\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*10|10|dez\",\n            },\n            {\n                content: \"Vencimento dia 15\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*15|15|quinze\",\n            },\n            {\n                content: \"Vencimento dia 20\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*20|20|vinte\",\n            },\n            {\n                content: \"Vencimento dia 25\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*25|25|vinte e cinco\",\n            },\n        ]);\n    }\n}\n","inputVariables":["responseDataVencimento"],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - monta menuOpcoesDataVencimento","$invalid":false,"settings":{"function":"run","source":"\nfunction run(options) {\n    try {\n        options = JSON.parse(options);\n\n        let menuOpcoesDataVencimento = \"Ok, tenho essas datas disponíveis. *Digita pra mim o número que indica a opção* que você prefere:\\n\\n\";\n\n        options.forEach(function (option, idx) {\n            const numeroOpcao = \"\" + (idx + 1);\n            const str = \"*\" + numeroOpcao + \"-* \" + option.content + \"\\n\";\n            menuOpcoesDataVencimento += str;\n        })\n\n        return menuOpcoesDataVencimento;\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["options"],"outputVariable":"menuOpcoesDataVencimento","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Alterar vencimento não combo data exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento não combo data exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        numericOption = i + 1;\n        numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255)\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Alterar vencimento não combo data selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento não combo data selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Alterar vencimento não combo data input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar vencimento não combo data input","action":"{{inputContentSubstring}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"escolhe data vencimento\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-de6e0754-fc20-4f07-976b-ae14f1900453","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2c2e054c-8b45-44ce-8a0e-688a14361835","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f7b85b30-f301-4b30-81c5-207f5aa635f4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-590dcc1c-6baf-4057-ab9d-2f3a826200e3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"cfa35b27-0769-47f2-9117-8066a29ddef3","root":false,"$title":"[A.1.7.1.1.1.1] Escolhe data vencimento","$position":{"top":"1310px","left":"9195px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"29a126d7-ef53-448f-a021-87eef0fe5646":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"b1dfc28c-6dfa-40ad-8035-c09e1ee9af96","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b1dfc28c-6dfa-40ad-8035-c09e1ee9af96","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d7a675e9-d74b-4ae4-ba38-9c756fe0eed3","type":"text/plain","content":"Ao confirmar, sua fatura passará a vencer *todo dia {{diaEscolhido}}*\n\nVocê gostaria de:\n\n*1-* Confirmar alteração\n*2-* Desistir da alteração\n*3-* Voltar e escolher outra data"},"$cardContent":{"document":{"id":"d7a675e9-d74b-4ae4-ba38-9c756fe0eed3","type":"text/plain","content":"Ao confirmar, sua fatura passará a vencer *todo dia {{diaEscolhido}}*\n\nVocê gostaria de:\n\n*1-* Confirmar alteração\n*2-* Desistir da alteração\n*3-* Voltar e escolher outra data"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"9e07872e-8d7a-449b-9bd1-084efcf6f78b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cb626973-a3f2-4ed6-8023-53eed1c744ea","$connId":"con_1368","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"4197eaa1-e97a-4876-97c3-8312ea168a0d"},{"stateId":"e46a00ba-77b1-40fc-88b1-55bd3d54f6f3","$connId":"con_1373","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"505ddf2c-5cd1-40ff-bb05-70e3c9dce9f4"},{"stateId":"cfa35b27-0769-47f2-9117-8066a29ddef3","$connId":"con_1378","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"f32a7fb8-ba77-4633-98bd-24d2c537ef3a"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - diaEscolhido","$invalid":false,"settings":{"function":"run","source":"function run(chooseAnswer) {\n    const diaEscolhido = JSON.parse(chooseAnswer).content.match(/\\d+/)[0];\n    return diaEscolhido;\n}","inputVariables":["chooseAnswer"],"outputVariable":"diaEscolhido","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"/**\n1- Confirmar alteração\n2- Desistir da alteração\n3- Voltar e escolher outra data\n**/\nfunction run() {\n    return JSON.stringify([\n        {\n            content: \"Confirmar alteração\",\n            regex: \"confirma\",\n        },\n        {\n            content: \"Desistir da alteração\",\n            regex: \"desist\\\\w*\",\n        },\n        {\n            content: \"Voltar e escolher outra data\",\n            regex: \"volta|escolher?.*data\",\n        },\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"confirmar alteracao vencimento\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-58a08a70-f7b8-4243-aa56-4565c7585e10","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4555de05-22a5-4d88-b479-b05be4d3962b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-d0980123-18b2-4f9e-9b51-64c42af91450","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"29a126d7-ef53-448f-a021-87eef0fe5646","root":false,"$title":"[A.1.7.1.1.1.1.1] Confirmar alteracao vencimento","$position":{"top":"1563px","left":"9008px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c6180b08-f420-44d3-9cb9-bd728ff70daa":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"8ec503dc-13c0-4bf4-be76-bc4dddca9346","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8ec503dc-13c0-4bf4-be76-bc4dddca9346","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"eae57c2c-285a-46b4-b9cb-b0a1da64c12b","type":"text/plain","content":"{{menuOpcoesDataVencimento}}"},"$cardContent":{"document":{"id":"eae57c2c-285a-46b4-b9cb-b0a1da64c12b","type":"text/plain","content":"{{menuOpcoesDataVencimento}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"edecb388-e47a-4ab3-9267-1eaf8bb03562","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e46a00ba-77b1-40fc-88b1-55bd3d54f6f3","$connId":"con_1383","conditions":[{"source":"context","comparison":"equals","values":["Desistir da alteração"],"variable":"chooseAnswer@content"}],"$invalid":false,"$id":"cdd07286-4a8b-4b3f-a239-82359d776adb"},{"stateId":"29a126d7-ef53-448f-a021-87eef0fe5646","$connId":"con_1388","conditions":[{"source":"context","comparison":"notEquals","values":["invalid"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"2c1a2da8-1458-4c1c-85c1-141546d4f3c6"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"function run(responseDataVencimento) {\n    try {\n        const dataAtual = JSON.parse(responseDataVencimento).expirationDate;\n        const todasDatasPossiveis = [\"5\", \"8\", \"10\", \"15\", \"20\", \"25\"]\n        const datasSobrando = todasDatasPossiveis.filter(function (d) {\n            return d != dataAtual;\n        })\n\n        let options = [];\n        datasSobrando.forEach(function (d) {\n            let optionsDayRegex = \"\";\n            switch (d) {\n                case '8':\n                    optionsDayRegex = \"|8|oito\";\n                    break;\n                case '10':\n                    optionsDayRegex = \"|10|dez\";\n                    break;\n                case '15':\n                    optionsDayRegex = \"|15|quinze\";\n                    break;\n                case '20':\n                    optionsDayRegex = \"|20|vinte\";\n                    break;\n                case '25':\n                    optionsDayRegex = \"|25|vinte e cinco\";\n                    break;\n            }\n            options.push({\n                content: \"Vencimento dia \" + d,\n                regex: \"(vencim\\\\w*|dia)\\\\s*\" + d + optionsDayRegex\n            })\n        });\n\n        options.push({\n            content: \"Desistir da alteração\",\n            regex: \"desist\\\\w*|voltar?|cancelar?\"\n        })\n\n        return JSON.stringify(options);\n\n    } catch (e) {\n        return JSON.stringify([\n            {\n                content: \"Vencimento dia 5\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*5\",\n            },\n            {\n                content: \"Vencimento dia 8\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*8|8|oito\",\n            },\n            {\n                content: \"Vencimento dia 10\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*10|10|dez\",\n            },\n            {\n                content: \"Vencimento dia 15\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*15|15|quinze\",\n            },\n            {\n                content: \"Vencimento dia 20\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*20|20|vinte\",\n            },\n            {\n                content: \"Vencimento dia 25\",\n                regex: \"(vencim\\\\w*|dia)\\\\s*25|25|vinte e cinco\",\n            },\n        ]);\n    }\n}\n","inputVariables":["responseDataVencimento"],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - monta menuOpcoesDataVencimento","$invalid":false,"settings":{"function":"run","source":"\nfunction run(options) {\n    try {\n        options = JSON.parse(options);\n        let menuOpcoesDataVencimento = \"Desculpe, não entendi. Digita pra mim *apenas o número que indica* a opção que você escolheu:\\n\\n\";\n\n        options.forEach(function (option, idx) {\n            const numeroOpcao = \"\" + (idx + 1);\n            const str = \"*\" + numeroOpcao + \"-* \" + option.content + \"\\n\";\n            menuOpcoesDataVencimento += str;\n        })\n\n        return menuOpcoesDataVencimento;\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["options"],"outputVariable":"menuOpcoesDataVencimento","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Confirmar vencimento não combo tentativa exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Confirmar vencimento não combo tentativa exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n    options = JSON.parse(options);\n    if (options && options.length > 0) {\n        numericOptionsRegex = JSON.parse(numericOptionsRegex);\n        input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n        if (input != \"\") {\n            for (let i = 0; i < options.length; i++) {\n                numericOption = i + 1;\n                numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n                option = options[i];\n                const contentRegex = new RegExp(option.regex, 'i');\n                if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n                    return { option: \"\" + numericOption, content: option.content };\n                }\n            }\n        }\n    }\n\n    return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0, 255)\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Confirmar vencimento não combo tentativa selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Confirmar vencimento não combo tentativa selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"TrackEvent","$title":"Confirmar vencimento não combo tentativa input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Confirmar vencimento não combo tentativa input","action":"{{inputContentSubstring}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"nao entendi data vencimento\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-5831ed6b-13ea-4183-9153-a0b6bdb6b59b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bc660bfe-9ad0-41a3-b733-df03079029bb","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7067a775-5d17-4efd-bd43-541690ae3761","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-bfb89323-ad05-4f5f-b62a-de1476d56b51","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c6180b08-f420-44d3-9cb9-bd728ff70daa","root":false,"$title":"[A.1.7.1.1.1.1.2] Nao entendi data vencimento","$position":{"top":"1487px","left":"9331px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"da1220fe-ddea-4dd9-98ab-86893e79db70":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"b1dfc28c-6dfa-40ad-8035-c09e1ee9af96","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b1dfc28c-6dfa-40ad-8035-c09e1ee9af96","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d7a675e9-d74b-4ae4-ba38-9c756fe0eed3","type":"text/plain","content":"Prontinho, alterei aqui! 😉\n\n⚠️ Fique atento à sua *próxima fatura, talvez ela venha na data antiga*\n\nA alteração da data de vencimento da sua fatura começará a valer em até *2 meses*"},"$cardContent":{"document":{"id":"d7a675e9-d74b-4ae4-ba38-9c756fe0eed3","type":"text/plain","content":"Prontinho, alterei aqui! 😉\n\n⚠️ Fique atento à sua *próxima fatura, talvez ela venha na data antiga*\n\nA alteração da data de vencimento da sua fatura começará a valer em até *2 meses*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"bd1f3b32-8c48-4f01-841e-87ca7c35470f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bd1f3b32-8c48-4f01-841e-87ca7c35470f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"f7a6f3b0-dddb-4041-b393-bd2bdb82c2cc","type":"text/plain","content":"Seu nº de protocolo para esta solicitação é: "},"$cardContent":{"document":{"id":"f7a6f3b0-dddb-4041-b393-bd2bdb82c2cc","type":"text/plain","content":"Seu nº de protocolo para esta solicitação é: "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"57963415-09df-4dd2-aa21-b213391e72c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"57963415-09df-4dd2-aa21-b213391e72c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"59bf86ec-3214-4873-8ba1-8e8a76e42ba0","type":"text/plain","content":"{{protocoloDataVencimento@number}}"},"$cardContent":{"document":{"id":"59bf86ec-3214-4873-8ba1-8e8a76e42ba0","type":"text/plain","content":"{{protocoloDataVencimento@number}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9e07872e-8d7a-449b-9bd1-084efcf6f78b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Data vencimento não combo confirmada exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Data vencimento não combo confirmada exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mensagem de confirmacao\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-4d0ccb88-57a1-402d-a7cf-82671640986f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ebaf91cb-0821-4e1a-81f4-d475e8602b4d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6c1b5d92-666d-4bc9-bb9e-93aec7aa9c65","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"da1220fe-ddea-4dd9-98ab-86893e79db70","root":false,"$title":"[A.1.7.1.1.1.1.1.1] Mensagem de confirmacao","$position":{"top":"1781px","left":"8987.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cb626973-a3f2-4ed6-8023-53eed1c744ea":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"703b87f6-c3a8-45ca-9c87-cf1e82f31991","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"da1220fe-ddea-4dd9-98ab-86893e79db70","$connId":"con_1393","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"protocoloDataVencimento"},{"source":"context","comparison":"equals","variable":"protocoloDataVencimento@status","values":["true"]}],"$invalid":false,"$id":"949b205f-c3ba-4844-b7da-5724719849e0"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"PUT Data Vencimento","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"POST","body":"{\n    \"AccessToken\": \"{{tokenAccessFormated}}\",\n    \"Document\": \"{{tokenPayload@cpf}}\",\n    \"ContractNumber\": \"{{tokenPayload@contrato}}\",\n    \"OperatorCode\": \"{{tokenPayload@codigoOperadora}}\",\n    \"Data\": {\n        \"alteredDate\": {{diaEscolhido}}\n    }\n}","uri":"{{config.apiUrl}}/v1/intermediate/accountmanagement/bill-expiration-days","responseStatusVariable":"statusAlterarVencimento","responseBodyVariable":"responseAlterarVencimento"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - protocoloDataVencimento","$invalid":false,"settings":{"function":"run","source":"\nfunction run(responseAlterarVencimento) {\n    try {\n        const response = JSON.parse(responseAlterarVencimento).data;\n        const protocol = response.entity.protocol.number;\n        const status = response.responseStatus.status;\n        \n        return {\n            number: protocol,\n            status: status\n        }\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["responseAlterarVencimento"],"outputVariable":"protocoloDataVencimento","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusAlterarVencimento","values":["200"]}]}],"$leavingCustomActions":[{"$id":"d2412bd8-7a0a-49c2-94b6-febac4b97fa3","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/accountmanagement/bill-expiration-days';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"HTTP PUT dataVencimento\",\n            status: status,\n            response: response,\n            request: {\n                url: url,\n                body: {\n                    \"clientName\": \"{{tokenPayload@nome}}\",\n                    \"codeCity\": \"{{tokenPayload@codCidadeNet}}\",\n                    \"alteredDate\": \"{{diaEscolhido}}\"\n                }\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["statusAlterarVencimento","responseAlterarVencimento"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusAlterarVencimento","values":["202"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-dd5cd015-65f9-41bc-bbae-bf12f387af4c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-f83a4cb5-df8d-45db-b860-3934f39f849a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"cb626973-a3f2-4ed6-8023-53eed1c744ea","root":false,"$title":"HTTP PUT dataVencimento","$position":{"top":"1695px","left":"9308px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"623439a2-a13c-448d-8b83-75b8d7a4aef6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0a7d3bcb-ac3e-474f-865d-c44c8bc4b18e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9fafe589-377e-4ce5-b6af-8cf50beea4d9","$connId":"con_1398","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isComboMulti"}],"$invalid":false,"$id":"5f82fdff-0fc2-4046-b360-0c4c1c4530c6"},{"stateId":"00ac1a04-047f-4b67-ae78-516bc403b378","$connId":"con_1403","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"statusVencimentoComboMulti"}],"$invalid":false,"$id":"61ed3f8a-cfe0-4488-bb9b-67561951cdc3"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Process \"responseVencimentoComboMulti\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/accountmanagement/bill-expiration-days/validate?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","responseStatusVariable":"statusVencimentoComboMulti","responseBodyVariable":"responseVencimentoComboMulti"},"conditions":[]},{"type":"ExecuteScript","$title":"Process \"isComboMulti\"","$invalid":false,"settings":{"function":"run","source":"function run(responseVencimentoComboMulti) {\n    try{\n        let response = JSON.parse(responseVencimentoComboMulti).data;\n    return response.responseStatus.arrayOfMessage[0].indexOf(\"Combo Multi\") != -1;\n    }\n    catch (e) {\n        return e\n    }\n}","inputVariables":["responseVencimentoComboMulti"],"outputVariable":"isComboMulti","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusVencimentoComboMulti","values":["202","200"]}]},{"type":"TrackEvent","$title":"Validacao retorno de login alterar vencimeto NET","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao retorno de login alterar vencimeto NET","action":"{{token}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c8ec4e68-4e28-4ac8-9ecd-31e7e80e8c03","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/accountmanagement/bill-expiration-days/validate?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"HTTP GET Cliente Combo Multi\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["statusVencimentoComboMulti","responseVencimentoComboMulti"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusVencimentoComboMulti","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$invalid":false},"$tags":[{"id":"blip-tag-bdcf044a-33b9-4fb0-9ba2-424e8713102e","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-944ae2ed-dcf9-4b27-ad30-27cd42f43337","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-aab743df-027c-4151-9f75-d5a01be46651","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"623439a2-a13c-448d-8b83-75b8d7a4aef6","root":false,"$title":"HTTP GET Cliente Combo Multi","$position":{"top":"977px","left":"9408px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1858101e-16c5-4bb6-be92-705ca5212677":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"22598052-5017-43cb-b246-4560692b2951","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"22598052-5017-43cb-b246-4560692b2951","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendRawMessage","settings":{"metadata":{},"type":"application/vnd.lime.collection+json","rawContent":"{{previousMessages}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5807f5b2-b1c7-4bdb-aca2-a31b2d8a94fd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f1a530e5-603c-43e2-bd48-270ba952109e","$connId":"con_1408","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"5b867270-b292-47e5-aa11-a165632be2f7"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f1a530e5-603c-43e2-bd48-270ba952109e","$invalid":false},"$tags":[{"id":"blip-tag-e15c5fd1-208c-45dc-aedd-671647cf1c79","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"1858101e-16c5-4bb6-be92-705ca5212677","root":false,"$title":"Enviar Mensagem ajudaAutenticacao","$position":{"top":"27px","left":"1903px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7f9d2979-a6b0-4438-a60d-579e3b575d53":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f44a37c8-4bbc-4e93-9af0-b624392ed852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f44a37c8-4bbc-4e93-9af0-b624392ed852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3263ee69-babf-4b1a-9b2a-cef1028b1f92","type":"text/plain","content":"O login e senha são os *mesmos usados no site e no App do Minha Claro,* se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"$cardContent":{"document":{"id":"3263ee69-babf-4b1a-9b2a-cef1028b1f92","type":"text/plain","content":"O login e senha são os *mesmos usados no site e no App do Minha Claro,* se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"670afa30-05db-4c9f-bad4-d0c2c6958f9e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"677fa416-ad39-4926-8c21-c1b1a069494f","$connId":"con_1413","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"a900db36-806e-4f87-8893-a35914871e90"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1418","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"06751617-3720-4bfc-8e7b-1d46c7586e27"},{"stateId":"914291a2-24b3-40ba-91a1-992e7abbb076","$connId":"con_1423","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"f0d520e1-8c9b-426b-a1ad-b3c1df95461d","typeOfStateId":"state"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1428","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"35a075db-90af-4e89-a190-40818bd8ef4a"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/*\n1- Fazer cadastro no Minha Claro\n2- Esqueci meu login e senha\n3- Fazer Login\n4- Sair\n*/\n\nfunction run(input) {\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    var firstRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|faz(er)?|[eé]\\s*[ao]?)\\s*)?((0*1\\s*)|um|(primei?r[ao]\\s*(op[cç][aã]o?)?)|((0*1\\s*)?(fazer)?\\s*cadastro(\\s*no\\s*minha\\s*claro)?))\\s*$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Fazer cadastro no Minha Claro\"}\n\n    var secondRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*2\\s*)|dois|(segund[ao]\\s*(op[cç][aã]o?)?)|((0*2\\s*)?\\s*esqueci\\s*(meu|o)?((\\s*login)?\\s*[eao]?(\\s*senha)?)?))\\s*$/i\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Esqueci meu login e senha\"};\n        \n    var thirdRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*3\\s*)|tr[eê]s|(tercei?r[ao]\\s*(op[cç][aã]o?)?)|((0*3\\s*)?(fazer)?\\s*login))\\s*$/i\n    if (thirdRegex.test(input))\n        return {option:\"3\", content:\"Fazer Login\"};\n        \n    var fourthRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*4\\s*)|quatro|(quart[ao]\\s*(op[cç][aã]o?)?)|((0*4\\s*)?sair))\\s*$/i\n    if (fourthRegex.test(input))\n        return {option:\"4\", content:\"Sair\"};\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["1","2"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"nao tenho login e senha\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-1e6a5dc9-141e-471d-bf53-9025894b8617","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c6d20134-761a-4a22-8151-ef13f9d9ce09","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-0225b6c4-aed8-4659-8fe8-c9567baaf47d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7f9d2979-a6b0-4438-a60d-579e3b575d53","root":false,"$title":"[A.1.2.2.0.3] Nao tenho login e senha","$position":{"top":"1000px","left":"1402px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2990f4cd-ff90-4d67-ad93-549f067930cc":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f44a37c8-4bbc-4e93-9af0-b624392ed852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f44a37c8-4bbc-4e93-9af0-b624392ed852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3263ee69-babf-4b1a-9b2a-cef1028b1f92","type":"text/plain","content":"O login e senha são os *mesmos usados no site e no App do Minha Claro,* se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"$cardContent":{"document":{"id":"3263ee69-babf-4b1a-9b2a-cef1028b1f92","type":"text/plain","content":"O login e senha são os *mesmos usados no site e no App do Minha Claro,* se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"670afa30-05db-4c9f-bad4-d0c2c6958f9e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"677fa416-ad39-4926-8c21-c1b1a069494f","$connId":"con_1433","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"c38f4227-bb6e-42d8-8162-530f9a6c44db"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1438","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"a2205095-97fc-4c4d-901c-0735cbc6f051"},{"stateId":"1a112d4e-707e-477b-8660-ca5524e37e45","$connId":"con_1443","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"080f608d-dadf-46b9-9526-ee81e7172b44"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1448","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"78f1886e-7587-4646-a653-c76b2f74b3d7"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/*\n1- Fazer cadastro no Minha Claro\n2- Esqueci meu login e senha\n3- Fazer Login\n4- Sair\n*/\n\nfunction run(input) {\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    var firstRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|faz(er)?|[eé]\\s*[ao]?)\\s*)?((0*1\\s*)|um|(primei?r[ao]\\s*(op[cç][aã]o?)?)|((0*1\\s*)?(fazer)?\\s*cadastro(\\s*no\\s*minha\\s*claro)?))\\s*$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Fazer cadastro no Minha Claro\"}\n\n    var secondRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*2\\s*)|dois|(segund[ao]\\s*(op[cç][aã]o?)?)|((0*2\\s*)?\\s*esqueci\\s*(meu|o)?((\\s*login)?\\s*[eao]?(\\s*senha)?)?))\\s*$/i\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Esqueci meu login e senha\"};\n        \n    var thirdRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*3\\s*)|tr[eê]s|(tercei?r[ao]\\s*(op[cç][aã]o?)?)|((0*3\\s*)?(fazer)?\\s*login))\\s*$/i\n    if (thirdRegex.test(input))\n        return {option:\"3\", content:\"Fazer Login\"};\n        \n    var fourthRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*4\\s*)|quatro|(quart[ao]\\s*(op[cç][aã]o?)?)|((0*4\\s*)?sair))\\s*$/i\n    if (fourthRegex.test(input))\n        return {option:\"4\", content:\"Sair\"};\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["1","2"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"nao tenho login e senha\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-20af545a-a29c-4695-8f43-f996fb4bb6f3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a872bcb6-e359-4c10-90b4-80579d572a04","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-d1f178cb-30c7-4061-92f0-279829716f13","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2990f4cd-ff90-4d67-ad93-549f067930cc","root":false,"$title":"[A.1.3.2.0.1] Nao tenho login e senha","$position":{"top":"567.333px","left":"4092.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"daf75513-69eb-42cd-bc3f-26d7f2d2d8a4":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f44a37c8-4bbc-4e93-9af0-b624392ed852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f44a37c8-4bbc-4e93-9af0-b624392ed852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3263ee69-babf-4b1a-9b2a-cef1028b1f92","type":"text/plain","content":"O login e senha são os *mesmos usados no site e no App do Minha Claro,* se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"$cardContent":{"document":{"id":"3263ee69-babf-4b1a-9b2a-cef1028b1f92","type":"text/plain","content":"O login e senha são os *mesmos usados no site e no App do Minha Claro,* se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"670afa30-05db-4c9f-bad4-d0c2c6958f9e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"677fa416-ad39-4926-8c21-c1b1a069494f","$connId":"con_1453","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"5426a3f5-4d8c-45d5-9db8-90e997bcea0e"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1458","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"a310cada-1556-47a6-8389-f52621e93c17"},{"stateId":"c1822311-3d36-42d2-a8b7-6d5c7bae0555","$connId":"con_1463","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"0652db75-eedc-4817-bfc9-d8d0ceb108c2"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1468","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"7d8d88e2-dccd-4394-848d-79ce4c514ec7"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/*\n1- Fazer cadastro no Minha Claro\n2- Esqueci meu login e senha\n3- Fazer Login\n4- Sair\n*/\n\nfunction run(input) {\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    var firstRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|faz(er)?|[eé]\\s*[ao]?)\\s*)?((0*1\\s*)|um|(primei?r[ao]\\s*(op[cç][aã]o?)?)|((0*1\\s*)?(fazer)?\\s*cadastro(\\s*no\\s*minha\\s*claro)?))\\s*$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Fazer cadastro no Minha Claro\"}\n\n    var secondRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*2\\s*)|dois|(segund[ao]\\s*(op[cç][aã]o?)?)|((0*2\\s*)?\\s*esqueci\\s*(meu|o)?((\\s*login)?\\s*[eao]?(\\s*senha)?)?))\\s*$/i\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Esqueci meu login e senha\"};\n        \n    var thirdRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*3\\s*)|tr[eê]s|(tercei?r[ao]\\s*(op[cç][aã]o?)?)|((0*3\\s*)?(fazer)?\\s*login))\\s*$/i\n    if (thirdRegex.test(input))\n        return {option:\"3\", content:\"Fazer Login\"};\n        \n    var fourthRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*4\\s*)|quatro|(quart[ao]\\s*(op[cç][aã]o?)?)|((0*4\\s*)?sair))\\s*$/i\n    if (fourthRegex.test(input))\n        return {option:\"4\", content:\"Sair\"};\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["1","2"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"nao tenho login e senha\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-3f5ae2b4-2e4f-47e6-91c4-6fd22d6e0462","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8fa1b1f2-34d0-4c6d-a0d6-32eac19fb4e7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-4b8b448d-eddf-40ff-95ce-fa1daaec2c96","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"daf75513-69eb-42cd-bc3f-26d7f2d2d8a4","root":false,"$title":"[A.1.4.2.1.1.0.1] Nao tenho login e senha","$position":{"top":"818.571px","left":"5434px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e385a432-dff6-488d-b91a-9b2606893548":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f44a37c8-4bbc-4e93-9af0-b624392ed852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f44a37c8-4bbc-4e93-9af0-b624392ed852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3263ee69-babf-4b1a-9b2a-cef1028b1f92","type":"text/plain","content":"O login e senha são os *mesmos usados no site e no App do Minha Claro,* se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"$cardContent":{"document":{"id":"3263ee69-babf-4b1a-9b2a-cef1028b1f92","type":"text/plain","content":"O login e senha são os *mesmos usados no site e no App do Minha Claro,* se você ainda não tem cadastro, podemos fazer agora!\n\n*1-* Fazer cadastro no Minha Claro\n*2-* Esqueci meu login e senha\n*3-* Fazer Login\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"670afa30-05db-4c9f-bad4-d0c2c6958f9e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"677fa416-ad39-4926-8c21-c1b1a069494f","$connId":"con_1473","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"8f8d8d30-012b-405d-8e10-a2169044879f"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1478","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"126915f1-718a-4c2e-94a9-63dd90ab9b25"},{"stateId":"1455caae-fafe-4956-a2b5-3b9a1b1637f9","$connId":"con_1483","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"b8a6f6e7-b366-4c71-b415-fc2ad1abf989"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1488","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"22356fab-1aca-4dd1-88af-005b93b62f24"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"/*\n1- Fazer cadastro no Minha Claro\n2- Esqueci meu login e senha\n3- Fazer Login\n4- Sair\n*/\n\nfunction run(input) {\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    var firstRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|faz(er)?|[eé]\\s*[ao]?)\\s*)?((0*1\\s*)|um|(primei?r[ao]\\s*(op[cç][aã]o?)?)|((0*1\\s*)?(fazer)?\\s*cadastro(\\s*no\\s*minha\\s*claro)?))\\s*$/i;\n    if (firstRegex.test(input))\n        return {option:\"1\", content:\"Fazer cadastro no Minha Claro\"}\n\n    var secondRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*2\\s*)|dois|(segund[ao]\\s*(op[cç][aã]o?)?)|((0*2\\s*)?\\s*esqueci\\s*(meu|o)?((\\s*login)?\\s*[eao]?(\\s*senha)?)?))\\s*$/i\n    if (secondRegex.test(input))\n        return {option:\"2\", content:\"Esqueci meu login e senha\"};\n        \n    var thirdRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*3\\s*)|tr[eê]s|(tercei?r[ao]\\s*(op[cç][aã]o?)?)|((0*3\\s*)?(fazer)?\\s*login))\\s*$/i\n    if (thirdRegex.test(input))\n        return {option:\"3\", content:\"Fazer Login\"};\n        \n    var fourthRegex = /^\\s*((n[úu]m\\w*|op[çc][aã]o|ver?|[eé]\\s*[ao]?)\\s*)?((0*4\\s*)|quatro|(quart[ao]\\s*(op[cç][aã]o?)?)|((0*4\\s*)?sair))\\s*$/i\n    if (fourthRegex.test(input))\n        return {option:\"4\", content:\"Sair\"};\n\n    return {option:\"invalid\", content:\"input inesperado\"};\n}","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["1","2"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"nao tenho login e senha\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-784d1757-c0a5-4210-83d7-8a5ff95d49ca","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fcbc79d7-2c95-48bf-8418-f7b209b904c0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-4202851e-f3c9-4a24-a99c-097e4de499d5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"e385a432-dff6-488d-b91a-9b2606893548","root":false,"$title":"[A.1.5.1.0.1] Nao tenho login e senha","$position":{"top":"601px","left":"7517px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a8b44bec-c014-40de-ade8-3e9b0ae6e3ae":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"e4cd0a59-f5d8-484a-b84a-2a24ac8960c8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e4cd0a59-f5d8-484a-b84a-2a24ac8960c8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"65ce630e-911a-4e72-a1cc-f832d157d7d7","type":"text/plain","content":"⚠️ Aviso:\n\nEsse serviço está passando por uma *manutenção temporária* e voltará a funcionar em breve ☺️🔧\n\nVolta daqui a alguns dias que eu tento te ajudar novamente!  "},"$cardContent":{"document":{"id":"65ce630e-911a-4e72-a1cc-f832d157d7d7","type":"text/plain","content":"⚠️ Aviso:\n\nEsse serviço está passando por uma *manutenção temporária* e voltará a funcionar em breve ☺️🔧\n\nVolta daqui a alguns dias que eu tento te ajudar novamente!  "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a9e92ca1-a827-4bd2-9a42-52710cc9fa34","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Manutencao Fatura Digital Exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Manutencao Fatura Digital Exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-42d6be63-cc41-4a60-880f-138092316200","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-53011d99-17da-4a4a-8765-a80697e002c9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a8b44bec-c014-40de-ade8-3e9b0ae6e3ae","root":false,"$title":"[EI.2] Msg de Manutencao","$position":{"top":"20px","left":"884px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dfc0020b-2f68-4ab9-b500-6b96afdd8548":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"4718bf94-e80d-4531-bc9f-4c82b6a770da","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4718bf94-e80d-4531-bc9f-4c82b6a770da","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{\n  \"type\": \"template\",\n  \"template\": {\n    \"namespace\": \"{{config.namespace}}\",\n    \"name\": \"{{config.templateRenegociar}}\",\n    \"language\": {\n      \"policy\": \"deterministic\",\n      \"code\": \"pt_BR\"\n    },\n    \"components\": [\n      {\n        \"type\": \"button\",\n        \"sub_type\": \"url\",\n        \"index\": 0,\n        \"parameters\": [\n          {\n            \"type\": \"text\",\n            \"text\": \"negociafacilclaro\"\n          }\n        ]\n      }\n    ]\n  }\n}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"19ae0b28-38bc-47cd-a3de-7f48cd852da3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Renegociar dividas exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Renegociar dividas exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"renegociar dívidas\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-a1950183-9e60-493e-8cdb-3dd5fb1789a2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e565b24d-e397-48fb-9e83-1573a20074c0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-50887199-4749-4f70-8bb6-a6afcf5f55d3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"dfc0020b-2f68-4ab9-b500-6b96afdd8548","root":false,"$title":"[A.1.7] Renegociar dívidas","$position":{"top":"2198px","left":"2309px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b4148ec6-cb64-4868-bf16-769b9e13652e":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"c276bba3-4ec2-45d4-bab5-90a02f6130d7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c276bba3-4ec2-45d4-bab5-90a02f6130d7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{\n  \"type\": \"template\",\n  \"template\": {\n    \"namespace\": \"{{config.namespace}}\",\n    \"name\": \"{{config.templateRenegociar}}\",\n    \"language\": {\n      \"policy\": \"deterministic\",\n      \"code\": \"pt_BR\"\n    },\n    \"components\": [\n      {\n        \"type\": \"button\",\n        \"sub_type\": \"url\",\n        \"index\": 0,\n        \"parameters\": [\n          {\n            \"type\": \"text\",\n            \"text\": \"negociafacilNET\"\n          }\n        ]\n      }\n    ]\n  }\n}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"8185a22b-ec77-45f5-8d88-6e7df2946f7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"07f4b64b-aac7-4899-bdfa-648a4fd360d1","$typeOfContent":"","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento) {\n    var channel = 'Claro Residencial';\n    if(tipoAtendimento == 'tv') {\n        channel = 'Claro TV';\n    }\n\n    var date = new Date();\n    return {\n        name: 'Renegociar NET/EMPRESAS/BOX TV',\n        channel: channel,\n        text: 'com Renegociar NET/EMPRESAS/BOX TV',\n        date: new Date()\n    }\n}","inputVariables":["tipoAtendimento"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"renegociar net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-b9a3af98-d0c6-4053-be12-56e49a978052","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-34331dd2-5bd6-417d-9299-2eedd73af56f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b4148ec6-cb64-4868-bf16-769b9e13652e","root":false,"$title":"[RN.0] Renegociar NET","$position":{"top":"2187px","left":"2545.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e4c91414-3ccf-47fd-9f60-2fc8b4b6af1d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9e3db676-6a4b-449c-8c81-7cf84782f0fa","$connId":"con_1493","conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"contadorFatura"}],"$invalid":false,"$id":"f675ee94-ae55-4a6f-9551-18da848f83a6"},{"stateId":"9e3db676-6a4b-449c-8c81-7cf84782f0fa","$connId":"con_1498","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"contadorFatura"},{"source":"context","comparison":"exists","values":[],"variable":"contadorFatura"}],"$invalid":false,"$id":"d87aeee5-60ac-4506-a665-1b9d4b913feb"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - define var contadorFatura","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run() {\n                return 0; //Return value will be saved as \"Return value variable\" field name\n            }","inputVariables":[],"outputVariable":"contadorFatura","LocalTimeZoneEnabled":false},"conditions":[{"comparison":"notExists","values":[],"source":"context","variable":"contadorFatura"}]},{"type":"ExecuteScript","$title":"Executar script - Define contadorFatura","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    if (input == \"\")\n        input = 0;\n    let contador = parseInt(input);\n    if (contador == 3)\n        return 0;\n    contador++;\n    return contador;\n}","inputVariables":["contadorFatura"],"outputVariable":"contadorFatura","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contadorFatura"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-7cdd8ff0-8363-497c-bfc3-01557eb9c1f3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"welcome","root":false,"$title":"Regra de exibicao - Define A.1 ou A.1.8","$position":{"top":"302px","left":"2312px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9e3db676-6a4b-449c-8c81-7cf84782f0fa":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"e78a95b5-db94-4a2d-9425-0a6691f5fc54","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e78a95b5-db94-4a2d-9425-0a6691f5fc54","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"1e9dd435-6b29-4232-9b0f-1d5150e83f39","type":"text/plain","content":"Sabia que você pode *acessar* os serviços de fatura de uma forma mais fácil? 🤓\n\nEm *qualquer ponto da conversa*, digite: *“código de barras residencial”* ou *“segunda via de fatura residencial”* para acessar o serviço que você precisa, é bem mais prático! 😉"},"$cardContent":{"document":{"id":"1e9dd435-6b29-4232-9b0f-1d5150e83f39","type":"text/plain","content":"Sabia que você pode *acessar* os serviços de fatura de uma forma mais fácil? 🤓\n\nEm *qualquer ponto da conversa*, digite: *“código de barras residencial”* ou *“segunda via de fatura residencial”* para acessar o serviço que você precisa, é bem mais prático! 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ff2355b6-f7e9-40ad-8280-015fd95723c6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"8c86ec2a-c208-4bf5-b7d9-fb0b1af9aced","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"8c86ec2a-c208-4bf5-b7d9-fb0b1af9aced","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mensagem dica nlp\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-0ca555f0-4791-411c-a68c-ca855b08c4b6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-55ea878c-19af-4193-b312-0298e855318e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9e3db676-6a4b-449c-8c81-7cf84782f0fa","root":false,"$title":"[A.1] Mensagem Dica NLP","$position":{"top":"450px","left":"2322px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"45e97fbb-c71b-44d4-957b-ea62ff8ac193":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8825f278-3ac3-405b-a41c-37691db4a6c5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f65bc558-4094-4be4-87a0-c8b46215c841","$connId":"con_1503","conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"contadorFaturaClaroTV"}],"$invalid":false,"$id":"e827cc43-7f99-47ca-af7a-f8e6c6cbbc0a"},{"stateId":"f65bc558-4094-4be4-87a0-c8b46215c841","$connId":"con_1508","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contadorFaturaClaroTV"},{"source":"context","comparison":"equals","variable":"contadorFaturaClaroTV","values":["1"]}],"$invalid":false,"$id":"c9e23a29-bbcd-45ec-bbd3-0dd8e04a0528"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Define Variavel contadorFaturaClaroTV","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run() {\n                return 0; //Return value will be saved as \"Return value variable\" field name\n            }","inputVariables":[],"outputVariable":"contadorFaturaClaroTV","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"contadorFaturaClaroTV"}]},{"type":"ExecuteScript","$title":"Executar script - Definir contadorfaturaclarotv","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    if (input == \"\")\n        input = 0;\n    let contadorFaturaClaroTV = parseInt(input);\n    if (contadorFaturaClaroTV == 3)\n        return 0;\n    contadorFaturaClaroTV++;\n    return contadorFaturaClaroTV;\n}","inputVariables":["contadorFaturaClaroTV"],"outputVariable":"contadorFaturaClaroTV","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contadorFaturaClaroTV"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"baa81344-c705-43c3-8fb7-05f4a89cf5c3","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-d342f27e-13ac-4ffc-96f6-d9b2859f812f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"45e97fbb-c71b-44d4-957b-ea62ff8ac193","root":false,"$title":"Regra de exibicao - Define A.1.5 ou A.1.5.0","$position":{"top":"571.429px","left":"3196.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f65bc558-4094-4be4-87a0-c8b46215c841":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"53e2bc8a-6852-486c-ba96-c36f412a430b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"53e2bc8a-6852-486c-ba96-c36f412a430b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"79cf0ee7-d948-4b4e-86ee-72abeacb4fe3","type":"text/plain","content":"Sabia que você pode *acessar* os serviços de fatura de uma forma *mais fácil?* 🤓\n\nEm *qualquer ponto da conversa*, digite: *“código de barras residencial”* ou *“segunda via de fatura residencial”* para acessar o serviço que você precisa, é bem mais prático! 😉"},"$cardContent":{"document":{"id":"79cf0ee7-d948-4b4e-86ee-72abeacb4fe3","type":"text/plain","content":"Sabia que você pode *acessar* os serviços de fatura de uma forma *mais fácil?* 🤓\n\nEm *qualquer ponto da conversa*, digite: *“código de barras residencial”* ou *“segunda via de fatura residencial”* para acessar o serviço que você precisa, é bem mais prático! 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5f205cf1-9805-4f34-b1c1-00547df71ca6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"0cf5d90d-fdc2-444d-a0c7-215f16e45880","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"0cf5d90d-fdc2-444d-a0c7-215f16e45880","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mensagem dica nlp - claro tv\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-f421172b-9eb4-4d07-ba85-46d8c1eb80f6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fa11295c-c3d3-46dd-ab46-42fb4c060683","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f65bc558-4094-4be4-87a0-c8b46215c841","root":false,"$title":"[A.1.5] Mensagem Dica NLP - Claro TV","$position":{"top":"762px","left":"3186px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6593bea0-cca3-47e3-ab7e-3144db0a38fb":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"5cab63e2-cb05-4feb-919c-8b53468001d0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5cab63e2-cb05-4feb-919c-8b53468001d0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"e7733dd8-3fa7-4f3d-9408-684038ab1905","type":"text/plain","content":"⚠️ Vi aqui no meu sistema que *ainda não existem faturas* para este contrato...\n\nEspera o *fechamento* da sua *primeira fatura* e volta aqui que eu te ajudo! 😉"},"$cardContent":{"document":{"id":"e7733dd8-3fa7-4f3d-9408-684038ab1905","type":"text/plain","content":"⚠️ Vi aqui no meu sistema que *ainda não existem faturas* para este contrato...\n\nEspera o *fechamento* da sua *primeira fatura* e volta aqui que eu te ajudo! 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"468dd144-be0d-4e99-8752-11f99b674c3a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"selecao fatura não existente","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"selecao fatura não existente","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"sem faturas\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-28762801-12d8-4cbf-a606-6cc2c67e156f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e533a660-3c41-4ccc-b958-784b2a98598d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b55747c1-0de5-4572-b8c2-32780168b779","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6593bea0-cca3-47e3-ab7e-3144db0a38fb","root":false,"$title":"[A.1.2.2.1.0] Sem Faturas","$position":{"top":"1471px","left":"1949px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"28829157-b1fe-4ec7-a475-04fd6eea55b3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1d0ba83-be2c-4ea3-9522-b1051edd7322","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"04e81a58-89c0-4300-9592-fab47b78fe2d","$connId":"con_1513","conditions":[{"source":"context","comparison":"greaterThan","values":["0"],"variable":"produtosDisponiveis@qtdProdutos"}],"$invalid":false,"$id":"3f5b5e1a-5c29-4f0c-961c-9b1a118a83a9"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"Get Produtos","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/contract/products?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","responseStatusVariable":"produtosStatus","responseBodyVariable":"produtos"},"conditions":[]},{"type":"ExecuteScript","$title":"OBTEM PRODUTOS DISPONIVEIS","$invalid":false,"settings":{"function":"run","source":"\n\nfunction run(input) {\n    try {\n         input = JSON.parse(input).data;\n        var produtosDisponiveis = input.products.filter(function (value) {\n            return value.situation == 'ATIVO' && value.businessLine != \"CELULAR\";\n        })\n        \n        for (i = 0; i < produtosDisponiveis.length; i++) {\n            let produto = trataRetornoProduto(produtosDisponiveis[i].businessLine);\n            produtosDisponiveis[i].businessLine = produto;\n        }\n\n        return JSON.stringify({ produtos: produtosDisponiveis, qtdProdutos: produtosDisponiveis.length });\n    }\n    catch (e) {\n        return 0;\n    }\n}\nfunction trataRetornoProduto(businessLine) {\n    var internet = /(internet)/gim;\n    if (internet.test(businessLine))\n        return \"INTERNET\";\n    var tv = /(tv)/gim;\n    if (tv.test(businessLine))\n        return \"TV\";\n    var tv = /(FONE)/gim;\n    if (tv.test(businessLine))\n        return \"FONE\";\n}","inputVariables":["produtos"],"outputVariable":"produtosDisponiveis","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Obtem Unico Produto","$invalid":false,"settings":{"function":"run","source":"\n            function run(input) {\n                try{\n                    var produtosDisponiveis = JSON.parse(input);\n\n                    return produtosDisponiveis.produtos[0].businessLine;\n                }\n                catch(e){\n                    return \"invalid\";\n                }\n            }","inputVariables":["produtosDisponiveis"],"outputVariable":"produto","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"produtosDisponiveis@qtdProdutos","values":["1"]}]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Encode Produtos Response","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    return encodeURI(input.data);\n}","inputVariables":["produtos"],"outputVariable":"encodedProdutos","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"produtosStatus","values":["200"]}]},{"$id":"74d55ccb-cb8b-4fa2-8563-ad605d5cf045","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/v1/intermediate/contract/products?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Obter contratos Debito Automatico\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["produtosStatus","produtos"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"produtosStatus","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-99efe277-7715-4890-86a9-1af29341cbbc","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-dd767639-216c-4f82-8ddd-b0053d4f358e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"28829157-b1fe-4ec7-a475-04fd6eea55b3","root":false,"$title":"Obter Produtos","$position":{"top":"1105px","left":"7749px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"29736574-85ec-4d85-b5b8-7b4e5b833782":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c183e936-f701-47c1-910f-9bb05683e59e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to \"{{config.servicoFaturaTv}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#A.1.7"},"address":"{{config.servicoFaturaTv}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-d6035a79-d20d-4b9f-8a88-0f118eff8e81","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"29736574-85ec-4d85-b5b8-7b4e5b833782","root":false,"$title":"Redireciona Promessa de Pagamento Claro Tv","$position":{"top":"934px","left":"3140px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6f51de6b-a36f-40a7-9d56-fdb121e68e7a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"833f138f-ed30-4b24-ae6b-710508d61e70","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1518","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusResponsePDF"}],"$invalid":false,"$id":"89278583-d761-4408-8260-960a0f1aabce"},{"stateId":"340a68d3-e643-4d8b-ba1a-7366e042c324","$connId":"con_1523","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"statusResponsePDF"}],"$invalid":false,"$id":"865ce07f-e0a2-489d-8845-b97f6d371012"}],"$enteringCustomActions":[{"$id":"25e9d094-7f63-48bb-879a-cc46227785bb","type":"ProcessHttp","$title":"Requisição HTTP - Traz  link Segunda Via  de conta","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","x-application-id":"whatsapp"},"method":"POST","body":"{\n  \"idBill\": \"{{faturaSelecionada@invoiceId}}\",\n  \"accessToken\": \"{{tokenAccessFormated}}\",\n  \"contract\": \"{{tokenPayload@codigoOperadora}}/{{tokenPayload@contrato}}\",\n  \"document\": \"{{tokenPayload@cpf}}\"\n}","uri":"{{config.apiUrl}}/SecondInvoice/second-invoice-link","responseBodyVariable":"responsePDF","responseStatusVariable":"statusResponsePDF"},"conditions":[]}],"$leavingCustomActions":[{"$id":"108dd0f4-52bd-45f2-8260-e247861a21e2","type":"TrackEvent","$title":"Segunda Via PDF Status","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Segunda Via PDF Status","action":"sim"},"conditions":[{"source":"context","comparison":"equals","variable":"statusResponsePDF","values":["200"]}]},{"$id":"44259c53-d5d7-489d-bab2-91a9639ba39f","type":"TrackEvent","$title":"Segunda Via PDF Status","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Segunda Via PDF Status","action":"não"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusResponsePDF","values":["200"]}]},{"$id":"10528454-9409-4ab2-827b-e5f5378598dc","type":"ExecuteScript","$title":"httpErrorInfo","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    try {\n        response = JSON.parse(response);\n        var url = '{{config.apiUrl}}/SecondInvoice/second-invoice-link';\n\n        return JSON.stringify({\n            skill: \"Faturamento Residencial\",\n            name: \"Carrega Fatura no AWS S3 da Claro\",\n            status: status,\n            response: response,\n            request: {\n                url: url\n            }\n        })\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["statusResponsePDF","responsePDF"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusResponsePDF","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$invalid":false},"$tags":[{"id":"blip-tag-4bf27533-8eb0-4ae5-8834-89b4921f8433","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-9c70b705-7b28-4ed1-9bb8-6d3034172838","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f0fb4898-4475-4d15-82fc-5476cd93e528","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"6f51de6b-a36f-40a7-9d56-fdb121e68e7a","root":false,"$title":"Carrega Fatura no AWS S3 da Claro","$position":{"top":"1519px","left":"1293px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"340a68d3-e643-4d8b-ba1a-7366e042c324":{"$contentActions":[{"action":{"$id":"2d3fec89-3158-4ab0-b400-ca241c6aed40","type":"SendMessage","settings":{"id":"5e3a1cff-7dfe-4284-abef-90248ab6f405","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5e3a1cff-7dfe-4284-abef-90248ab6f405","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6bc721d2-6122-415c-9886-9779e8e8b141","type":"SendMessage","settings":{"id":"a00cec88-4ee4-4b7f-8784-197a10f18732","type":"text/plain","content":"Clique aqui para ver sua fatura ⬇️","metadata":{}},"$cardContent":{"document":{"id":"a00cec88-4ee4-4b7f-8784-197a10f18732","type":"text/plain","content":"Clique aqui para ver sua fatura ⬇️"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0d795475-e176-452c-bd9b-03ad3d7b4ec8","type":"SendMessage","settings":{"id":"8c25230c-c391-4437-8635-270eb0a02fcd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"8c25230c-c391-4437-8635-270eb0a02fcd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"38e1bf5a-6939-43ea-a6b8-65d2f4049b62","type":"SendRawMessage","settings":{"metadata":{},"type":"application/vnd.lime.media-link+json","selectedType":{"name":"application/vnd.lime.media-link+json"},"rawContent":"{\n        \"title\": \"{{nomeArquivo}}\",\n        \"uri\": \"{{responsePDF}}\",\n        \"type\": \"application/pdf\",\n        \"size\": 5540\n}"}},"$invalid":false},{"action":{"$id":"2fc5fe6c-446e-493f-b1c8-67428fce2626","type":"SendMessage","settings":{"id":"77394408-bad5-477f-b4f9-17e1d36b731e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"10000"},"metadata":{}},"$cardContent":{"document":{"id":"77394408-bad5-477f-b4f9-17e1d36b731e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"10000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"12f8112c-9b9c-40aa-8f72-3371b8afd641","type":"SendRawMessage","settings":{"metadata":{},"type":"{{segundaViaMenuContent@mimeType}}","selectedType":{"name":"application/json"},"rawContent":"{{segundaViaMenuContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"66f7b590-f584-4936-96ec-dba2ad2b830b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"conditions":[{"source":"context","comparison":"equals","values":["sim"],"variable":"chooseAnswer@option"}],"$invalid":false,"stateId":"4130f339-6a5c-46d8-a500-3f1cb8eb5e10","$connId":"con_1528","$id":"93888a09-ec40-4708-ad69-49aaff01d725"},{"conditions":[{"source":"context","comparison":"equals","values":["nao"],"variable":"chooseAnswer@option"}],"$invalid":false,"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1533","$id":"57916db5-4159-4ad2-8f79-2c7830e3c56d"}],"$enteringCustomActions":[{"$id":"66e58c86-9d63-4bf9-86d1-4dc9eeb2d6a2","type":"ExecuteScript","$title":"Executar script -Define Nome do arquivo","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    var fatura = JSON.parse(input);\n    let date = new Date(fatura.expirationDate);\n    const monthNames = [\"Jan\", \"Fev\", \"Mar\", \"Abr\", \"Mai\", \"Jun\",\n        \"Jul\", \"Ago\", \"Set\", \"Out\", \"Nov\", \"Dez\"\n    ];\n    let nomearquivo = \"Segunda Via de Fatura \" + monthNames[date.getMonth()] + \"_ \" + date.getFullYear() + \".pdf\";\n    return nomearquivo;\n}","inputVariables":["faturaSelecionada"],"outputVariable":"nomeArquivo","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8ad7c463-19de-4f67-8be2-5ee46c15475d","type":"TrackEvent","$title":"Segunda Via PDF exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Segunda Via PDF exibicao","action":"Exibicao"},"conditions":[]},{"$id":"27af3c4a-4583-4f03-a005-c62421ecc66c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"segundaViaMenuContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var message = \"Você quer *ver* a Segunda Via de alguma *outra fatura?*\";\n\n    var buttonsInOptions = [];\n\n    buttonsInOptions.push({\n        type: \"reply\",\n        reply: {\n            \"id\": \"&\" + \"Sim\",\n            \"title\": \"Sim\"\n        }\n    });\n\n    buttonsInOptions.push({\n        type: \"reply\",\n        reply: {\n            \"id\": \"&\" + \"Não\",\n            \"title\": \"Não\"\n        }\n    });\n\n    var template = {\n        content: {\n            recipient_type: \"individual\",\n            type: \"interactive\",\n            interactive: {\n                type: \"button\",\n                body: {\n                    text: message\n                },\n                action: {\n                    buttons: buttonsInOptions\n                }\n            }\n        },\n        mimeType: \"application/json\"\n    }\n\n    return template;\n}","inputVariables":[],"outputVariable":"segundaViaMenuContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4fdb2afe-3362-4c10-bd35-9ddbb27d0b07","type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n    let strRegex = /^\\s*(n[ãa]o|naum|nem|[nñ])\\s*$/i;\n    if (strRegex.test(input))\n        return { option: \"nao\", content: \"Nao\" }\n    strRegex = /^\\s*(si.|s)\\s*$/i;\n    if (strRegex.test(input))\n        return { option: \"sim\", content: \"Sim\" };\n    return { option: \"invalid\", content: \"input inesperado\" };\n}\n","inputVariables":["input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e93dfc40-6101-4841-9494-7d17b0214543","type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a546f56f-4a1a-4be1-a6f0-54edd16f697e","type":"TrackEvent","$title":"Segunda Via PDF selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"action":"{{chooseAnswer@content}}","category":"Segunda Via PDF selecao"},"conditions":[]},{"$id":"51b61d5f-495f-4f02-a583-704db65af6a3","type":"TrackEvent","$title":"Segunda Via PDF input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Segunda Via PDF input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"$id":"e837d5ed-d889-40a1-8c27-dc4d78202b95","type":"TrackEvent","$title":"Segunda Via PDF clique","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Segunda Via PDF clique","action":"sim"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["sim"]}]},{"$id":"a0615ee3-51ca-48a4-ab05-705025bc549b","type":"TrackEvent","$title":"Segunda Via PDF clique","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Segunda Via PDF clique","action":"não"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["nao"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"segunda via pdf exibicao\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-c519fa2f-03d5-42f8-a9e0-4303f95df95a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-94061e9b-66c2-47c9-a9ab-9c6ef227777a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-645bcd14-697b-40bd-b640-b7b44b6c0923","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-d4210362-0335-439e-b759-d5ce14ba769a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"340a68d3-e643-4d8b-ba1a-7366e042c324","root":false,"$title":"[A.1.2.2.1.1.1] Segunda Via PDF exibicao","$position":{"top":"1713.14px","left":"1018.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"887150cc-f756-455f-aad4-54097ff02040":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"95beacc6-5d62-46c6-a1c4-3341c92e73fc","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","$connId":"con_1538","conditions":[{"source":"input","comparison":"equals","values":["false"]}],"$invalid":false,"$id":"0b512380-e344-4e99-9546-8a480f0681cf"}],"$enteringCustomActions":[{"$id":"5af8d45e-cc1a-4a7e-99aa-04f9701980a1","type":"Redirect","$title":"Redirect to \"{{config.servicoAutenticacao}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#clienteLogado#v2"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"47cd44e6-d1f8-4a88-9294-4b4812f96350","type":"SetVariable","$title":"tipoAtendimento","$invalid":false,"settings":{"variable":"tipoAtendimento","value":"residencial"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-83e7634a-67dc-4f00-888d-ae85310977d9","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-892ffd30-6495-4408-9c1a-e680d3232474","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-db3a5398-6e30-46b3-8ab6-5de69da97777","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"887150cc-f756-455f-aad4-54097ff02040","root":false,"$title":"Segunda Via Outro Numero - Verifica cliente logado","$position":{"top":"362px","left":"1995px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a3e28dd4-d521-4ea4-8cab-6d1a0f79a982":{"$contentActions":[{"action":{"$id":"c8ec83fa-ef09-4b72-a534-c6e0cdbe2f7e","type":"SendMessage","settings":{"id":"57f4ca3a-74d3-481d-a2bf-f1e83d078a63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"57f4ca3a-74d3-481d-a2bf-f1e83d078a63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"df8d4179-e974-4df7-858f-9cba17d0e67a","type":"SendMessage","settings":{"id":"83a48897-b2b9-47e4-8271-d94f1e759969","type":"text/plain","content":"Fatura digital é um serviço em que você faz seu *cadastro* e passa a receber sua *fatura* todo mês *por e-mail*","metadata":{}},"$cardContent":{"document":{"id":"83a48897-b2b9-47e4-8271-d94f1e759969","type":"text/plain","content":"Fatura digital é um serviço em que você faz seu *cadastro* e passa a receber sua *fatura* todo mês *por e-mail*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1cb7d1ec-d9ea-445c-954d-705182382e69","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"482db5fa-ba55-41f9-8c9f-6c4165bf2781","type":"SendMessage","settings":{"id":"ffe90a35-b1e9-4c13-ae76-8faa2ed2da6e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"ffe90a35-b1e9-4c13-ae76-8faa2ed2da6e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"1a112d4e-707e-477b-8660-ca5524e37e45","$connId":"con_1543","$id":"0c178bdd-4e02-407d-b22b-71276117d906","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"[a.1.3.2]\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-2fba1442-87e1-4714-93c8-c6f316ed2a41","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b7623eda-1ac7-41b4-970e-4d1c17048c43","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a3e28dd4-d521-4ea4-8cab-6d1a0f79a982","root":false,"$title":"[A.1.3.2]","$position":{"top":"448px","left":"3826.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ce967266-c793-4e80-91ac-97bf3584d129":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ad002d93-ec1c-4585-8c56-a3b01312c690","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1548","$id":"dc57eb62-ca25-48f1-a5f9-91699268b908","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusCurrentPayment"}],"$invalid":false},{"stateId":"f1311a51-d995-4afa-87f6-1507e8d89426","$connId":"con_1553","$id":"d631db28-0f42-4502-96ef-d4d2cab7cf8a","conditions":[{"source":"context","comparison":"notEquals","values":["DEBIT_ACCOUNT"],"variable":"currentPayment@data.payMethodType"},{"source":"context","comparison":"equals","variable":"fluxoDcc","values":["alterar"]}],"$invalid":false},{"stateId":"6380727c-3d48-44c5-95ab-c42ec2ad309b","$connId":"con_1558","$id":"a84891a8-7085-445f-accc-e5476800a736","conditions":[{"source":"context","comparison":"notEquals","values":["DEBIT_ACCOUNT"],"variable":"currentPayment@data.payMethodType"},{"source":"context","comparison":"equals","variable":"fluxoDcc","values":["cancelar"]}],"$invalid":false},{"stateId":"0f6f257a-bea4-437e-9fd2-ebece523b004","$connId":"con_1563","$id":"ffa2d656-1d46-4525-bea2-96b9f5698202","conditions":[{"source":"context","comparison":"equals","values":["DEBIT_ACCOUNT"],"variable":"currentPayment@data.payMethodType"},{"source":"context","comparison":"equals","variable":"fluxoDcc","values":["cancelar"]}],"$invalid":false},{"stateId":"053debbc-d7d7-40b8-b6b0-6eb7800468f2","$connId":"con_1568","$id":"2889098b-8db8-4744-b4e6-c99a2b6cce0b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a6dcde4f-8de9-435d-b39f-32cc77596df0","type":"TrackEvent","$title":"Validacao retorno de login debito automatico alterar","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao retorno de login debito automatico alterar","action":"{{tokenPayload}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"tokenPayload"}]},{"$id":"74e71b2d-a28f-40c7-941b-f3d75ecb453f","type":"ProcessHttp","$title":"GET Current Payment Method","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/paymentmethods/payments?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","responseStatusVariable":"statusCurrentPayment","responseBodyVariable":"currentPayment"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1d1e229c-b8ed-4b3b-bd09-d6f937802a4e","type":"SetVariable","$title":"dccAttempts","$invalid":false,"settings":{"value":"0","variable":"dccAttempts"},"conditions":[]},{"$id":"b49d5e2d-e13f-4e37-954e-eb776cc52013","type":"TrackEvent","$title":"Validacao login alterar dados debito SIM","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao login alterar dados debito","action":"sim"},"conditions":[{"source":"context","comparison":"equals","variable":"statusCurrentPayment","values":["200"]},{"source":"context","comparison":"equals","values":["DEBIT_ACCOUNT"],"variable":"currentPayment@data.payMethodType"}]},{"$id":"29d482bb-6b4a-4124-9d22-458ace04007a","type":"TrackEvent","$title":"Validacao login alterar dados debito NAO","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Validacao login alterar dados debito","action":"nao"},"conditions":[{"source":"context","comparison":"equals","variable":"statusCurrentPayment","values":["200"]},{"source":"context","comparison":"notEquals","variable":"currentPayment@data.payMethodType","values":["DEBIT_ACCOUNT"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"053debbc-d7d7-40b8-b6b0-6eb7800468f2","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-3f833631-69b7-4283-92d3-5172db909a16","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d98c59b8-b49a-4ea6-9539-7cd3c6fc6784","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-0c10d94e-fd8e-4ae3-9192-cf15f29e488d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"ce967266-c793-4e80-91ac-97bf3584d129","root":false,"$title":"GET Current Payment Method","$position":{"top":"641.75px","left":"6794.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ec3bf851-2c33-462b-bbe5-1b027fe47da4":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"b6baf7be-fa1c-40c9-af0f-2307026e16d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b6baf7be-fa1c-40c9-af0f-2307026e16d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"4ecea51f-51b5-4c02-a752-75a56aaa6505","type":"text/plain","content":"Você precisa:\n\n*1-* Cadastrar no débito automático\n*2-* Alterar dados bancários\n*3-* Cancelar débito automático\n*4-* Voltar ao Menu de Faturas","metadata":{}},"$cardContent":{"document":{"id":"4ecea51f-51b5-4c02-a752-75a56aaa6505","type":"text/plain","content":"Você precisa:\n\n*1-* Cadastrar no débito automático\n*2-* Alterar dados bancários\n*3-* Cancelar débito automático\n*4-* Voltar ao Menu de Faturas"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"2e924f4b-3171-4b41-af3e-2a7738b72dfe","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"193ca9f8-d159-42cd-9794-bf2279c2ec7b","$connId":"con_1573","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"4fe15d6d-9288-43f9-b19a-93009b1b0b21"},{"stateId":"332f5478-463c-42cd-9f3c-da92d2ffefc7","$connId":"con_1578","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"94226d07-a491-4251-b117-b06c611cb80c"},{"stateId":"6c6c86ef-3eb8-4fc8-8b5d-4957f77a4d52","$connId":"con_1583","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"e2f84cbe-2fa7-4103-8c9e-230a9203ee9d"},{"stateId":"abcf33d4-6b8e-4e48-b15e-68a202a32549","$connId":"con_1588","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"$id":"880248f9-ae1c-4460-974f-786975b5decc"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Debito automatico net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Debito automatico net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"ea1bf697-61b9-429d-a4bc-6877ee56aaa8","type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"/**\n * \n * Você precisa:\n\n*1-* Cadastrar no débito automático\n*2-* Alterar dados bancários\n*3-* Cancelar débito automático\n*4-* Voltar ao Menu de Faturas\n */\n\nfunction run() {\n    return options = JSON.stringify([\n        {\n            content: \"Cadastrar no débito automático\",\n            regex: \"cadastr(o|a|ar)?\",\n        },\n        {\n            content: \"Alterar dados bancários\",\n            regex: \"altera|muda|outro banco|outra conta\",\n        },\n        {\n            content: \"Cancelar débito automático\",\n            regex: \"cancela\",\n        },\n        {\n            content: \"Voltar ao Menu de Faturas\",\n            regex: \"volta|menu.*fatura\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Choose Answer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar Script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\nreturn input.substring(0,255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Debito automatico net  input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Debito automatico net  input","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"TrackEvent","$title":"Debito automatico net  selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Debito automatico net  selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"debito automatico net\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir variável - redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#A.1.4.2"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - confirmationCounter","$invalid":false,"settings":{"function":"run","source":"function run(confirmationCounter, chooseAnswer) {\n    try{                    \n        var newChooseAnswer = JSON.parse(chooseAnswer)\n        \n        if(newChooseAnswer.option != \"invalid\" || parseInt(confirmationCounter) + 1 >= 3)\n            return null;\n\n        if(confirmationCounter == null)\n            return 1\n\n        return parseInt(confirmationCounter) + 1;\n\n    }catch(e){\n        return null\n    }            \n}","inputVariables":["confirmationCounter","chooseAnswer"],"outputVariable":"confirmationCounter","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-8cbd1933-7b95-4076-898b-71f1a8c82ec0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-10a69e62-00c6-485f-8e45-73af57acd0a8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7aa13ff8-1145-47b7-b844-f3c387b76286","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a03b5770-9ffc-4b14-89f9-3956c4ed374c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-7633a75e-45f0-4f61-a0e3-bde3f0661a51","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"ec3bf851-2c33-462b-bbe5-1b027fe47da4","root":false,"$title":"[A.1.4.2.0] Debito automatico net menu","$position":{"top":"399px","left":"5789px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b3b2de0e-4fde-4360-809e-19ca9f50450b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"35f385cc-6e03-4947-9d1d-e7ad17f08bef","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"57fea87f-de6d-4e71-af4c-ce1bb5799003","$connId":"con_1593","$id":"bc4ed66d-9727-494c-9dd3-3cdcfa962194","conditions":[{"source":"input","comparison":"equals","values":["#A.1.3.2.1.2"]}],"$invalid":false},{"stateId":"71985007-21d4-4857-a4e2-b12b5dbbbfc0","$connId":"con_1598","$id":"f2d11002-7ac5-4ec0-9819-08f55072ca06","conditions":[{"source":"input","comparison":"equals","values":["#A.1.5.0"]}],"$invalid":false},{"stateId":"53d7e972-d324-49a1-97fa-df51250f389e","$connId":"con_1603","$id":"c235f44d-9986-4f46-ad31-a70c62ab5600","conditions":[{"source":"input","comparison":"equals","values":["#debug"]}],"$invalid":false},{"stateId":"332f5478-463c-42cd-9f3c-da92d2ffefc7","$connId":"con_1608","$id":"f1852d27-0579-4bd3-8af2-8e78a9da746f","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.2.0"]}],"$invalid":false},{"stateId":"6c6c86ef-3eb8-4fc8-8b5d-4957f77a4d52","$connId":"con_1613","$id":"68962e1f-16aa-4642-bd02-f9a2c4e6f1a7","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2.3.0.0"]}],"$invalid":false},{"stateId":"223190f0-83ff-445f-b688-15f8ef91d1da","$connId":"con_1618","$id":"d6de5bb1-7089-4494-a98a-c345bc99511c","conditions":[{"source":"input","comparison":"equals","values":["#segundaviasemlogin"]}],"$invalid":false,"typeOfStateId":"state"},{"stateId":"e747b47e-e9b7-401e-b515-e8a3c89d0f4a","typeOfStateId":"state","$connId":"con_1623","$id":"b57e683f-4eb2-4153-b74a-70d904ade03c","conditions":[{"source":"input","comparison":"equals","values":["#F.1.0.0"]}],"$invalid":false},{"stateId":"baa81344-c705-43c3-8fb7-05f4a89cf5c3","typeOfStateId":"state","$connId":"con_1628","$id":"9824ef63-1b5d-4248-8a4d-2a4a5e7681db","conditions":[{"source":"input","comparison":"equals","values":["#F.2.0.0"]}],"$invalid":false},{"stateId":"2218e690-f599-4214-af50-dd42797ac152","typeOfStateId":"state","$connId":"con_1633","$id":"64c1bce3-b3fb-4af4-bbf7-b30dde821d44","conditions":[{"source":"input","comparison":"equals","values":["#P.1.0.0"]}],"$invalid":false},{"stateId":"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7","typeOfStateId":"state","$connId":"con_1638","$id":"93a7e6a8-f0d3-47cf-a199-d75121fd0cee","conditions":[{"source":"input","comparison":"equals","values":["#CBR.0.0.0"]}],"$invalid":false},{"stateId":"53d7e972-d324-49a1-97fa-df51250f389e","typeOfStateId":"state","$connId":"con_1643","$id":"b9bb08f0-8356-4737-b30c-62151f64d052","conditions":[{"source":"input","comparison":"equals","values":["#A.1.4.2"]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"abcf33d4-6b8e-4e48-b15e-68a202a32549","$invalid":false},"$tags":[],"id":"b3b2de0e-4fde-4360-809e-19ca9f50450b","root":false,"$title":"Roteamento inicio 2","$position":{"top":"445px","left":"2529px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f1311a51-d995-4afa-87f6-1507e8d89426":{"$contentActions":[{"action":{"$id":"0aca0e43-54bf-4493-842b-9d7ceee1d6b2","type":"SendMessage","settings":{"id":"609885a8-5867-4d4d-b238-09e8aef4880d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"609885a8-5867-4d4d-b238-09e8aef4880d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a64608dd-911c-406a-9b08-08778c65112a","type":"SendMessage","settings":{"id":"f7d760b9-15de-4b3f-b162-5a66e8e2eb8e","type":"text/plain","content":"Identifiquei que você *ainda não possui o débito automático* cadastrado como forma de pagamento, como eu posso te ajudar?\n\n*1-* Cadastrar no débito automático\n*2-* Voltar ao Menu de faturas\n*3-* Sair","metadata":{}},"$cardContent":{"document":{"id":"f7d760b9-15de-4b3f-b162-5a66e8e2eb8e","type":"text/plain","content":"Identifiquei que você *ainda não possui o débito automático* cadastrado como forma de pagamento, como eu posso te ajudar?\n\n*1-* Cadastrar no débito automático\n*2-* Voltar ao Menu de faturas\n*3-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c3fcf782-bdcc-4546-8893-a40c4f5cc3f6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"193ca9f8-d159-42cd-9794-bf2279c2ec7b","$connId":"con_1648","$id":"404ebb7b-21b7-468a-b4e8-1b7ebf43c171","conditions":[{"source":"context","comparison":"equals","values":["Cadastrar no débito automático"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","$connId":"con_1653","$id":"b1b5d30f-9dcd-4cd9-9773-7b80763af198","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao Menu de faturas"],"variable":"chooseAnswer@content"}],"$invalid":false,"typeOfStateId":"state"},{"stateId":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","$connId":"con_1658","$id":"22a47115-875d-4862-b273-3fbd92669536","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"2dcf5bb7-d563-4d81-af57-6c640f1e3c33","type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"/**\n * \n * 1- Cadastrar no débito automático \n * 2- Voltar ao Menu de faturas \n * 3- Sair\n */\nfunction run() {\n    return options = JSON.stringify([\n        {\n            content: \"Cadastrar no débito automático\",\n            regex: \"cadastrar?$|cadastrar?.*d.bi?to\\\\s*(autom.t)?\",\n        },\n        {\n            content: \"Voltar ao Menu de faturas\",\n            regex: \"voltar?$|voltar?.*menu|menu\\\\s*fatura\",\n        },\n        {\n            content: \"Sair\",\n            regex: \"sair?$\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Alterar debito automatico cadastrar exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar debito automatico cadastrar exibicao","action":"Exibicao"},"conditions":[],"$id":"44722ed6-20e4-4c7d-9de1-a9a75f032bd2"}],"$leavingCustomActions":[{"$id":"23b2dccc-c721-42d6-b9bf-b58549155974","type":"ExecuteScript","$title":"chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"ainda nao tem dcc\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}},{"$id":"4772d45b-83f5-4425-8f55-85e5ad8a2786","$typeOfContent":"","type":"TrackEvent","$title":"Alterar debito automatico cadastrar selecao","$invalid":false,"settings":{"extras":{},"category":"Alterar debito automatico cadastrar selecao","action":"{{input.content}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"input.content"}]},{"$id":"1de51678-4967-4c5f-bf32-c78159586ca8","$typeOfContent":"","type":"TrackEvent","$title":"Alterar debito automatico cadastrar input","$invalid":false,"settings":{"extras":{},"category":"Alterar debito automatico cadastrar input","action":"{{chooseAnswer@content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-ea9bba21-d4f7-4c34-bce9-a163f71d8310","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3a604591-0c3b-4062-9ad3-71b53e04f1ff","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-478431f8-1383-4a63-824c-291beba5b670","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-44d3b28d-40c0-4834-bc03-653638c5f2e6","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f1311a51-d995-4afa-87f6-1507e8d89426","root":false,"$title":"[A.1.4.2.2] Ainda nao tem DCC alterar","$position":{"top":"874.571px","left":"6509px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"053debbc-d7d7-40b8-b6b0-6eb7800468f2":{"$contentActions":[{"action":{"$id":"b35df86b-8567-4124-bdc9-f9365faa9d90","type":"SendMessage","settings":{"id":"07d20f69-bf3b-42d3-8aa0-cedfb8fb85fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"07d20f69-bf3b-42d3-8aa0-cedfb8fb85fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ad92d065-11f1-4156-8d3c-d5a5812cc70d","type":"SendMessage","settings":{"id":"58062e5c-48db-4056-910e-b759b62f13ef","type":"text/plain","content":"Selecione o seu banco:\n\n*1-* Itaú\n*2-* Banco do Brasil\n*3-* Bradesco\n*4-* Caixa Econômica\n*5-* Santander\n*6-* Safra\n*7-* Ver mais bancos","metadata":{}},"$cardContent":{"document":{"id":"58062e5c-48db-4056-910e-b759b62f13ef","type":"text/plain","content":"Selecione o seu banco:\n\n*1-* Itaú\n*2-* Banco do Brasil\n*3-* Bradesco\n*4-* Caixa Econômica\n*5-* Santander\n*6-* Safra\n*7-* Ver mais bancos"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"e3fc23de-06c3-427a-99d0-8142fd9183fd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6e5f76c9-0cb5-487e-bb83-cb79582e8271","$connId":"con_1663","$id":"419e614d-c838-40ec-b3ec-4f2082199239","conditions":[{"source":"context","comparison":"equals","values":["1","2","3","4","5","6"],"variable":"chooseAnswer@option"}],"$invalid":false},{"stateId":"54b971b0-0994-416c-bc05-80c9fab3699a","$connId":"con_1668","$id":"bc63c817-c8ba-4474-8bab-c70cab625357","conditions":[{"source":"context","comparison":"equals","values":["7"],"variable":"chooseAnswer@option"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c474b2a2-7e97-4d20-b21e-8315fe1f3a24","type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"/**\n * Selecione o seu banco:\n\n1- Itaú \n2- Banco do Brasil️\n3- Bradesco \n4- Caixa Econômica \n5- Santander \n6- Safra \n7- Ver mais bancos\n */\n\nfunction run() {\n    return options = JSON.stringify([\n        {\n            content: \"Itaú\",\n            regex: \"ita[uú]\",\n        },\n        {\n            content: \"Banco do Brasil\",\n            regex: \"brasil|bb\",\n        },\n        {\n            content: \"Bradesco\",\n            regex: \"bradesco\",\n        },\n        {\n            content: \"Caixa Econômica\",\n            regex: \"caixa\",\n        },\n        {\n            content: \"Santander\",\n            regex: \"santander\",\n        },\n        {\n            content: \"Safra\",\n            regex: \"safra\",\n        },\n        {\n            content: \"Ver mais bancos\",\n            regex: \"v[eê]r?\\\\s*mai?s|mai?s\\\\s*banco|outro\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"999700ad-f2e0-4983-958e-7e14994816fb","type":"ExecuteScript","$title":"chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d57965dc-6e09-4bb1-91f7-23b34b81eba7","type":"SetVariable","$title":"banco","$invalid":false,"settings":{"variable":"banco","value":"{{chooseAnswer@content}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["1","2","3","4","5","6"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"selecione seu banco\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-6f0787e5-8533-4d4a-971f-83af075442ad","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-daf81248-03d4-46ac-8ed5-07961bf8f797","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e62e4858-c88d-44e4-ac68-3f5943b1d7b4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-09861783-aaab-41dd-ad84-a2c8c293264a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"053debbc-d7d7-40b8-b6b0-6eb7800468f2","root":false,"$title":"[A.1.4.2.2.1] Selecione seu banco","$position":{"top":"883px","left":"6743px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6e5f76c9-0cb5-487e-bb83-cb79582e8271":{"$contentActions":[{"action":{"$id":"d0145321-003f-44da-8935-3644ed0755a2","type":"SendMessage","settings":{"id":"a9f7433a-97f4-4fa8-9452-f8f6aa29ca68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a9f7433a-97f4-4fa8-9452-f8f6aa29ca68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2ad40d17-9970-4070-951d-f595e010e1cb","type":"SendMessage","settings":{"id":"5102ec23-f9ea-4d79-be51-f174f5151e77","type":"text/plain","content":"Me informa o número da sua *agência:*","metadata":{}},"$cardContent":{"document":{"id":"5102ec23-f9ea-4d79-be51-f174f5151e77","type":"text/plain","content":"Me informa o número da sua *agência:*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"befe1d4f-7d1a-40bd-8c5b-ca83bc13e2a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1673","$id":"9ca428bc-4e39-4ea1-991d-6bdc324f8803","conditions":[{"source":"input","comparison":"matches","values":["(?i)(sair?)"]}],"$invalid":false},{"stateId":"c03a2154-8449-4a07-8363-c3c7d7167a88","$connId":"con_1678","$id":"f6e7a7f5-c98f-48f1-8667-fe9fc99aa6b8","conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@content","values":["Corrigir o número da agência"]}],"$invalid":false},{"stateId":"297706c5-59ce-48fd-9387-8e684683b04d","$connId":"con_1683","$id":"a641423c-ba2a-4282-847d-78e7e2a8fa1d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3bd8e282-e040-4361-93c8-4e2aa9263954","type":"SetVariable","$title":"agencia","$invalid":false,"settings":{"value":"{{input.content}}","variable":"agencia"},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"agencia\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-f4d83af6-7f93-4ad7-a052-8854cbe23ad0","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-34f712f9-0bcc-4a1e-b9f3-808a4a35e666","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-021a2343-bc77-45b1-a2bb-ec103d3a2724","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-7d9e988a-a6ad-4698-800c-5afcb569956e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"6e5f76c9-0cb5-487e-bb83-cb79582e8271","root":false,"$title":"[A.1.4.2.2.2] Agencia","$position":{"top":"1035px","left":"6600px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"54b971b0-0994-416c-bc05-80c9fab3699a":{"$contentActions":[{"action":{"$id":"5f404d49-3793-4163-b135-59e779d0ad90","type":"SendMessage","settings":{"id":"a10a22cb-85f6-48fd-a874-df362c5af16e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a10a22cb-85f6-48fd-a874-df362c5af16e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"77b7ac14-501d-4bd9-bc2d-9bfee95309a0","type":"SendMessage","settings":{"id":"964870dd-3199-45f0-9a87-1ed1362b89fe","type":"text/plain","content":"Selecione o seu banco:\n\n*1-* Citibank\n*2-* Banrisul\n*3-* Banpará \n*4-* Mercantil do Brasil\n*5-* Banese \n*6-* Banestes\n*7-* Voltar ao Menu anterior","metadata":{}},"$cardContent":{"document":{"id":"964870dd-3199-45f0-9a87-1ed1362b89fe","type":"text/plain","content":"Selecione o seu banco:\n\n*1-* Citibank\n*2-* Banrisul\n*3-* Banpará \n*4-* Mercantil do Brasil\n*5-* Banese \n*6-* Banestes\n*7-* Voltar ao Menu anterior"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"d2f1817a-bcf7-4f85-b2e8-6fa20fbf2eed","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6e5f76c9-0cb5-487e-bb83-cb79582e8271","$connId":"con_1688","$id":"b8f431d1-4483-456b-b691-24dac99fb6e9","conditions":[{"source":"context","comparison":"equals","values":["1","2","3","4","5","6"],"variable":"chooseAnswer@option"}],"$invalid":false},{"stateId":"053debbc-d7d7-40b8-b6b0-6eb7800468f2","$connId":"con_1693","$id":"0f6fec65-5c5d-4e4e-8886-a0cb0dbcc113","conditions":[{"source":"context","comparison":"equals","values":["7"],"variable":"chooseAnswer@option"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"12eca63a-23a7-4960-8eb0-ecc09fc55f9e","type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"/**\n * Selecione o seu banco:\n\n1- Citibank\n2- Banrisul\n3- Banpará \n4- Mercantil do Brasil\n5- Banese \n6- Banestes\n7- Voltar ao Menu anterior\n */\n\nfunction run() {\n    return options = JSON.stringify([\n        {\n            content: \"Citibank\",\n            regex: \"citi\",\n        },\n        {\n            content: \"Banrisul\",\n            regex: \"banrisul\",\n        },\n        {\n            content: \"Banpará\",\n            regex: \"banpar[aá]\",\n        },\n        {\n            content: \"Mercantil do Brasil\",\n            regex: \"mercantil\",\n        },\n        {\n            content: \"Banese\",\n            regex: \"banese\",\n        },\n        {\n            content: \"Banestes\",\n            regex: \"banestes\",\n        },\n        {\n            content: \"Voltar ao Menu anterior\",\n            regex: \"voltar?$|menu\\\\s*(anterior)?$\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4599e0a4-0f26-493d-a128-71df781b0f0f","type":"ExecuteScript","$title":"chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c7d015e6-e532-4bd5-b333-7a19f316719b","type":"SetVariable","$title":"banco","$invalid":false,"settings":{"value":"{{chooseAnswer@content}}","variable":"banco"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["1","2","3","4","5","6"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mais bancos\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-f600b231-3203-4db1-a6d9-79ffcd63c635","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c0531adf-16c4-4b07-9657-b223bc996858","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6f98432a-84bf-4cbe-bde2-f8ec1e91ff61","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-f62d677b-b5dd-4fd4-9bf7-4dcca6a838b1","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"54b971b0-0994-416c-bc05-80c9fab3699a","root":false,"$title":"[A.1.4.2.2.5] Mais bancos","$position":{"top":"962px","left":"6923px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"297706c5-59ce-48fd-9387-8e684683b04d":{"$contentActions":[{"action":{"$id":"6e83d06f-acb5-4b10-bb44-42b02964d3e0","type":"SendMessage","settings":{"id":"c74cd905-09e4-4e6a-ac23-3fd235ff5940","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c74cd905-09e4-4e6a-ac23-3fd235ff5940","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3dd90a92-9be8-48d6-9853-4ab3f12cecea","type":"SendMessage","settings":{"id":"7ef1bec3-6984-40b7-bde5-aaee3b31e67c","type":"text/plain","content":"Me informa o número da sua *conta:*","metadata":{}},"$cardContent":{"document":{"id":"7ef1bec3-6984-40b7-bde5-aaee3b31e67c","type":"text/plain","content":"Me informa o número da sua *conta:*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"150c2ccb-ccef-40db-aa19-bee5598e7b0d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1698","$id":"43427198-618a-4bd1-9fb0-06cae606b508","conditions":[{"source":"input","comparison":"matches","values":["(?i)(sair?)"]}],"$invalid":false},{"stateId":"c03a2154-8449-4a07-8363-c3c7d7167a88","$connId":"con_1703","$id":"fec22f3e-bbbd-48d7-8ce0-b15e8bc46c89","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"conta"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a74fb6b9-2dc7-454d-9b1e-418894fde614","type":"ExecuteScript","$title":"conta","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n    try {\n        var conta = inputContent.split('-');\n        if (conta.length == 0 || conta.length > 2) {\n            return null;\n        }\n\n        if (conta.length == 1) {\n            return JSON.stringify({\n                numero: conta[0].substr(0, conta[0].length - 1),\n                digito: conta[0].substr(conta[0].length - 1, conta[0].length)\n            });\n        }\n\n        return JSON.stringify({\n            numero: conta[0],\n            digito: conta[1]\n        });\n    } catch (e) {\n        return null;\n    }\n\n}","inputVariables":["input.content"],"outputVariable":"conta","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"conta\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-fddeb166-52d2-42de-835c-522e7cc73867","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1ce9083a-40d2-4d61-b439-88ecf4d4b5d7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-edaa970d-5f29-40ad-a806-5a8a134281b3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"297706c5-59ce-48fd-9387-8e684683b04d","root":false,"$title":"[A.1.4.2.2.3] Conta","$position":{"top":"1120px","left":"6601px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c03a2154-8449-4a07-8363-c3c7d7167a88":{"$contentActions":[{"action":{"$id":"c3f3f25b-6320-41a6-ae08-09f176b0123e","type":"SendMessage","settings":{"id":"19232c0d-1742-46b1-817b-8086c892ccad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19232c0d-1742-46b1-817b-8086c892ccad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"54cb3c3b-d1e6-4a67-9b5c-f61a34ebfe47","type":"SendMessage","settings":{"id":"05828fa4-cf6c-4162-a7ce-2284d19019c5","type":"text/plain","content":"Confirma pra mim se os dados bancários estão corretos:\n\n*Agência: {{agencia}}*\n*Conta: {{conta@numero}}-{{conta@digito}}*\n\n*1-* Tudo certo, pode cadastrar!\n*2-* Corrigir o número da agência\n*3-* Corrigir o número da conta\n*4-* Sair","metadata":{}},"$cardContent":{"document":{"id":"05828fa4-cf6c-4162-a7ce-2284d19019c5","type":"text/plain","content":"Confirma pra mim se os dados bancários estão corretos:\n\n*Agência: {{agencia}}*\n*Conta: {{conta@numero}}-{{conta@digito}}*\n\n*1-* Tudo certo, pode cadastrar!\n*2-* Corrigir o número da agência\n*3-* Corrigir o número da conta\n*4-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"8ce279f2-d282-488b-9eeb-7f6073fd9e67","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4a4b3903-1bf3-4851-b877-9117cc632d11","$connId":"con_1708","$id":"f95879ce-20ee-4a06-b66b-a860a4c7b897","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false},{"stateId":"6e5f76c9-0cb5-487e-bb83-cb79582e8271","$connId":"con_1713","$id":"719ed2b1-d769-4c41-bca3-6c21fe29f5c8","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false},{"stateId":"297706c5-59ce-48fd-9387-8e684683b04d","$connId":"con_1718","$id":"87a2e12b-afc8-4e9a-8bd5-7847cbd32b30","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"chooseAnswer@option"}],"$invalid":false},{"stateId":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","$connId":"con_1723","$id":"e1bbcac8-e6c9-45fa-96d8-6624baa5cd9c","conditions":[{"source":"context","comparison":"equals","values":["4"],"variable":"chooseAnswer@option"}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"9d368971-e5b4-44e2-abcd-8851f50c2119","type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"/**\n * Confirma pra mim se os dados bancários estão corretos:\n\nAgência: {{numerodaagencia}}\nConta: {{numerodaconta}}\n\n1- Tudo certo, pode cadastrar!\n2- Corrigir o número da agência\n3- Corrigir o número da conta\n */\n\nfunction run() {\n    return options = JSON.stringify([\n        {\n            content: \"Tudo certo, pode cadastrar!\",\n            regex: \"certo|cadastrar?|confirm(o|a|ar)|correto\",\n        },\n        {\n            content: \"Corrigir o número da agência\",\n            regex: \"corrig[ie].*ag.encia|ag[eê]ncia$\",\n        },\n        {\n            content: \"Corrigir o número da conta\",\n            regex: \"corrig[ie].*conta|conta$\",\n        },\n        {\n            content: \"Sair\",\n            regex: \"sair?$\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"3e30343a-b426-4219-aa13-f9cfc28d0e9e","type":"ExecuteScript","$title":"chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"confirma\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-36c95cf3-1e58-4c54-a741-0322cad86546","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-937d63c4-e158-4f66-a63b-5af96f52fa48","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-e0e72e8f-a94b-4e86-8cb7-dc3007baa2f9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c03a2154-8449-4a07-8363-c3c7d7167a88","root":false,"$title":"[A.1.4.2.2.4] Confirma","$position":{"top":"1214px","left":"6599px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4a4b3903-1bf3-4851-b877-9117cc632d11":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0561014a-e05b-4f65-87d5-2ae3bcd1aeb8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ea8ab98d-f6d0-4e6d-a3e0-dec24fd920f4","$connId":"con_1728","$id":"185687ac-3737-4321-8435-e44db40bd49f","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isValidConta"},{"source":"context","comparison":"equals","variable":"dccAttempts","values":["2"]}],"$invalid":false},{"stateId":"a28e058a-a1e9-4be9-a462-76b6a2add1aa","$connId":"con_1733","$id":"934e8943-ee91-420b-9179-933f136a7f58","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isValidConta"}],"$invalid":false},{"stateId":"f87ddb96-0cc0-4397-ae20-ea3cb551de06","$connId":"con_1738","$id":"8facf476-4742-440b-b401-59df810999e5","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isValidConta"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ab599684-76ff-4bcb-a1c0-8908cdd04ae2","type":"ExecuteScript","$title":"isValidConta","$invalid":false,"settings":{"function":"run","source":"function run(agencia, conta, responseAlteraDcc, fluxoDcc) {\n    try {\n        if (parseInt(agencia) && agencia.length >= 3 && JSON.parse(conta).numero.length > 3) {\n            return true;\n        }\n    } catch (e) {\n\n    }\n\n\n    return false;\n}","inputVariables":["agencia","conta"],"outputVariable":"isValidConta","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b88c7d47-ace0-41db-a9ee-9c354068fed6","type":"ExecuteScript","$title":"dccAttempts","$invalid":false,"settings":{"function":"run","source":"function run(dccAttempts) {\n    if (!dccAttempts) {\n        dccAttempts = 0;\n    }\n\n    dccAttempts = parseInt(dccAttempts) + 1;\n    return dccAttempts;\n}","inputVariables":["dccAttempts"],"outputVariable":"dccAttempts","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"isValidConta","values":["false"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8af9ed71-81f9-48dc-8d8e-0a1311c47bb8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"4a4b3903-1bf3-4851-b877-9117cc632d11","root":false,"$title":"Validar formato de conta","$position":{"top":"1304px","left":"6601px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a28e058a-a1e9-4be9-a462-76b6a2add1aa":{"$contentActions":[{"action":{"$id":"b567cd9e-38a7-4787-99f6-103d67075c63","type":"SendMessage","settings":{"id":"18b236e7-54ed-47aa-8951-17f9622cd5db","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"18b236e7-54ed-47aa-8951-17f9622cd5db","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cdfec031-bead-46de-97ba-4e83ba497792","type":"SendMessage","settings":{"id":"eed4ef15-9a49-490c-83b9-953525954370","type":"text/plain","content":"Não consegui identificar o dados da sua conta 🤔\n\nVerifique mais uma vez se você digitou todos os números corretamente.","metadata":{}},"$cardContent":{"document":{"id":"eed4ef15-9a49-490c-83b9-953525954370","type":"text/plain","content":"Não consegui identificar o dados da sua conta 🤔\n\nVerifique mais uma vez se você digitou todos os números corretamente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e5ceb4e0-9128-4f05-9d6b-91d63d57f6a7","type":"SendMessage","settings":{"id":"49f34fec-79aa-4231-b359-d85483488f1d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"49f34fec-79aa-4231-b359-d85483488f1d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fa6de8b9-aa60-4e59-9396-24fa316a7ca8","type":"SendMessage","settings":{"id":"c0c2dd3d-5867-40d5-b129-4c3909a050a5","type":"text/plain","content":"Escolha uma das opções:\n\n*1-* Tentar novamente\n*2-* Sair","metadata":{}},"$cardContent":{"document":{"id":"c0c2dd3d-5867-40d5-b129-4c3909a050a5","type":"text/plain","content":"Escolha uma das opções:\n\n*1-* Tentar novamente\n*2-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"95c63586-977a-4c78-ac29-04d844917019","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"75a8d48b-cb2c-49a7-b117-d235feff9bb7","$connId":"con_1743","$id":"638f5cc0-d18a-4458-bd51-f2b44f6cc1a0","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"},{"source":"context","comparison":"equals","variable":"fluxoDcc","values":["cancela"]}],"$invalid":false},{"stateId":"053debbc-d7d7-40b8-b6b0-6eb7800468f2","$connId":"con_1748","$id":"158e6f48-d37a-47aa-8379-ad6b852d853f","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$connId":"con_1753","$id":"072fbe96-c249-4b30-84fc-21e47265d9a3","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"a09a5ce3-20c3-4118-9fbc-8429010c4875","type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return options = JSON.stringify([\n        {\n            content: \"Tentar novamente\",\n            regex: \"tenta|de novo|novamente\",\n        },\n        {\n            content: \"Sair\",\n            regex: \"sair?\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b77c29cf-3dfb-439f-b092-0f5f9cddc3c5","type":"ExecuteScript","$title":"chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"conta invalida\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-52150504-8ff8-49c0-94eb-01229016c46f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f1616f5d-fc76-4f54-ad3a-4699ebba31fa","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-1c7d53e5-a615-4797-977d-65abcf4e25b1","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a28e058a-a1e9-4be9-a462-76b6a2add1aa","root":false,"$title":"[A.1.4.2.2.6] Conta invalida","$position":{"top":"1419px","left":"6512px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ea8ab98d-f6d0-4e6d-a3e0-dec24fd920f4":{"$contentActions":[{"action":{"$id":"1d5d6f32-dae0-4c66-a0d0-ada27711d84f","type":"SendMessage","settings":{"id":"75f88068-bbc4-42e6-83d6-d4e7480a9a68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"75f88068-bbc4-42e6-83d6-d4e7480a9a68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"efcca04f-61a0-43f7-95eb-d957afcfc6d5","type":"SendMessage","settings":{"id":"4325b3f4-3189-4401-b2b0-5d366f063611","type":"text/plain","content":"Desculpe, ainda não consegui identificar os dados da sua conta 😕\n\nConfere os dados e volta aqui mais tarde que eu tento te ajudar novamente!","metadata":{}},"$cardContent":{"document":{"id":"4325b3f4-3189-4401-b2b0-5d366f063611","type":"text/plain","content":"Desculpe, ainda não consegui identificar os dados da sua conta 😕\n\nConfere os dados e volta aqui mais tarde que eu tento te ajudar novamente!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e5bd5a4a-d894-481e-bc08-cbc87d8e42bb","type":"SendMessage","settings":{"id":"3a660124-5827-4f6f-b36b-3eeb6b74ca6d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{}},"$cardContent":{"document":{"id":"3a660124-5827-4f6f-b36b-3eeb6b74ca6d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5ed5fd0c-9824-4e0b-948e-4de2021a19a1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"validation":{"type":"text/plain","rule":"text","error":"Informe um tempo de inatividade"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c10a75ce-fe02-4b2b-a4ab-8642a3a560c6","type":"TrackEvent","$title":"Alterar debito automatico dados invalidos exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar debito automatico dados invalidos exibicao","action":"exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"segundo erro dcc\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}},{"$id":"809edc8b-704d-4640-98e1-c87eb794f0c3","type":"SetVariable","$title":"dccAttempts = 0","$invalid":false,"settings":{"value":"0","variable":"dccAttempts"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-b2782936-d99d-40ae-8628-bebf06f3e0bd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7f8fc2a7-3707-421c-b22b-1044c9673cef","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ed932ee7-8d8e-4c1d-995b-c7699e6a4243","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-dd9cbc5e-2cd3-45d6-84f9-945917a961de","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ea8ab98d-f6d0-4e6d-a3e0-dec24fd920f4","root":false,"$title":"[A.1.4.2.2.6.1] Segundo erro dcc","$position":{"top":"1545px","left":"6513px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"86dac87e-c9a9-4a1b-96d6-95b4a80f7ca5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d0a6408f-c4bc-4d1d-a12b-0c1ae9191a0b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d4e59928-2779-43a0-961e-8381096ef4bc","$connId":"con_1758","$id":"7abb290e-8aac-4dbe-8add-bbce558f1aff","conditions":[{"source":"context","comparison":"equals","values":["Banco do Brasil️","Caixa Econômica"],"variable":"banco"}],"$invalid":false},{"stateId":"1f392211-4e02-4a42-b337-244316a23d2f","$connId":"con_1763","$id":"ae0589a5-7c9a-4692-85de-dc36d4743070","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1f392211-4e02-4a42-b337-244316a23d2f","$invalid":false},"$tags":[],"id":"86dac87e-c9a9-4a1b-96d6-95b4a80f7ca5","root":false,"$title":"Valida banco dcc","$position":{"top":"1460px","left":"6877px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d4e59928-2779-43a0-961e-8381096ef4bc":{"$contentActions":[{"action":{"$id":"7a630cb8-9c4b-44d0-a767-8354ab004f9d","type":"SendMessage","settings":{"id":"7c791932-ada5-4bcf-b03e-da6d2d93cf07","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7c791932-ada5-4bcf-b03e-da6d2d93cf07","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"394d6a95-7566-434c-b4f3-60a0cf526017","type":"SendMessage","settings":{"id":"edb17117-5cca-4da2-9e8c-34c47869f684","type":"text/plain","content":"Prontinho, já solicitei a alteração dos seus dados bancários! 😉","metadata":{}},"$cardContent":{"document":{"id":"edb17117-5cca-4da2-9e8c-34c47869f684","type":"text/plain","content":"Prontinho, já solicitei a alteração dos seus dados bancários! 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fd8cb428-3b3e-4faa-aa5a-b91c54767c0c","type":"SendMessage","settings":{"id":"7f32e36e-cfe6-435e-a3a2-42472ff924ae","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"7f32e36e-cfe6-435e-a3a2-42472ff924ae","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"56973cc9-5c95-4c7d-8d80-b97c983fac45","type":"SendMessage","settings":{"id":"11303de1-bb3e-466a-8322-713e43413519","type":"text/plain","content":"⚠ Atenção:\n\nVocê precisa agora *entrar em contato com o seu banco* e pedir para que ele *autorize o débito em conta da Claro!*\n\nAté que você faça isso, a solicitação que eu enviei para o banco permanece pendente","metadata":{}},"$cardContent":{"document":{"id":"11303de1-bb3e-466a-8322-713e43413519","type":"text/plain","content":"⚠ Atenção:\n\nVocê precisa agora *entrar em contato com o seu banco* e pedir para que ele *autorize o débito em conta da Claro!*\n\nAté que você faça isso, a solicitação que eu enviei para o banco permanece pendente"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"70524011-79e3-4184-9a7a-ecb77dbae91f","type":"SendMessage","settings":{"id":"a50f740f-f7fe-4576-a5db-a861e01acaa0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"},"metadata":{}},"$cardContent":{"document":{"id":"a50f740f-f7fe-4576-a5db-a861e01acaa0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"530ac0f4-b8a0-4804-93ba-29472b2086fb","type":"SendMessage","settings":{"id":"4c04a12b-3cdb-4f4e-a147-51d7cfccba3d","type":"text/plain","content":"Não esqueça de acompanhar o débito em conta da sua próxima fatura para ter certeza que deu tudo certo 😉","metadata":{}},"$cardContent":{"document":{"id":"4c04a12b-3cdb-4f4e-a147-51d7cfccba3d","type":"text/plain","content":"Não esqueça de acompanhar o débito em conta da sua próxima fatura para ter certeza que deu tudo certo 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f67fc755-7a75-4e68-b44a-dfbbe11a547f","type":"SendMessage","settings":{"id":"15d799f8-2650-48b5-8e70-8651c3dbb642","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"15d799f8-2650-48b5-8e70-8651c3dbb642","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3ac748da-8ddc-4908-9a83-304a238126b7","type":"SendMessage","settings":{"id":"d63865fd-370b-48fb-97f7-31c9622cc77b","type":"text/plain","content":"O número do seu protocolo para esta solicitação é:","metadata":{}},"$cardContent":{"document":{"id":"d63865fd-370b-48fb-97f7-31c9622cc77b","type":"text/plain","content":"O número do seu protocolo para esta solicitação é:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d9ccee24-c348-4f6e-9c81-5abc7cad89b8","type":"SendMessage","settings":{"id":"0044bfe8-9eda-40da-83f9-bc7a86e7492e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0044bfe8-9eda-40da-83f9-bc7a86e7492e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1a6e2c42-939c-40a7-a7df-b61bcdf10f49","type":"SendMessage","settings":{"id":"d1cb8a61-3f69-426b-9076-dc244b6ffaa4","type":"text/plain","content":"{{responseAlteraDcc@data.protocol}}","metadata":{}},"$cardContent":{"document":{"id":"d1cb8a61-3f69-426b-9076-dc244b6ffaa4","type":"text/plain","content":"{{responseAlteraDcc@data.protocol}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a3233d37-1282-482f-bcb0-8bdda3c4c30b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"d97a2848-667f-4f8a-8bf2-1fab599bc8b3","type":"SendMessage","settings":{"id":"0bcac177-e012-49b6-be49-2392a8b9b247","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"0bcac177-e012-49b6-be49-2392a8b9b247","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6a45442e-8863-43b0-aaa7-fd3f6bdaa392","type":"TrackEvent","$title":"Alterar debito automatico concluido caixa ou BB exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar debito automatico concluido caixa ou BB exibicao","action":"exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"caixa ou bb\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-5df03dcb-2ad2-4d3c-9968-12074ab9f26c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-918d04c3-799a-44be-a15b-29b99de53357","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d0097fb3-95ae-4d87-b7a1-dc2575d514b0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d4e59928-2779-43a0-961e-8381096ef4bc","root":false,"$title":"[A.1.4.2.2.8] Caixa ou BB","$position":{"top":"1548px","left":"6961px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1f392211-4e02-4a42-b337-244316a23d2f":{"$contentActions":[{"action":{"$id":"28e1d1af-0d99-4794-ba32-8a2e63c2722d","type":"SendMessage","settings":{"id":"cc12c6ca-e6a6-409e-91a5-fb8f683c74f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cc12c6ca-e6a6-409e-91a5-fb8f683c74f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ebaf0691-b8e4-4ed5-bc14-68c6b753589f","type":"SendMessage","settings":{"id":"70f7b4e9-6bd9-44d7-b831-0fa23cb189b4","type":"text/plain","content":"Prontinho, já solicitei a alteração dos seus dados bancários! 😉","metadata":{}},"$cardContent":{"document":{"id":"70f7b4e9-6bd9-44d7-b831-0fa23cb189b4","type":"text/plain","content":"Prontinho, já solicitei a alteração dos seus dados bancários! 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7e5e99f4-592e-42ba-a082-ac0bf6db03f5","type":"SendMessage","settings":{"id":"588ae4e2-b028-43c7-901b-0a4cdd601115","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"588ae4e2-b028-43c7-901b-0a4cdd601115","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2bd71edd-dcaf-41b5-92c9-20761592a1ea","type":"SendMessage","settings":{"id":"f2b7d381-3955-4ee6-b52e-382f8288d28b","type":"text/plain","content":"Lembrando que o banco sempre checa as informações cadastrais antes de aprovar tudo.\nSe houver diferença entre o CPF do titular da conta bancária e do contrato conosco, essa operação não será autorizada!","metadata":{}},"$cardContent":{"document":{"id":"f2b7d381-3955-4ee6-b52e-382f8288d28b","type":"text/plain","content":"Lembrando que o banco sempre checa as informações cadastrais antes de aprovar tudo.\nSe houver diferença entre o CPF do titular da conta bancária e do contrato conosco, essa operação não será autorizada!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f0164fd2-f941-41c5-8343-ad7056819fd3","type":"SendMessage","settings":{"id":"84df623e-ec4d-4329-a5ee-fd9b2805fff5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"},"metadata":{}},"$cardContent":{"document":{"id":"84df623e-ec4d-4329-a5ee-fd9b2805fff5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"4000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"926d4e3d-260c-4a1b-a441-b68e8f513083","type":"SendMessage","settings":{"id":"a00b578d-33ef-4d73-887e-3da5c029992c","type":"text/plain","content":"Não esqueça de acompanhar o débito em conta da sua próxima fatura para ter certeza que deu tudo certo 😉","metadata":{}},"$cardContent":{"document":{"id":"a00b578d-33ef-4d73-887e-3da5c029992c","type":"text/plain","content":"Não esqueça de acompanhar o débito em conta da sua próxima fatura para ter certeza que deu tudo certo 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"69961d6d-afff-463b-b048-b53d550b398c","type":"SendMessage","settings":{"id":"f1e952d4-aba9-4968-88ad-384681c34d7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f1e952d4-aba9-4968-88ad-384681c34d7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d0506522-bbbd-480d-a079-8093b290f2f7","type":"SendMessage","settings":{"id":"3f9ac041-1afe-4e0a-b516-a3b49df47c85","type":"text/plain","content":"O número do seu protocolo para esta solicitação é:","metadata":{}},"$cardContent":{"document":{"id":"3f9ac041-1afe-4e0a-b516-a3b49df47c85","type":"text/plain","content":"O número do seu protocolo para esta solicitação é:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2cf05154-ca94-42a3-a050-b104bd864c6a","type":"SendMessage","settings":{"id":"72402b71-6d6f-43bb-881c-ff5d255fc398","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"72402b71-6d6f-43bb-881c-ff5d255fc398","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"710946af-c259-4e7f-a79a-edb50960e369","type":"SendMessage","settings":{"id":"98a13c1e-c583-4ba0-8b13-7fe91df9c531","type":"text/plain","content":"{{responseAlteraDcc@data.protocol}}","metadata":{}},"$cardContent":{"document":{"id":"98a13c1e-c583-4ba0-8b13-7fe91df9c531","type":"text/plain","content":"{{responseAlteraDcc@data.protocol}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fd825dd9-6f88-4365-8430-8884566467fc","type":"SendMessage","settings":{"id":"083bb682-7073-4966-adb1-e034a1345bd4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"083bb682-7073-4966-adb1-e034a1345bd4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"acc44503-2181-4996-a9db-7bfd039108db","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3800d9f8-25cd-4be6-a436-77f918da007a","type":"TrackEvent","$title":"Alterar debito automatico concluido exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Alterar debito automatico concluido exibicao","action":"exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"outros bancos\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-3d9a3326-96e9-44ff-b7f1-4dbce2142ceb","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3e296947-b0ba-47a6-afe6-21f723a85380","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d74ea3cc-68ca-4849-8afb-0c6e40add900","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"1f392211-4e02-4a42-b337-244316a23d2f","root":false,"$title":"[A.1.4.2.2.7] Outros bancos","$position":{"top":"1546px","left":"6774px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0acc0c2f-51c2-4287-b296-9c801ce8b565":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e7385a20-d402-49a1-a899-8de29db8999b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ea1fbb9b-061c-4374-9c9f-bb25fc57e55f","$connId":"con_1768","$id":"4da8d233-b4f1-4a66-8de0-6f45002ba6e7","conditions":[{"source":"context","comparison":"equals","values":["400"],"variable":"statusAlteraDcc"},{"source":"context","comparison":"contains","variable":"responseAlteraDcc","values":["Unprocessable Entity"]}],"$invalid":false},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1773","$id":"dbea5570-f418-42bd-975e-678567c7ae49","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusAlteraDcc"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fb68600a-321f-4680-9ad3-ca4a7f255518","type":"ProcessHttp","$title":"PUT Alterar DCC","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"PUT","body":"{\n    \"AccessToken\": \"{{tokenAccessFormated}}\",\n    \"Document\": \"{{tokenPayload@cpf}}\",\n    \"ContractNumber\": \"{{tokenPayload@contrato}}\",\n    \"OperatorCode\": \"{{tokenPayload@codigoOperadora}}\",\n    \"Data\": {\n        \"bank\": {{idBanco}},\n        \"agency\": \"{{agencia}}\",\n        \"accountNumber\": \"{{conta@numero}}\",\n        \"accountDigit\": \"{{conta@digito}}\"\n    }\n}","uri":"{{config.apiUrl}}/v1/intermediate/paymentmethods/dcc","responseStatusVariable":"statusAlteraDcc","responseBodyVariable":"responseAlteraDcc"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"86dac87e-c9a9-4a1b-96d6-95b4a80f7ca5","$invalid":false},"$tags":[{"id":"blip-tag-6b2811b2-c5ae-4b05-8b80-f29ec1a4aca8","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"0acc0c2f-51c2-4287-b296-9c801ce8b565","root":false,"$title":"PUT Altera DCC","$position":{"top":"1375.89px","left":"6877.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f87ddb96-0cc0-4397-ae20-ea3cb551de06":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e7c94baa-c7ce-45db-a950-3638a5189e01","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1778","$id":"336aeb84-e6c4-4618-af17-6974f1ebd1c2","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusBancos"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ec7a4693-6774-4fb2-9d1a-702b7c91c51b","type":"ProcessHttp","$title":"GET Bancos","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/paymentmethods/banks?AccessToken={{tokenAccessFormated}}&Document={{tokenPayload@cpf}}&ContractNumber={{tokenPayload@contrato}}&OperatorCode={{tokenPayload@codigoOperadora}}","responseStatusVariable":"statusBancos","responseBodyVariable":"responseBancos"},"conditions":[]},{"$id":"f2d0f6e1-8356-45af-84db-16a6958465fd","type":"ExecuteScript","$title":"idBanco","$invalid":false,"settings":{"function":"run","source":"function run(responseBanco, banco) {\n    try {\n        var banks = JSON.parse(responseBanco).data.listOfResult\n        if (banco == \"Itaú\") {\n            banco = \"Itau\";\n        } else if (banco == \"Caixa Econômica\") {\n            banco = \"Caixa Economica\";\n        } else if (banco == \"Banpará\") {\n            banco = \"Banco do Estado do Para\";\n        }\n\n\n        var bank = banks.find(function (b) {\n            var regex = new RegExp(banco, 'i');\n            return regex.test(b.nome);\n        })\n        return bank.codigo;\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["responseBancos","banco"],"outputVariable":"idBanco","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0acc0c2f-51c2-4287-b296-9c801ce8b565","$invalid":false},"$tags":[{"id":"blip-tag-cbb951c6-96b4-4afa-ad52-c6d5cc6ab8f9","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-2606d3b9-366c-4e6d-931e-601491663405","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"f87ddb96-0cc0-4397-ae20-ea3cb551de06","root":false,"$title":"GET Bancos","$position":{"top":"1290.25px","left":"6873.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0f6f257a-bea4-437e-9fd2-ebece523b004":{"$contentActions":[{"action":{"$id":"9be33c34-3e66-40e1-a69e-e877c9bfffc1","type":"SendMessage","settings":{"id":"872a5713-64ac-4d62-b7b1-adbd52a839fe","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"872a5713-64ac-4d62-b7b1-adbd52a839fe","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"59b1ace5-16ac-4e5b-84d7-e145eebc267b","type":"SendMessage","settings":{"id":"512f433b-a5ff-42b7-9790-ab4b92e70864","type":"text/plain","content":"Ao cancelar o débito automático:\n\n➡️ Caso tenha algum *desconto* em virtude do Débito Automático, você *perde* esse benefício\n\n➡️ O valor da sua fatura *deixa de ser descontado automaticamente* da sua conta todo mês","metadata":{}},"$cardContent":{"document":{"id":"512f433b-a5ff-42b7-9790-ab4b92e70864","type":"text/plain","content":"Ao cancelar o débito automático:\n\n➡️ Caso tenha algum *desconto* em virtude do Débito Automático, você *perde* esse benefício\n\n➡️ O valor da sua fatura *deixa de ser descontado automaticamente* da sua conta todo mês"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8cb74041-5329-4b0a-a0a3-784f8f1d9a2a","type":"SendMessage","settings":{"id":"3e84a08e-a4ed-4d0b-beb3-1cb452307634","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{}},"$cardContent":{"document":{"id":"3e84a08e-a4ed-4d0b-beb3-1cb452307634","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a823c826-f2f1-46a2-b576-7d028f774000","type":"SendMessage","settings":{"id":"b8fe3d8f-8a8a-4717-a56d-111ade53f9ad","type":"text/plain","content":"Você ainda *quer cancelar* o débito automático?\n\n*1-* Cancelar débito automático\n*2-* Manter débito automático","metadata":{}},"$cardContent":{"document":{"id":"b8fe3d8f-8a8a-4717-a56d-111ade53f9ad","type":"text/plain","content":"Você ainda *quer cancelar* o débito automático?\n\n*1-* Cancelar débito automático\n*2-* Manter débito automático"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"4e975145-90e8-4e9d-8a85-0904729ebe61","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c96afdb5-4b8d-4610-ad7a-369077425924","$connId":"con_1783","$id":"5ed16dda-ad9b-4029-b6ed-b9615a7d14dd","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"chooseAnswer@option"}],"$invalid":false},{"stateId":"af7b604c-ade5-42ef-83df-894401d4e1a7","$connId":"con_1788","$id":"7a576f04-aff2-45ac-9d34-d62a9bbd7fa2","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"chooseAnswer@option"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"de9940ba-cc46-405a-b935-79af438e0e0b","type":"TrackEvent","$title":"Cancelar debito automatico pos login exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Cancelar debito automatico pos login exibicao","action":"exibicao"},"conditions":[]},{"$id":"83efeb4e-cf72-4d9a-86a6-21a5467f4472","type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"/**\n * Você ainda quer cancelar o débito automático?\n\n1- Cancelar débito automático\n2- Manter débito automático\n */\nfunction run() {\n    return options = JSON.stringify([\n        {\n            content: \"Cancelar débito automático\",\n            regex: \"^cancelar?|sim|^quero|retirar?|remover?\",\n        },\n        {\n            content: \"Manter débito automático\",\n            regex: \"mant[eé][rm]|n[aã]o\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"ea23586d-336c-406f-8aed-125f28130114","type":"ExecuteScript","$title":"chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8b4b5e8a-603d-48c0-90a6-461dde3fe208","type":"ExecuteScript","$title":"inputContentSubstring","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    return input.substr(0, 255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a39e9347-9ccd-4fcb-86bc-46fd3391c990","type":"TrackEvent","$title":"Cancelar debito automatico pos login selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Cancelar debito automatico pos login selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"8c9f7861-245e-4a45-961c-10deb42992ea","type":"TrackEvent","$title":"Cancelar debito automatico pos login input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"action":"{{inputContentSubstring}}","category":"Cancelar debito automatico pos login input"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@option","values":["invalid"]}]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"confirmar cancela dcc\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-fdec396b-b911-4d21-8b2d-26e0b7a440bb","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0eee307e-0ae4-455b-a735-0dcbe15239dd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c2e01b43-fdaa-4bc9-91b1-4212a5fb341b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-1c5f6b0c-8e8d-4813-9a45-f22456f46a71","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0f6f257a-bea4-437e-9fd2-ebece523b004","root":false,"$title":"[A.1.4.2.3] Confirmar cancela DCC","$position":{"top":"567px","left":"7254px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"af7b604c-ade5-42ef-83df-894401d4e1a7":{"$contentActions":[{"action":{"$id":"02c2c8c4-b45b-44d0-b3b8-9a60ed992631","type":"SendMessage","settings":{"id":"8583cb36-b2b2-48c6-ae96-e26093c31e50","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8583cb36-b2b2-48c6-ae96-e26093c31e50","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7a7515c1-d1fe-487f-ae11-97dc78bfc765","type":"SendMessage","settings":{"id":"e417f0ec-5659-4973-bd50-f314e05e821f","type":"text/plain","content":"Ok, sua fatura Claro Residencial continua cadastrada no débito automático! 😉","metadata":{}},"$cardContent":{"document":{"id":"e417f0ec-5659-4973-bd50-f314e05e821f","type":"text/plain","content":"Ok, sua fatura Claro Residencial continua cadastrada no débito automático! 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"09a4b807-0a6a-438d-a4ae-3a6fee987728","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"e7cc6762-c879-4e54-9ba0-51837a1f97c4","type":"SendMessage","settings":{"id":"94f7cb68-60b4-43d0-b809-55e9cc154bf3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"94f7cb68-60b4-43d0-b809-55e9cc154bf3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"0d14a5b1-581e-45c2-90e9-73402b36c56b","type":"TrackEvent","$title":"Cancelar debito automatico nao concluido exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Cancelar debito automatico nao concluido exibicao","action":"exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"manter dcc\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-26de61c4-72c7-4913-a855-3a251efe1242","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0f6563a9-96fd-4622-ae77-f4147936dcb8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-678dee36-5554-4e4c-9187-dbe6a17f4663","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"af7b604c-ade5-42ef-83df-894401d4e1a7","root":false,"$title":"[A.1.4.2.5] Manter DCC","$position":{"top":"772px","left":"7358px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dfd75e84-cfaa-4317-b8bb-8390c5c71edd":{"$contentActions":[{"action":{"$id":"381b3a0d-ed05-44f6-a0da-1da2494f2009","type":"SendMessage","settings":{"id":"362d7c5a-dc9b-441e-a941-d5f32b3deb41","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"362d7c5a-dc9b-441e-a941-d5f32b3deb41","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7a32fcd5-01e1-4c94-8081-98e09da1834a","type":"SendMessage","settings":{"id":"c311ea06-bd13-4f46-954f-5c2e2b2c60d6","type":"text/plain","content":"Prontinho, *já solicitei o cancelamento* do débito automático para a sua fatura Claro Residencial! 😉","metadata":{}},"$cardContent":{"document":{"id":"c311ea06-bd13-4f46-954f-5c2e2b2c60d6","type":"text/plain","content":"Prontinho, *já solicitei o cancelamento* do débito automático para a sua fatura Claro Residencial! 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b0a84e6a-0842-4f25-87c3-5c8c6314b577","type":"SendMessage","settings":{"id":"ef67e273-c57a-400b-bcaf-a10218be7cfc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"ef67e273-c57a-400b-bcaf-a10218be7cfc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"aa6096c9-e316-40db-a738-57e1b346ae19","type":"SendMessage","settings":{"id":"04a77874-1bc7-4ac9-b0d1-689fc6740159","type":"text/plain","content":"⚠️ Fique atento:\n\nSe a fatura desse mês já estiver fechada, a alteração da forma de pagamento será feita apenas na próxima fatura!","metadata":{}},"$cardContent":{"document":{"id":"04a77874-1bc7-4ac9-b0d1-689fc6740159","type":"text/plain","content":"⚠️ Fique atento:\n\nSe a fatura desse mês já estiver fechada, a alteração da forma de pagamento será feita apenas na próxima fatura!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0f5200d5-0071-4822-b328-842b92719545","type":"SendMessage","settings":{"id":"a1ad11d5-997c-4edf-bed3-f1f317cd226d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a1ad11d5-997c-4edf-bed3-f1f317cd226d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1cec5ea0-3c7e-444f-940d-49f272bc0ddf","type":"SendMessage","settings":{"id":"6a2e03d4-736b-4592-bd6b-6adfd41562ff","type":"text/plain","content":"Seu nº de protocolo para esta solicitação é: ","metadata":{}},"$cardContent":{"document":{"id":"6a2e03d4-736b-4592-bd6b-6adfd41562ff","type":"text/plain","content":"Seu nº de protocolo para esta solicitação é: "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8163404b-eb17-40b3-8f0a-23f703985a2b","type":"SendMessage","settings":{"id":"635468dc-6da3-4006-a5ee-82d033637a87","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"635468dc-6da3-4006-a5ee-82d033637a87","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7d10ae76-ff55-423f-b9dd-ce054d714a48","type":"SendMessage","settings":{"id":"ed9ede16-9a4f-44dd-9474-a6fd0deace05","type":"text/plain","content":"{{responseCancelaDcc@data.protocol}}","metadata":{}},"$cardContent":{"document":{"id":"ed9ede16-9a4f-44dd-9474-a6fd0deace05","type":"text/plain","content":"{{responseCancelaDcc@data.protocol}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"78fc92ba-2420-4fc2-ad90-5cb505c620d0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"784699c2-13be-438a-9f87-12d13bdbcc2d","type":"SendMessage","settings":{"id":"ca31e864-222c-4f57-bbaf-848ba5ab91b9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"ca31e864-222c-4f57-bbaf-848ba5ab91b9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6f200140-e9a1-4889-8ec5-219c643279ce","type":"TrackEvent","$title":"Cancelar debito automatico concluido exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"action":"exibicao","category":"Cancelar debito automatico concluido exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"dcc cancelado\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-301b0bc6-3655-4e96-b290-838bea1dc867","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-eb0a36e8-239f-42ad-a724-cd371c72199b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-36983890-c4ba-4b6c-a77a-578a7dbde5d4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"dfd75e84-cfaa-4317-b8bb-8390c5c71edd","root":false,"$title":"[A.1.4.2.4] DCC Cancelado","$position":{"top":"868px","left":"7173px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c96afdb5-4b8d-4610-ad7a-369077425924":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1dd3dfed-0912-436d-9d96-171e5ae604de","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"validation":{"type":"text/plain","rule":"text","error":"Informe um tempo de inatividade"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1793","$id":"6d107313-d000-4bc6-8ce8-28bd0270a8b9","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusCancelaDcc"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"17dea455-dea5-4ce2-b3a7-1115d3763b75","type":"ProcessHttp","$title":"PUT Cancela Dcc","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"PUT","body":"{\r\n    \"AccessToken\": \"{{tokenAccessFormated}}\",\r\n    \"Document\": \"{{tokenPayload@cpf}}\",\r\n    \"ContractNumber\": \"{{tokenPayload@contrato}}\",\r\n    \"OperatorCode\": \"{{tokenPayload@codigoOperadora}}\"\r\n}","uri":"{{config.apiUrl}}/v1/intermediate/paymentmethods/billet","responseStatusVariable":"statusCancelaDcc","responseBodyVariable":"responseCancelaDcc"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"dfd75e84-cfaa-4317-b8bb-8390c5c71edd","$invalid":false},"$tags":[{"id":"blip-tag-5fdb1be5-b3d4-4ae3-bf98-f526ee77e1e5","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"c96afdb5-4b8d-4610-ad7a-369077425924","root":false,"$title":"PUT Cancelar DCC","$position":{"top":"767.111px","left":"8145.11px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6380727c-3d48-44c5-95ab-c42ec2ad309b":{"$contentActions":[{"action":{"$id":"0aca0e43-54bf-4493-842b-9d7ceee1d6b2","type":"SendMessage","settings":{"id":"609885a8-5867-4d4d-b238-09e8aef4880d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"609885a8-5867-4d4d-b238-09e8aef4880d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a64608dd-911c-406a-9b08-08778c65112a","type":"SendMessage","settings":{"id":"f7d760b9-15de-4b3f-b162-5a66e8e2eb8e","type":"text/plain","content":"Identifiquei que você *não possui o débito automático* cadastrado.\n\nVocê prefere:\n\n*1-* Voltar ao Menu de faturas\n*2-* Sair","metadata":{}},"$cardContent":{"document":{"id":"f7d760b9-15de-4b3f-b162-5a66e8e2eb8e","type":"text/plain","content":"Identifiquei que você *não possui o débito automático* cadastrado.\n\nVocê prefere:\n\n*1-* Voltar ao Menu de faturas\n*2-* Sair"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c3fcf782-bdcc-4546-8893-a40c4f5cc3f6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","$connId":"con_1798","$id":"b1b5d30f-9dcd-4cd9-9773-7b80763af198","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao Menu de faturas"],"variable":"chooseAnswer@content"}],"$invalid":false,"typeOfStateId":"state"},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$connId":"con_1803","$id":"22a47115-875d-4862-b273-3fbd92669536","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"2dcf5bb7-d563-4d81-af57-6c640f1e3c33","type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"/**\n * \n * 1- Cadastrar no débito automático \n * 2- Voltar ao Menu de faturas \n * 3- Sair\n */\nfunction run() {\n    return options = JSON.stringify([\n        {\n            content: \"Voltar ao Menu de faturas\",\n            regex: \"voltar?$|voltar?.*menu|menu\\\\s*fatura\",\n        },\n        {\n            content: \"Sair\",\n            regex: \"sair?$\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"23b2dccc-c721-42d6-b9bf-b58549155974","type":"ExecuteScript","$title":"chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"ainda nao tem dcc\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-02e0b12b-7c49-42a8-a8e8-039502f997c7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6e71f956-10f3-41bb-9c9a-96fb9170f43e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-e48188a3-c184-4a00-a388-708cc94f8b6b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"6380727c-3d48-44c5-95ab-c42ec2ad309b","root":false,"$title":"[A.1.4.2.3.0.0] Ainda nao tem DCC cancelar","$position":{"top":"505px","left":"7046px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ea1fbb9b-061c-4374-9c9f-bb25fc57e55f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"10edf4bd-974b-40fa-b415-88f2b66995f2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"validation":{"type":"text/plain","rule":"text","error":"Informe um tempo de inatividade"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"ea8ab98d-f6d0-4e6d-a3e0-dec24fd920f4","$connId":"con_1808","$id":"b85d0684-0c17-47d8-8ebc-57bba5f1cb26","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"dccAttempts"}],"$invalid":false},{"stateId":"a28e058a-a1e9-4be9-a462-76b6a2add1aa","$connId":"con_1813","$id":"8be552f3-865b-440f-97fd-376e2c555914","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"dccAttempts"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b2b8c56c-853e-420a-ae6c-32aced3bb3d8","type":"SetVariable","$title":"fluxoDcc","$invalid":false,"settings":{"variable":"fluxoDcc","value":"altera"},"conditions":[]},{"$id":"69a9430d-761c-4754-b05c-36057618eb52","type":"ExecuteScript","$title":"dccAttempts","$invalid":false,"settings":{"function":"run","source":"function run(dccAttempts) {\n    if (!dccAttempts) {\n        dccAttempts = 0;\n    }\n\n    dccAttempts = parseInt(dccAttempts) + 1;\n    return dccAttempts;\n}","inputVariables":["dccAttempts"],"outputVariable":"dccAttempts","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-c7793d39-9962-46c1-bd08-54c5cac46d16","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-683a5324-cfc4-47af-afcc-80c6568317cb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"ea1fbb9b-061c-4374-9c9f-bb25fc57e55f","root":false,"$title":"Provavel conta invalida Altera Dcc","$position":{"top":"1371px","left":"7134px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3a7d3209-9650-4ec2-b299-420f3fbcbb0a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"10edf4bd-974b-40fa-b415-88f2b66995f2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"validation":{"type":"text/plain","rule":"text","error":"Informe um tempo de inatividade"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"ea8ab98d-f6d0-4e6d-a3e0-dec24fd920f4","$connId":"con_1818","$id":"b85d0684-0c17-47d8-8ebc-57bba5f1cb26","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"dccAttempts"}],"$invalid":false},{"stateId":"a28e058a-a1e9-4be9-a462-76b6a2add1aa","$connId":"con_1823","$id":"8be552f3-865b-440f-97fd-376e2c555914","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"dccAttempts"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b2b8c56c-853e-420a-ae6c-32aced3bb3d8","type":"SetVariable","$title":"fluxoDcc","$invalid":false,"settings":{"variable":"fluxoDcc","value":"cancela"},"conditions":[]},{"$id":"69a9430d-761c-4754-b05c-36057618eb52","type":"ExecuteScript","$title":"dccAttempts","$invalid":false,"settings":{"function":"run","source":"function run(dccAttempts) {\n    if (!dccAttempts) {\n        dccAttempts = 0;\n    }\n\n    dccAttempts = parseInt(dccAttempts) + 1;\n    return dccAttempts;\n}","inputVariables":["dccAttempts"],"outputVariable":"dccAttempts","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-e15085ab-964b-4cc5-a8ef-d0f961246127","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1584e64c-1de2-4c5e-8e55-7f7997449780","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"3a7d3209-9650-4ec2-b299-420f3fbcbb0a","root":false,"$title":"Provavel conta invalida Cadastra Dcc","$position":{"top":"1897.71px","left":"5785.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dedd76b8-fb59-41dc-8e23-1960941430b7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fcdb5299-4ebc-44e4-865a-cf95d9c754a6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"validation":{"type":"text/plain","rule":"text","error":"Informe um tempo de inatividade"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"2ec7c9fe-54eb-4270-9bc2-8bb812344337","type":"Redirect","$title":"Redirect to \"{{config.servicoPrincipal}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#M.2.1"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-522124f9-9cea-4f8d-86db-b95d41be34d9","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"dedd76b8-fb59-41dc-8e23-1960941430b7","root":false,"$title":"Redireciona para menu NET","$position":{"top":"146px","left":"4056px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8be6a854-25e0-437a-9bb1-0abe822404c7":{"$contentActions":[{"action":{"$id":"bb9d7405-461e-4a38-85f9-23d7649dd0bd","type":"SendMessage","settings":{"id":"5c4829a1-b03d-4a31-9bd7-4e2ca37997ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5c4829a1-b03d-4a31-9bd7-4e2ca37997ba","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cdf73045-1812-4d8d-87d2-aa56ebc47884","type":"SendMessage","settings":{"id":"b26c94f3-77a7-45ea-836b-b996d892253c","type":"text/plain","content":"⚠️ Estamos passando por uma *manutenção* agora e meu sistema está *temporariamente indisponível* \n\n*Volta mais tarde* que eu consigo te ajudar!","metadata":{}},"$cardContent":{"document":{"id":"b26c94f3-77a7-45ea-836b-b996d892253c","type":"text/plain","content":"⚠️ Estamos passando por uma *manutenção* agora e meu sistema está *temporariamente indisponível* \n\n*Volta mais tarde* que eu consigo te ajudar!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"145dab58-d144-4c42-af4b-55a908b30631","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"validation":{"type":"text/plain","rule":"text","error":"Informe um tempo de inatividade"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"aedce693-1aab-4192-9a0b-145d379b6061","type":"TrackEvent","$title":"Mensagem de manutencao exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Mensagem de manutencao exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mensagem de manutencao\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-8389bbab-ad03-42dd-bbfc-cb63a46e6128","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ebbec4e5-76d3-4ece-b435-c9a7ac3c50df","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-69b1ad5b-e0d1-428c-a5c8-b7dabe5444b0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"8be6a854-25e0-437a-9bb1-0abe822404c7","root":false,"$title":"[MM.1] Mensagem de manutencao","$position":{"top":"36px","left":"1430px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b2e632fb-920c-4766-bae8-37bb455bbf40":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e0cf5e67-a007-43b3-8c11-8012102c2d5e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"origemAjudaAutenticacao"}]},{"type":"Redirect","$title":"Redirecionar autenticacao","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#ajudaLoginTelefone"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-872d9458-e487-4a9f-98bf-1962ff6fafb8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1dc4a301-ce55-41a7-843a-8b782723350e","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"b2e632fb-920c-4766-bae8-37bb455bbf40","root":false,"$title":"Redireciona para login com telefone","$position":{"top":"145px","left":"3557px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"aa273963-9ca7-4be3-b11f-22bbdd86c182":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e0cf5e67-a007-43b3-8c11-8012102c2d5e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"origemAjudaAutenticacao"}]},{"type":"Redirect","$title":"Redirecionar autenticacao","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#ajudaRecuperacao"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-4ac0b697-9397-45a8-83e5-27fbe8aedf64","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e67276bd-5d71-4005-8658-21ee3c773fb5","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"aa273963-9ca7-4be3-b11f-22bbdd86c182","root":false,"$title":"Redireciona para recuperar senha","$position":{"top":"294px","left":"3553px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c59a05a7-6f32-4f76-b962-c133e9171732":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e0cf5e67-a007-43b3-8c11-8012102c2d5e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"origemAjudaAutenticacao"}]},{"type":"Redirect","$title":"Redirecionar autenticacao","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#ajudaRecuperacaoTv"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-5d32ba9b-7a8a-475c-93f7-62d39b7c7b23","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d1fbe4a1-8198-46f6-a55f-a5bf2d68bc4a","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c59a05a7-6f32-4f76-b962-c133e9171732","root":false,"$title":"Redireciona para recuperar senha tv","$position":{"top":"0px","left":"2365.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"24615743-6cdb-4dda-868d-f086b0583520":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e0cf5e67-a007-43b3-8c11-8012102c2d5e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"origemAjudaAutenticacao"}]},{"type":"Redirect","$title":"Redirecionar autenticacao","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#ajudaCadastroTv"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-de1f6427-5eae-42e5-9f10-a220a95a15c3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-44e2421e-fe14-4d02-9e8e-d1b5321bb837","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"24615743-6cdb-4dda-868d-f086b0583520","root":false,"$title":"Redireciona para fazer cadastro MInha Claro tv","$position":{"top":"308px","left":"2929px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8ecbb96d-c0f9-4503-a24e-9a28c27b0214":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9bac885b-3573-4c01-b7d8-3b7ae80b1628","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6097f8a9-74ea-493c-a7bb-0d74645d4247","type":"Redirect","$title":"Redirect to \"{{config.servicoAutenticacao}}\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturanet#clienteLogado"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d426a966-639b-4332-b349-bb14382f8d12","type":"SetVariable","$title":"Definir variável - suporteNetRedirectMessage = #A.4.0.0.1","$invalid":false,"settings":{"variable":"suporteNetRedirectMessage","value":"#suporteNet;#A.4.0.0.1"},"conditions":[{"source":"input","comparison":"equals","values":["true"]}]},{"$id":"8220ec8a-dc1d-4fa2-bf10-cba5e3888e91","type":"SetVariable","$title":"Definir variável - suporteNetRedirectMessage = #A.4.0","$invalid":false,"settings":{"value":"#suporteNet;#A.4.0","variable":"suporteNetRedirectMessage"},"conditions":[{"source":"input","comparison":"equals","values":["false"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"6274756d-31d5-49e9-8d4e-006c022207c5","$invalid":false},"$tags":[{"id":"blip-tag-a304eff7-7dd1-40fb-9c7e-7177ba7cf40e","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-c2429bce-b2d0-400a-bf8a-b6c13ef67d7a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9bed24ae-1775-41b3-b73b-24b2e6ff4183","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"8ecbb96d-c0f9-4503-a24e-9a28c27b0214","root":false,"$title":"Usuario inadimplente Verifica logado","$position":{"top":"1095px","left":"8119px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"914291a2-24b3-40ba-91a1-992e7abbb076":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"493d9d92-9520-4ecb-9f3a-2ec133401e96","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1828","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false,"$id":"2cc1b15c-7930-43a1-b7dc-4a161a96293c"},{"stateId":"07e22cc5-0aca-4f74-8296-d99e6eaa6a5f","$connId":"con_1833","conditions":[{"source":"input","comparison":"equals","values":["#menu"]}],"$invalid":false,"$id":"4fe89074-cab7-4245-88fc-fe534874785d"},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1838","conditions":[{"source":"input","comparison":"equals","values":["#finalizacao"]}],"$invalid":false,"$id":"657f4f87-aac7-4675-9ac5-579369124185"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1843","conditions":[{"source":"input","comparison":"equals","values":["#ajudaAutenticacao"]}],"$invalid":false,"$id":"f700bf34-711d-4004-b2d2-ec48afbad004"},{"stateId":"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7","$connId":"con_1848","$id":"9dfd60a2-e083-4920-982e-41fd03de0112","conditions":[{"source":"input","comparison":"equals","values":["#retorno"]},{"source":"context","comparison":"equals","variable":"chooseAnswer@content","values":["Pegar o codigo de barras"]}],"$invalid":false},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1853","$id":"0d58722e-4911-48a1-8098-6638495a2d39","conditions":[{"source":"input","comparison":"equals","values":["#retorno"]},{"source":"context","comparison":"equals","variable":"chooseAnswer@content","values":["Ajuda com login"]}],"$invalid":false},{"stateId":"6480aa60-f028-4650-a2b9-5d3a41a0fde5","$connId":"con_1858","$id":"59f098cb-964a-48bc-a2d6-a15d11ed1053","conditions":[{"source":"input","comparison":"equals","values":["#retorno"]},{"source":"context","comparison":"equals","variable":"chooseAnswer@content","values":["Voltar ao menu"]}],"$invalid":false},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","$connId":"con_1863","$id":"9f5e0f6d-7c04-49da-9020-d994d8c0a203","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"a0921d01-fdb8-43a9-a581-fcd07be470fc","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento) {\n    var channel = 'Claro Residencial';\n    if(tipoAtendimento == 'tv') {\n        channel = 'Claro TV';\n    }\n\n    var date = new Date();\n    return {\n         name: 'Segunda via',\n        channel: channel,\n        text: 'com a segunda via',\n        date: date\n    }\n}","inputVariables":["tipoAtendimento"],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bfb4ec96-7b11-4504-bc8a-94bd1647650c","$typeOfContent":"","type":"ExecuteScript","$title":"loginOptions","$invalid":false,"settings":{"function":"run","source":"function run(tipoAtendimento, isBusinessClient) {\n    try {\n        isBusinessClient = JSON.parse(isBusinessClient);\n    } catch (e) {\n        isBusinessClient = false;\n    }\n\n    let menuOrigem;\n    switch (tipoAtendimento) {\n        case 'residencial':\n            menuOrigem = isBusinessClient ? 'Empresas' : 'Residencial';\n            break;\n\n        case 'tv':\n            menuOrigem = 'Claro TV';\n            break;\n\n        default:\n            menuOrigem = 'Residencial';\n    }\n\n    return {\n        templateText: 'Para te enviar sua fatura',\n        menu: `Ou, *se preferir*, escolha uma das opções:\\n\\n*1-* Pegar o código de barras (sem login)\\n*2-* Ajuda com login\\n*3-* Voltar ao Menu ${menuOrigem}\\n*4-* Sair`,\n        options: [\n            {\n                content: 'Pegar o codigo de barras',\n                regex: 'c[oó]digo(\\\\s*(de\\\\s*)?barras)?',\n            },\n            {\n                content: 'Ajuda com login',\n                regex: 'ajuda',\n            },\n            {\n                content: `Voltar ao menu`,\n                regex: 'voltar?|menu',\n            },\n            {\n                content: 'Sair',\n                regex: 'sair?',\n            },\n        ],\n        trackingExhibition: 'Teste login Segunda Via net exibicao',\n        trackingOption: 'Teste login Segunda Via net selecao',\n        trackingInput: 'Teste login Segunda Via net input',\n    };\n}\n","inputVariables":["tipoAtendimento","isBusinessClient"],"outputVariable":"loginOptions","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"Redirect","$title":"LoginOptions","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#loginWithOptions#v2"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"segunda via\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3500a05d-f5a3-42fe-9f89-379afa692592","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-3158f497-8e66-489e-b45b-725081adf7af","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a10b5a71-767b-41d5-8d4e-330046a65c68","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-91a211e8-cac0-44f7-8597-b4af3646ba60","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"914291a2-24b3-40ba-91a1-992e7abbb076","root":false,"$title":"Redireciona para login Segunda Via","$position":{"top":"1005px","left":"1744px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"223190f0-83ff-445f-b688-15f8ef91d1da":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a1c15d24-c702-4f60-af48-59c9d28589e3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5694ad5f-d151-4800-804f-6396eb3b3aa6","typeOfStateId":"state","$connId":"con_1868","$id":"841670cf-3b23-49c5-8377-adeecad608a6","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"segundaViaSemLoginStatus"}],"$invalid":false},{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","typeOfStateId":"state","$connId":"con_1873","$id":"993acd6d-a80b-4bda-892b-fac9f5d70650","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"segundaViaSemLoginStatus"}],"$invalid":false},{"stateId":"1634fb92-e457-48f6-b950-432708d7f434","typeOfStateId":"state","$connId":"con_1878","$id":"a5265020-e175-434b-9097-d891fa246ea4","conditions":[{"source":"context","comparison":"equals","values":["Alexa"],"variable":"activeTemplateVar@SourceType"}],"$invalid":false},{"stateId":"127ef2ea-236c-4042-b212-dfb3c3550ac7","typeOfStateId":"state","$connId":"con_1883","$id":"9f473b3f-1850-423c-a7c4-8be201551508","conditions":[{"source":"context","comparison":"equals","values":["Ura"],"variable":"activeTemplateVar@SourceType"},{"source":"context","comparison":"notEquals","variable":"pdfInfo","values":["error"]},{"source":"context","comparison":"equals","variable":"segundaViaSemLoginStatus1Pdf","values":["200"]}],"$invalid":false},{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","typeOfStateId":"state","$connId":"con_1888","$id":"81ec23af-14e2-49c0-bfc7-8fc590035009","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"segundaViaSemLoginStatus1Pdf"},{"source":"context","comparison":"equals","variable":"activeTemplateVar@SourceType","values":["Ura"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"abfecf3d-b9e7-436f-94b9-92d2aeb9626d","$typeOfContent":"","type":"ExecuteScript","$title":"pdfInfo","$invalid":false,"settings":{"function":"run","source":"function run(activeTemplateVar) {\n    try {\n        activeTemplateVar = JSON.parse(activeTemplateVar)\n        var map = {}\n        for (var i = 0; i < activeTemplateVar.RedirectParameters.length; i++) {\n            [invoiceId, barcode] = activeTemplateVar.RedirectParameters[i].Value.split(\"|\")\n            map[`invoiceId${i + 1}`] = invoiceId\n            map[`barcode${i + 1}`] = barcode\n        }\n        map['count'] = activeTemplateVar.RedirectParameters.length\n        return map\n    } catch (e) {\n        return \"error\" \n    }\n}","inputVariables":["activeTemplateVar"],"outputVariable":"pdfInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"activeTemplateVar@SourceType","values":["Ura"]}]},{"$id":"d2ed9282-c46f-4f1f-88e8-afa968fb26b2","$typeOfContent":"","type":"ProcessHttp","$title":"segundaViaSemLogin","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiGeeKey}}"},"method":"POST","body":"{\n    \"idBill\": \"{{pdfInfo@invoiceId1}}\",\n    \"contract\": \"{{activeTemplateVar@ContractNumber}}\"\n}\n","uri":"{{config.apiUrl}}/SecondInvoice/second-invoice-link","responseStatusVariable":"segundaViaSemLoginStatus1Pdf","responseBodyVariable":"segundaViaSemLoginResponse1Pdf"},"conditions":[{"source":"context","comparison":"equals","variable":"activeTemplateVar@SourceType","values":["Ura"]}]},{"$id":"eb023d3f-6990-449c-9007-ce077b1dc6d4","$typeOfContent":"","type":"SetVariable","$title":"cpfInformado","$invalid":false,"settings":{"variable":"cpfInformado","value":"{{activeTemplateVar@DocumentNumber}}"},"conditions":[{"source":"context","comparison":"notEquals","variable":"segundaViaSemLoginStatus1Pdf","values":["200"]}]},{"$id":"8b92f196-185d-4a5c-80b6-6118798b136d","$typeOfContent":"","type":"ExecuteScript","$title":"secondInvoiceId","$invalid":false,"settings":{"function":"run","source":"function run(activetemplate) {\n    var redirectParameters = JSON.parse(activetemplate).RedirectParameters;\n    \n    var invoiceId = redirectParameters.find(rp => /(invoiceid)/gi.test(rp.Key)).Value;\n\n    return invoiceId.padStart(15, '0');\n}","inputVariables":["activeTemplateVar"],"outputVariable":"secondInvoiceId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bf4e97cf-4fdd-49bd-aaa0-a082d24c28d4","$typeOfContent":"","type":"ProcessHttp","$title":"segundaViaSemLoginResponse","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiGeeKey}}"},"method":"POST","body":"{\n    \"idBill\": \"{{secondInvoiceId}}\",\n    \"contract\": \"{{activeTemplateVar@ContractNumber}}\"\n}\n","uri":"{{config.apiUrl}}/SecondInvoice/second-invoice-link","responseStatusVariable":"segundaViaSemLoginStatus","responseBodyVariable":"segundaViaSemLoginResponse"},"conditions":[]},{"$id":"eed4128c-7eed-4324-b8ed-08636f1ddf34","$typeOfContent":"","type":"SetVariable","$title":"cpfInformado","$invalid":false,"settings":{"variable":"cpfInformado","value":"{{activeTemplateVar@DocumentNumber}}"},"conditions":[{"source":"context","variable":"segundaViaSemLoginStatus","comparison":"notEquals","values":["200"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-44b1108d-7742-4b05-bd52-bf5c05a75249","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-102b01d7-0530-4429-8acb-eeddfec8946b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-43a80ee5-da53-4138-9bfd-ee00efd0f9dc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"223190f0-83ff-445f-b688-15f8ef91d1da","root":false,"$title":"Segunda via sem login","$position":{"top":"2103.67px","left":"3261.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0ac697d8-de30-4ae4-a7f8-b0619981a84c":{"$contentActions":[{"action":{"$id":"ee8bc9be-1f92-4994-a554-5f83c6b466b8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5613ec2d-5d27-417d-84f9-09c7286f1a58","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"},"metadata":{}},"$cardContent":{"document":{"id":"5613ec2d-5d27-417d-84f9-09c7286f1a58","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0ffc2992-ca7f-4139-8836-51e3a1393bf2","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/vnd.lime.media-link+json","rawContent":"{\n        \"title\": \"segundavia.pdf\",\n        \"uri\": \"{{segundaViaSemLoginResponse}}\",\n        \"type\": \"application/pdf\"\n}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"58a33d13-e52c-4497-9539-be49d7ace6f2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"7d3020aa-1418-48a5-8241-31dd524efd24","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"894994d6-8dc6-4a11-9593-91b00288c033","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"10000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"894994d6-8dc6-4a11-9593-91b00288c033","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"10000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e4a427d-3377-412d-a98f-3405742a4147","$connId":"con_1893","$id":"4f393b45-875b-489f-8d7b-f6042562e2d7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-6a29b837-76e9-406c-ae6f-94346a61229c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0ac697d8-de30-4ae4-a7f8-b0619981a84c","root":false,"$title":"Visualização do PDF 2 via sem login - Alexa","$position":{"top":"2427.67px","left":"3101.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9b64a273-3663-471a-9748-9c3516aacb39":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"39aba8f6-230f-4ca0-8c9b-d53c4a6f4727","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to F.0.1","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#finalizacao F.0.1"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-5ed4047b-f4bb-4a09-a626-cc64a017b225","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"9b64a273-3663-471a-9748-9c3516aacb39","root":false,"$title":"Redireciona para finalizacao F.0.1","$position":{"top":"132.667px","left":"3173px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a4e576de-5fb7-45e4-8bc8-87d24925e64e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"39aba8f6-230f-4ca0-8c9b-d53c4a6f4727","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to F.1.6","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#finalizacao F.1.6"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-b6c9d432-5fa9-49de-a625-a7fc76243048","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"a4e576de-5fb7-45e4-8bc8-87d24925e64e","root":false,"$title":"Redireciona para finalizacao F.1.6","$position":{"top":"270px","left":"3173px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"47a05807-b24b-409b-ab06-e66f7d15089b":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"7d3c310d-0195-4a1c-b79b-695406ca15c1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-9e9c09e9-3f46-4c67-b698-423c57f7e424","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"47a05807-b24b-409b-ab06-e66f7d15089b","root":false,"$title":"a.1.2.2","$position":{"top":"456.96px","left":"2179.52px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9e6b570f-23d6-419f-a60e-0ea4bd24bc89":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0828851c-3d7a-4132-bff9-0085d7d187be","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"16202832-fe0f-4061-a87d-979df4ff9e2d","typeOfStateId":"state","$connId":"con_1898","$id":"f887d2d5-efdf-4f6f-b186-b8a2c0a7075c","conditions":[{"source":"input","comparison":"equals","values":["true"]}],"$invalid":false},{"stateId":"f0c999b6-0441-4cdc-958e-b097ed7fa503","typeOfStateId":"state","$connId":"con_1903","$id":"f9bebe27-789c-47d6-8b43-47f8e8a30b61","conditions":[{"source":"input","comparison":"equals","values":["false"]}],"$invalid":false},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","typeOfStateId":"state","$connId":"con_1908","$id":"8f39f74c-17c2-4746-b69d-3aab1482fb09","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"36a78ff3-1054-4557-ae4a-df1d2116b73e","$typeOfContent":"","type":"Redirect","$title":"#faturaNet#clienteLogado","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#clienteLogado"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]},{"$id":"3a28195b-6ee4-43d2-9128-1b7398480971","$typeOfContent":"","type":"SetVariable","$title":"Definir Pular Incentivo Ecom","$invalid":false,"settings":{"variable":"pularIncentivoEcom","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-f749cfd6-ec1c-4e9c-90bb-fe51d662303f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-77d63625-074b-478f-a1cf-98097eb28bf2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b702e30d-220c-47b0-8b59-33ab9fee3858","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"9e6b570f-23d6-419f-a60e-0ea4bd24bc89","root":false,"$title":"Cliente já está logado? Promessa de pagamento","$position":{"top":"269.333px","left":"7764px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c34400fa-7e75-4be1-9866-0a3b460e363a":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0828851c-3d7a-4132-bff9-0085d7d187be","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5e11a338-7db9-4223-bac6-e0ff5abc72a3","typeOfStateId":"state","$connId":"con_1913","$id":"f887d2d5-efdf-4f6f-b186-b8a2c0a7075c","conditions":[{"source":"input","comparison":"equals","values":["true"]}],"$invalid":false},{"stateId":"c1822311-3d36-42d2-a8b7-6d5c7bae0555","typeOfStateId":"state","$connId":"con_1918","$id":"f9bebe27-789c-47d6-8b43-47f8e8a30b61","conditions":[{"source":"input","comparison":"equals","values":["false"]}],"$invalid":false},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","typeOfStateId":"state","$connId":"con_1923","$id":"8f39f74c-17c2-4746-b69d-3aab1482fb09","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"36a78ff3-1054-4557-ae4a-df1d2116b73e","$typeOfContent":"","type":"Redirect","$title":"#faturaNet#clienteLogado","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#clienteLogado"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8a2bc92c-b82a-4e76-b3ff-22d5abe47052","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-e02af202-0eed-453c-8968-531696737d1b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c34400fa-7e75-4be1-9866-0a3b460e363a","root":false,"$title":"Cliente já está logado? Debito Automático","$position":{"top":"842.667px","left":"5786.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1721c199-eecf-4ce4-a700-822d0b0d308a":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"502fc8e9-7c0c-4325-ae2d-6e7bccd01d81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_1928","conditions":[{"source":"input","comparison":"equals","values":["#finalizacao"]}],"$invalid":false,"$id":"6593322d-61b7-4a58-bfd8-bc4fa7cc7689"},{"stateId":"07e22cc5-0aca-4f74-8296-d99e6eaa6a5f","$connId":"con_1933","conditions":[{"source":"input","comparison":"equals","values":["#menu"]}],"$invalid":false,"$id":"bf655b60-e07d-47ae-b207-8247915e3d0b"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_1938","conditions":[{"source":"input","comparison":"equals","values":["#AjudaAutenticacao"]}],"$invalid":false,"$id":"0b26515d-88e2-42d9-b157-a8294ab7b66a"},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_1943","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false,"$id":"110f1298-ea5d-4de7-a254-51da76b06d31"},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","typeOfStateId":"state","$connId":"con_1948","$id":"9d49873a-9f0d-4ea1-a340-53a9a3bddcaa","conditions":[{"source":"context","comparison":"equals","values":["Ajuda com login"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"ec3bf851-2c33-462b-bbe5-1b027fe47da4","typeOfStateId":"state","$connId":"con_1953","$id":"2b9d3a54-e318-4288-9eb2-af106aa879df","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","typeOfStateId":"state","$connId":"con_1958","$id":"fa297966-edc0-403e-8215-9914834fe626","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"907a475c-a58c-46fa-b053-5cce0a489e1c","$typeOfContent":"","type":"ExecuteScript","$title":"loginOptions","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return {\n        templateText: 'Para te ajudar com esse assunto',\n        menu: 'Ou, *se preferir*, escolha uma das opções:\\n\\n*1-* Ajuda com o login\\n*2-* Voltar ao Menu anterior\\n*3-* Sair',\n        options: [\n            {\n                content: 'Ajuda com login',\n                regex: 'ajuda',\n            },\n            {\n                content: `Voltar ao menu`,\n                regex: 'voltar?|menu',\n            },\n            {\n                content: 'Sair',\n                regex: 'sair?',\n            },\n        ],\n        trackingExhibition: 'exibicao',\n        trackingOption: 'selecao',\n        trackingInput: 'input',\n    };\n}\n","inputVariables":[],"outputVariable":"loginOptions","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"Redirect","$title":"Redirect to \"{{config.servicoAutenticacao}}\"","$invalid":false,"settings":{"address":"{{config.servicoAutenticacao}}","context":{"type":"text/plain","value":"#faturaNet#loginWithOptions#v2"}},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ce967266-c793-4e80-91ac-97bf3584d129","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-6ba9fc6b-8aee-45e0-b29d-fa3b591da531","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-06aa4fcb-7191-4952-9c12-aeb5e7556b90","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-f446f319-1bdb-4902-9410-c32205387433","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1721c199-eecf-4ce4-a700-822d0b0d308a","root":false,"$title":"Redireciona login alterar/cancelar débito automáti","$position":{"top":"466.333px","left":"6796px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"188960e0-a8b3-4da5-8c2a-d60e6edc77f4":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"130078ea-bce4-43f4-919c-48a770011308","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"623439a2-a13c-448d-8b83-75b8d7a4aef6","typeOfStateId":"state","$connId":"con_1963","$id":"412d5226-4e0b-403c-9a21-3c076da5d3ac","conditions":[{"source":"input","comparison":"equals","values":["true"]}],"$invalid":false},{"stateId":"ecb44e13-a078-448a-a65e-6bec925fd244","typeOfStateId":"state","$connId":"con_1968","$id":"d9fb5bc9-114f-46d1-bf06-a7df5aec733d","conditions":[{"source":"input","comparison":"equals","values":["false"]}],"$invalid":false},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","typeOfStateId":"state","$connId":"con_1973","$id":"40948f5f-ecc7-4024-9168-dae30677c45e","conditions":[{"source":"input","comparison":"equals","values":["Erro"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"917286ec-0e02-4b58-90cb-bb0e58f8bf31","$typeOfContent":"","type":"Redirect","$title":"#faturaNet#clienteLogado","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#clienteLogado"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-4a21ab7f-fc3d-44a7-951c-9300413794a4","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-5fa4136d-c389-452d-b6db-1c03fbc74735","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"188960e0-a8b3-4da5-8c2a-d60e6edc77f4","root":false,"$title":"Cliente já está logado? Alterar Vencimento","$position":{"top":"533.75px","left":"9181.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2b5affcc-9e73-4afe-abca-aa0b2cf8b3c7":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0828851c-3d7a-4132-bff9-0085d7d187be","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"71985007-21d4-4857-a4e2-b12b5dbbbfc0","typeOfStateId":"state","$connId":"con_1978","$id":"f887d2d5-efdf-4f6f-b186-b8a2c0a7075c","conditions":[{"source":"input","comparison":"equals","values":["true"]}],"$invalid":false},{"stateId":"a3e28dd4-d521-4ea4-8cab-6d1a0f79a982","typeOfStateId":"state","$connId":"con_1983","$id":"f9bebe27-789c-47d6-8b43-47f8e8a30b61","conditions":[{"source":"input","comparison":"equals","values":["false"]}],"$invalid":false},{"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","typeOfStateId":"state","$connId":"con_1988","$id":"8f39f74c-17c2-4746-b69d-3aab1482fb09","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"36a78ff3-1054-4557-ae4a-df1d2116b73e","$typeOfContent":"","type":"Redirect","$title":"#faturaNet#clienteLogado","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#clienteLogado"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-0b309522-ee81-4f4c-8674-ecbc1330cc24","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-2c5c9811-0ce1-4d6b-938c-252da6e6241c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2b5affcc-9e73-4afe-abca-aa0b2cf8b3c7","root":false,"$title":"Cliente já está logado? Fatura Digital","$position":{"top":"299px","left":"3831px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6f8733d1-4561-4f90-8be8-5bf2174a1355":{"$contentActions":[{"action":{"$id":"ee8bc9be-1f92-4994-a554-5f83c6b466b8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5613ec2d-5d27-417d-84f9-09c7286f1a58","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"},"metadata":{}},"$cardContent":{"document":{"id":"5613ec2d-5d27-417d-84f9-09c7286f1a58","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0ffc2992-ca7f-4139-8836-51e3a1393bf2","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{InvoiceWithoutComponent@type}}","rawContent":"{{InvoiceWithoutComponent@content}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"58a33d13-e52c-4497-9539-be49d7ace6f2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"7d3020aa-1418-48a5-8241-31dd524efd24","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"894994d6-8dc6-4a11-9593-91b00288c033","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"894994d6-8dc6-4a11-9593-91b00288c033","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"9e6fb110-a14f-4c07-91a9-0c3ec79715fd","$typeOfContent":"","type":"ExecuteScript","$title":"InvoiceWithoutComponent","$invalid":false,"settings":{"function":"run","source":"function run(activeTemplateVar, baseUrl) {\n  \n  let activeTemplate = JSON.parse(activeTemplateVar);\n\n  let contractNumber = activeTemplate.ContractNumber.replace(\"/\", \"%2F\");\n\n  const whatsAppMenu = {\n    \"title\": \"fatura.pdf\",\n    \"uri\": `${baseUrl}/SecondInvoice/${activeTemplate.RedirectParameters.invoiceId[0]}/${contractNumber}`,\n    \"type\": \"application/pdf\"\n  }\n\n  return {\n    'type': 'application/vnd.lime.media-link+json',\n    'content': whatsAppMenu,\n  }\n}","inputVariables":["activeTemplateVar","config.apiUrl"],"outputVariable":"InvoiceWithoutComponent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-e6760e78-bf68-477b-bdc2-00c5b0555399","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e45d6b9f-a939-4c01-844f-69b1725cb02d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6f8733d1-4561-4f90-8be8-5bf2174a1355","root":false,"$title":"Visualização do PDF 2 via sem login [NOVO]","$position":{"top":"284.286px","left":"1133.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1634fb92-e457-48f6-b950-432708d7f434":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a1c15d24-c702-4f60-af48-59c9d28589e3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","$connId":"con_1993","$id":"32b9019c-573d-4f10-bed5-d02118b474f7","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"segundaViaSemLoginStatus"}],"$invalid":false,"typeOfStateId":"state"},{"stateId":"0ac697d8-de30-4ae4-a7f8-b0619981a84c","$connId":"con_1998","$id":"94bbb83c-4e43-4d80-94c9-1bd95f060fbe","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"segundaViaSemLoginStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"33de76ca-993c-4f40-bfc2-3ec0abd4ced6","$typeOfContent":"","type":"ExecuteScript","$title":"secondInvoiceId","$invalid":false,"settings":{"function":"run","source":"function run(activetemplate) {\n    var redirectParameters = JSON.parse(activetemplate).RedirectParameters;\n    \n    var invoiceId = redirectParameters.find(rp => /(invoiceid)/gi.test(rp.Key)).Value;\n\n    return invoiceId.padStart(15, '0');\n}","inputVariables":["activeTemplateVar"],"outputVariable":"secondInvoiceId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dae49789-737f-417c-b867-88f9d1a9719e","$typeOfContent":"","type":"ProcessHttp","$title":"segundaViaSemLoginResponse","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiGeeKey}}"},"method":"POST","body":"{\n    \"idBill\": \"{{secondInvoiceId}}\",\n    \"contract\": \"{{activeTemplateVar@ContractNumber}}\"\n}\n","uri":"{{config.apiUrl}}/SecondInvoice/second-invoice-link","responseStatusVariable":"segundaViaSemLoginStatus","responseBodyVariable":"segundaViaSemLoginResponse"},"conditions":[]},{"$id":"0ed0027e-aa3b-42a6-80a4-d9af03463af2","$typeOfContent":"","type":"SetVariable","$title":"cpfInformado","$invalid":false,"settings":{"variable":"cpfInformado","value":"{{activeTemplateVar@DocumentNumber}}"},"conditions":[{"source":"context","variable":"segundaViaSemLoginStatus","comparison":"notEquals","values":["200"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-ba5df38f-3aac-4c23-b646-7376e9f99198","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6bd05c81-ad48-4585-b9a0-61f68680c8fd","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-60e1e996-fe9e-471a-a5d6-492f20649fb9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"1634fb92-e457-48f6-b950-432708d7f434","root":false,"$title":"Segunda via sem login  - Alexa","$position":{"top":"2289.33px","left":"3100px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e4a427d-3377-412d-a98f-3405742a4147":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fecdd8d2-4f04-4aa2-97d1-21fa90ee08de","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"0e4a427d-3377-412d-a98f-3405742a4147","root":false,"$title":"T - Redireciona para finalizacao F.0","$position":{"top":"2633px","left":"3177.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"127ef2ea-236c-4042-b212-dfb3c3550ac7":{"$contentActions":[{"action":{"$id":"6072bd57-9b0a-4a59-94b5-e8ca69b68b0a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f12b9cdb-025a-4cc5-855b-325092ed5a04","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"},"metadata":{}},"$cardContent":{"document":{"id":"f12b9cdb-025a-4cc5-855b-325092ed5a04","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0852ef3e-3d02-47a7-9c6b-f7c7ff66b8ec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{\n      \"type\":\"template\",\n      \"namespace\": \"{{config.namespace}}\",\n      \"template\":{\n         \"name\":\"{{config.templateSegundaViaSemLoginV1}}\",\n         \"language\":{\n            \"code\":\"pt_BR\",\n            \"policy\":\"deterministic\"\n         },\n         \"components\":[\n            {\n                \"type\": \"header\",\n                \"parameters\": [\n                    {\n                        \"type\":\"document\",\n                        \"document\":{\n                           \"filename\":\"segundavia.pdf\",\n                           \"link\":\"{{segundaViaSemLoginResponse2Pdf}}\"\n                        }\n                     }\n                ]\n            },\n            {\n                \"type\": \"body\",\n                \"parameters\": [\n                    {\n                        \"type\": \"text\",\n                        \"text\": \"{{pdfInfo@barcode2}}\"\n                    }\n                   \n                ]\n            }\n          ]\n        }\n    }"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a1c15d24-c702-4f60-af48-59c9d28589e3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","$connId":"con_2003","$id":"32b9019c-573d-4f10-bed5-d02118b474f7","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"segundaViaSemLoginStatus1Pdf"}],"$invalid":false,"typeOfStateId":"state"},{"stateId":"f6b4ccfd-7fbb-47b1-a555-cf3a30531750","typeOfStateId":"state","$connId":"con_2008","$id":"28c3c741-a1d8-449b-b5db-dbfff0eaf3b4","conditions":[{"source":"context","comparison":"greaterThanOrEquals","values":["2"],"variable":"pdfInfo@count"}],"$invalid":false},{"stateId":"0e4a427d-3377-412d-a98f-3405742a4147","typeOfStateId":"state","$connId":"con_2013","$id":"ddf010ee-eb74-4d61-bf25-cfe6d347097d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e3091c8e-44c2-4b94-a8ea-07a9dd86d41a","$typeOfContent":"","type":"ProcessHttp","$title":"segundaViaSemLoginResponse2Pdf","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiGeeKey}}"},"method":"POST","body":"{\n    \"idBill\": \"{{pdfInfo@invoiceId2}}\",\n    \"contract\": \"{{activeTemplateVar@ContractNumber}}\"\n}\n","uri":"{{config.apiUrl}}/SecondInvoice/second-invoice-link","responseStatusVariable":"segundaViaSemLoginStatus2Pdf","responseBodyVariable":"segundaViaSemLoginResponse2Pdf"},"conditions":[{"source":"context","comparison":"greaterThanOrEquals","variable":"pdfInfo@count","values":["2"]}]},{"$id":"1f689721-8ee9-40d2-b1cb-eec6c5ba742b","$typeOfContent":"","type":"ProcessHttp","$title":"segundaViaSemLoginResponse3Pdf","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiGeeKey}}"},"method":"POST","body":"{\n    \"idBill\": \"{{pdfInfo@invoiceId3}}\",\n    \"contract\": \"{{activeTemplateVar@ContractNumber}}\"\n}\n","uri":"{{config.apiUrl}}/SecondInvoice/second-invoice-link","responseStatusVariable":"segundaViaSemLoginStatus3Pdf","responseBodyVariable":"segundaViaSemLoginResponse3Pdf"},"conditions":[{"source":"context","comparison":"equals","variable":"pdfInfo@count","values":["3"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-07548c03-2cee-4d05-86f2-b69cd18fe655","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-f2b68ac8-ec84-4dc6-abed-6c5aad5109f3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"127ef2ea-236c-4042-b212-dfb3c3550ac7","root":false,"$title":"Segunda via sem login  - URA  - 1 PDF","$position":{"top":"2274.33px","left":"3438.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f6b4ccfd-7fbb-47b1-a555-cf3a30531750":{"$contentActions":[{"action":{"$id":"47a406f7-bfa7-41c3-a10a-c897cfb2f0eb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1e05986c-e735-4766-86e2-70b2888e23dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"},"metadata":{}},"$cardContent":{"document":{"id":"1e05986c-e735-4766-86e2-70b2888e23dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a3ab986f-a7db-44ed-9290-cbfb5fc73236","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{\n      \"type\":\"template\",\n      \"namespace\": \"{{config.namespace}}\",\n      \"template\":{\n         \"name\":\"{{config.templateSegundaViaSemLoginV1}}\",\n         \"language\":{\n            \"code\":\"pt_BR\",\n            \"policy\":\"deterministic\"\n         },\n         \"components\":[\n            {\n                \"type\": \"header\",\n                \"parameters\": [\n                    {\n                        \"type\": \"document\",\n                        \"filename\":\"fatura.pdf\",\n                        \"link\":\"{{segundaViaSemLoginResponse2Pdf}}\"\n                    }\n                ]\n            },\n            {\n                \"type\": \"body\",\n                \"parameters\": [\n                    {\n                        \"type\": \"text\",\n                        \"text\": \"{{pdfInfo@barcode2}}\"\n                    }\n                   \n                ]\n            }\n          ]\n        }\n    }"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a1c15d24-c702-4f60-af48-59c9d28589e3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","$connId":"con_2018","$id":"32b9019c-573d-4f10-bed5-d02118b474f7","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"segundaViaSemLoginStatus2Pdf"}],"$invalid":false,"typeOfStateId":"state"},{"stateId":"dc1d6648-78a0-4c0d-8548-462374a7d73a","typeOfStateId":"state","$connId":"con_2023","$id":"9f9873f7-9e3d-4ec2-b0db-2b6a79cfbbea","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"pdfInfo@count"}],"$invalid":false},{"stateId":"0e4a427d-3377-412d-a98f-3405742a4147","typeOfStateId":"state","$connId":"con_2028","$id":"1011549b-c9b6-4144-a323-b9e7b2a550d0","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dae49789-737f-417c-b867-88f9d1a9719e","$typeOfContent":"","type":"ProcessHttp","$title":"segundaViaSemLoginResponse","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiGeeKey}}"},"method":"POST","body":"{\n    \"idBill\": \"{{secondInvoiceId}}\",\n    \"contract\": \"{{activeTemplateVar@ContractNumber}}\"\n}\n","uri":"{{config.apiUrl}}/SecondInvoice/second-invoice-link","responseStatusVariable":"segundaViaSemLoginStatus","responseBodyVariable":"segundaViaSemLoginResponse"},"conditions":[]},{"$id":"2af79119-0704-4837-bd59-8dd07fdd225d","$typeOfContent":"","type":"SetVariable","$title":"cpfInformado","$invalid":false,"settings":{"variable":"cpfInformado","value":"{{activeTemplateVar@DocumentNumber}}"},"conditions":[{"source":"context","comparison":"notEquals","variable":"segundaViaSemLoginStatus2Pdf","values":["200"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-97e6b332-66a5-42e6-8ef9-210c90d39f86","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-88d837d2-6b2a-4b01-a2fc-cd9e79a7f8ca","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3034abdd-8fdf-472b-93ac-ada7eb49c672","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f6b4ccfd-7fbb-47b1-a555-cf3a30531750","root":false,"$title":"Segunda via sem login  - URA  - 2 PDF","$position":{"top":"2753px","left":"4142px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dc1d6648-78a0-4c0d-8548-462374a7d73a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a1c15d24-c702-4f60-af48-59c9d28589e3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"36ae9ed7-6ece-4e0f-a7e1-1101c5d0bc81","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3de7aa72-ba15-4b16-b383-189f4b54e414","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"3de7aa72-ba15-4b16-b383-189f4b54e414","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"93615c27-7f31-4d02-8b67-e21e7fc69da2","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"},"type":"application/json","rawContent":"{\n      \"type\":\"template\",\n      \"namespace\": \"{{config.namespace}}\",\n      \"template\":{\n         \"name\":\"{{config.templateSegundaViaSemLoginV1}}\",\n         \"language\":{\n            \"code\":\"pt_BR\",\n            \"policy\":\"deterministic\"\n         },\n         \"components\":[\n            {\n                \"type\": \"header\",\n                \"parameters\": [\n                    {\n                        \"type\": \"document\",\n                        \"filename\":\"fatura.pdf\",\n                        \"link\":\"{{segundaViaSemLoginResponse3Pdf}}\"\n                    }\n                ]\n            },\n            {\n                \"type\": \"body\",\n                \"parameters\": [\n                    {\n                        \"type\": \"text\",\n                        \"text\": \"{{pdfInfo@barcode3}}\"\n                    }\n                   \n                ]\n            }\n          ]\n        }\n    }"}},"$invalid":false},{"action":{"$id":"5dd391d9-d682-4ed3-8561-7c34c68714b3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fd94bbed-be1a-412a-b626-da7823806a45","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"fd94bbed-be1a-412a-b626-da7823806a45","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"9d3a8018-0997-4fc6-b5c6-cc008416af8c","$connId":"con_2033","$id":"32b9019c-573d-4f10-bed5-d02118b474f7","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"segundaViaSemLoginStatus3Pdf"}],"$invalid":false,"typeOfStateId":"state"},{"stateId":"0e4a427d-3377-412d-a98f-3405742a4147","typeOfStateId":"state","$connId":"con_2038","$id":"177acf3f-4a8e-44cf-ab6a-67fcaebd0feb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dae49789-737f-417c-b867-88f9d1a9719e","$typeOfContent":"","type":"ProcessHttp","$title":"segundaViaSemLoginResponse","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiGeeKey}}"},"method":"POST","body":"{\n    \"idBill\": \"{{secondInvoiceId}}\",\n    \"contract\": \"{{activeTemplateVar@ContractNumber}}\"\n}\n","uri":"{{config.apiUrl}}/SecondInvoice/second-invoice-link","responseStatusVariable":"segundaViaSemLoginStatus","responseBodyVariable":"segundaViaSemLoginResponse"},"conditions":[]},{"$id":"f4e9c2ad-18c0-4b63-a3ee-59d1a3e6fd37","$typeOfContent":"","type":"SetVariable","$title":"cpfInformado","$invalid":false,"settings":{"value":"{{activeTemplateVar@DocumentNumber}}","variable":"cpfInformado"},"conditions":[{"source":"context","comparison":"notEquals","variable":"segundaViaSemLoginStatus3Pdf","values":["200"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-aadbdb11-b99e-4a59-be6c-62bb5532fac6","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-3d8f95d7-0219-432b-a651-56144747eb1a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f2dc246c-14e9-42fb-96d5-5c8e10a158e2","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"dc1d6648-78a0-4c0d-8548-462374a7d73a","root":false,"$title":"Segunda via sem login  - URA  - 3 PDF","$position":{"top":"2543.57px","left":"3440.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5694ad5f-d151-4800-804f-6396eb3b3aa6":{"$contentActions":[{"action":{"$id":"ee8bc9be-1f92-4994-a554-5f83c6b466b8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5613ec2d-5d27-417d-84f9-09c7286f1a58","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"},"metadata":{}},"$cardContent":{"document":{"id":"5613ec2d-5d27-417d-84f9-09c7286f1a58","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"16000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0ffc2992-ca7f-4139-8836-51e3a1393bf2","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/vnd.lime.media-link+json","rawContent":"{\n        \"title\": \"segundavia.pdf\",\n        \"uri\": \"{{segundaViaSemLoginResponse}}\",\n        \"type\": \"application/pdf\"\n}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"58a33d13-e52c-4497-9539-be49d7ace6f2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"7d3020aa-1418-48a5-8241-31dd524efd24","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"894994d6-8dc6-4a11-9593-91b00288c033","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"10000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"894994d6-8dc6-4a11-9593-91b00288c033","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"10000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_2043","$id":"4f393b45-875b-489f-8d7b-f6042562e2d7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-65cdf4d2-6f7e-4c52-8ba4-c7d8026f3c3a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5694ad5f-d151-4800-804f-6396eb3b3aa6","root":false,"$title":"Visualização do PDF 2 via sem login","$position":{"top":"2144px","left":"3616px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e9546479-ce90-4b00-86f0-b26450d04f02":{"$contentActions":[{"action":{"$id":"193c63ad-df85-4cea-992b-a4b172900fe3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3be60118-d928-4029-a8bf-4ad15c708b35","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3be60118-d928-4029-a8bf-4ad15c708b35","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"080183d2-efa9-4065-8176-35cd1c3c0bc7","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f4484b88-85f5-4168-bf28-395baf3a5eb6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fallback","typeOfStateId":"state","$connId":"con_2048","$id":"266414cc-98b2-450e-8fcd-5f01c14df855","conditions":[{"source":"context","comparison":"equals","values":["invalid"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"abcf33d4-6b8e-4e48-b15e-68a202a32549","typeOfStateId":"state","$connId":"con_2053","$id":"a7257440-d16a-4a49-8772-2db32f47106a","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu anterior"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","typeOfStateId":"state","$connId":"con_2058","$id":"4ccb3747-a441-43c4-8ae5-c03020023616","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"4a128f07-979f-47cb-9dc6-b85e6320669e","typeOfStateId":"state","$connId":"con_2063","$id":"6d8f4258-2c99-40b6-acfc-7ac828ea0f71","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"faturas@count"}],"$invalid":false},{"stateId":"adec572d-ea99-4a55-a52e-6d301d7f82dc","typeOfStateId":"state","$connId":"con_2068","$id":"e22d9e00-6981-4a3c-a51c-5a6d09f147d0","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"05719719-d7ae-4b69-94ea-435cbf581087","$typeOfContent":"","type":"ExecuteScript","$title":"set \"userChannel\"","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f8250ac1-ca1e-4456-9ce1-52bc6208f5c0","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"channelBoldTags\"","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"set options","$invalid":false,"settings":{"function":"run","source":"function run(inputFaturas) {\n    try {\n        const faturas = JSON.parse(inputFaturas).invoices;\n        let options = [];\n        faturas.forEach(function (fatura) {\n            var date = formatDate(fatura.paymentDueDate) + ' | R$' + fatura.billAmount.replace('.', ',');\n            // var dateRegex = date.replace('/', '.').replace('|', '.').replace('$', '.').replace(/ /g, '.');\n            // var dateRegex = date.split(\"/\")[0] + \".\" + date.split(\"|\")[0].split(\"/\")[1].trim();\n            var dateRegex = '^' + date.split(\"/\")[0] + '.' + date.split(\"|\")[0].split(\"/\")[1].trim() + '.*' + fatura.billAmount.replace('.', ',') + '$';\n\n            options.push({\n                content: date,\n                regex: dateRegex\n            });\n        })\n        options.push({\n            content: \"Voltar ao menu anterior\",\n            regex: \"Voltar ao menu anterior\"\n        });\n        options.push({\n            content: \"Sair\",\n            regex: \"Sair\"\n        });\n        return JSON.stringify(options);\n    } catch (e) {\n        return null;\n    }\n}\nfunction formatDate(date) {\n    var meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];\n    var data = new Date(date);\n    var mes = meses[data.getMonth()];\n    var ano = data.getFullYear();\n    return mes + '/' + ano;\n}","inputVariables":["faturas"],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"monta opcoes menu","$invalid":false,"settings":{"function":"run","source":"\nfunction run(options) {\n    try {\n        let opcoes = \"\";\n\n        options = JSON.parse(options);\n\n        options.forEach(function (option, idx) {\n            const numeroOpcao = \"\" + (idx + 1);\n            const str = \"*\" + numeroOpcao + \"-* \" + option.content + \"\\n\";\n            opcoes += str;\n        })\n        \n        return opcoes;\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["options"],"outputVariable":"opcoesMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9b35d0fd-4ee0-4b5c-b305-77a5b4b309bf","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        button: 'Faturas em aberto',\n        text:  `Você possui *mais de uma fatura em aberto*. Para facilitar, basta tocar no botão abaixo e me dizer sobre qual fatura você deseja obter informações. 👇 `,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: false,\n        hasWppListMenu: true,\n        isBlipImmediateMenu: false,\n    };\n\n    let menu = createMenu(props, config);\n    \n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"21a28755-3f08-4c1e-be21-01f872136f40","type":"TrackEvent","$title":"Codigo barras residencial faturas abertas validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Codigo barras residencial faturas abertas validacao","action":"Sim"},"conditions":[]},{"$id":"9676d4c2-98f2-40c1-90d8-3efff2c96ab0","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas abertas mais 1 validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas abertas mais 1 validacao","action":"Sim"},"conditions":[]},{"type":"TrackEvent","$title":"Codigo barras residencial faturas abertas mais 1 exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}","BotId":"{{tunnel.destination}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}"},"category":"Codigo barras residencial faturas abertas mais 1 exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptions, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptions);\n    // input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:´`=+&%#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - Update lastState","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return \"mais de uma fatura em aberto\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"lastState","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"63fdbc4b-c905-439b-90f7-c797b146fc67","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"inputContentSubstring\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n\treturn input.substring(0, 255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a4291a7e-a6ed-4246-832f-b7c81e910e45","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas abertas mais 1 selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas abertas mais 1 selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"45c6fd36-ba02-4f7e-b940-8f62d90a6cbc","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas abertas mais 1 inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas abertas mais 1 inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@content","values":["input inesperado"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-b7218760-de9f-4fc2-8196-a21ccf3591e1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c1096a7b-fe06-4173-b550-740da2371244","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d9d7df23-8269-498c-8757-ed4e7d0c683c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-8f0e3e6d-73c2-4877-883c-0161d4bba27f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"e9546479-ce90-4b00-86f0-b26450d04f02","root":false,"$title":"[CBR.1.0.0] Mais de uma fatura em aberto","$position":{"top":"742px","left":"314px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"00c5791e-5945-4271-aba9-044bf54b4849":{"$contentActions":[{"action":{"$id":"8921f974-4d55-48a0-bc71-2314a2230703","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2a5274d2-9e3d-4af4-b174-d2615c14580b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2a5274d2-9e3d-4af4-b174-d2615c14580b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"06682587-2be8-411d-baca-796d89a8e57e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"35ffa1b1-cd1b-4085-b185-9f3f6233e0ac","type":"text/plain","content":"{{fatura@billCode}}","metadata":{}},"$cardContent":{"document":{"id":"35ffa1b1-cd1b-4085-b185-9f3f6233e0ac","type":"text/plain","content":"{{fatura@billCode}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"54457018-9779-4660-aaba-64a3cb4d5b57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","typeOfStateId":"state","$connId":"con_2073","$id":"97c6d77b-0b4d-45a3-9230-4431485c94e9","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"faturas@count"}],"$invalid":false},{"stateId":"e9546479-ce90-4b00-86f0-b26450d04f02","typeOfStateId":"state","$connId":"con_2078","$id":"b7dd970e-098c-470f-a5ff-9732efeadb06","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"faturas@count"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ec60b622-a1cd-4905-91f8-8c1415fe40d6","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial cod barr validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial cod barr validacao","action":"Sim"},"conditions":[{"source":"context","comparison":"equals","variable":"faturas@count","values":["1"]}]},{"$id":"6a3e4e9c-e528-4fed-8662-7b3246547870","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial cod barr validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial cod barr validacao","action":"nao"},"conditions":[{"source":"context","comparison":"notEquals","variable":"faturas@count","values":["1"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-82504c8e-145e-438f-9a59-4e17a0a412ea","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-383fd529-ff58-4d8c-b310-dc6cfa2bbc8e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"00c5791e-5945-4271-aba9-044bf54b4849","root":false,"$title":"[CBR.1.0.2] Exibe o código de barras","$position":{"top":"1084px","left":"318px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"adec572d-ea99-4a55-a52e-6d301d7f82dc":{"$contentActions":[{"action":{"$id":"f13258c8-cf65-4230-bbfc-c8dc9117a972","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fcfa951e-b73e-469c-9b76-c4de4afdaa5c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fcfa951e-b73e-469c-9b76-c4de4afdaa5c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"45c9dccc-ef0f-497a-9411-e3bd86534549","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"83b47801-a418-442b-abbb-1ad5d4105441","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"00c5791e-5945-4271-aba9-044bf54b4849","typeOfStateId":"state","$connId":"con_2083","$id":"cedcfd0e-357e-4255-a4f0-04eaada4ba48","conditions":[{"source":"context","comparison":"equals","values":["Código de barras"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"e9546479-ce90-4b00-86f0-b26450d04f02","typeOfStateId":"state","$connId":"con_2088","$id":"10c24186-1485-4179-9d56-edbb40fdb3ea","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","typeOfStateId":"state","$connId":"con_2093","$id":"1297e5b7-aede-453c-8e77-9624533fe4d9","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7f1767ad-3a9f-4ff9-95ac-5f13aedc3fe5","$typeOfContent":"","type":"ExecuteScript","$title":"Monta obj fatura","$invalid":false,"settings":{"function":"run","source":"function run(faturas, chooseAnswer) {\n    let option = JSON.parse(chooseAnswer).option\n    let fatura = JSON.parse(faturas).invoices[option - 1];\n\n    try {\n        if (fatura.customerAccountId.indexOf('021') == 0) {\n            fatura.service = 'Claro TV';\n        } else {\n            fatura.service = 'Claro Residencial (NET)';\n        }\n\n        var vencimentoArray = fatura.paymentDueDate.split('-');\n        if (vencimentoArray.length == 3) {\n            var vencimento = vencimentoArray[2] + '/' + vencimentoArray[1] + '/' + vencimentoArray[0]\n        } else {\n            vencimento = vencimentoArray;\n        }\n\n        fatura['vencimento'] = vencimento;\n    }\n    catch (e) {\n        \n    }\n\n    return fatura;\n}","inputVariables":["faturas","chooseAnswer"],"outputVariable":"fatura","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9fff357e-a3e4-41e2-8cd2-2444329919c4","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"userChannel\"","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1bad66d4-b9a0-46a1-8760-0404ae21a7ef","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"channelBoldTags\"","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6e3df537-1546-4b6c-8b7a-cf27ca90a76d","$typeOfContent":"","type":"ExecuteScript","$title":"Set  \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return options = JSON.stringify([\n        {\n            content: \"Código de barras\",\n            regex: \"c[óo]digo.de.barra\",\n        },\n        {\n            content: \"Voltar ao menu\",\n            regex: \"volta(r|).ao.menu\",\n        },\n        {\n            content: \"Sair\",\n            regex: \"sai(|r)\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c6f5bdc4-4f7e-4ceb-85ab-11dc21c5773e","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        text: `${channelBoldTags.open}Fatura {{fatura@service}}${channelBoldTags.close}\nVencimento: ${channelBoldTags.open}{{fatura@vencimento}}${channelBoldTags.close} 🗓️\nValor: ${channelBoldTags.open}R$ {{fatura@billAmount}}${channelBoldTags.close} 💰`,\n        //footer: 'Ou digite “voltar” para retornar ao menu anterior.',\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: true,\n        hasWppListMenu: false,\n        isBlipImmediateMenu: true,\n    };\n\n    let menu = createMenu(props, config);\n    \n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1afc4ff1-c452-4e9c-8a65-e6ae4928c2d6","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"0b5a2df0-e2df-4780-bc71-91c013d86cf0","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"chooseAnswer\"","$invalid":false,"settings":{"function":"run","source":"function run(numericOptions, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptions);\n    // input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:´`=+&%#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"71d9f470-4942-4040-b155-2fe52be072e4","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"inputContentSubstring\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n\treturn input.substring(0, 255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"00e6ae70-f25c-4feb-994d-4914b907abf6","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"74c8581a-4943-4405-af8c-826c0dfed207","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@content","values":["input inesperado"]}]},{"$id":"4a3cffd9-88b3-49a3-9df2-7f707fd4e498","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas detalhes","action":"{{fatura@vencimento}} | {{fatura@billAmount}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"fatura"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-fc0bb054-9d14-4338-b0a0-b7e15b51b131","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-83563527-46a7-449e-b5b9-7d07c99824a2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e3602b98-9bed-4fdd-a6c8-bedaef83a05e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-d2221766-3372-4dd9-bce5-fefa94824177","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"adec572d-ea99-4a55-a52e-6d301d7f82dc","root":false,"$title":"[CBR.1.0.1] Exibe fatura","$position":{"top":"905px","left":"143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4a128f07-979f-47cb-9dc6-b85e6320669e":{"$contentActions":[{"action":{"$id":"f13258c8-cf65-4230-bbfc-c8dc9117a972","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fcfa951e-b73e-469c-9b76-c4de4afdaa5c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fcfa951e-b73e-469c-9b76-c4de4afdaa5c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"45c9dccc-ef0f-497a-9411-e3bd86534549","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"83b47801-a418-442b-abbb-1ad5d4105441","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"00c5791e-5945-4271-aba9-044bf54b4849","typeOfStateId":"state","$connId":"con_2098","$id":"cedcfd0e-357e-4255-a4f0-04eaada4ba48","conditions":[{"source":"context","comparison":"equals","values":["Código de barras"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"e9546479-ce90-4b00-86f0-b26450d04f02","typeOfStateId":"state","$connId":"con_2103","$id":"58a2ed17-1c98-4793-a2d9-1f30da4f9363","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","typeOfStateId":"state","$connId":"con_2108","$id":"5f9e60d5-a1e5-487c-b279-9bec1248cbed","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7f1767ad-3a9f-4ff9-95ac-5f13aedc3fe5","$typeOfContent":"","type":"ExecuteScript","$title":"Monta obj fatura","$invalid":false,"settings":{"function":"run","source":"function run(faturas) {\n    let fatura = JSON.parse(faturas).invoices[0];\n\n    try {\n        if (fatura.customerAccountId.indexOf('021') == 0) {\n            fatura.service = 'Claro TV';\n        } else {\n            fatura.service = 'Claro Residencial (NET)';\n        }\n\n        var vencimentoArray = fatura.paymentDueDate.split('-');\n        if (vencimentoArray.length == 3) {\n            var vencimento = vencimentoArray[2] + '/' + vencimentoArray[1] + '/' + vencimentoArray[0]\n        } else {\n            vencimento = vencimentoArray;\n        }\n\n        fatura['vencimento'] = vencimento;\n    }\n    catch (e) {\n        \n    }\n\n    return fatura;\n}","inputVariables":["faturas"],"outputVariable":"fatura","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9fff357e-a3e4-41e2-8cd2-2444329919c4","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"userChannel\"","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1bad66d4-b9a0-46a1-8760-0404ae21a7ef","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"channelBoldTags\"","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6e3df537-1546-4b6c-8b7a-cf27ca90a76d","$typeOfContent":"","type":"ExecuteScript","$title":"Set  \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return options = JSON.stringify([\n        {\n            content: \"Código de barras\",\n            regex: \"c[óo]digo.de.barra\",\n        },\n        {\n            content: \"Voltar ao menu\",\n            regex: \"volta(r|).ao.menu\",\n        },\n        {\n            content: \"Sair\",\n            regex: \"sai(|r)\",\n        }\n    ]);\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c6f5bdc4-4f7e-4ceb-85ab-11dc21c5773e","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        text: `${channelBoldTags.open}Fatura {{fatura@service}}${channelBoldTags.close}\nVencimento: ${channelBoldTags.open}{{fatura@vencimento}}${channelBoldTags.close} 🗓️\nValor: ${channelBoldTags.open}R$ {{fatura@billAmount}}${channelBoldTags.close} 💰`,\n        //footer: 'Ou digite “voltar” para retornar ao menu anterior.',\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: true,\n        hasWppListMenu: false,\n        isBlipImmediateMenu: true,\n    };\n\n    let menu = createMenu(props, config);\n    \n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"794fdccd-5349-4b7f-bba8-efc4ec1bdf27","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial contr encont validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial contr encont validacao","action":"Sim"},"conditions":[]},{"$id":"2d9d5193-4135-4803-a2c6-2edb0209df32","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"547664b6-1ec4-48a9-b7db-27c82a5ef5c0","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"chooseAnswer\"","$invalid":false,"settings":{"function":"run","source":"function run(numericOptions, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptions);\n    // input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:´`=+&%#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"77a87a2c-d37b-4dbd-9e6e-d28dab915658","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"inputContentSubstring\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n\treturn input.substring(0, 255);\n}","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"91319e47-c3bc-4ecb-9d3b-d04fecd3018b","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"add2ea86-985d-4589-814f-eec389bdfb96","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"source":"context","comparison":"equals","variable":"chooseAnswer@content","values":["input inesperado"]}]},{"$id":"f146e2b4-4acd-449e-9521-e337692d3cde","$typeOfContent":"","type":"TrackEvent","$title":"Codigo barras residencial faturas detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Codigo barras residencial faturas detalhes","action":"{{fatura@vencimento}} | {{fatura@billAmount}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"fatura"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-079373d1-caeb-4b29-99d3-c2f24bd2f49c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1c43bf20-ae3c-4356-b6bd-7c4d10dea495","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2302333c-9990-4947-82d8-959b2a9d4190","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-6ff0a413-87fd-40e8-97f1-5df34a48d0aa","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"4a128f07-979f-47cb-9dc6-b85e6320669e","root":false,"$title":"[CBR.1.0.1] Exibe fatura (cenário fatura única)","$position":{"top":"906px","left":"576px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"040d78d2-8415-4a98-80ff-59e74fcc70ef":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"881ae644-2e16-4a91-ac61-612758af1a12","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2218e690-f599-4214-af50-dd42797ac152","typeOfStateId":"state","$connId":"con_2113","$id":"882f45c2-cf6b-4335-8a0f-779f43924293","conditions":[{"source":"context","comparison":"equals","values":["Código Pix"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7","typeOfStateId":"state","$connId":"con_2118","$id":"dd141f96-866c-4e06-88c1-63cf05381024","conditions":[{"source":"context","comparison":"equals","values":["Código de barras"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","typeOfStateId":"state","$connId":"con_2123","$id":"aa90ed6e-6edf-46b9-8c10-114032515ba5","conditions":[{"source":"context","comparison":"equals","values":["Segunda via"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"9e6b570f-23d6-419f-a60e-0ea4bd24bc89","typeOfStateId":"state","$connId":"con_2128","$id":"9f4c56cc-d534-4880-921f-dc800c1396a1","conditions":[{"source":"context","comparison":"equals","values":["Promessa de pagamento"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"2b5affcc-9e73-4afe-abca-aa0b2cf8b3c7","typeOfStateId":"state","$connId":"con_2133","$id":"41b6b283-6e03-47ad-a392-a484cdc13795","conditions":[{"source":"context","comparison":"equals","values":["Fatura digital"],"variable":"chooseAnswer@content"},{"values":["true","false"],"source":"context","comparison":"equals","variable":"isBusinessClient"}],"$invalid":false},{"stateId":"a79bebc7-c116-478f-8d65-42408b0d716b","typeOfStateId":"state","$connId":"con_2138","$id":"620de2de-9a1e-42bc-8f5a-2df08ab61d52","conditions":[{"source":"context","comparison":"equals","values":["Como pagar a Fatura"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"7f115999-665e-4682-9751-389d2ae96718","typeOfStateId":"state","$connId":"con_2143","$id":"4cbad268-4f47-4428-93ab-454990589f3f","conditions":[{"source":"context","comparison":"equals","values":["Alterar vencimento"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"fba7b34e-5fdb-4389-a3cd-c603aedeb9a9","typeOfStateId":"state","$connId":"con_2148","$id":"a1696665-7764-4e5e-a6c4-231386860c53","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu anterior"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"89d3ae9e-1ea6-4172-839e-97f54531fb89","typeOfStateId":"state","$connId":"con_2153","$id":"b9059f76-e490-4a28-8894-a66dfaef2e5b","conditions":[{"source":"context","comparison":"equals","values":["input inesperado"],"variable":"chooseAnswer@content"},{"values":["0"],"source":"context","comparison":"greaterThan","variable":"erroPersistente"}],"$invalid":false},{"stateId":"53d7e972-d324-49a1-97fa-df51250f389e","typeOfStateId":"state","$connId":"con_2158","$id":"521431a2-8c18-40dc-93ab-5b07fc6caec3","conditions":[{"source":"context","comparison":"equals","values":["Débito automático"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"32df0cbc-666a-43cc-a9f6-981167ea2577","$typeOfContent":"","type":"SetVariable","$title":"Set \"lastMenuFaturaRes\"","$invalid":false,"settings":{"variable":"lastMenuFaturaRes","value":"F.1.0.0"},"conditions":[]},{"$id":"dbeb782d-94c0-401d-8103-43609f09c5a1","$typeOfContent":"","type":"ExecuteScript","$title":"Update \"erroPersistente\"","$invalid":false,"settings":{"function":"run","source":"function run(erroPersistente) {\n\terroPersistente = parseInt(erroPersistente);\n\terroPersistente = erroPersistente - 1;\n\treturn erroPersistente;\n}","inputVariables":["erroPersistente"],"outputVariable":"erroPersistente","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[],"$id":"a5d66603-4d6e-463d-b7de-96d19a0d25e3"},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[],"$id":"fe7bd0ce-fbd9-43bf-877d-8a839dcd14f3"},{"$id":"885f3c07-3c81-4c40-a9e9-28adb2753037","$typeOfContent":"","type":"TrackEvent","$title":"Menu fatura residencial net selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Menu fatura residencial net selecao detalhes","action":"{{chooseAnswer@content}} | {{selectedServiceFaturaRes}}"},"conditions":[]},{"$id":"85266d90-4714-4615-84cf-6323082ee35e","$typeOfContent":"","type":"TrackEvent","$title":"Menu fatura residencial net input detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Menu fatura residencial net input detalhes","action":"{{inputContentSubstring}} | {{selectedServiceFaturaRes}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"2124f03b-c6cd-4ab5-b5d1-679cc49bccc4","$typeOfContent":"","type":"TrackEvent","$title":"Menu fatura residencial net selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Menu fatura residencial net selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"0bb793a5-b3af-4af9-9bbc-9c27eb1ac7b8","$typeOfContent":"","type":"TrackEvent","$title":"Menu fatura residencial net input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Menu fatura residencial net input","action":"{{inputContentSubstring}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"2dcb05ae-114d-4043-929c-3b5dffb40c13","$typeOfContent":"","type":"SetVariable","$title":"returnOption","$invalid":false,"settings":{"variable":"returnOption"},"conditions":[{"values":["Voltar ao menu anterior"],"source":"context","comparison":"notEquals","variable":"chooseAnswer@content"}]},{"$id":"12c03624-b511-45bf-afa4-2af62760b2ba","$typeOfContent":"","type":"SetVariable","$title":"set returnOption","$invalid":false,"settings":{"variable":"returnOption","value":"#voltar"},"conditions":[{"values":["Voltar ao menu anterior"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"},{"values":[],"source":"context","comparison":"notExists","variable":"returnOption"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-771456b4-20e2-461a-8bdc-aeb935c46220","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-2acc0a34-e3a4-4df2-9006-4a3b5502252b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8436bf18-0cf9-4c5b-a36a-d210df819820","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-abd17767-7342-48f3-8702-3b7124f8ee05","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"040d78d2-8415-4a98-80ff-59e74fcc70ef","root":false,"$title":"[F.1.0.1] [input] MENU Fatura Residencia","$position":{"top":"344px","left":"10816.6px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f0cc9747-73f0-4fb5-ab29-401f635110a8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c4423677-e38e-4857-89d6-08d03388d3df","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f06f07f8-902f-4f1f-b25a-2a2daca3b747","typeOfStateId":"state","$connId":"con_2163","$id":"b86ee365-3b01-476e-929d-d7775e83e40c","conditions":[{"source":"context","comparison":"equals","values":["0"],"variable":"invoicesCount"}],"$invalid":false},{"stateId":"db27a6cc-abb0-423f-8c80-153a27f9e987","typeOfStateId":"state","$connId":"con_2168","$id":"a493873d-2c22-493c-906f-4ef4035470e9","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d53ee97d-ffb6-4ae3-b077-64f80e34f149","$typeOfContent":"","type":"SetVariable","$title":"Set \"toMock\"","$invalid":false,"settings":{"variable":"toMock","value":"false"},"conditions":[]},{"$id":"0839808a-a18d-4211-b77e-9d34991eca48","$typeOfContent":"","type":"ProcessHttp","$title":"Requisição HTTP \"GetInvoices\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/customerbill/invoices?AccessToken={{tokenAccessFormated}}&document={{document}}&contractNumber={{contractNumber}}&operatorCode={{operatorCode}}&limit=3","responseStatusVariable":"getInvoicesStatus","responseBodyVariable":"getInvoicesBody"},"conditions":[]},{"$id":"18c34fb7-bc60-46c4-8e05-8da6628c5d14","$typeOfContent":"","type":"ExecuteScript","$title":"Mock \"getInvoicesBody\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return {\n        \"traceId\": \"00-d9a60d6800db904d9a2a2207e468fd7f-555ac5fa7287ec47-00\",\n        \"data\": {\n            \"data\": {\n                \"nextInvoiceClosingDate\": \"2023-08-28\",\n                \"daysLateCountFirstOpenInvoice\": 0,\n                \"invoices\": [\n                    {\n                        \"invoiceId\": \"274032999\",\n                        \"amount\": 74.88,\n                        \"dueDate\": \"2023-08-05\",\n                        \"status\": 1,\n                        \"statusDescription\": \"Em Aberto\",\n                        \"barcodeLine\": \"84630000000-3 74880162202-2 30805129000-2 MOCK4032575-4\",\n                        \"barcode\": \"84630000000748801622023080512900000274032575\",\n                        \"customerAccountId\": \"129155504997\",\n                        \"origin\": \"NETSMS\"\n                    },\n                    {\n                        \"invoiceId\": \"272182888\",\n                        \"amount\": 900.84,\n                        \"dueDate\": \"2023-07-08\",\n                        \"status\": 2,\n                        \"statusDescription\": \"Pago\",\n                        \"barcodeLine\": \"84690000000-7 74840162202-6 30708129000-8 MOCK2182032-8\",\n                        \"barcode\": \"84690000000748401622023070812900000272182032\",\n                        \"customerAccountId\": \"129155504997\",\n                        \"origin\": \"NETSMS\"\n                    },\n                    {\n                        \"invoiceId\": \"270439777\",\n                        \"amount\": 200,\n                        \"dueDate\": \"2023-06-05\",\n                        \"status\": 2,\n                        \"statusDescription\": \"Pago\",\n                        \"barcodeLine\": \"84620000002-0 02000162202-4 30605129000-6 MOCK0439071-1\",\n                        \"barcode\": \"84620000002020001622023060512900000270439071\",\n                        \"customerAccountId\": \"129155504997\",\n                        \"origin\": \"NETSMS\"\n                    }\n                ]\n            }\n        },\n        \"errors\": []\n    }\n}","inputVariables":[],"outputVariable":"getInvoicesBody","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"toMock"}]},{"$id":"f7faed8e-d756-40b6-81ac-452639356ef8","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"openInvoices\"","$invalid":false,"settings":{"function":"run","source":"function run(getInvoicesBody) {\n    try {\n        let invoices = JSON.parse(getInvoicesBody).data.data.invoices;\n        let openInvoices = invoices.filter(invoice => invoice.statusDescription == \"Em Aberto\");\n\n        openInvoices = openInvoices.map((invoice) => new Object({\n            invoiceId: invoice.invoiceId,\n            amount: invoice.amount,\n            dueDate: invoice.dueDate,\n            dueDateFormated: formatDate(invoice.dueDate),\n            month: getMonth(invoice.dueDate),\n            year: getYear(invoice.dueDate),\n            pixPayload: null\n        }))\n\n        return openInvoices;\n    } catch (error) {\n        return {\n            hasError: true,\n            flowId: \"Logado Pix\",\n            errorMessage: error.message\n        }\n    }\n}\n\nfunction formatDate(dueDate) {\n    let dateArr = dueDate.split(\"-\")\n    return `${dateArr[2]}/${dateArr[1]}/${dateArr[0]}`\n}\n\nfunction getYear(dueDate) {\n    let dateArr = dueDate.split(\"-\")\n    return dateArr[0]\n}\n\nfunction getMonth(dueDate) {\n    let dateArr = dueDate.split(\"-\")\n    let months = [\n        \"Janeiro\",\n        \"Fevereiro\",\n        \"Março\",\n        \"Abril\",\n        \"Maio\",\n        \"Junho\",\n        \"Julho\",\n        \"Agosto\",\n        \"Setembro\",\n        \"Outubro\",\n        \"Novembro\",\n        \"Dezembro\",\n    ]\n\n    let monthNumber = parseInt(dateArr[1]) - 1;\n\n    return months[monthNumber]\n}","inputVariables":["getInvoicesBody"],"outputVariable":"openInvoices","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"93ed1916-66c5-46e2-af81-8974f5cc953b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"invoicesCount\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices) {\n    try {\n        let invoicesCount = JSON.parse(openInvoices).length;\n        return invoicesCount;\n    } catch (e) {\n        return 0;\n    }\n}","inputVariables":["openInvoices"],"outputVariable":"invoicesCount","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"045e3ce2-8de3-4246-8141-ca85ef989dac","$typeOfContent":"","type":"SetVariable","$title":"Set \"invoicesIterator\"","$invalid":false,"settings":{"variable":"invoicesIterator","value":"{{invoicesCount}}","expiration":null},"conditions":[]},{"$id":"4f39a7c4-d1a0-420e-80aa-671f9f106aac","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial authtoken ativo validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial authtoken ativo validacao","action":"Sim"},"conditions":[]},{"$id":"078933eb-6072-42eb-9326-df64b5470a51","$typeOfContent":"","type":"TrackEvent","$title":"Status geral API Sucesso","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Status geral API","action":"Pagar_Com_Pix_lista_faturas | P.1.1.0 | Whatsapp | Sucesso | 200"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"getInvoicesStatus"}]},{"$id":"e498b969-59e3-42f0-ac60-ca4e4124480c","$typeOfContent":"","type":"TrackEvent","$title":"Status geral API Falha","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Status geral API","action":"Pagar_Com_Pix_lista_faturas | P.1.1.1 | Whatsapp | Falha | {{getInvoicesStatus}} | {{getInvoicesBody}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-e23cd42b-a870-4d36-9a05-d9660441f253","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-223560ae-2657-4770-9c79-57abb166702d","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-de54e4d5-03fb-4b9d-862d-f80d1b1f8308","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-806e0f49-a8be-40cd-8506-afcce9cf04c2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"f0cc9747-73f0-4fb5-ab29-401f635110a8","root":false,"$title":"Logado Pix","$position":{"top":"669px","left":"10818px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2218e690-f599-4214-af50-dd42797ac152":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0828851c-3d7a-4132-bff9-0085d7d187be","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f0cc9747-73f0-4fb5-ab29-401f635110a8","typeOfStateId":"state","$connId":"con_2173","$id":"f887d2d5-efdf-4f6f-b186-b8a2c0a7075c","conditions":[{"source":"input","comparison":"equals","values":["true"]}],"$invalid":false},{"stateId":"e1750f2a-4a2f-4a7a-8e95-5b1d091d7972","typeOfStateId":"state","$connId":"con_2178","$id":"57f7db5f-bc99-40c0-b8c7-c18e2691b769","conditions":[{"source":"input","comparison":"equals","values":["false"]}],"$invalid":false},{"stateId":"e1750f2a-4a2f-4a7a-8e95-5b1d091d7972","typeOfStateId":"state","$connId":"con_2183","$id":"8f39f74c-17c2-4746-b69d-3aab1482fb09","conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"36a78ff3-1054-4557-ae4a-df1d2116b73e","$typeOfContent":"","type":"Redirect","$title":"#faturaNet#clienteLogado","$invalid":false,"settings":{"context":{"type":"text/plain","value":"#faturaNet#clienteLogado"},"address":"{{config.servicoAutenticacao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-dfd895fc-f737-490b-bc1b-f2628bcfecb7","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-827e13c7-c8fe-4339-9b36-581014003efa","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2218e690-f599-4214-af50-dd42797ac152","root":false,"$title":"Cliente já está logado? Pix","$position":{"top":"508.667px","left":"10817.6px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e1750f2a-4a2f-4a7a-8e95-5b1d091d7972":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"1810549b-d936-484d-8c49-ea162296dae3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"conditions":[{"source":"input","comparison":"equals","values":["#finalizacao"]}],"$invalid":false,"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$connId":"con_2188","$id":"6ce909ea-f09f-4004-9825-d0ca57346352"},{"conditions":[{"source":"input","comparison":"equals","values":["#menu"]}],"$invalid":false,"stateId":"07e22cc5-0aca-4f74-8296-d99e6eaa6a5f","$connId":"con_2193","$id":"a25144aa-8011-45f9-8fa7-11facceeb709"},{"conditions":[{"source":"input","comparison":"equals","values":["#AjudaAutenticacao"]}],"$invalid":false,"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","$connId":"con_2198","$id":"502b2023-da3b-4407-9c08-285ce51218fe"},{"conditions":[{"source":"input","comparison":"equals","values":["#erro"]}],"$invalid":false,"stateId":"f2fe48ca-e06c-4701-a1da-be6b569ee7f9","$connId":"con_2203","$id":"14073c4f-4367-4fe8-ab2f-ffdd70fc3ef2"},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","typeOfStateId":"state","$connId":"con_2208","$id":"3850fb68-667f-4be5-8ffc-861dc2cbc9a0","conditions":[{"source":"context","comparison":"equals","values":["Ir para Segunda Via de Fatura"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7","typeOfStateId":"state","$connId":"con_2213","$id":"ef761762-b102-4a76-9430-cc2ace16c5d1","conditions":[{"source":"context","comparison":"equals","values":["Pegar o codigo de barras"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"be1a84c6-a52a-43d9-afc1-61d5321ff8af","typeOfStateId":"state","$connId":"con_2218","$id":"b7ef80d7-35fc-4ddd-bd96-a9fa05d0be4c","conditions":[{"source":"context","comparison":"equals","values":["Ajuda com login"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","typeOfStateId":"state","$connId":"con_2223","$id":"c65bcc9f-4faa-4d31-a523-0bdb1b598aca","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"9b64a273-3663-471a-9748-9c3516aacb39","typeOfStateId":"state","$connId":"con_2228","$id":"4dbc3087-2ea7-4893-bf11-a6becebc053b","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"f0cc9747-73f0-4fb5-ab29-401f635110a8","typeOfStateId":"state","$connId":"con_2233","$id":"f958cec4-66c9-47ec-8e43-b7a0d53b3131","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dd9edec3-15bf-4e1d-823b-0797c083f7f7","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial authtoken ativo validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial authtoken ativo validacao","action":"nao"},"conditions":[]},{"$id":"5ea031eb-d440-4dab-a5bf-3a8e1e8f2345","type":"ExecuteScript","$title":"lastFeature","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var date = new Date();\n    return {\n        name: 'Pix residencial',\n        channel: 'Faturamento Residencial',\n        text: 'com a sua fatura digital',\n        date: date\n    }\n}","inputVariables":[],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"da4414e3-1676-4dc7-84a4-9950aee9f383","$typeOfContent":"","type":"ExecuteScript","$title":"loginOptions","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return {\n        templateText: 'Para gerar o código Pix das suas faturas',\n        menu: `Ou, *se preferir*, escolha uma das opções:\\n\\n*1-* Ir para Segunda Via de Fatura\\n*2-* Pegar o código de barras (sem login)\\n*3-* Ajuda com login\\n*4-* Voltar ao Menu anterior\\n*5-* Sair`,\n        options: [\n            {\n                content: 'Ir para Segunda Via de Fatura',\n                regex: 'segund[ao]?\\s?(via)?\\s?(d[aei])?\\s?(fatura)?',\n            },\n            {\n                content: 'Pegar o codigo de barras',\n                regex: 'c[oó]digo(\\\\s*(de\\\\s*)?barras)?',\n            },\n            {\n                content: 'Ajuda com login',\n                regex: 'ajuda',\n            },\n            {\n                content: `Voltar ao menu`,\n                regex: 'voltar?|menu',\n            },\n            {\n                content: 'Sair',\n                regex: 'sair?',\n            },\n        ],\n        trackingExhibition: 'exibicao',\n        trackingOption: 'selecao',\n        trackingInput: 'input',\n    };\n}\n","inputVariables":[],"outputVariable":"loginOptions","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"Redirect","$title":"Redirecionar Bot Autenticacao","$invalid":false,"settings":{"address":"{{config.servicoAutenticacao}}","context":{"type":"text/plain","value":"#faturaNet#loginWithOptions#v2"}},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - origemAjudaAutenticacao","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n    return {stateId: input, subBot: \"faturaResidencial\"}\n}","inputVariables":["state.previous.id"],"outputVariable":"origemAjudaAutenticacao","LocalTimeZoneEnabled":false},"conditions":[{"source":"input","comparison":"equals","values":["#ajudaAutenticacao"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"71985007-21d4-4857-a4e2-b12b5dbbbfc0","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-c2fd9fa2-7965-47ff-aaf0-fa11d4f47af7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2e00552a-8359-4ce6-978e-7e2c0fa1a4b0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ceef7ffa-9047-48c2-9e50-bd55fe7d266f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-2104691d-0095-46cf-8096-b3d04b7e6603","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"e1750f2a-4a2f-4a7a-8e95-5b1d091d7972","root":false,"$title":"Redireciona login pix","$position":{"top":"603.524px","left":"10541.4px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f06f07f8-902f-4f1f-b25a-2a2daca3b747":{"$contentActions":[{"action":{"$id":"47f95168-170c-4482-bef0-952fa777c7d7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3177e4d7-2306-4a04-8552-17ec9aa01efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3177e4d7-2306-4a04-8552-17ec9aa01efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b17ac3f0-f01c-4080-b8dc-1c6ab38b11b3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"fe853838-694b-401a-8ef8-bd7dde862018","type":"text/plain","content":"Todas as suas faturas estão em dia! ✅","metadata":{}},"$cardContent":{"document":{"id":"fe853838-694b-401a-8ef8-bd7dde862018","type":"text/plain","content":"Todas as suas faturas estão em dia! ✅"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9b52db67-fe79-4c3a-9df9-5e854d9ba861","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cda0180d-72f0-4c11-8dec-143bdffbb368","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cda0180d-72f0-4c11-8dec-143bdffbb368","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c1b09277-1d73-45f2-860d-71626803e492","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"2382acb2-62fe-45dd-a87b-f46f53450b34","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a3987fa2-95be-4cfb-9cb0-83bdfa3cd64f","typeOfStateId":"state","$connId":"con_2238","$id":"75d0bb4a-e2b4-421a-b64e-bac180980d22","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","typeOfStateId":"state","$connId":"con_2243","$id":"5ce5317a-51b5-4059-80db-a070198aaa91","conditions":[{"source":"context","comparison":"contains","values":["Sim"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"77b3a6fd-4717-40c0-a5e7-fc52bd2ba9d6","$typeOfContent":"","type":"ExecuteScript","$title":"Set userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d441bc27-fe26-463a-8b97-08330c679efb","$typeOfContent":"","type":"ExecuteScript","$title":"Set channelBoldTags","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"64fc2887-6e8a-4d86-8fae-f3b9c18a93b3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return [\n    {\n      content: 'Sim, baixar 2ª via',\n      regex: '^(desejo|quero|si[mn])$|(si[mn],?\\\\s*baixar?\\\\s*(2|2ª|segun?das?)\\\\s*vias?)|(2|2ª|segun?das?)\\\\s*vias?'\n    },\n    {\n      content: 'Não',\n      regex: '(^n[aã]o$|n[aã]o\\\\s*(desejo|quero))'\n    }\n  ];\n};\n","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"11a3aac7-5ebb-42a1-b465-400919af124d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        text: `Você quer ${channelBoldTags.open}baixar o PDF da 2ª via${channelBoldTags.close} de alguma fatura?`,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: true,\n        hasWppListMenu: false,\n        isBlipImmediateMenu: true,\n    };\n\n    let menu = createMenu(props, config);\n    \n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"125c0d42-780b-4496-b308-3a01124e7779","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numericOptionsRegex\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn JSON.stringify([\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*1\\\\s*?)|um|(primei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*2\\\\s*?)|dois|(segund[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*3\\\\s*?)|tr[eê]s|(tercei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*4\\\\s*?)|quatro|(quart[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*5\\\\s*?)|cinco|(quint[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*6\\\\s*?)|seis|(sext[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*7\\\\s*?)|sete|(s[eé]tim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*8\\\\s*?)|oito|(oitav[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*9\\\\s*?)|nove|(non[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*10\\\\s*?)|dez|(d[eé]cim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*11\\\\s*?)|onze|(d[eé]cim[ao]\\\\s*primei?ra))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*12\\\\s*?)|doze|(d[eé]cim[ao])\\\\s*segunda)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*13\\\\s*?)|treze|(d[eé]cim[ao])\\\\s*tercei?ra)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*14\\\\s*?)|catorze|(d[eé]cim[ao])\\\\s*quarta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*15\\\\s*?)|quinze|(d[eé]cim[ao])\\\\s*quinta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*16\\\\s*?)|dezesseis|(d[eé]cim[ao])\\\\s*sexta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*17\\\\s*?)|dezessete|(d[eé]cim[ao])\\\\s*s[eé]tima)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*18\\\\s*?)|dezoit|(d[eé]cim[ao])\\\\s*oitava)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*19\\\\s*?)|dezenove|(d[eé]cim[ao])nona)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*20\\\\s*?)|vinte|(vig[eé]sima))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t]);\n}","inputVariables":[],"outputVariable":"numericOptionsRegex","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"be4fe5e6-365a-4ae2-948e-7ef59cffc6e3","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura abertas validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura abertas validacao","action":"nao"},"conditions":[]},{"$id":"65d82ee0-4698-4f54-a4fd-68aaaa47d082","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura pagas exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura pagas exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n\n  if (options && options.length > 0) {\n    numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    if (input != '') {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const contentRegex = new RegExp(options[i].regex, 'i');\n\n        if (numericRegex.test(input) || contentRegex.test(input)) {\n          return {\n            option: numericOption.toString(),\n            content: options[i].content,\n          };\n        }\n      }\n    }\n  }\n\n  return { option: 'invalid', content: 'input inesperado' };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[],"$id":"984a80f8-9da7-40ce-9dc6-1ae609385741"},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[],"$id":"52355f63-5ae6-44e0-9798-8704d5e0a733"},{"$id":"967be13b-3339-4930-9bbb-4aa33d22441f","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura pagas selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura pagas selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"e5fd1022-e17c-48a6-bbfd-8e2b931a9803","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura pagas inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura pagas inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-93ba0067-83ce-4027-b1d3-77d73df17040","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ae645da0-7d08-4ab0-89e6-3eeedabc5930","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4fc1c232-2475-4869-9c8a-b387a138f633","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-b624f6dc-8590-49c3-a34f-9f3ee8de9c4e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f06f07f8-902f-4f1f-b25a-2a2daca3b747","root":false,"$title":"[P.1.8.0] Não existem faturas em aberto","$position":{"top":"509.19px","left":"11101.1px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"db27a6cc-abb0-423f-8c80-153a27f9e987":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f7df67e2-29c3-4378-9c3e-5d4739789732","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"db27a6cc-abb0-423f-8c80-153a27f9e987","typeOfStateId":"state","$connId":"con_2248","$id":"69801164-a4ce-4feb-abfc-7ba2b0b96bd9","conditions":[{"source":"context","comparison":"greaterThan","values":["0"],"variable":"invoicesIterator"}],"$invalid":false},{"stateId":"39e1492a-0f8c-4a17-9c35-75bc38016c9f","typeOfStateId":"state","$connId":"con_2253","$id":"3d5c7e88-eaac-4a71-b4cc-f1df8e6f5eed","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"getPixPayloadStatus"}],"$invalid":false},{"stateId":"39e1492a-0f8c-4a17-9c35-75bc38016c9f","typeOfStateId":"state","$connId":"con_2258","$id":"e30e5a50-8603-4e16-aa56-86daf4d8fd45","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"pixElegibility"}],"$invalid":false},{"stateId":"39e1492a-0f8c-4a17-9c35-75bc38016c9f","typeOfStateId":"state","$connId":"con_2263","$id":"5c57c6f4-09ee-4d99-9d63-23815316b293","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"openInvoices@hasError"}],"$invalid":false},{"stateId":"8c36edfa-f7cb-4571-8240-6ca71e51e321","typeOfStateId":"state","$connId":"con_2268","$id":"fae850b9-0851-4fab-a4ab-0bf6d899696c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1b89d172-2b0d-494a-aadd-809d0fd836ac","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"invoiceId\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices, invoicesIterator) {\n    try {\n        let invoiceIndex = parseInt(invoicesIterator) - 1;\n        let invoiceId = JSON.parse(openInvoices)[invoiceIndex].invoiceId;\n\n        return invoiceId;\n    } catch (e) {\n        return false\n    }\n}","inputVariables":["openInvoices","invoicesIterator"],"outputVariable":"invoiceId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1dfded21-4e4e-4d00-b916-40d46ed8cff5","$typeOfContent":"","type":"ProcessHttp","$title":"Requisição HTTP \"getPixPayload\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/paymentmethods/pix?AccessToken={{tokenAccessFormated}}&document={{document}}&contractNumber={{contractNumber}}&operatorCode={{operatorCode}}&BillId={{invoiceId}}","responseStatusVariable":"getPixPayloadStatus","responseBodyVariable":"getPixPayloadBody"},"conditions":[]},{"$id":"0b6072d3-619f-48a9-a721-eac8975454d0","$typeOfContent":"","type":"ExecuteScript","$title":"Mock \"getPixPayloadBody\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    // return {\n    //     \"traceId\": \"00-ea678df7e279ab4d92994e8c8600b99b-9f5ee95b75f26042-00\",\n    //     \"data\": {\n    //         \"apiVersion\": \"1;2021-07-19\",\n    //         \"transactionId\": \"981ce57e-4527-463e-99d4-c7bead0f57f4\",\n    //         \"data\": {\n    //             \"dueDate\": \"2023-08-05\",\n    //             \"payload\": \"00020109999126580014br.gov.bcb.pox01362b946329-3dd9-4237-9897-658af92371ef520400005303986540574.885802BR5909CODIGO PIX MOCKADO 62270523006129129555552740325756304F2BB\"\n    //         }\n    //     },\n    //     \"errors\": []\n    // }\n\n    return {\n        \"traceId\": \"00-cf8e25689fd9164e92d1385f6a999f6d-a74229a9835ecd45-00\",\n        \"data\": {\n            \"apiVersion\": null,\n            \"transactionId\": null,\n            \"data\": null\n        },\n        \"errors\": []\n    }\n}","inputVariables":[],"outputVariable":"getPixPayloadBody","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"toMock"}]},{"$id":"37ab266f-1432-4192-92b0-60fd282b0c9c","$typeOfContent":"","type":"SetVariable","$title":"Mock \"getPixPayloadStatus\"","$invalid":false,"settings":{"variable":"getPixPayloadStatus","value":"200"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"toMock"}]},{"$id":"4f04c954-c3e3-4b53-a7e0-e5ae1b25cd72","$typeOfContent":"","type":"ExecuteScript","$title":"Update \"invoicesIterator\"","$invalid":false,"settings":{"function":"run","source":"function run(invoicesIterator) {\n    try {\n        invoicesIterator = parseInt(invoicesIterator) - 1;\n        return invoicesIterator\n    } catch (e) {\n        return 0\n    }\n}","inputVariables":["invoicesIterator"],"outputVariable":"invoicesIterator","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5bdcb681-3221-46a7-ab41-b3e398d134cd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"pixElegibility\"","$invalid":false,"settings":{"function":"run","source":"function run(getPixPayloadBody) {\n\ttry {\n\t\tgetPixPayloadBody = JSON.parse(getPixPayloadBody);\n\t\t\n\t\tif (!(getPixPayloadBody.data.data)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\treturn {\n\t\t\thasError: true,\n\t\t\tflowId: \"[P.1.3.2] Get Pix Payloads\",\n\t\t\terrorMessage: error.message\n\t\t}\n\t}\n}","inputVariables":["getPixPayloadBody"],"outputVariable":"pixElegibility","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9db9bc41-6934-4cb0-8e7f-f88cddd5bcae","$typeOfContent":"","type":"ExecuteScript","$title":"Update \"openInvoices\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices, getPixPayloadBody) {\n    try {\n        openInvoices = JSON.parse(openInvoices);\n        getPixPayloadBody = JSON.parse(getPixPayloadBody);\n\n        let payloadDueDate = getPixPayloadBody.data.data.dueDate;\n        let invoiceIndex = openInvoices.findIndex(invoice => invoice.dueDate == payloadDueDate);\n\n        openInvoices[invoiceIndex].pixPayload = getPixPayloadBody.data.data.payload;\n\n        return openInvoices;\n    } catch (error) {\n        return {\n            hasError: true,\n            flowId: \"[P.1.3.2] Get Pix Payloads\",\n            errorMessage: error.message\n        }\n    }\n}","inputVariables":["openInvoices","getPixPayloadBody"],"outputVariable":"openInvoices","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b3e25b95-8c7c-4d6e-9261-92bbd0fcee3d","$typeOfContent":"","type":"TrackEvent","$title":"Status geral API (sucesso)","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Status geral API","action":"Pagar_Com_Pix_Recuperar_Codigo_Pix | [P.1.3.2] | Whatsapp | Sucesso | 200"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"getPixPayloadStatus"}]},{"$id":"7bfadb44-facd-415f-bb45-8c8eaf871d2a","$typeOfContent":"","type":"TrackEvent","$title":"Status geral API (falha)","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Status geral API","action":"Pagar_Com_Pix_Recuperar_Codigo_Pix | [P.1.3.2] | Whatsapp | Falha | {{getPixPayloadStatus}} | {{getPixPayloadBody}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"getPixPayloadStatus"}]},{"$id":"e4319ef6-c1a2-404f-a134-8a8e952c24b0","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura abertas validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura abertas validacao","action":"Sim"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-b3327a85-21d0-4dfb-9866-8a92df11818e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7572848c-9beb-4797-afdc-81ba552bb4f7","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-15701d77-e344-4aa7-a051-ddeaff4266c4","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-8bf9a89e-b2f5-4bed-ba64-b13468b7aa4a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"db27a6cc-abb0-423f-8c80-153a27f9e987","root":false,"$title":"[P.1.3.2] Get Pix Payloads","$position":{"top":"771.571px","left":"11100px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8c36edfa-f7cb-4571-8240-6ca71e51e321":{"$contentActions":[{"action":{"$id":"1108a42b-cf9c-4fa9-a775-e01abfdfe238","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"37bd8f84-329d-48f1-861d-3c8e6f105f55","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"37bd8f84-329d-48f1-861d-3c8e6f105f55","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"919c09ec-ce3f-4e25-a1b5-e0359539fc20","$typeOfContent":"text","type":"SendMessage","settings":{"id":"67d6e75a-8ba1-4a19-9797-01f51dcbfe66","type":"text/plain","content":"Estou procurando suas faturas abertas, só um momento. 🔎","metadata":{}},"$cardContent":{"document":{"id":"67d6e75a-8ba1-4a19-9797-01f51dcbfe66","type":"text/plain","content":"Estou procurando suas faturas abertas, só um momento. 🔎"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d65962ed-ae5d-4b79-a569-cc912b6b35ff","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"90a24866-226e-4ef1-af50-8b2d134749db","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a61450af-2308-4017-9fd3-cef52ba6a554","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"a61450af-2308-4017-9fd3-cef52ba6a554","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"6a0e4530-4be1-4dde-aeea-464de25d25c6","typeOfStateId":"state","$connId":"con_2273","$id":"c0d3620d-eb88-4905-8d59-fa184802ba63","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"invoicesCount"}],"$invalid":false},{"stateId":"0b7ec526-8183-440e-a77e-2a0f0a488239","typeOfStateId":"state","$connId":"con_2278","$id":"bdd8dc7b-73f6-4c55-824d-5a1fd4f49377","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"invoicesCount"}],"$invalid":false},{"stateId":"1a8cbbdb-7560-4182-84ac-fd7bb1d382fe","typeOfStateId":"state","$connId":"con_2283","$id":"96146c5f-c86a-47c4-b323-2a657893b898","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"invoicesCount"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"21ca91c6-15ec-4540-b9b6-389ab52f13b1","$typeOfContent":"","type":"SetVariable","$title":"Set \"erroPersistente\"","$invalid":false,"settings":{"variable":"erroPersistente","value":"2"},"conditions":[]},{"$id":"a333e6ef-6a59-42a6-8d4d-6bb627c380b1","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura tipo cod barras validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura tipo cod barras validacao","action":"Sim"},"conditions":[]},{"$id":"ba62d66f-5184-4ca5-8f69-bd0d4eb33cbd","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura tipo cod barras sim exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura tipo cod barras sim exibicao","action":"Exibicao"},"conditions":[]},{"$id":"23d76144-b467-41e6-aeaa-7c8c000340e2","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura abertas validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura abertas validacao","action":"Sim"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b908ad4f-3efc-4394-88aa-b03c1720070c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-877b303a-90fc-4909-b9de-468d10373b0d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6f1f4c1b-ab68-417d-bb6f-fb511c9b1555","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"8c36edfa-f7cb-4571-8240-6ca71e51e321","root":false,"$title":"[P.1.2.0] [P.1.4.0] Quantas faturas estão em abert","$position":{"top":"860.333px","left":"10818px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6a0e4530-4be1-4dde-aeea-464de25d25c6":{"$contentActions":[{"action":{"$id":"ecc1bd4e-ff11-4221-ac82-dbe36579bf9e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a2f69072-3a00-40a6-bad7-91b41cd22d76","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a2f69072-3a00-40a6-bad7-91b41cd22d76","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0100a915-f014-4d39-9456-224df5b5e082","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f88c04af-c976-417c-8052-0a2779eed297","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5292aa4d-07e0-49b2-a076-4847ae44fbd8","typeOfStateId":"state","$connId":"con_2288","$id":"226f069d-f857-48ee-b135-549259942a58","conditions":[{"source":"context","comparison":"contains","values":["pagar agora"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"a3987fa2-95be-4cfb-9cb0-83bdfa3cd64f","typeOfStateId":"state","$connId":"con_2293","$id":"f15a1cd5-c15e-49f5-9017-ff84eaa0beb2","conditions":[{"source":"context","comparison":"equals","values":["Agora não"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"f9f4901e-097b-4a86-aa02-4c5467b7668a","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 1 exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 1 exibicao","action":"Exibicao"},"conditions":[]},{"$id":"cbd2967a-3564-4ac9-a1a9-55a778a4520f","$typeOfContent":"","type":"ExecuteScript","$title":"Set userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4bd74801-2e74-4d1e-83f5-e98e23f7ef61","$typeOfContent":"","type":"ExecuteScript","$title":"Set channelBoldTags","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9be2ffc6-9d27-4056-ab61-b618daba769b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return [\n    {\n      content: 'Sim, pagar agora',\n      regex: '^(desejo|quero|si[mn]|pag[ae]r?\\\\s*agora|quero\\\\s*pagar?)$|(si[mn],?\\\\s*pagar?\\\\s*agora)'\n    },\n    {\n      content: 'Agora não',\n      regex: '^(n[aã]o|n[aã]o\\\\s*desejo|n[aã]o\\\\s*quero\\\\s*(pagar?\\\\s*agora?)?|agora\\\\s*n[aã]o|n[aã]o\\\\s*agora)$'\n    }\n  ];\n};\n","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3422e20c-15df-4f85-bc56-0062b5719c87","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options, openInvoices, date) {\n    return getMenu(userChannel, channelBoldTags, options, openInvoices, date);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction isOpenInvoiceAfterDate(invoice, date) {\n    if (!date) {\n        return true;\n    }\n\n    let invoiceDate = new Date(invoice[0].dueDate);\n    let currentDate = new Date(date);\n    return currentDate > invoiceDate;\n}\n\nfunction getMenu(userChannel, channelBoldTags, options, openInvoices, date) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n    openInvoices = JSON.parse(openInvoices);\n\n    let isExpired = isOpenInvoiceAfterDate(openInvoices, date) ? \"venceu\" : \"vence\"\n\n    const menuFields = {\n        text: `Pronto. A fatura de *${openInvoices[0].month}* está aberta, tem o valor de *R$ ${(openInvoices[0].amount).toString().replace(\".\", \",\")}* e ${isExpired} em ${(openInvoices[0].dueDate).split(\"-\")[2]}/${openInvoices[0].month}/${openInvoices[0].year}. *Deseja pagar agora?*`,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: true,\n        hasWppListMenu: false,\n        isBlipImmediateMenu: true,\n    };\n\n    let menu = createMenu(props, config);\n\n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options","openInvoices","calendar.date"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2a7e04fb-38cb-4433-937c-99119ed4ba1e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numericOptionsRegex\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn JSON.stringify([\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*1\\\\s*?)|um|(primei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*2\\\\s*?)|dois|(segund[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*3\\\\s*?)|tr[eê]s|(tercei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*4\\\\s*?)|quatro|(quart[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*5\\\\s*?)|cinco|(quint[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*6\\\\s*?)|seis|(sext[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*7\\\\s*?)|sete|(s[eé]tim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*8\\\\s*?)|oito|(oitav[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*9\\\\s*?)|nove|(non[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*10\\\\s*?)|dez|(d[eé]cim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*11\\\\s*?)|onze|(d[eé]cim[ao]\\\\s*primei?ra))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*12\\\\s*?)|doze|(d[eé]cim[ao])\\\\s*segunda)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*13\\\\s*?)|treze|(d[eé]cim[ao])\\\\s*tercei?ra)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*14\\\\s*?)|catorze|(d[eé]cim[ao])\\\\s*quarta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*15\\\\s*?)|quinze|(d[eé]cim[ao])\\\\s*quinta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*16\\\\s*?)|dezesseis|(d[eé]cim[ao])\\\\s*sexta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*17\\\\s*?)|dezessete|(d[eé]cim[ao])\\\\s*s[eé]tima)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*18\\\\s*?)|dezoit|(d[eé]cim[ao])\\\\s*oitava)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*19\\\\s*?)|dezenove|(d[eé]cim[ao])nona)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*20\\\\s*?)|vinte|(vig[eé]sima))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t]);\n}","inputVariables":[],"outputVariable":"numericOptionsRegex","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n\n  if (options && options.length > 0) {\n    numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    if (input != '') {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const contentRegex = new RegExp(options[i].regex, 'i');\n\n        if (numericRegex.test(input) || contentRegex.test(input)) {\n          return {\n            option: numericOption.toString(),\n            content: options[i].content,\n          };\n        }\n      }\n    }\n  }\n\n  return { option: 'invalid', content: 'input inesperado' };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[],"$id":"2e8aa4cb-b234-4a54-9720-6341bc0c53c2"},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[],"$id":"1a0da45a-6586-477a-a5f3-a052a8a07558"},{"$id":"96bb580f-0e3f-460b-80d4-108c27a81098","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"selectedInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices) {\n\ttry {\n\t\topenInvoices = JSON.parse(openInvoices);\n\t\treturn openInvoices[0];\n\t} catch (e) {\n\t\treturn e;\n\t}\n}","inputVariables":["openInvoices"],"outputVariable":"selectedInvoice","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8d61266f-1e0b-4de2-9b5c-96a4362a8d73","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 1 selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 1 selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"30a20d2e-19a5-4499-bbe0-9f0d17e12711","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 1 inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 1 inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"7a4a9f8e-ef57-432b-b238-fc8e99db4de5","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 1 exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 1 exibicao detalhes","action":"Exibicao | {{selectedInvoice@month}} | {{selectedInvoice@amount}} | vence | {{selectedInvoice@dueDateFormated}}"},"conditions":[]},{"$id":"b246943f-b2f5-4d33-8951-3a3b78f45c0f","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 1 selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 1 selecao detalhes","action":"{{chooseAnswer@content}} |  {{selectedInvoice@month}} | {{selectedInvoice@amount}} | vence | {{selectedInvoice@dueDateFormated}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-3d5a36c7-a782-4a76-aac0-026dadf794ea","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e3f2404f-30f1-4584-82a6-08ec6a20ea6f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6923b2a6-6c29-4d54-9891-a619536e314a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-82ff1c0d-24ef-443e-aa47-f2b420c90fff","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"6a0e4530-4be1-4dde-aeea-464de25d25c6","root":false,"$title":"[P.1.5.0] 1 fatura em aberto","$position":{"top":"1078.43px","left":"10471.3px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0b7ec526-8183-440e-a77e-2a0f0a488239":{"$contentActions":[{"action":{"$id":"f6c8aa37-7db7-4f99-b41a-5866a5bba2c4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"e209aa11-bfc7-459b-b8a4-89b60f55147e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e209aa11-bfc7-459b-b8a4-89b60f55147e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b95be469-41ea-49a6-a479-75dca4bc0ba3","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"353d5c25-d91a-40bb-b45d-d3aed57bcca3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"03e8a5ad-e0f9-468c-9f8f-3c74b1396f10","typeOfStateId":"state","$connId":"con_2298","$id":"89b8d0a7-ee54-4cfa-a662-71ce1c9f215c","conditions":[{"source":"context","comparison":"equals","values":["As duas"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"5292aa4d-07e0-49b2-a076-4847ae44fbd8","typeOfStateId":"state","$connId":"con_2303","$id":"f98600b2-770d-4fff-84d7-94850382522e","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"203d8800-aa43-4dc4-9d95-6a9c9f7c1a74","typeOfStateId":"state","$connId":"con_2308","$id":"b7214467-25d2-4596-ba7d-967c75f94870","conditions":[{"source":"context","comparison":"equals","values":["input inesperado"],"variable":"chooseAnswer@content"},{"values":["0"],"source":"context","comparison":"greaterThan","variable":"erroPersistente"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"da15ed26-9c27-41cb-83de-79f043cc1678","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 exibicao","action":"Exibicao"},"conditions":[]},{"$id":"d73984fb-c681-41f0-8c9d-fc8041d68740","$typeOfContent":"","type":"ExecuteScript","$title":"Set userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f462f5a8-d656-4b0d-b17b-94fabcfe6d65","$typeOfContent":"","type":"ExecuteScript","$title":"Set channelBoldTags","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"460ee443-72b2-4bc4-9a01-aa6272eef74d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices) {\n  try {\n    openInvoices = JSON.parse(openInvoices);\n\n    return [\n      // {\n      //   content: `${openInvoices[0].month}/${(openInvoices[0].year).substring(2, 4)} R$ ${openInvoices[0].amount}`.replace(\".\", \",\"),\n      //   regex: `${openInvoices[0].month}`\n      // },\n      // {\n      //   content: `${openInvoices[1].month}/${(openInvoices[1].year).substring(2, 4)} R$ ${openInvoices[1].amount}`.replace(\".\", \",\"),\n      //   regex: `${openInvoices[1].month}`\n      // },\n      // {\n      //   content: 'As duas',\n      //   regex: '([oa]s\\\\s*d[ou][ia]s|a[mn]bas|duas\\\\s*faturas?|quero\\\\s*todas?|^todas?$)'\n      // }\n      {\n        content: `${(openInvoices[0].month).substring(0, 3)}/${(openInvoices[0].year)} R$ ${openInvoices[0].amount}`.replace(\".\", \",\"),\n        regex: `${(openInvoices[0].month).substring(0, 3)}`\n      },\n      {\n        content: `${(openInvoices[1].month).substring(0, 3)}/${(openInvoices[1].year)} R$ ${openInvoices[1].amount}`.replace(\".\", \",\"),\n        regex: `${(openInvoices[1].month).substring(0, 3)}`\n      },\n      {\n        content: 'As duas',\n        regex: '([oa]s\\\\s*d[ou][ia]s|a[mn]bas|duas\\\\s*faturas?|quero\\\\s*todas?|^todas?$)'\n      }\n    ];\n  } catch (e) {\n    return false;\n  }\n}","inputVariables":["openInvoices"],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8b50c28-3941-4461-b14f-682862f8e573","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options, openInvoices) {\n    return getMenu(userChannel, channelBoldTags, options, openInvoices);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction getMenu(userChannel, channelBoldTags, options, openInvoices) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n    openInvoices = JSON.parse(openInvoices);\n\n//     const menuFields = {\n//         text: `Pronto. Existem duas faturas abertas. ${channelBoldTags.open}Qual você quer pagar?${channelBoldTags.close}\n\n// - - - - - - - - - - - - - - - - -\n\n// ${openInvoices[0].month}/${openInvoices[0].year}\n// Valor: R$ ${(openInvoices[0].amount).toString().replace(\".\", \",\")}\n// Vencimento: ${openInvoices[0].dueDateFormated}\n// - - - - - - - - - - - - - - - - -\n\n// ${openInvoices[1].month}/${openInvoices[1].year}\n// Valor: R$ ${(openInvoices[1].amount).toString().replace(\".\", \",\")}\n// Vencimento: ${openInvoices[1].dueDateFormated}\n\n// - - - - - - - - - - - - - - - - -`,\n//         options: getOptions(options)\n//     };\n\n    const menuFields = {\n        text: `Pronto. Existem duas faturas abertas. ${channelBoldTags.open}Qual você quer pagar?${channelBoldTags.close}\n\n- - - - - - - - - - - - - - - - -\n\n${channelBoldTags.open}${openInvoices[0].month}/${openInvoices[0].year}${channelBoldTags.close}\nValor: ${channelBoldTags.open}R$ ${(openInvoices[0].amount).toString().replace(\".\", \",\")}${channelBoldTags.close}\nVencimento: ${channelBoldTags.open}${openInvoices[0].dueDateFormated}${channelBoldTags.close}\n- - - - - - - - - - - - - - - - -\n\n${channelBoldTags.open}${openInvoices[1].month}/${openInvoices[1].year}${channelBoldTags.close}\nValor: ${channelBoldTags.open}R$ ${(openInvoices[1].amount).toString().replace(\".\", \",\")}${channelBoldTags.close}\nVencimento: ${channelBoldTags.open}${openInvoices[1].dueDateFormated}${channelBoldTags.close}\n\n- - - - - - - - - - - - - - - - -`,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: true,\n        hasWppListMenu: false,\n        isBlipImmediateMenu: true,\n    };\n\n    let menu = createMenu(props, config);\n\n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options","openInvoices"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"490fe0d7-5942-4c64-b932-b0a8062d404e","$typeOfContent":"","type":"ExecuteScript","$title":"Update \"erroPersistente\"","$invalid":false,"settings":{"function":"run","source":"function run(erroPersistente) {\n\terroPersistente = parseInt(erroPersistente);\n\terroPersistente = erroPersistente - 1;\n\treturn erroPersistente;\n}","inputVariables":["erroPersistente"],"outputVariable":"erroPersistente","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"c68ff3b4-84ab-4462-bd72-559d84d6e32b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numericOptionsRegex\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn JSON.stringify([\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*1\\\\s*?)|um|(primei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*2\\\\s*?)|dois|(segund[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*3\\\\s*?)|tr[eê]s|(tercei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*4\\\\s*?)|quatro|(quart[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*5\\\\s*?)|cinco|(quint[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*6\\\\s*?)|seis|(sext[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*7\\\\s*?)|sete|(s[eé]tim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*8\\\\s*?)|oito|(oitav[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*9\\\\s*?)|nove|(non[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*10\\\\s*?)|dez|(d[eé]cim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*11\\\\s*?)|onze|(d[eé]cim[ao]\\\\s*primei?ra))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*12\\\\s*?)|doze|(d[eé]cim[ao])\\\\s*segunda)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*13\\\\s*?)|treze|(d[eé]cim[ao])\\\\s*tercei?ra)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*14\\\\s*?)|catorze|(d[eé]cim[ao])\\\\s*quarta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*15\\\\s*?)|quinze|(d[eé]cim[ao])\\\\s*quinta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*16\\\\s*?)|dezesseis|(d[eé]cim[ao])\\\\s*sexta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*17\\\\s*?)|dezessete|(d[eé]cim[ao])\\\\s*s[eé]tima)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*18\\\\s*?)|dezoit|(d[eé]cim[ao])\\\\s*oitava)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*19\\\\s*?)|dezenove|(d[eé]cim[ao])nona)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*20\\\\s*?)|vinte|(vig[eé]sima))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t]);\n}","inputVariables":[],"outputVariable":"numericOptionsRegex","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n\n  if (options && options.length > 0) {\n    numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    if (input != '') {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const contentRegex = new RegExp(options[i].regex, 'i');\n\n        if (numericRegex.test(input) || contentRegex.test(input)) {\n          return {\n            option: numericOption.toString(),\n            content: options[i].content,\n          };\n        }\n      }\n    }\n  }\n\n  return { option: 'invalid', content: 'input inesperado' };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[],"$id":"62156058-9566-47ca-a016-f788a82be985"},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[],"$id":"8c378d3e-17be-41b8-bd02-33a4b95c8138"},{"$id":"b384ee24-f8be-43a7-95ff-b907888d1e71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"selectedInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices, chooseAsnwer) {\n    try {\n        openInvoices = JSON.parse(openInvoices);\n        chooseAsnwer = JSON.parse(chooseAsnwer);\n\n        const months = {\n            Janeiro: \"Jan\",\n            Fevereiro: \"Fev\",\n            Março: \"Mar\",\n            Abril: \"Abr\",\n            Maio: \"Mai\",\n            Junho: \"Jun\",\n            Julho: \"Jul\",\n            Agosto: \"Ago\",\n            Setembro: \"Set\",\n            Outubro: \"Out\",\n            Novembro: \"Nov\",\n            Dezembro: \"Dez\"\n        };\n\n        let invoice = openInvoices.find(invoice => months[invoice.month] == chooseAsnwer.content.split(\"/\")[0]);\n\n        return invoice;\n    } catch (error) {\n        return null;\n    }\n}","inputVariables":["openInvoices","chooseAnswer"],"outputVariable":"selectedInvoice","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"37e74e9a-f60b-4e1b-964a-ababa4f0cf98","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"c0a66301-c1ae-42ed-b90d-33f853684679","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"46e695db-07f7-40be-8343-4731885c8198","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 selecao detalhes","action":"{{chooseAnswer@content}} | Agosto | 2023 | 05/08/2023 | 72.83"},"conditions":[{"values":["As duas"],"source":"context","comparison":"notEquals","variable":"chooseAnswer@content"}]},{"$id":"fd3c71b7-ab20-4809-8647-d484d258d507","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 exibicao detalhes","action":"Exibicao | {{selectedInvoice@month}} | {{selectedInvoice@year}} | {{selectedInvoice@dueDateFormated}} | {{selectedInvoice@amount}}"},"conditions":[{"values":["As duas"],"source":"context","comparison":"notEquals","variable":"chooseAnswer@content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-2d1870b7-4d25-427a-98ec-6d488ca820e5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-486ea15b-f088-49de-9b9b-5af72a083a52","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0535f637-e6b8-4194-9e89-8dbf3ac2035a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-43f1ae56-c8c9-49a4-b743-85fcae5f5ed5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0b7ec526-8183-440e-a77e-2a0f0a488239","root":false,"$title":"[P.1.6.0] 2 faturas em aberto","$position":{"top":"1082.57px","left":"10820px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1a8cbbdb-7560-4182-84ac-fd7bb1d382fe":{"$contentActions":[{"action":{"$id":"f68e19fe-2c9f-4367-8ff5-3441d02c2dc4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2f52cdca-a1ce-4e59-8ad4-e10c6399a405","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2f52cdca-a1ce-4e59-8ad4-e10c6399a405","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"49e33d8c-b085-46f1-9a16-75ddce63e84a","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"dd4d60ae-3557-4227-8554-035798c2bd46","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cb0323b1-1ace-428e-9bd2-a408ef0435c6","typeOfStateId":"state","$connId":"con_2313","$id":"85d87886-968d-44bd-a60a-910dc860e7d8","conditions":[{"source":"context","comparison":"equals","values":["Todas"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"5292aa4d-07e0-49b2-a076-4847ae44fbd8","typeOfStateId":"state","$connId":"con_2318","$id":"6f2bc207-5b35-471d-be91-106569f547cf","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"203d8800-aa43-4dc4-9d95-6a9c9f7c1a74","typeOfStateId":"state","$connId":"con_2323","$id":"7fead439-00b4-4c39-830c-f565eaeef297","conditions":[{"source":"context","comparison":"equals","values":["input inesperado"],"variable":"chooseAnswer@content"},{"values":["0"],"source":"context","comparison":"greaterThan","variable":"erroPersistente"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7b7df3a2-f6f1-49b5-b712-6049d45d878d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices) {\n  try {\n    openInvoices = JSON.parse(openInvoices);\n\n    return [\n      {\n        content: `${openInvoices[0].month}/${openInvoices[0].year}`,\n        regex: `${openInvoices[0].month}`,\n        description: `${openInvoices[0].dueDateFormated} no valor de R$ ${(openInvoices[0].amount).toString().replace(\".\", \",\")}`\n      },\n      {\n        content: `${openInvoices[1].month}/${openInvoices[1].year}`,\n        regex: `${openInvoices[1].month}`,\n        description: `${openInvoices[1].dueDateFormated} no valor de R$ ${(openInvoices[1].amount).toString().replace(\".\", \",\")}`\n      },\n      {\n        content: `${openInvoices[2].month}/${openInvoices[2].year}`,\n        regex: `${openInvoices[2].month}`,\n        description: `${openInvoices[2].dueDateFormated} no valor de R$ ${(openInvoices[2].amount).toString().replace(\".\", \",\")}`\n      },\n      {\n        content: 'Todas',\n        regex: '([oa]s\\\\s*d[ou][ia]s|a[mn]bas|duas\\\\s*faturas?|quero\\\\s*todas?|^todas?$)'\n      }\n    ];\n  } catch (e) {\n    return false;\n  }\n}","inputVariables":["openInvoices"],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"09a806a9-7dd9-49ff-9c9b-33280e9faa10","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    let section1 = options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n\n    return {\n        \"FATURAS ABERTAS\": section1\n    };\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        //header: 'Opções sobre Fatura',\n        button: 'Selecionar fatura',\n        text:  `Pronto. Existem ${channelBoldTags.open}3 faturas abertas.${channelBoldTags.close} Qual você quer pagar?`,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: false,\n        hasWppListMenu: true,\n        isBlipImmediateMenu: false,\n    };\n\n    let menu = createMenu(props, config);\n\n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options","openInvoices"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"630803bf-84cc-4ade-8cfc-59b46804a5db","$typeOfContent":"","type":"ExecuteScript","$title":"Update \"erroPersistente\"","$invalid":false,"settings":{"function":"run","source":"function run(erroPersistente) {\n\terroPersistente = parseInt(erroPersistente);\n\terroPersistente = erroPersistente - 1;\n\treturn erroPersistente;\n}","inputVariables":["erroPersistente"],"outputVariable":"erroPersistente","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d1063cb2-8344-4228-99e8-510261f0d02c","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 3 exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 3 exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[],"$id":"f565d47a-75ee-4e88-b25e-82fa825d38c2"},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[],"$id":"7697cdc3-9976-47f9-a850-bb43fb72064e"},{"$id":"05b54e2b-2da8-49ff-a277-e019b9f7fe98","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"selectedInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices, chooseAsnwer) {\n    try {\n        openInvoices = JSON.parse(openInvoices);\n        chooseAsnwer = JSON.parse(chooseAsnwer);\n\n        let invoice = openInvoices.find(invoice => invoice.month == chooseAsnwer.content.split(\"/\")[0]);\n        return invoice;\n    } catch (e) {\n        return e;\n    }\n}","inputVariables":["openInvoices","chooseAnswer"],"outputVariable":"selectedInvoice","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"af2b0bd2-a800-4ec9-94af-3ba90dd056d1","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 3 selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 3 selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"8b1ac23f-8653-4118-9377-26662b43eaa9","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 3 inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 3 inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"cab23911-29d2-4c10-ac98-dd04a04b8f4c","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 3 exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 3 exibicao detalhes","action":"Exibicao | {{selectedInvoice@month}} | {{selectedInvoice@year}} | {{selectedInvoice@dueDateFormated}} | {{selectedInvoice@amount}}"},"conditions":[{"values":["Todas"],"source":"context","comparison":"notEquals","variable":"chooseAnswer@content"}]},{"$id":"67a0ba1a-1815-4d35-8925-f6b8dbafc84b","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 3 selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 3 selecao detalhes","action":"{{chooseAnswer@content}} | {{selectedInvoice@month}} | {{selectedInvoice@year}} | {{selectedInvoice@dueDateFormated}} | {{selectedInvoice@amount}}"},"conditions":[{"values":["Todas"],"source":"context","comparison":"notEquals","variable":"chooseAnswer@content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b5f2d94d-2d7a-4a80-9431-7ab811e2799e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-dca7ca78-d417-47f8-ae26-7f8c76e8332f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8a8b67be-9a31-4b75-85bd-78e20edc3f51","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-d42ccab7-b9e2-4260-88c6-0bb2465a9515","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1a8cbbdb-7560-4182-84ac-fd7bb1d382fe","root":false,"$title":"[P.1.7.0] 3 faturas em aberto","$position":{"top":"1082.14px","left":"11166.9px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5292aa4d-07e0-49b2-a076-4847ae44fbd8":{"$contentActions":[{"action":{"$id":"03c2ddb8-70a5-4eab-a844-ba15af88af41","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c669667a-26cb-43fc-8b65-f32feeccdb46","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c669667a-26cb-43fc-8b65-f32feeccdb46","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"96fb527b-bbdc-4fe1-a1a1-5cd50b6b7695","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7746e953-ea9d-497e-95d8-aa154c1b28ba","type":"text/plain","content":"Estou gerando seu código Pix, só um momento. 💠","metadata":{}},"$cardContent":{"document":{"id":"7746e953-ea9d-497e-95d8-aa154c1b28ba","type":"text/plain","content":"Estou gerando seu código Pix, só um momento. 💠"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"350d5164-77a0-4234-9edd-ffe66abd95e3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"94502937-e8fb-47fc-9e3d-17ed6fb52852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"94502937-e8fb-47fc-9e3d-17ed6fb52852","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9eaefadb-a192-4a62-a51f-cb36c3459b68","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"869e4142-17cc-4035-95da-76530477c78d","typeOfStateId":"state","$connId":"con_2328","$id":"5c4b0c46-d799-43d7-9ca8-bd358b1136e5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"df88315a-0423-4057-9b36-667366a68c62","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao erro persistente maior 0 validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao erro persistente maior 0 validacao","action":"Sim"},"conditions":[]},{"$id":"2d03b546-f59f-4397-b54d-1158dd03e81e","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial listar copia cola exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial listar copia cola exibicao","action":"Exibicao"},"conditions":[]},{"$id":"1794915e-7b00-4a8a-94c4-0a6e510ea0f5","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial listar copia cola exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial listar copia cola exibicao detalhes","action":"1"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c27ee720-b9f3-40fd-99e8-69c5265ae947","$typeOfContent":"","type":"SetVariable","$title":"Reset \"invoicesIterator\"","$invalid":false,"settings":{"variable":"invoicesIterator","value":"{{invoicesCount}}"},"conditions":[]},{"$id":"b6f724a2-0c90-4e6e-95a5-8255a8bbc93f","$typeOfContent":"","type":"TrackEvent","$title":"Set \"moreThanOneBill\"","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"moreThanOneBill","action":"true"},"conditions":[{"values":["As duas","Todas"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-d1072ead-04c1-42fd-bf8d-a27a349d697c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-93d4d856-b5c5-4cac-84d8-e32ab60481fd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7fbff176-a756-4ca0-abf8-e6af4526b04b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5292aa4d-07e0-49b2-a076-4847ae44fbd8","root":false,"$title":"[P.2.0.0] Listar Pix Copia e Cola","$position":{"top":"1277.57px","left":"10821px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f309125c-4256-4dd9-a4a0-ce2ae1078b7f":{"$contentActions":[{"action":{"$id":"4b7c58b0-07ea-4960-81a1-caf3e93423d1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1c1222f8-503a-4e51-88b6-448ebe078c0b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1c1222f8-503a-4e51-88b6-448ebe078c0b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"aa596115-1606-498d-a302-c62432dfbd0e","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{templateCopyPaste}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f4aa0326-f1ad-400f-b609-eaaabc19bea2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f309125c-4256-4dd9-a4a0-ce2ae1078b7f","typeOfStateId":"state","$connId":"con_2333","$id":"11c87e63-a3ff-4e52-b27f-b86a465ff3e9","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"bravo"}],"$invalid":false},{"stateId":"f309125c-4256-4dd9-a4a0-ce2ae1078b7f","typeOfStateId":"state","$connId":"con_2338","$id":"4239aa75-9b42-4bce-bb31-db268ceaf7b3","conditions":[{"source":"context","comparison":"greaterThan","values":["0"],"variable":"invoicesIterator"},{"values":["As duas","Todas"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"f06a3c2c-c572-4f0d-a581-7bfbcd31e012","typeOfStateId":"state","$connId":"con_2343","$id":"109485c4-e34b-4091-bbc7-9b026a4de3f5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"944c59d5-932c-43aa-8175-cc29ac72f0c1","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"selectedInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices, invoicesIterator) {\n\ttry {\n\t\tinvoicesIterator = parseInt(invoicesIterator);\n\t\topenInvoices = JSON.parse(openInvoices);\n\t\treturn openInvoices[invoicesIterator - 1];\n\t} catch (e) {\n\t\treturn e;\n\t}\n}","inputVariables":["openInvoices","invoicesIterator"],"outputVariable":"selectedInvoice","LocalTimeZoneEnabled":false},"conditions":[{"values":["Todas","As duas"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"92ea8b8d-2e6c-40ba-9770-b22401659a5b","$typeOfContent":"","type":"SetVariable","$title":"urlPathCopyToClipboardPage","$invalid":false,"settings":{"variable":"urlPathCopyToClipboardPage","value":"{{config.pixUrl}}/pix/copy?contactId={{contact.identity}}&pixPayload={{selectedInvoice@pixPayload}}"},"conditions":[]},{"$id":"7178caba-a33e-437a-94ba-909c12eb3012","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userRouterKey\"","$invalid":false,"settings":{"function":"run","source":"function run(routerName, authKeyRouter1, authKeyRouter2) {\n    try {\n        var isRouter2 = /(router2)/gi.test(routerName);\n\n        if (isRouter2) {\n            return authKeyRouter2;\n        }\n\n        return authKeyRouter1;\n    } catch (error) {\n        return \"invalid\"\n    }\n}","inputVariables":["resource.routerName","config.routerAuthorizationKey","config.router2AuthorizationKey"],"outputVariable":"userRouterKey","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"787bb4d2-9f3d-41df-9779-d838a5d4ffbe","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"pixRedirectUrlResponse\" USING \"post\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiKey}}"},"method":"POST","body":"{\n    \"botAuthKey\": \"{{userRouterKey}}\",\n    \"category\": \"Pix Residencial call to action link\",\n    \"action\": \"{{phonenumber}} | 1\",\n    \"redirectUrl\": \"{{urlPathCopyToClipboardPage}}\"\n}","uri":"{{config.urlApi}}LinkEventTracking/create-link","responseStatusVariable":"pixRedirectUrlStatus","responseBodyVariable":"pixRedirectUrlResponse"},"conditions":[]},{"$id":"0b2472ac-2772-49c5-9f53-1b4a8ef91026","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS pixRedirectUrlResponseDecoded","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(pixRedirectUrlResponse) {\n\treturn pixRedirectUrlResponse; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":["pixRedirectUrlResponse"],"outputVariable":"pixRedirectUrlResponseDecoded","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"21991051-db6d-4fde-b597-bba115eaf0b9","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial call to action exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial call to action exibicao","action":"Exibicao"},"conditions":[]},{"$id":"5567b014-997f-46d8-8528-c9d9c8f3267d","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial teste ab validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial teste ab validacao","action":"call to action"},"conditions":[]},{"$id":"d0391edf-066b-4d92-bb37-9f48ae0562f7","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"templateCopyPaste\"","$invalid":false,"settings":{"function":"run","source":"function run(selectedInvoice, identity, templateName, templateNamespace,pixRedirectUrlResponse,apiUrl) {\n    try {\n        selectedInvoice = JSON.parse(selectedInvoice);\n    } catch (e) {\n        return null;\n    }\n    return {\n        \"type\": \"interactive\",\n        \"interactive\": {\n            \"type\": \"cta_url\",\n            \"body\": {\n                \"text\": `Aqui está o código Pix referente ao mês de *${selectedInvoice.month}* no valor de *R$ ${selectedInvoice.amount}.*`\n            },\n            \"action\": {\n                \"name\": \"cta_url\",\n                \"parameters\": {\n                    \"display_text\": \"Copiar código Pix\",\n                    \"url\": pixRedirectUrlResponse\n                }\n            }\n        }\n    }\n/*\n    return {\n        \"type\": \"template\",\n        \"template\": {\n            \"namespace\": templateNamespace,\n            \"name\": templateName,\n            \"language\": {\n                \"policy\": \"deterministic\",\n                \"code\": \"pt_br\"\n            },\n            \"components\": [\n                {\n                    \"type\": \"body\",\n                    \"parameters\": [\n                        {\n                            \"type\": \"text\",\n                            \"text\": `${selectedInvoice.month}`\n                        },\n                        {\n                            \"type\": \"text\",\n                            \"text\": `${selectedInvoice.amount}`\n                        }\n                    ]\n                },\n                {\n                    \"type\": \"button\",\n                    \"index\": \"0\",\n                    \"sub_type\": \"url\",\n                    \"parameters\": [\n                        {\n                            \"type\": \"text\",\n                            \"text\": pixRedirectUrlResponse.replace(apiUrl+\"/\", '')\n                        }\n                    ]\n                }\n            ]\n        }\n    }*/\n}","inputVariables":["selectedInvoice","contact.identity","config.templatePixA","config.templateNamespace","pixRedirectUrlResponse","config.pixUrl"],"outputVariable":"templateCopyPaste","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d9809202-bfe3-4ac2-b5c2-e71685e3d5ca","$typeOfContent":"","type":"ExecuteScript","$title":"Update \"invoicesIterator\"","$invalid":false,"settings":{"function":"run","source":"function run(invoicesIterator) {\n    try {\n        invoicesIterator = parseInt(invoicesIterator) - 1;\n        return invoicesIterator\n    } catch (e) {\n        return 0\n    }\n}","inputVariables":["invoicesIterator"],"outputVariable":"invoicesIterator","LocalTimeZoneEnabled":false},"conditions":[{"values":["Todas","As duas"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"7730aad8-d75c-4b3f-9602-2e4ebaa8fc27","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial call to action exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial call to action exibicao detalhes","action":"Exibicao | {{selectedInvoice@amount}} | {{selectedInvoice@month}}/{{selectedInvoice@year}} | {{selectedInvoice@dueDateFormated}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"116c6c49-c824-4d78-8b90-0d2a2ff28354","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"httpErrorInfo\"","$invalid":false,"settings":{"function":"run","source":"function run(status, response) {\n    var url = '{{config.urlApi}}/api/LinkEventTracking/create-link';\n\n    return JSON.stringify({\n        skill: \"Faturamento Res\",\n        name: \"Criar link de registro com redirecionamento\",\n        status: status,\n        response: response,\n        request: {\n            url: url,\n            identity: '{{contact.identity}}'\n        }\n    })\n}","inputVariables":["pixRedirectUrlStatus","pixRedirectUrlResponse"],"outputVariable":"httpErrorInfo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","variable":"pixRedirectUrlStatus","comparison":"notEquals","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-de4405bc-916f-4ee8-999d-300fe77a2a49","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b79ed805-b077-41ed-be03-407c65be92ab","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d6c71af7-da57-4046-8685-7066b88173c7","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-1c284e25-aedb-428f-8745-3eb13c201e66","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d04b8b15-307f-42da-81db-ef63366f6d54","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-64322634-f2f2-4600-bc68-2a24a14d635d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f309125c-4256-4dd9-a4a0-ce2ae1078b7f","root":false,"$title":"[P.2.1.0]","$position":{"top":"1554px","left":"10531px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"17995de5-468f-4b17-9921-ea1d42af70e2":{"$contentActions":[{"action":{"$id":"f3c2a32f-0edc-4710-ae1d-5397fd62b19c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3783f1a3-539d-4cde-9dfa-8b3c2bb165b7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3783f1a3-539d-4cde-9dfa-8b3c2bb165b7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"29c172d6-fcca-42f5-ad25-ce357b450f97","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{templateCopyPaste}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"040ad86b-d53f-4b4c-81a8-5c6873df8988","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"17995de5-468f-4b17-9921-ea1d42af70e2","typeOfStateId":"state","$connId":"con_2348","$id":"cdccfcb6-b41e-4995-a837-a0b09b605488","conditions":[{"source":"context","comparison":"greaterThan","values":["0"],"variable":"invoicesIterator"},{"values":["As duas","Todas"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"f06a3c2c-c572-4f0d-a581-7bfbcd31e012","typeOfStateId":"state","$connId":"con_2353","$id":"79cee39a-7fb9-4b26-971e-87f9348f5fb8","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ae8f7504-e370-42c6-bbae-ed377ea1a1c0","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial teste ab validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial teste ab validacao","action":"copy authentication"},"conditions":[]},{"$id":"101bd3c6-8294-4bc6-9a21-b6922c96fe37","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial copy authentication exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial copy authentication exibicao","action":"Exibicao"},"conditions":[]},{"$id":"eb64f336-1ae3-4dd8-9e0a-dd77c694890e","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"selectedInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices, invoicesIterator) {\n\ttry {\n\t\tinvoicesIterator = parseInt(invoicesIterator);\n\t\topenInvoices = JSON.parse(openInvoices);\n\t\treturn openInvoices[invoicesIterator - 1];\n\t} catch (e) {\n\t\treturn e;\n\t}\n}","inputVariables":["openInvoices","invoicesIterator"],"outputVariable":"selectedInvoice","LocalTimeZoneEnabled":false},"conditions":[{"values":["Todas","As duas"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"dbac4067-3ad3-438d-b5c0-785aedaf8deb","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"templateCopyPaste\"","$invalid":false,"settings":{"function":"run","source":"function run(selectedInvoice, templateName, templateNamespace) {\n    try {\n        selectedInvoice = JSON.parse(selectedInvoice);\n    } catch (e) {\n        return null;\n    }\n\n    return {\n        \"type\": \"template\",\n        \"template\": {\n            \"namespace\": templateNamespace,\n            \"name\": templateName,\n            \"language\": {\n                \"policy\": \"deterministic\",\n                \"code\": \"pt_br\"\n            },\n            \"components\": [\n                {\n                    \"type\": \"body\",\n                    \"parameters\": [\n                        {\n                            \"type\": \"text\",\n                            \"text\": `${selectedInvoice.month.slice(0,3)} R$ ${(selectedInvoice.amount).toString().replace(\",\", \".\")}`\n                        }\n                    ]\n                },\n                {\n                    \"type\": \"button\",\n                    \"index\": \"0\",\n                    \"sub_type\": \"url\",\n                    \"parameters\": [\n                        {\n                            \"type\": \"text\",\n                            \"text\": `${encodeURI(selectedInvoice.pixPayload)}`\n                        }\n                    ]\n                }\n            ]\n        }\n    }\n}","inputVariables":["selectedInvoice","config.templatePixB","config.templateNamespace"],"outputVariable":"templateCopyPaste","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cbaa2479-8ba6-4765-9821-650260f7ccf6","$typeOfContent":"","type":"ExecuteScript","$title":"Update \"invoicesIterator\"","$invalid":false,"settings":{"function":"run","source":"function run(invoicesIterator) {\n    try {\n        invoicesIterator = parseInt(invoicesIterator) - 1;\n        return invoicesIterator\n    } catch (e) {\n        return 0\n    }\n}","inputVariables":["invoicesIterator"],"outputVariable":"invoicesIterator","LocalTimeZoneEnabled":false},"conditions":[{"values":["Todas","As duas"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"062bce16-5e20-4458-bbae-97e070bd76e0","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial copy authentication exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial copy authentication exibicao detalhes","action":"Exibicao | {{selectedInvoice@month}} |  {{selectedInvoice@year}} | {{selectedInvoice@dueDateFormated}} |  {{selectedInvoice@amount}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-2a3534f9-c284-4748-9df7-cd8aa1b4fadc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1836b0e8-67bb-4829-8868-d01a63c5023e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cafc7202-c3c2-4f72-8f01-7ea2c55a13f2","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"17995de5-468f-4b17-9921-ea1d42af70e2","root":false,"$title":"[P.2.2.0]","$position":{"top":"1562px","left":"11098px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"869e4142-17cc-4035-95da-76530477c78d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6d1f7042-82cd-41db-b9ea-dc4e58b565e8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f309125c-4256-4dd9-a4a0-ce2ae1078b7f","typeOfStateId":"state","$connId":"con_2358","$id":"50cd6f4b-3d4e-4fbd-a4fc-057b608d65f3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bb6a7325-3038-4a94-a9bb-78ea18dd6b4a","$typeOfContent":"","type":"ExecuteScript","$title":"Set abTest","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn Math.random() < 0.5;\n}","inputVariables":[],"outputVariable":"abTest","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f309125c-4256-4dd9-a4a0-ce2ae1078b7f","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-247251bd-5862-4ca0-a9a8-833edfb3e1cf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"869e4142-17cc-4035-95da-76530477c78d","root":false,"$title":"[P.2.0.1] Teste A/B","$position":{"top":"1484px","left":"10827.3px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f06a3c2c-c572-4f0d-a581-7bfbcd31e012":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"73e055b3-2bb0-459d-b7ab-4de99ce31bb1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"367d18b2-a826-4889-980f-a044cf8440ad","typeOfStateId":"state","$connId":"con_2363","$id":"14b12dba-67fd-43f3-b4f5-a68cc1e873af","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"dontShowTips"},{"values":["true"],"source":"context","comparison":"equals","variable":"dontShowTips"}],"$invalid":false},{"stateId":"e456a3e9-27c8-4613-9c40-b2c2d82c9d03","typeOfStateId":"state","$connId":"con_2368","$id":"83a1b47c-5e7d-4512-9cb8-0162233d1aaf","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"175548f0-30b2-4327-881f-407f8a55d2c0","$typeOfContent":"","type":"SetVariable","$title":"Set dicaInput","$invalid":false,"settings":{"variable":"dicaInput","value":"true"},"conditions":[]},{"$id":"92f0f14d-36bb-4498-b341-ee8004168115","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial desativou dica flutuante validacao (não)","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial desativou dica flutuante validacao","action":"nao"},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"dontShowTips"}]},{"$id":"807adcd9-298c-4456-b4b4-b4ff4425f8d6","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial desativou dica flutuante validacao (sim)","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial desativou dica flutuante validacao","action":"Sim"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dontShowTips"}]},{"$id":"012ea828-6631-438f-a4c5-325199f4f9b8","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial dica flutuante exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial dica flutuante exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":["Não mostre novamente"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-826d50c0-7a22-49d7-94d4-f4844b8bdf86","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7265a02c-ae49-44d4-8023-dff4db3a8ff4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"f06a3c2c-c572-4f0d-a581-7bfbcd31e012","root":false,"$title":"[P.2.3.0] Select dica flutante","$position":{"top":"1648.71px","left":"10814.6px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"367d18b2-a826-4889-980f-a044cf8440ad":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b89be09c-48b1-481b-9689-a86ceb30a4c5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:15"},"$invalid":false}],"$conditionOutputs":[{"stateId":"1e4db21e-ee65-464e-9d95-ca400b8edcb9","typeOfStateId":"state","$connId":"con_2373","$id":"e1364349-cb49-4d43-9365-c2f9f5b93994","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"0e1e32b8-8236-4d53-9be8-6b2573bd182f","typeOfStateId":"state","$connId":"con_2378","$id":"f0a08b4b-8a24-42ad-b570-7af33242e949","conditions":[{"source":"context","comparison":"notEquals","values":["text/plain"],"variable":"input.type"}],"$invalid":false},{"stateId":"4d17719e-bf53-455c-96a4-25d6f06fd88a","typeOfStateId":"state","$connId":"con_2383","$id":"09d1c15b-32d0-4729-9dcd-7258560db616","conditions":[{"source":"context","comparison":"equals","values":["Não mostre novamente"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"0d4b339c-2c56-4245-b744-37e7be8e43e1","typeOfStateId":"state","$connId":"con_2388","$id":"f8256ab6-f1e1-4900-8ed2-b2f8f7db62eb","conditions":[{"source":"context","comparison":"equals","values":["Já paguei"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"367d18b2-a826-4889-980f-a044cf8440ad","typeOfStateId":"state","$connId":"con_2393","$id":"0f47062a-2e8b-438c-91e0-34039162dde6","conditions":[{"source":"context","comparison":"equals","values":["Ok"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"941231ee-fa4d-4d10-a684-ede37db778ba","typeOfStateId":"state","$connId":"con_2398","$id":"477feb68-4736-4cd4-85a0-789cd51a4a34","conditions":[{"source":"context","comparison":"equals","values":["input inesperado"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0d2861e0-6207-47db-aad9-51962fd731d1","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return [\n    {\n      content: 'Já paguei',\n      regex: '(conta|bolet[ao]|f(r)?a(r)?tura)(.*)((a?pag([ao]|uei|amento)|debitad[oa]|liquidad[oa]|(qui|ki?)tad[oa]))|(([jt]|est)[aáà]|foi)(.*)((a?pag([ao]|uei|amento)|debitad[oa]|liquidad[oa]|(qui|ki?)tad[oa]))|((^av[ie][sz]ar?|comunicar?)\\\\s*(sobr?[ei]|que)?\\\\s*pag([ua]?i?men?to)?)|(^paguei$|pagamen?tos?\\\\s*(reali[sz]ados?|feitos?))|(confirmar\\\\s*meu\\\\s*pagamento)|(confirmar.*pagamento|dar\\\\s*baixa).*(faturas?|boletos?|contas?|d[ée]bitos?|d[íi]vida)|(faturas?|boletos?|contas?|d[ée]bitos?|d[íi]vida|pagamento).*(confirmad[ao]|baixado)|^pago$'\n    },\n    {\n      content: 'Não mostre novamente',\n      regex: '(n[aã]o\\\\s*mos?tre\\\\s*novamen?te)'\n    },\n    {\n      content: 'Ok',\n      regex: '^(ok|tu?do?\\\\s*bem|t[aá]\\\\s*bom)$'\n    }\n  ];\n};\n","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"76da1bf6-46d8-4175-b27d-b7d010a1016f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numericOptionsRegex\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn JSON.stringify([\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*1\\\\s*?)|um|(primei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*2\\\\s*?)|dois|(segund[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*3\\\\s*?)|tr[eê]s|(tercei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*4\\\\s*?)|quatro|(quart[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*5\\\\s*?)|cinco|(quint[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*6\\\\s*?)|seis|(sext[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*7\\\\s*?)|sete|(s[eé]tim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*8\\\\s*?)|oito|(oitav[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*9\\\\s*?)|nove|(non[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*10\\\\s*?)|dez|(d[eé]cim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*11\\\\s*?)|onze|(d[eé]cim[ao]\\\\s*primei?ra))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*12\\\\s*?)|doze|(d[eé]cim[ao])\\\\s*segunda)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*13\\\\s*?)|treze|(d[eé]cim[ao])\\\\s*tercei?ra)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*14\\\\s*?)|catorze|(d[eé]cim[ao])\\\\s*quarta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*15\\\\s*?)|quinze|(d[eé]cim[ao])\\\\s*quinta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*16\\\\s*?)|dezesseis|(d[eé]cim[ao])\\\\s*sexta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*17\\\\s*?)|dezessete|(d[eé]cim[ao])\\\\s*s[eé]tima)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*18\\\\s*?)|dezoit|(d[eé]cim[ao])\\\\s*oitava)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*19\\\\s*?)|dezenove|(d[eé]cim[ao])nona)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*20\\\\s*?)|vinte|(vig[eé]sima))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t]);\n}","inputVariables":[],"outputVariable":"numericOptionsRegex","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n\n  if (options && options.length > 0) {\n    numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    if (input != '') {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const contentRegex = new RegExp(options[i].regex, 'i');\n\n        if (numericRegex.test(input) || contentRegex.test(input)) {\n          return {\n            option: numericOption.toString(),\n            content: options[i].content,\n          };\n        }\n      }\n    }\n  }\n\n  return { option: 'invalid', content: 'input inesperado' };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[],"$id":"ea9b0e06-7769-4441-8aa9-5f288822cc0a"},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[],"$id":"a5a60d9b-3495-4ffd-97d7-ddc3658d7a2c"},{"$id":"3cf6c1bd-8a58-40e3-8dd0-55b7b9a0eac8","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial dica flutuante selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial dica flutuante selecao","action":"{{chooseAnswer@content}}"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"1df79fcc-a2bd-48fc-821e-2d39030afdb6","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial dica flutuante inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial dica flutuante inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"},{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-bc02ed6d-a8c4-460a-b8b3-e4b286222851","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5cae2cd6-a766-41bc-a098-b5e05440ee33","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9c63b74c-b557-42dd-a48e-0fd9b4908b44","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"367d18b2-a826-4889-980f-a044cf8440ad","root":false,"$title":"[P.2.4.1] [Input] Dica flutante","$position":{"top":"1925.29px","left":"10813px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4d17719e-bf53-455c-96a4-25d6f06fd88a":{"$contentActions":[{"action":{"$id":"da92dfef-20e4-48cf-8391-cd26184d3c2c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"11f95dba-faca-4f33-b161-8c7dcf004067","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"11f95dba-faca-4f33-b161-8c7dcf004067","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1af86b29-2c5f-42d6-ba39-7d1f6b37ecc2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6b7e6983-7357-4835-99d3-835bc449271a","type":"text/plain","content":"Combinado. ☺","metadata":{}},"$cardContent":{"document":{"id":"6b7e6983-7357-4835-99d3-835bc449271a","type":"text/plain","content":"Combinado. ☺"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e1e68033-3336-4072-abe1-45e8bc0089f7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"367d18b2-a826-4889-980f-a044cf8440ad","typeOfStateId":"state","$connId":"con_2403","$id":"867fbfb3-b1ad-4865-868b-50498945af33","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3197e8a2-8be1-4091-b3aa-fcaf791e2282","$typeOfContent":"","type":"SetVariable","$title":"Set \"dontShowTips\"","$invalid":false,"settings":{"variable":"dontShowTips","value":"true"},"conditions":[]},{"$id":"e586d062-efba-4a8b-869e-8ef06cad7f66","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial dica flutuante nao mostre exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial dica flutuante nao mostre exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-428392b3-7900-4a59-a3ab-d34e0b1d367b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-56642e75-5daf-4ee6-9fe3-c7ff85b0fa27","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fef2bcc1-a025-419a-9fe4-47c223e5e0f7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"4d17719e-bf53-455c-96a4-25d6f06fd88a","root":false,"$title":"[P.2.5.0]","$position":{"top":"2083px","left":"10593px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0d4b339c-2c56-4245-b744-37e7be8e43e1":{"$contentActions":[{"action":{"$id":"a07c3717-1ae5-4b3d-ada5-e924928ad91d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9275a97a-deb1-4081-b5e5-6218856de704","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9275a97a-deb1-4081-b5e5-6218856de704","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b71fa360-3a2a-4622-91be-eb7e0df3cea6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"87fd0c1d-1d9b-4d45-b093-4971d0493df5","type":"text/plain","content":"Se você já pagou sua fatura, ela deve ser faturada em breve. 🎉","metadata":{}},"$cardContent":{"document":{"id":"87fd0c1d-1d9b-4d45-b093-4971d0493df5","type":"text/plain","content":"Se você já pagou sua fatura, ela deve ser faturada em breve. 🎉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1e274f9d-53e1-4026-b774-b5834fa62a39","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1e9d3f3d-176f-4b09-8442-8a3daf581275","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial dica flutuante paguei exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial dica flutuante paguei exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1e4db21e-ee65-464e-9d95-ca400b8edcb9","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-eea68da3-ecab-45cc-9130-e4ecb48580f0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e2e000e5-f67d-4e5e-a6df-74f89a8ed561","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0d4b339c-2c56-4245-b744-37e7be8e43e1","root":false,"$title":"[P.2.6.0]","$position":{"top":"2083.29px","left":"11077.6px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e456a3e9-27c8-4613-9c40-b2c2d82c9d03":{"$contentActions":[{"action":{"$id":"6a6d0f80-c265-4a13-9f42-6e2bce0f44b8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3c7f9dcd-d0aa-4478-b3ff-0d40bb95979b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3c7f9dcd-d0aa-4478-b3ff-0d40bb95979b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e60bd0fd-3c72-497c-ad04-d4015d504932","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f3800a71-abb8-4c03-9ccb-9a9511a232db","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"367d18b2-a826-4889-980f-a044cf8440ad","typeOfStateId":"state","$connId":"con_2408","$id":"7c699b67-3ca9-4b12-b84d-f1b013a1b5e1","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4d233b4d-0eaa-4467-853a-8bd27c36868d","$typeOfContent":"","type":"ExecuteScript","$title":"Set userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a0d4e8bb-8326-49db-8386-d138a71c13f8","$typeOfContent":"","type":"ExecuteScript","$title":"Set channelBoldTags","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c2f89d2d-b53f-48bf-8791-c4ddec78cc90","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return [\n    {\n      content: 'Não mostre novamente',\n      regex: '(n[aã]o\\\\s*mos?tre\\\\s*novamen?te)'\n    }\n  ];\n};\n","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4e36b394-cabb-4ded-91e4-953869f1a1ff","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options, openInvoices) {\n    return getMenu(userChannel, channelBoldTags, options, openInvoices);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction getMenu(userChannel, channelBoldTags, options, openInvoices) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n    openInvoices = JSON.parse(openInvoices);\n\n    const menuFields = {\n        text: `*Dica ✨*\n\nPara pagar, copie o código > abra o aplicativo do seu banco > entre na área Pix > selecione *“Pix copia e cola”* > cole o código e realize pagamento.\n\n*Não precisa enviar o comprovante,* ok? A confirmação de pagamento é feita em, no máximo, 10 minutos.`,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: true,\n        hasWppListMenu: false,\n        isBlipImmediateMenu: true,\n    };\n\n    let menu = createMenu(props, config);\n\n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options","openInvoices"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-19c643c9-2194-4518-a573-158f3db61f76","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4c8edc93-a1b0-4f8f-b27a-38e1cd8aeece","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e456a3e9-27c8-4613-9c40-b2c2d82c9d03","root":false,"$title":"[P.2.4.0] [Message] Dica flutante","$position":{"top":"1743.29px","left":"10532px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e1e32b8-8236-4d53-9be8-6b2573bd182f":{"$contentActions":[{"action":{"$id":"acb1bee4-e999-45fb-9a3f-dcb64afe1ddc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a805a43a-488b-41b6-b750-69c839e1de4e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a805a43a-488b-41b6-b750-69c839e1de4e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"669167b4-221c-49bd-a83b-ca46bdb9a57f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"031f22d3-e5ff-4be4-986e-624576233731","type":"text/plain","content":"{{input.type}}","metadata":{}},"$cardContent":{"document":{"id":"031f22d3-e5ff-4be4-986e-624576233731","type":"text/plain","content":"{{input.type}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f5ed8d3c-ee8a-4f0b-9b89-2ae368f458c6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6e60e87b-b29d-46de-a510-97a8b49cf93d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6e60e87b-b29d-46de-a510-97a8b49cf93d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9406d35f-4d0d-4f2a-af10-98e2c75afab8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d7a33f32-2802-4e1c-af16-04c456cf3e62","type":"text/plain","content":"Poxa, ainda não consigo entender imagens. Mas, se for o comprovante de pagamento, *não precisa enviar da próxima vez,* ok?","metadata":{}},"$cardContent":{"document":{"id":"d7a33f32-2802-4e1c-af16-04c456cf3e62","type":"text/plain","content":"Poxa, ainda não consigo entender imagens. Mas, se for o comprovante de pagamento, *não precisa enviar da próxima vez,* ok?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f19b8944-5e88-4763-9c1e-203063d34ee6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"367d18b2-a826-4889-980f-a044cf8440ad","typeOfStateId":"state","$connId":"con_2413","$id":"dbad1079-a1ff-48c4-9059-0ef9444de1bd","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"56cbdf2d-c809-487b-b0fd-310d8f67426b","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial dica flutuante imagem exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial dica flutuante imagem exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-93d533e6-42dc-4eb7-a6bb-19ba9c6ce567","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6c3bd724-4e2e-48af-9a65-508c3cf9eada","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e1e32b8-8236-4d53-9be8-6b2573bd182f","root":false,"$title":"[P.2.7.0]","$position":{"top":"1930.29px","left":"11085px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1e4db21e-ee65-464e-9d95-ca400b8edcb9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3e9c5d0f-2c26-4354-9de3-6bea4eacd351","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"11d49cf6-3945-417b-b3f1-49839a6ad8aa","typeOfStateId":"state","$connId":"con_2418","$id":"e3530271-9ad4-44d0-9fdb-ee1f2235b31c","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"moreThanOneBill"}],"$invalid":false},{"stateId":"3d661629-1e01-48d7-9e8a-663fbd2c2060","typeOfStateId":"state","$connId":"con_2423","$id":"10fe02b8-7976-45c3-9f10-f345709b30db","conditions":[{"source":"context","comparison":"notEquals","values":["true"],"variable":"moreThanOneBill"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5126c001-9c5f-4bf6-bd92-8fc66f0d606d","$typeOfContent":"","type":"ProcessHttp","$title":"Requisição HTTP \"GetInvoices\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.claroWhatsappAuthorization}}"},"method":"GET","uri":"{{config.apiUrl}}/v1/intermediate/customerbill/invoices?AccessToken={{tokenAccessFormated}}&document={{document}}&contractNumber={{contractNumber}}&operatorCode={{operatorCode}}&limit=3","responseStatusVariable":"getInvoicesStatus","responseBodyVariable":"getInvoicesBody"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-25b773f9-653d-4949-91b9-2bba7922116b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"1e4db21e-ee65-464e-9d95-ca400b8edcb9","root":false,"$title":"[P.3.0.0] Gerou mais de uma fatura?","$position":{"top":"2228px","left":"10812.7px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"11d49cf6-3945-417b-b3f1-49839a6ad8aa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ec4ad3c9-f909-4bc8-a716-f12eced1f96d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b162fcac-744e-4a9c-b9d2-9aac05f40c80","typeOfStateId":"state","$connId":"con_2428","$id":"416a40f4-1d76-4505-b46a-4423237efcfc","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"hasOpenInvoice"}],"$invalid":false},{"stateId":"76bd8a22-4955-49df-90f8-3d7ea3645d6c","typeOfStateId":"state","$connId":"con_2433","$id":"05d116cc-970d-4541-8a65-94691b71b316","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false},{"stateId":"76bd8a22-4955-49df-90f8-3d7ea3645d6c","typeOfStateId":"state","$connId":"con_2438","$id":"8ed911d8-5c3e-49fd-acb1-abf6f3aa50eb","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"97507206-c285-4e52-9d56-b1bb9b009a9f","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"hasOpenInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(getInvoicesBody) {\n    try {\n        getInvoicesBody = JSON.parse(getInvoicesBody);\n\n        if (getInvoicesBody && getInvoicesBody.data && getInvoicesBody.data.data && getInvoicesBody.data.data.invoices) {\n            for (let invoice of getInvoicesBody.data.data.invoices) {\n                if (invoice.statusDescription == \"Em Aberto\") {\n                    return true;\n                }\n            }\n        }\n        return false;\n    } catch (e) {\n        return true;\n    }\n}","inputVariables":["getInvoicesBody"],"outputVariable":"hasOpenInvoice","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"getInvoicesStatus"}],"continueOnError":true},{"$id":"5532580f-1acd-400e-a444-cfbde99c7d73","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial validar pg mais de uma fatura validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial validar pg mais de uma fatura validacao","action":"Sim"},"conditions":[]},{"$id":"3181ef87-7184-4eae-b8e9-2675ad49b54b","$typeOfContent":"","type":"TrackEvent","$title":"Status geral API Sucesso","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Status geral API","action":"Validar_Pagamento_lista_faturas | P.3.1.0 | Whatsapp | Sucesso | 200"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"getInvoicesStatus"}]},{"$id":"b5ffdc2f-766f-4193-8557-3602314e88c3","$typeOfContent":"","type":"TrackEvent","$title":"Status geral API Falha","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Status geral API","action":"Validar_Pagamento_lista_faturas | P.3.1.0 | Whatsapp | Falha | {{getInvoicesStatus}} | {{getInvoicesBody}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-408b0eee-043d-4c7b-b12b-6d257f95446c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f08de495-ff94-4c70-b386-0dd1c2a998de","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"11d49cf6-3945-417b-b3f1-49839a6ad8aa","root":false,"$title":"[P.3.1.0] Todas as faturas estão pagas?","$position":{"top":"2344.44px","left":"10549px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b162fcac-744e-4a9c-b9d2-9aac05f40c80":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a180a219-3203-40ee-8908-18041259a212","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"ee700873-3125-45c2-988a-c3348fc46f43","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial validar pg mais um status pg validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial validar pg mais um status pg validacao","action":"Sim"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"98078bbf-601a-4376-a02e-32b5fd96b272","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-f89f6f99-7cc1-4e95-97e1-accb0bbdd243","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"b162fcac-744e-4a9c-b9d2-9aac05f40c80","root":false,"$title":"Faturas estão pagas","$position":{"top":"2511.67px","left":"10303.7px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"76bd8a22-4955-49df-90f8-3d7ea3645d6c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c62ddd59-c481-4465-bcc0-b8ecca9f52ea","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"cee995cd-48a4-43a4-9aed-505513720193","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial validar pg mais um status pg validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial validar pg mais um status pg validacao","action":"nao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0a010cd7-8600-4ba1-9cb7-3c446a6fe0c7","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-34804188-2a37-4c38-88f8-17fb47d2c780","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"76bd8a22-4955-49df-90f8-3d7ea3645d6c","root":false,"$title":"Faturas não estão pagas","$position":{"top":"2520.67px","left":"10646.7px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3d661629-1e01-48d7-9e8a-663fbd2c2060":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b884780-4bda-447b-9b5f-0914f4feda2e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"98078bbf-601a-4376-a02e-32b5fd96b272","typeOfStateId":"state","$connId":"con_2443","$id":"4c39d507-985d-4a8a-9cf6-d173417d0069","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"hasOpenInvoice"}],"$invalid":false},{"stateId":"0a010cd7-8600-4ba1-9cb7-3c446a6fe0c7","typeOfStateId":"state","$connId":"con_2448","$id":"3065b0f6-d258-4172-995e-b05d39b3e5f7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false},{"stateId":"0a010cd7-8600-4ba1-9cb7-3c446a6fe0c7","typeOfStateId":"state","$connId":"con_2453","$id":"0685949b-a0a6-48b5-aa12-4079e558a3b3","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bf81ed81-c1c6-43c8-a64d-61208ac1528a","$typeOfContent":"","type":"ExecuteScript","$title":"Set \"hasOpenInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(getInvoicesBody) {\n    try {\n        getInvoicesBody = JSON.parse(getInvoicesBody);\n\n        if (getInvoicesBody && getInvoicesBody.data && getInvoicesBody.data.data && getInvoicesBody.data.data.invoices) {\n            for (let invoice of getInvoicesBody.data.data.invoices) {\n                if (invoice.statusDescription == \"Em Aberto\") {\n                    return true;\n                }\n            }\n        }\n        return false;\n    } catch (e) {\n        return true;\n    }\n}","inputVariables":["getInvoicesBody"],"outputVariable":"hasOpenInvoice","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"getInvoicesStatus"}],"continueOnError":true},{"$id":"d6530dbb-f359-489e-9eb8-0fb2296fb46d","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial validar pg mais de uma fatura validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial validar pg mais de uma fatura validacao","action":"nao"},"conditions":[]},{"$id":"5bb51798-f3db-43d6-a330-c5efd8c84cac","$typeOfContent":"","type":"TrackEvent","$title":"Status geral API Sucesso","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Status geral API","action":"Validar_Pagamento_lista_faturas | P.3.2.1 | Whatsapp | Sucesso | 200"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"getInvoicesStatus"}]},{"$id":"c6f18c35-5cfa-41cd-ad02-8c2b2a3367ed","$typeOfContent":"","type":"TrackEvent","$title":"Status geral API Falha","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Status geral API","action":"Validar_Pagamento_lista_faturas | P.3.2.1 | Whatsapp | Falha | {{getInvoicesStatus}} | {{getInvoicesBody}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-af1f2e0d-3dd7-4393-9e36-b08649d954c3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-163d3508-669a-4691-a782-cb00277d53d4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3d661629-1e01-48d7-9e8a-663fbd2c2060","root":false,"$title":"[P.3.2.1] A fatura está paga?","$position":{"top":"2355.33px","left":"11132px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"98078bbf-601a-4376-a02e-32b5fd96b272":{"$contentActions":[{"action":{"$id":"cbd2de83-3817-42e6-a1d4-e42adb73b50e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0fbddbf6-3cdf-4279-99ce-a8fb8c000fb7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0fbddbf6-3cdf-4279-99ce-a8fb8c000fb7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b482d8bc-a92a-4151-9580-36a4e091184c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"610c98cc-f381-427e-ab83-1dbc25094c78","type":"text/plain","content":"Fatura em dia! ✅\nRecebemos o seu pagamento. Obrigado!","metadata":{}},"$cardContent":{"document":{"id":"610c98cc-f381-427e-ab83-1dbc25094c78","type":"text/plain","content":"Fatura em dia! ✅\nRecebemos o seu pagamento. Obrigado!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"472fda6d-31a1-446c-a970-2e61876f46c7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"d598037d-87aa-438e-a770-676df9192d16","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial validar pg status pg validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial validar pg status pg validacao","action":"Sim"},"conditions":[]},{"$id":"22daa2a3-5487-4f62-b312-20369525ebd4","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial validar status pg sim exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial validar status pg sim exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0a010cd7-8600-4ba1-9cb7-3c446a6fe0c7","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-dc37cf89-4685-49d9-b31b-159cf82af12f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3137d32a-227a-467d-860a-5b20745fd039","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"98078bbf-601a-4376-a02e-32b5fd96b272","root":false,"$title":"[P.3.3.0] Fatura paga","$position":{"top":"2512.57px","left":"11000px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0a010cd7-8600-4ba1-9cb7-3c446a6fe0c7":{"$contentActions":[{"action":{"$id":"f1e24d2e-0454-4850-ad91-485588fcf6cf","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ae1ce395-bdc2-4168-9d07-df56d000c4b3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ae1ce395-bdc2-4168-9d07-df56d000c4b3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cab18ef8-bfad-46f0-b64c-156f2fcec51b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"30ad0131-46e0-4552-9bf3-8fb4cfa391d9","type":"text/plain","content":"Você acabou de experimentar a praticidade de pagar com Pix! Da próxima vez que precisar é só enviar “Pix do meu {{selectedServiceFaturaRes}}”. 🫶","metadata":{}},"$cardContent":{"document":{"id":"30ad0131-46e0-4552-9bf3-8fb4cfa391d9","type":"text/plain","content":"Você acabou de experimentar a praticidade de pagar com Pix! Da próxima vez que precisar é só enviar “Pix do meu {{selectedServiceFaturaRes}}”. 🫶"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"06643391-3ef3-491b-90a8-b8121f7c1c57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e811cbb1-5f0f-4337-9c66-7f7f78b25e19","typeOfStateId":"state","$connId":"con_2458","$id":"230e05e7-7eb6-494a-b4f9-a5bdd3288052","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false},{"stateId":"e811cbb1-5f0f-4337-9c66-7f7f78b25e19","typeOfStateId":"state","$connId":"con_2463","$id":"6886a8f1-ee1e-41de-ac77-5e01063f7b25","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5f46099a-0c4f-48f1-92f9-d4c87acda0d4","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial validar pg status pg validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial validar pg status pg validacao","action":"nao"},"conditions":[]},{"$id":"5ab11598-03ce-4c90-8141-8c5c1a87542f","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial validar status pg nao exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial validar status pg nao exibicao","action":"Exibicao"},"conditions":[]},{"$id":"66c00170-6086-446a-8067-1babe7c32f9f","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial validar status pg nao exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial validar status pg nao exibicao detalhes","action":"Exibicao | Claro Combo Multi"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-4f77c57e-600e-4626-90e6-3c42105c7e7c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1b290138-f025-4fbf-8258-f037b29f140a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0a010cd7-8600-4ba1-9cb7-3c446a6fe0c7","root":false,"$title":"[P.3.4.0] Fatura não está paga","$position":{"top":"2516.75px","left":"11280px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a3987fa2-95be-4cfb-9cb0-83bdfa3cd64f":{"$contentActions":[{"action":{"$id":"737d942b-56da-4ae2-b0f5-1feefea03b99","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b5112205-f641-4fd7-8b2b-ec4bf2e5d10e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b5112205-f641-4fd7-8b2b-ec4bf2e5d10e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d2f55836-569a-403b-ae82-3d6d71f38e82","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8e2a13ec-224e-48eb-8772-4eb5bd75fb3f","type":"text/plain","content":"Tudo bem.","metadata":{}},"$cardContent":{"document":{"id":"8e2a13ec-224e-48eb-8772-4eb5bd75fb3f","type":"text/plain","content":"Tudo bem."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"46fbc01e-f2d4-4d67-944f-6a449f63c13d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a6cb2b3a-8464-4bbb-8511-7b72f6c68f7b","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao finalizar negativa exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao finalizar negativa exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-a7e55dd3-5424-4a9c-bd5d-4d7c8783f71f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a604f17a-5590-4923-9528-f1d5f4f50ce9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a3987fa2-95be-4cfb-9cb0-83bdfa3cd64f","root":false,"$title":"E.5.0.0 Redirecionar para Finalização após Negativ","$position":{"top":"869.286px","left":"10234px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"203d8800-aa43-4dc4-9d95-6a9c9f7c1a74":{"$contentActions":[{"action":{"$id":"9f83dfe4-2e7d-4196-adb5-8a7566ec753e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"71d81697-1f64-4524-a812-4e0252d9e9c5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"71d81697-1f64-4524-a812-4e0252d9e9c5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"78b5c359-733e-4e52-ac1d-ad8e46316154","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d6136fdb-2e21-4237-85e8-f7bd0465c7e7","type":"text/plain","content":"Desculpe, essa fatura é qual das que eu te mostrei?","metadata":{}},"$cardContent":{"document":{"id":"d6136fdb-2e21-4237-85e8-f7bd0465c7e7","type":"text/plain","content":"Desculpe, essa fatura é qual das que eu te mostrei?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"41e68ac7-0ec8-4f6d-9e85-c46395659bf3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0b7ec526-8183-440e-a77e-2a0f0a488239","typeOfStateId":"state","$connId":"con_2468","$id":"951c299f-419e-4159-8f74-453b05edbd21","conditions":[{"source":"context","comparison":"equals","values":["2"],"variable":"invoicesCount"},{"values":["0"],"source":"context","comparison":"greaterThan","variable":"erroPersistente"}],"$invalid":false},{"stateId":"1a8cbbdb-7560-4182-84ac-fd7bb1d382fe","typeOfStateId":"state","$connId":"con_2473","$id":"ba360913-5c60-485f-b00a-460fdd36aede","conditions":[{"source":"context","comparison":"equals","values":["3"],"variable":"invoicesCount"},{"values":["0"],"source":"context","comparison":"greaterThan","variable":"erroPersistente"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4b10f7ac-47be-4406-96cd-e989f8d64241","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao fatura validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao fatura validacao","action":"Menu 2 Faturas Abertas"},"conditions":[{"values":["2"],"source":"context","comparison":"equals","variable":"invoicesCount"}]},{"$id":"6cfae2b6-c1ed-4c95-a1dd-6d6fd66c181b","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao fatura validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao fatura validacao","action":"Menu 3 Faturas Abertas"},"conditions":[{"values":["3"],"source":"context","comparison":"equals","variable":"invoicesCount"}]},{"$id":"ff5d4ffa-110c-4bd0-9944-f22f4450a04a","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao erro persistente maior 0 validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao erro persistente maior 0 validacao","action":"nao"},"conditions":[]},{"$id":"59274047-fbea-4149-9cd9-9089c7bc0c36","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao fatura exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao fatura exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8e41ee0b-933b-4bb8-8e4a-ccff2670b3a7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-01a7a5e6-1edd-4209-bcd4-5e3888a5315c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"203d8800-aa43-4dc4-9d95-6a9c9f7c1a74","root":false,"$title":"[E.2.0.0] NM Selecionar Fatura","$position":{"top":"873.556px","left":"11391.4px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"39e1492a-0f8c-4a17-9c35-75bc38016c9f":{"$contentActions":[{"action":{"$id":"3ced591c-0371-45ce-8ae8-80717502a2d4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"010890f3-386e-46ae-af72-eefacba3c691","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"010890f3-386e-46ae-af72-eefacba3c691","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6b5c7441-97e6-423c-9b34-c807591011d3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b86bde29-12bc-4412-b2fe-1b809e803f0a","type":"text/plain","content":"Parece que o pagamento via Pix *ainda não está habilitado para o seu plano.*","metadata":{}},"$cardContent":{"document":{"id":"b86bde29-12bc-4412-b2fe-1b809e803f0a","type":"text/plain","content":"Parece que o pagamento via Pix *ainda não está habilitado para o seu plano.*","metadata":{}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"082524c7-0495-4009-a821-698e18c0cda1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"617bf7e5-a1aa-4bb0-a081-12b4361b9549","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"617bf7e5-a1aa-4bb0-a081-12b4361b9549","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0a826ded-692a-453b-ae60-b7d0a358b36b","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"d84e9a59-1b78-4ddd-879c-be25dc54140e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a3987fa2-95be-4cfb-9cb0-83bdfa3cd64f","typeOfStateId":"state","$connId":"con_2478","$id":"0042cd80-624d-4369-b6e1-31a192a43ec2","conditions":[{"source":"context","comparison":"equals","values":["Não precisa"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","typeOfStateId":"state","$connId":"con_2483","$id":"5d5e5487-eecd-4fd0-9593-41fbc203d4fa","conditions":[{"source":"context","comparison":"contains","values":[" gerar fatura"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0aa64f6c-b6af-40fc-a4fa-cbb83c525e9c","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura tipo cod barras validacao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura tipo cod barras validacao","action":"nao"},"conditions":[]},{"$id":"8c129f83-cf0c-4a30-b0f7-1fc0a79e00cc","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao pix nao elegivel exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao pix nao elegivel exibicao","action":"Exibicao"},"conditions":[]},{"$id":"eaad6dee-92d5-487a-a371-a1cca2edb8e9","$typeOfContent":"","type":"ExecuteScript","$title":"Set userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"eb79d41d-6c89-4ac4-b530-e1f8910f1f20","$typeOfContent":"","type":"ExecuteScript","$title":"Set channelBoldTags","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e25f8120-e359-4462-9b67-b1e7b8fe5483","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return [\n    {\n      content: 'Sim, gerar fatura',\n      regex: '^(ok|quero|tudo\\\\s*bem)$|(((si[mn]|pode),?)?\\\\s*ger[ea]r?\\\\s*(as?)?\\\\s*faturas?)|(pode\\\\s*gerar?)'\n    },\n    {\n      content: 'Não precisa',\n      regex: '^(n[aã]o|n[aã]o\\\\s*(quero|precisa))$|(n[aã]o\\\\s*gere\\\\s*(as?)?\\\\s*faturas?)'\n    }\n  ];\n};\n","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fe0c378d-8b4f-4b44-89cc-1cfc4a9ed4b1","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        text: `Eu posso *gerar suas faturas detalhadas,* o que acha?`,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: true,\n        hasWppListMenu: false,\n        isBlipImmediateMenu: true,\n    };\n\n    let menu = createMenu(props, config);\n    \n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1bab28fb-a8e7-4b0d-b8e8-04d254471eb5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numericOptionsRegex\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn JSON.stringify([\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*1\\\\s*?)|um|(primei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*2\\\\s*?)|dois|(segund[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*3\\\\s*?)|tr[eê]s|(tercei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*4\\\\s*?)|quatro|(quart[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*5\\\\s*?)|cinco|(quint[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*6\\\\s*?)|seis|(sext[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*7\\\\s*?)|sete|(s[eé]tim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*8\\\\s*?)|oito|(oitav[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*9\\\\s*?)|nove|(non[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*10\\\\s*?)|dez|(d[eé]cim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*11\\\\s*?)|onze|(d[eé]cim[ao]\\\\s*primei?ra))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*12\\\\s*?)|doze|(d[eé]cim[ao])\\\\s*segunda)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*13\\\\s*?)|treze|(d[eé]cim[ao])\\\\s*tercei?ra)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*14\\\\s*?)|catorze|(d[eé]cim[ao])\\\\s*quarta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*15\\\\s*?)|quinze|(d[eé]cim[ao])\\\\s*quinta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*16\\\\s*?)|dezesseis|(d[eé]cim[ao])\\\\s*sexta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*17\\\\s*?)|dezessete|(d[eé]cim[ao])\\\\s*s[eé]tima)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*18\\\\s*?)|dezoit|(d[eé]cim[ao])\\\\s*oitava)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*19\\\\s*?)|dezenove|(d[eé]cim[ao])nona)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*20\\\\s*?)|vinte|(vig[eé]sima))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t]);\n}","inputVariables":[],"outputVariable":"numericOptionsRegex","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n\n  if (options && options.length > 0) {\n    numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    if (input != '') {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const contentRegex = new RegExp(options[i].regex, 'i');\n\n        if (numericRegex.test(input) || contentRegex.test(input)) {\n          return {\n            option: numericOption.toString(),\n            content: options[i].content,\n          };\n        }\n      }\n    }\n  }\n\n  return { option: 'invalid', content: 'input inesperado' };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[],"$id":"14d8a45b-0ad5-4fed-af05-2864bd7dd2c6"},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[],"$id":"5a36e124-ade5-476a-a76a-d784a6306699"},{"$id":"d1c13382-f70d-4ffd-b684-2e5186e5dcfb","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao pix nao elegivel selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao pix nao elegivel selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"4a026018-2bcc-44b9-89bd-b2646c768186","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao pix nao elegivel inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao pix nao elegivel inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"615f8b3f-2527-4a0e-bd80-947948b04c0d","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao pix nao elegivel exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao pix nao elegivel exibicao detalhes","action":"Exibicao | {{mobileClientType}}"},"conditions":[]},{"$id":"2cdbe3e7-87f0-4e07-9c99-046818a4856b","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao pix nao elegivel selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao pix nao elegivel selecao detalhes","action":"{{chooseAnswer@content}} | {{mobileClientType}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-6dc4b6d3-9553-4490-8160-44abf9cfbfdf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e3de8912-9092-4ab0-a065-3e91302cdaac","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-920f7966-3880-4ac1-a603-4c0581caf0c0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-68377257-6c72-44e8-a2c6-878688617a97","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"39e1492a-0f8c-4a17-9c35-75bc38016c9f","root":false,"$title":"[E.3.0.0] Exceção Pix não elegível","$position":{"top":"682.714px","left":"11346px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e747b47e-e9b7-401e-b515-e8a3c89d0f4a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2ef971cf-ce14-40b7-9e89-08cf5ca43f50","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"baa81344-c705-43c3-8fb7-05f4a89cf5c3","typeOfStateId":"state","$connId":"con_2488","$id":"9e1f69df-247c-4b07-b146-ac0ad4852e61","conditions":[{"source":"context","comparison":"equals","values":["021"],"variable":"tokenPayload@codigoOperadora"}],"$invalid":false},{"stateId":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","typeOfStateId":"state","$connId":"con_2493","$id":"31fc7bd5-3844-4131-92af-07a3c6baf4ae","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bc04f6c2-6ca5-4691-878a-e512991059ba","$typeOfContent":"","type":"SetVariable","$title":"erroPersistente","$invalid":false,"settings":{"variable":"erroPersistente","value":"2"},"conditions":[]},{"$id":"d50adda3-78b8-45ee-94ed-32b4b2863d27","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"lastFeature\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    var date = new Date();\n    return {\n        name: 'Fatura Residencial Pix',\n        channel: 'Claro Residencial',\n        text: 'com sua fatura',\n        date: new Date()\n    }\n}","inputVariables":[],"outputVariable":"lastFeature","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-316e714b-fd84-4534-9049-4c13800f81fb","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-208cbe11-f8a2-4791-89f6-0817f9845b38","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"e747b47e-e9b7-401e-b515-e8a3c89d0f4a","root":false,"$title":"[SELECT] Claro TV","$position":{"top":"60px","left":"10818.4px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0b82988b-a5b8-4e72-ba64-0c135e2e51d2":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"881ae644-2e16-4a91-ac61-612758af1a12","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2218e690-f599-4214-af50-dd42797ac152","typeOfStateId":"state","$connId":"con_2498","$id":"882f45c2-cf6b-4335-8a0f-779f43924293","conditions":[{"source":"context","comparison":"equals","values":["Código Pix"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"198d34e4-4b89-4ec2-a3f1-45b2cc6c10d7","typeOfStateId":"state","$connId":"con_2503","$id":"dd141f96-866c-4e06-88c1-63cf05381024","conditions":[{"source":"context","comparison":"equals","values":["Código de barras"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"34347643-ab7c-4809-a53e-cd7b1f2be325","typeOfStateId":"state","$connId":"con_2508","$id":"aa90ed6e-6edf-46b9-8c10-114032515ba5","conditions":[{"source":"context","comparison":"equals","values":["Segunda via"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"29736574-85ec-4d85-b5b8-7b4e5b833782","typeOfStateId":"state","$connId":"con_2513","$id":"9f4c56cc-d534-4880-921f-dc800c1396a1","conditions":[{"source":"context","comparison":"equals","values":["Promessa de pagamento"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"2df23b8d-35a1-40ca-a18a-b10a5692cd8c","typeOfStateId":"state","$connId":"con_2518","$id":"41b6b283-6e03-47ad-a392-a484cdc13795","conditions":[{"source":"context","comparison":"equals","values":["Fatura digital"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"a79bebc7-c116-478f-8d65-42408b0d716b","typeOfStateId":"state","$connId":"con_2523","$id":"620de2de-9a1e-42bc-8f5a-2df08ab61d52","conditions":[{"source":"context","comparison":"equals","values":["Como pagar a Fatura"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"fba7b34e-5fdb-4389-a3cd-c603aedeb9a9","typeOfStateId":"state","$connId":"con_2528","$id":"a1696665-7764-4e5e-a6c4-231386860c53","conditions":[{"source":"context","comparison":"equals","values":["Voltar ao menu anterior"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"b434339f-dd01-41f8-a242-318de8db7a1c","typeOfStateId":"state","$connId":"con_2533","$id":"9e3e639a-e0a6-4325-bf63-ed06bbc58fd8","conditions":[{"source":"context","comparison":"equals","values":["Débito automático"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"89d3ae9e-1ea6-4172-839e-97f54531fb89","typeOfStateId":"state","$connId":"con_2538","$id":"edf28488-6b7b-4fb9-a09e-e5c16e7871c5","conditions":[{"source":"context","comparison":"equals","values":["input inesperado"],"variable":"chooseAnswer@content"},{"values":["0"],"source":"context","comparison":"greaterThan","variable":"erroPersistente"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4e7290b5-7fd7-4e22-a096-237c413ac61d","$typeOfContent":"","type":"SetVariable","$title":"Set \"lastMenuFaturaRes\"","$invalid":false,"settings":{"variable":"lastMenuFaturaRes","value":"F.2.0.0"},"conditions":[]},{"$id":"ddcc2b4f-e323-427a-a1a2-d40cec7bea8c","$typeOfContent":"","type":"ExecuteScript","$title":"Update \"erroPersistente\"","$invalid":false,"settings":{"function":"run","source":"function run(erroPersistente) {\n\terroPersistente = parseInt(erroPersistente);\n\terroPersistente = erroPersistente - 1;\n\treturn erroPersistente;\n}","inputVariables":["erroPersistente"],"outputVariable":"erroPersistente","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - chooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n  if (options && options.length > 0) {\n    const numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, \"\");\n    if (input != \"\") {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericOptionRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const option = options[i];\n        const contentRegex = new RegExp(option.regex, 'i');\n        if (numericOptionRegex.test(input) || contentRegex.test(input)) {\n          return { option: \"\" + numericOption, content: option.content };\n        }\n      }\n    }\n  }\n\n  return { option: \"invalid\", content: \"input inesperado\" };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[],"$id":"a5d66603-4d6e-463d-b7de-96d19a0d25e3"},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[],"$id":"fe7bd0ce-fbd9-43bf-877d-8a839dcd14f3"},{"$id":"bd160665-c2d5-4630-bb45-94cfcd15ef6f","$typeOfContent":"","type":"TrackEvent","$title":"Menu fatura claro tv selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Menu fatura claro tv selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"36837e03-4c5f-4c4a-9875-60dd808ed61d","$typeOfContent":"","type":"TrackEvent","$title":"Menu fatura claro tv input","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"action":"{{inputContentSubstring}}","category":"Menu fatura claro tv input"},"conditions":[{"values":["input content"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]},{"$id":"e3e52009-f243-4c8f-9431-53d815d211e2","$typeOfContent":"","type":"SetVariable","$title":"returnOption","$invalid":false,"settings":{"variable":"returnOption"},"conditions":[{"values":["Voltar ao menu anterior"],"source":"context","comparison":"notEquals","variable":"chooseAnswer@content"}]},{"$id":"df2af35d-7d74-40ac-a609-befda788ce30","$typeOfContent":"","type":"SetVariable","$title":"set returnOption","$invalid":false,"settings":{"variable":"returnOption","value":"#voltar"},"conditions":[{"values":["Voltar ao menu anterior"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"},{"values":[],"source":"context","comparison":"notExists","variable":"returnOption"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8898f48b-71c7-4d71-a36a-e50cfd99ebda","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c12fd67a-472d-478d-91f3-fdb2b044d10c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b13ef3a7-4ae8-49ee-aca0-0e5c21e88a9f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-22b2c16c-55f1-40d4-8b82-b3214b018d54","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0b82988b-a5b8-4e72-ba64-0c135e2e51d2","root":false,"$title":"[F.2.0.1] [input] MENU Fatura Claro TV","$position":{"top":"343px","left":"11099px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"941231ee-fa4d-4d10-a684-ede37db778ba":{"$contentActions":[{"action":{"$id":"2b6afc0e-70b7-4b8d-9bb3-30b69cddbc7f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3a5886be-d188-4efb-86f7-15697636d38f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3a5886be-d188-4efb-86f7-15697636d38f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"37033ff5-197d-4ec0-8ec6-9009bd37ccd3","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"5ec78db0-c445-4783-baba-ea8f5741f24d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"270ca3c1-18d4-4240-bee4-d878fab79a12","typeOfStateId":"state","$connId":"con_2543","$id":"688daaec-fe47-4f6f-b979-6a72c48deafd","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"chooseAnswer@content"}],"$invalid":false},{"stateId":"46db9f26-9348-4a18-bf04-4db56a86301a","typeOfStateId":"state","$connId":"con_2548","$id":"cbaf97a7-b13b-4d29-ac19-d22fb8bba411","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"chooseAnswer@content"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"85208864-88aa-4629-a224-2bd214d5aeb8","$typeOfContent":"","type":"ExecuteScript","$title":"Set userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n    return getUserChannel(contactIdentity);\n}\n\nfunction getUserChannel(contactIdentity) {\n    const CHANNEL = 1;\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const FACEBOOK_CHANNEL = \"facebook\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n    const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n    const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n    const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n    const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n    const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL];\n    let userChannel = DEFAULT_CHANNEL;\n\n    switch (contactChannelIdentifier) {\n        case WHATSAPP_IDENTIFIER:\n            userChannel = WHATSAPP_CHANNEL;\n            break;\n        case BLIPCHAT_IDENTIFIER:\n            userChannel = BLIPCHAT_CHANNEL;\n            break;\n\n    }\n\n    return userChannel;\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d44c792f-7eac-47c4-8464-22ab002d7d3a","$typeOfContent":"","type":"ExecuteScript","$title":"Set channelBoldTags","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n    return getBoldTagsByChannel(userChannel)\n}\n\nfunction getBoldTagsByChannel(userChannel) {\n    const DEFAULT_CHANNEL = \"other\";\n    const WHATSAPP_CHANNEL = \"whatsapp\";\n    const BLIPCHAT_CHANNEL = \"blipchat\";\n    const INSTAGRAM_CHANNEL = \"instagram\"\n\n    let channelBoldTags = {\n        open: \"<b>\",\n        close: \"</b>\",\n        open_i: \"<i>\",\n        close_i: \"</i>\"\n    };\n\n    switch (userChannel) {\n        case WHATSAPP_CHANNEL:\n        case INSTAGRAM_CHANNEL:\n            channelBoldTags = {\n                open: \"*\",\n                close: \"*\",\n                open_i: \"_\",\n                close_i: \"_\"\n            };\n            break;\n    }\n\n    return channelBoldTags;\n}","inputVariables":["userChannel"],"outputVariable":"channelBoldTags","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e367be90-bb58-4c01-933d-362ac6c82324","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return [\n    {\n      content: 'Sim',\n      regex: '^(si[mn]|si[mn]\\\\s*preciso|preciso)$'\n    },\n    {\n      content: 'Não',\n      regex: '^(n[aã]o|n[aã]o\\\\s*preciso)$'\n    }\n  ];\n};\n","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"42e3129d-3bc3-40b4-9f97-3f2c71f5a184","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    return options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        text: `Desculpe, não entendi. Você ainda precisa de ajuda?`,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: true,\n        hasWppListMenu: false,\n        isBlipImmediateMenu: true,\n    };\n\n    let menu = createMenu(props, config);\n    \n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2e256d84-6ff8-4b89-b6a7-33987ef31123","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numericOptionsRegex\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn JSON.stringify([\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*1\\\\s*?)|um|(primei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*2\\\\s*?)|dois|(segund[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*3\\\\s*?)|tr[eê]s|(tercei?r[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*4\\\\s*?)|quatro|(quart[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*5\\\\s*?)|cinco|(quint[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*6\\\\s*?)|seis|(sext[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*7\\\\s*?)|sete|(s[eé]tim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*8\\\\s*?)|oito|(oitav[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*9\\\\s*?)|nove|(non[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*10\\\\s*?)|dez|(d[eé]cim[ao]))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*11\\\\s*?)|onze|(d[eé]cim[ao]\\\\s*primei?ra))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*12\\\\s*?)|doze|(d[eé]cim[ao])\\\\s*segunda)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*13\\\\s*?)|treze|(d[eé]cim[ao])\\\\s*tercei?ra)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*14\\\\s*?)|catorze|(d[eé]cim[ao])\\\\s*quarta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*15\\\\s*?)|quinze|(d[eé]cim[ao])\\\\s*quinta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*16\\\\s*?)|dezesseis|(d[eé]cim[ao])\\\\s*sexta)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*17\\\\s*?)|dezessete|(d[eé]cim[ao])\\\\s*s[eé]tima)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*18\\\\s*?)|dezoit|(d[eé]cim[ao])\\\\s*oitava)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*19\\\\s*?)|dezenove|(d[eé]cim[ao])nona)(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t\t\"^\\\\s*\\\\.*((n[úu]m\\\\w*|op[çcs][aã]o)\\\\s*)?((0*20\\\\s*?)|vinte|(vig[eé]sima))(\\\\s*op[çsc][aã]o)?\\\\s*$\",\n\t]);\n}","inputVariables":[],"outputVariable":"numericOptionsRegex","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"90e5c3e0-391f-4a5c-8ab9-943460af6976","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao não entendi precisa ajuda exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao não entendi precisa ajuda exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"Executar script - ChooseAnswer","$invalid":false,"settings":{"function":"run","source":"function run(numericOptionsRegex, options, input) {\n  options = JSON.parse(options);\n\n  if (options && options.length > 0) {\n    numericOptionsRegex = JSON.parse(numericOptionsRegex);\n    input = input.replace(/[\\.\\*\\-\\\\\\[\\]{}_/\"'!?~^;:,´`=+&%$#()]/gm, '');\n\n    if (input != '') {\n      for (let i = 0; i < options.length; i++) {\n        const numericOption = i + 1;\n        const numericRegex = new RegExp(numericOptionsRegex[i], 'i');\n        const contentRegex = new RegExp(options[i].regex, 'i');\n\n        if (numericRegex.test(input) || contentRegex.test(input)) {\n          return {\n            option: numericOption.toString(),\n            content: options[i].content,\n          };\n        }\n      }\n    }\n  }\n\n  return { option: 'invalid', content: 'input inesperado' };\n}","inputVariables":["numericOptionsRegex","options","input.content"],"outputVariable":"chooseAnswer","LocalTimeZoneEnabled":false},"conditions":[],"$id":"691e082b-0f0a-4675-9d55-8952a653e2dc"},{"type":"ExecuteScript","$title":"Executar script - Input Content Substring","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(input) {\n                return input.substring(0,255);\n            }","inputVariables":["input.content"],"outputVariable":"inputContentSubstring","LocalTimeZoneEnabled":false},"conditions":[],"$id":"92d82806-0576-4e02-b918-97484640575c"},{"$id":"5392e4ed-0d3a-48bc-b3f9-f00993439a0f","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao não entendi precisa ajuda selecao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao não entendi precisa ajuda selecao","action":"{{chooseAnswer@content}}"},"conditions":[]},{"$id":"b3e32fa5-ac3b-4506-ae0e-1bff11ffda17","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao não entendi precisa ajuda inesperado","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao não entendi precisa ajuda inesperado","action":"{{inputContentSubstring}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"chooseAnswer@content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-f2a92b2b-93fb-4f99-96a2-512ec26d62ab","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bdb878c9-6e37-404f-861b-6b96a4329230","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-424a4dec-4918-4c3f-934b-7b95aa2f0e10","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-eb44c66f-6659-4a41-a6b2-6726c27f8015","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"941231ee-fa4d-4d10-a684-ede37db778ba","root":false,"$title":"[E.4.0.0] NM Continuar interação","$position":{"top":"1726.29px","left":"11086px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"270ca3c1-18d4-4240-bee4-d878fab79a12":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9e235a10-39e7-4299-bf9f-3c98c90a64ad","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a3f28324-8da9-4181-94c4-4a095bb8ea62","$typeOfContent":"","type":"SetVariable","$title":"Set \"redirectMessage\"","$invalid":false,"settings":{"variable":"redirectMessage","value":"inicio"},"conditions":[]},{"$id":"8ae24e90-3c38-4725-82c3-09835618138d","$typeOfContent":"","type":"Redirect","$title":"Redirecionar para principal","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b20b2677-b424-477b-8760-6fa192fd12d2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-eae469ae-05e5-4da5-84a5-9d5feb3e5d9b","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"270ca3c1-18d4-4240-bee4-d878fab79a12","root":false,"$title":"Redirecionar para principal","$position":{"top":"1681.29px","left":"11336px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"46db9f26-9348-4a18-bf04-4db56a86301a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e2f5112a-fb8f-4bd5-81bf-e7acf5fdba01","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"46db9f26-9348-4a18-bf04-4db56a86301a","root":false,"$title":"[GO TO] Redireciona para finalização","$position":{"top":"1832.29px","left":"11335px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"89d3ae9e-1ea6-4172-839e-97f54531fb89":{"$contentActions":[{"action":{"$id":"478bdbb4-389c-4e5e-8e87-99a78ee72b5c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"00a02093-7f8a-46f5-a1f1-3f6515c2901d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00a02093-7f8a-46f5-a1f1-3f6515c2901d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8f7650af-5b7a-46bc-9e37-ad17e1e2997a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"26d289c2-dad7-43b4-b3f2-872fefb0a678","type":"text/plain","content":"Desculpe, não entendi muito bem o que você precisa. Clicando no botão “*Opções sobre Fatura*” você consegue ver alguns assuntos que consigo te ajudar.","metadata":{}},"$cardContent":{"document":{"id":"26d289c2-dad7-43b4-b3f2-872fefb0a678","type":"text/plain","content":"Desculpe, não entendi muito bem o que você precisa. Clicando no botão “*Opções sobre Fatura*” você consegue ver alguns assuntos que consigo te ajudar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"374ecc43-baff-4c9e-b6ec-1df64d3cb89f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"040d78d2-8415-4a98-80ff-59e74fcc70ef","typeOfStateId":"state","$connId":"con_2553","$id":"42a7a44b-572f-4235-b7a4-053957c67a4a","conditions":[{"source":"context","comparison":"equals","values":["F.1.0.0"],"variable":"lastMenuFaturaRes"}],"$invalid":false},{"stateId":"0b82988b-a5b8-4e72-ba64-0c135e2e51d2","typeOfStateId":"state","$connId":"con_2558","$id":"8db481d4-bd00-459b-8b2b-b94bd0e537a0","conditions":[{"source":"context","comparison":"equals","values":["F.2.0.0"],"variable":"lastMenuFaturaRes"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"21d72e94-7bae-4440-9c94-0ca68bb0838f","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao menu fatural exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao menu fatural exibicao","action":"Exibicao"},"conditions":[]},{"$id":"87afb2ca-5573-4062-901e-42ee480f7a4d","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao menu fatural validacao (F.1.0.0)","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial excecao menu fatural validacao","action":"Fatura residencial"},"conditions":[{"values":["F.1.0.0"],"source":"context","comparison":"equals","variable":"lastMenuFaturaRes"}]},{"$id":"9a94bead-7e1e-4fef-983e-326d6973c8d8","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial excecao menu fatural validacao (F.2.0.0)","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"action":"Fatura Claro tv","category":"Pix Residencial excecao menu fatural validacao"},"conditions":[{"values":["F.2.0.0"],"source":"context","comparison":"equals","variable":"lastMenuFaturaRes"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-1c453c91-bf79-4edd-a6d7-0dce6b62451d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ac329190-4577-4605-9e87-9d4e82e65bfb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"89d3ae9e-1ea6-4172-839e-97f54531fb89","root":false,"$title":"[E.1.0.0] NM Em Menu Fatural","$position":{"top":"346.143px","left":"11405.3px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"af10a725-9cca-4c89-9cd6-e1cdcd295a53":{"$contentActions":[{"action":{"$id":"038fa424-e30f-499c-8740-424c4f4f8580","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"358d6ed1-4c27-4ce9-b097-2e76a11e5603","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"358d6ed1-4c27-4ce9-b097-2e76a11e5603","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7e5e0cc0-a290-4af0-abde-341186c9a183","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"91a91056-e362-440d-8523-1b0917eec2e6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"040d78d2-8415-4a98-80ff-59e74fcc70ef","typeOfStateId":"state","$connId":"con_2563","$id":"e0094876-e07a-49f7-906b-0cf995b4432a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3f001c9f-f9be-46d4-a549-09fc1f77471d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return [\n    {\n      content: 'Código Pix',\n      regex: '(pix\\\\s*copia\\\\s*e\\\\s*cola|faturas?\\\\s*co[mn]\\\\s*pix|c[oó]digos?\\\\s*pix)',\n      description: 'Pagar fatura com Pix de forma instantânea (Recomendado)'\n    },\n    {\n      content: 'Código de barras',\n      regex: '(c[oó]digos?\\\\s*(d[ea])?\\\\s*barr?as?)',\n      description: 'Pagar fatura com Código de barras'\n    },\n    {\n      content: 'Segunda via',\n      regex: '(pdf|(faturas?|boletos?)\\\\s*detalh?ad[oa]s?|segun?das?\\\\s*vias?|2ª?\\\\s*vias?)',\n      description: 'PDF da fatura detalhada'\n    },\n    {\n      content: 'Promessa de pagamento',\n      regex: '(pr?omess?as?\\\\s*(d[eo])?\\\\s*pagamen?tos?|reativa(r|[cç][aã]o)\\\\s*(d[oe]s?)?\\\\s*servi[cç]os?)',\n      description: 'Negociar a reativação do serviço'\n    },\n    {\n      content: 'Fatura digital',\n      regex: '((faturas?|boletos?)\\\\s*digita(l|is)|envi[ea]r?\\\\s*(faturas?|boletos?)\\\\s*(.*)\\\\s*e\\\\-?mail)',\n      description: 'Enviar Fatura todo mês por e-mail'\n    },\n    {\n      content: 'Como pagar a Fatura',\n      regex: '((co[mn]o\\\\s*pag[ao]r?\\\\s*(as?|os?)?\\\\s*(faturas?|boletos?)))'\n    },\n    {\n      content: 'Débito automático',\n      regex: '((d[eé]bitos?|pagamen?tos?)\\\\s*autom[aá]ticos?)',\n      description: 'Pagamento automático que desconta da sua conta todo mês'\n    },\n    {\n      content: 'Alterar vencimento',\n      regex: '((altera(r|[cç][aã]o)|m[ou]d[ia](r|ficar?))\\\\s*(os?|de)?\\\\s*ven?cimen?tos?)',\n      description: 'Alterar data do vencimento da Fatura'\n    },\n    {\n      content: 'Voltar ao menu anterior',\n      regex: '^(voltar)$|((voltar)\\\\s*ao\\\\s*menu)|menu\\\\s*anterior'\n    }\n  ];\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7d0178a4-4203-4de9-9435-091384ccee9f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    let section1 = options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n    let lastOption = section1.pop();\n\n    return {\n        \"FATURA\": section1,\n        \"NAVEGAÇÃO\": [`${lastOption}`]\n    };\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        //header: 'Opções sobre Fatura',\n        button: 'Opções sobre Fatura',\n        text:  `Certo! Posso gerar o ${channelBoldTags.open}Código de barras${channelBoldTags.close} ou ${channelBoldTags.open}Pix${channelBoldTags.close} de pagamento, ${channelBoldTags.open}gerar o PDF da sua fatura${channelBoldTags.close} ou ajudar com outros assuntos. O que você precisa?`,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: false,\n        hasWppListMenu: true,\n        isBlipImmediateMenu: false,\n    };\n\n    let menu = createMenu(props, config);\n    \n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"151887db-7825-4e71-a096-a58176156066","$typeOfContent":"","type":"TrackEvent","$title":"Menu fatura residencial net exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Menu fatura residencial net exibicao detalhes","action":"Exibicao | {{selectedServiceFaturaRes}}"},"conditions":[]},{"$id":"371eee0f-8c00-440c-864c-b52186d81a59","$typeOfContent":"","type":"SetVariable","$title":"tipoAtendimento","$invalid":false,"settings":{"variable":"tipoAtendimento","value":"residencial"},"conditions":[]},{"$id":"f4b9de29-c04a-4ccf-af78-66da91dd9dd3","$typeOfContent":"","type":"TrackEvent","$title":"Menu fatura residencial net exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Menu fatura residencial net exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-d143fb19-8ba6-4144-ba80-4857b2e4b515","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f71facb9-c192-4d22-b310-e5bf1c969287","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d4ad0798-d7f2-4a5d-8d17-00b243c377a3","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-486b2576-0a90-446d-a63a-71420684a294","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"af10a725-9cca-4c89-9cd6-e1cdcd295a53","root":false,"$title":"[A.1.8] MENU Fatura Residencial","$position":{"top":"198px","left":"10819px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"baa81344-c705-43c3-8fb7-05f4a89cf5c3":{"$contentActions":[{"action":{"$id":"e08cf746-6301-4e60-a328-d38d11476f4d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"da92a5bc-a72f-4b1a-a822-9b3326869d0c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"da92a5bc-a72f-4b1a-a822-9b3326869d0c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"596cfebc-c9ae-4611-b476-5fcf78c73e01","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"637644e9-b33b-4a75-abf2-06285cf224c7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0b82988b-a5b8-4e72-ba64-0c135e2e51d2","typeOfStateId":"state","$connId":"con_2568","$id":"081dc30a-00a7-438e-8f9c-1906451c5705","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dcff49b8-81c6-4cf9-9016-33eab8d30932","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"options\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return [\n    {\n      content: 'Código Pix',\n      regex: '(pix\\\\s*copia\\\\s*e\\\\s*cola|faturas?\\\\s*co[mn]\\\\s*pix|c[oó]digos?\\\\s*pix)',\n      description: 'Pagar fatura com Pix de forma instantânea (Recomendado)'\n    },\n    {\n      content: 'Código de barras',\n      regex: '(c[oó]digos?\\\\s*(d[ea])?\\\\s*barr?as?)',\n      description: 'Pagar fatura com Código de barras'\n    },\n    {\n      content: 'Segunda via',\n      regex: '(pdf|(faturas?|boletos?)\\\\s*detalh?ad[oa]s?|segun?das?\\\\s*vias?|2ª?\\\\s*vias?)',\n      description: 'PDF da fatura detalhada'\n    },\n    {\n      content: 'Promessa de pagamento',\n      regex: '(pr?omess?as?\\\\s*(d[eo])?\\\\s*pagamen?tos?|reativa(r|[cç][aã]o)\\\\s*(d[oe]s?)?\\\\s*servi[cç]os?)',\n      description: 'Negociar a reativação do serviço'\n    },\n    {\n      content: 'Fatura digital',\n      regex: '((faturas?|boletos?)\\\\s*digita(l|is)|envi[ea]r?\\\\s*(faturas?|boletos?)\\\\s*(.*)\\\\s*e\\\\-?mail)',\n      description: 'Enviar Fatura todo mês por e-mail'\n    },\n    {\n      content: 'Como pagar a Fatura',\n      regex: '((co[mn]o\\\\s*pag[ao]r?\\\\s*(as?|os?)?\\\\s*(faturas?|boletos?)))'\n    },\n    {\n      content: 'Débito automático',\n      regex: '((d[eé]bitos?|pagamen?tos?)\\\\s*autom[aá]ticos?)',\n      description: 'Pagamento automático que desconta da sua conta todo mês'\n    },\n    {\n      content: 'Voltar ao menu anterior',\n      regex: '^(voltar)$|((voltar)\\\\s*ao\\\\s*menu)|menu\\\\s*anterior'\n    }\n  ];\n}","inputVariables":[],"outputVariable":"options","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f0e6a96f-9282-41b8-8dca-fd1fb3bb224d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"menu\"","$invalid":false,"settings":{"function":"run","source":"{{resource.dev_createMenuFunction}}\n\nfunction run(userChannel, channelBoldTags, options) {\n    return getMenu(userChannel, channelBoldTags, options);\n}\n\nfunction getOptions(options) {\n    options = JSON.parse(options);\n    let section1 = options.map((opt) => !opt.description ? opt.content : `${opt.content}\\n${opt.description}`);\n    let lastOption = section1.pop();\n\n    return {\n        \"FATURA\": section1,\n        \"NAVEGAÇÃO\": [`${lastOption}`]\n    };\n}\n\nfunction getMenu(userChannel, channelBoldTags, options) {\n    channelBoldTags = JSON.parse(channelBoldTags);\n\n    const menuFields = {\n        //header: 'Opções sobre Fatura',\n        button: 'Opções sobre Fatura',\n        text:  `Certo! Posso gerar o ${channelBoldTags.open}Código de barras${channelBoldTags.close} ou ${channelBoldTags.open}Pix${channelBoldTags.close} de pagamento, ${channelBoldTags.open}gerar o PDF da sua fatura${channelBoldTags.close} ou ajudar com outros assuntos. O que você precisa?`,\n        options: getOptions(options)\n    };\n\n    let props = {\n        userChannel,\n        channelBoldTags,\n        menuFields\n    };\n\n    let config = {\n        hasDefaultQuickReply: true,\n        hasWppQuickReply: false,\n        hasWppListMenu: true,\n        isBlipImmediateMenu: false,\n    };\n\n    let menu = createMenu(props, config);\n    \n    return menu;\n}","inputVariables":["userChannel","channelBoldTags","options"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d5a0a284-4d51-4bef-a51f-235c89977f05","$typeOfContent":"","type":"TrackEvent","$title":"Menu fatura claro tv exibicao","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Menu fatura claro tv exibicao","action":"Exibicao"},"conditions":[]},{"$id":"cc69394a-ade6-464b-859e-f22eb381ec58","$typeOfContent":"","type":"SetVariable","$title":"tipoAtendimento","$invalid":false,"settings":{"variable":"tipoAtendimento","value":"tv"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8d645de2-7b84-4700-a214-f4770ab19bd8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-da0a365d-97a0-4b9d-a5d6-88715ceb60f5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0be8bd80-65a1-4d15-ac3d-2902cf3271d8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ce917886-c7c2-430c-84e9-e29c353c95dd","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"baa81344-c705-43c3-8fb7-05f4a89cf5c3","root":false,"$title":"[F.2.0.0] MENU Fatura Claro TV","$position":{"top":"190px","left":"11102px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e811cbb1-5f0f-4337-9c66-7f7f78b25e19":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0a52ec3b-2031-466c-b4da-20c130a0f971","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7482a23b-d90f-4476-840a-7f1f1a076702","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"e811cbb1-5f0f-4337-9c66-7f7f78b25e19","root":false,"$title":"[GO TO] Redireciona para finalização","$position":{"top":"2688px","left":"11282.3px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"03e8a5ad-e0f9-468c-9f8f-3c74b1396f10":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"49fde5a6-47d3-45ed-aaa0-871a55175553","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5292aa4d-07e0-49b2-a076-4847ae44fbd8","typeOfStateId":"state","$connId":"con_2573","$id":"033b66df-66e7-4dca-b82c-1722c6650b7f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"47a074dd-33d1-4efa-a37a-7db8fb87c3dd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"firstInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices) {\n\ttry {\n\t\topenInvoices = JSON.parse(openInvoices);\n\t\treturn openInvoices[0];\n\t} catch (error) {\n\t\treturn null;\n\t}\n}","inputVariables":["openInvoices"],"outputVariable":"firstInvoice","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"be5781fd-b42d-498f-a7b1-5e269ac1d060","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"secondInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices) {\n\ttry {\n\t\topenInvoices = JSON.parse(openInvoices);\n\t\treturn openInvoices[1];\n\t} catch (error) {\n\t\treturn null;\n\t}\n}","inputVariables":["openInvoices"],"outputVariable":"secondInvoice","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"849a455c-33c6-4b48-90f2-97a9ad4141dd","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 exibicao detalhes","action":"Exibicao | {{firstInvoice@month}} | {{firstInvoice@year}} | {{firstInvoice@dueDateFormated}} | {{firstInvoice@amount}}"},"conditions":[]},{"$id":"56175e56-bd96-4182-b760-2bf03140d2ba","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 selecao detalhes","action":"{{chooseAnswer@content}} | {{firstInvoice@month}} | {{firstInvoice@year}} | {{firstInvoice@dueDateFormated}} | {{firstInvoice@amount}}"},"conditions":[]},{"$id":"473e62eb-64c8-4c7e-9235-29de4d8a8539","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 exibicao detalhes","action":"Exibicao | {{secondInvoice@month}} | {{secondInvoice@year}} | {{secondInvoice@dueDateFormated}} | {{secondInvoice@amount}}"},"conditions":[]},{"$id":"ee8c98c0-a7f3-4702-9cf9-d604491bdd24","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 selecao detalhes","action":"{{chooseAnswer@content}} | {{secondInvoice@month}} | {{secondInvoice@year}} | {{secondInvoice@dueDateFormated}} | {{secondInvoice@amount}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5292aa4d-07e0-49b2-a076-4847ae44fbd8","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-ab2556f7-e8ed-40e6-8450-b217547d3527","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-24d98925-32bd-4670-a6fc-622c6b75a45f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"03e8a5ad-e0f9-468c-9f8f-3c74b1396f10","root":false,"$title":"[TRACKINGS] 2 faturas em aberto","$position":{"top":"1239.86px","left":"10482.1px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cb0323b1-1ace-428e-9bd2-a408ef0435c6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b7757fbb-2a49-46b6-be3c-2ca811f312dd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5292aa4d-07e0-49b2-a076-4847ae44fbd8","typeOfStateId":"state","$connId":"con_2578","$id":"87ea5373-6a50-4ccf-8c23-2645cdaff843","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"222cfe9d-7baa-47d8-9470-497b15d9727c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"firstInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices) {\n\ttry {\n\t\topenInvoices = JSON.parse(openInvoices);\n\t\treturn openInvoices[0];\n\t} catch (error) {\n\t\treturn null;\n\t}\n}","inputVariables":["openInvoices"],"outputVariable":"firstInvoice","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"49a85d55-db16-4dab-9a90-2094c879f43a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"secondInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices) {\n\ttry {\n\t\topenInvoices = JSON.parse(openInvoices);\n\t\treturn openInvoices[1];\n\t} catch (error) {\n\t\treturn null;\n\t}\n}","inputVariables":["openInvoices"],"outputVariable":"secondInvoice","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9254a528-d18b-471a-8eae-05e4cda423ce","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"thirdInvoice\"","$invalid":false,"settings":{"function":"run","source":"function run(openInvoices) {\n\ttry {\n\t\topenInvoices = JSON.parse(openInvoices);\n\t\treturn openInvoices[2];\n\t} catch (error) {\n\t\treturn null;\n\t}\n}","inputVariables":["openInvoices"],"outputVariable":"thirdInvoice","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"05cf00ef-8ed3-4d03-9e7d-2ee3e7f662fc","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 exibicao detalhes","action":"Exibicao | {{firstInvoice@month}} | {{firstInvoice@year}} | {{firstInvoice@dueDateFormated}} | {{firstInvoice@amount}}"},"conditions":[]},{"$id":"7a2119a5-03f3-4d74-9657-77f97a81f6a2","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 selecao detalhes","action":"{{chooseAnswer@content}} | {{firstInvoice@month}} | {{firstInvoice@year}} | {{firstInvoice@dueDateFormated}} | {{firstInvoice@amount}}"},"conditions":[]},{"$id":"25a7b2f9-10ac-41c7-9724-ad40eeb48aaa","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 exibicao detalhes","action":"Exibicao | {{secondInvoice@month}} | {{secondInvoice@year}} | {{secondInvoice@dueDateFormated}} | {{secondInvoice@amount}}"},"conditions":[]},{"$id":"319c0e1a-19b9-4055-ac54-11d69aeb3a1d","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 selecao detalhes","action":"{{chooseAnswer@content}} | {{secondInvoice@month}} | {{secondInvoice@year}} | {{secondInvoice@dueDateFormated}} | {{secondInvoice@amount}}"},"conditions":[]},{"$id":"672214a2-95d5-4a42-854d-65d5b11ea2cb","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 exibicao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 exibicao detalhes","action":"Exibicao | {{thirdInvoice@month}} | {{thirdInvoice@year}} | {{thirdInvoice@dueDateFormated}} | {{thirdInvoice@amount}}"},"conditions":[]},{"$id":"f6ff83fe-b19e-45d9-8053-fe977bf44511","$typeOfContent":"","type":"TrackEvent","$title":"Pix Residencial fatura 2 selecao detalhes","$invalid":false,"settings":{"extras":{"userName":"{{contact.name}}","phoneNumber":"{{contact.phoneNumber}}","perfilMovel":"{{mobileClientType}}","lastTicketId":"{{lastTicketId}}","message":"{{input.content}}","origin":"{{lastState}}","canalSelecao":"{{CanalSelecao}}","globalSessionId":"{{globalSessionId}}","userSessionCount":"{{userSessionCount}}","contrato":"{{contrato}}","protocolo_ouvidoria":"{{ombudsmanProtocol}}","template_usado_ouvidoria":"{{ombudsmanTemplate}}","LastFeature":"{{lastState}}","SessionId":"{{SessionId}}"},"category":"Pix Residencial fatura 2 selecao detalhes","action":"{{chooseAnswer@content}} | {{thirdInvoice@month}} | {{thirdInvoice@year}} | {{thirdInvoice@dueDateFormated}} | {{thirdInvoice@amount}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5292aa4d-07e0-49b2-a076-4847ae44fbd8","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-9dac1953-5435-4ffe-8f88-d2ac751a2289","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7a102944-d5a3-4a38-af8e-a6154b6593b5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"cb0323b1-1ace-428e-9bd2-a408ef0435c6","root":false,"$title":"[TRACKINGS] 3 faturas em aberto","$position":{"top":"1257.86px","left":"11167.1px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fba7b34e-5fdb-4389-a3cd-c603aedeb9a9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3435d335-b621-4cc4-ad60-52a6af70834e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to principal","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{returnOption}}"},"address":"{{config.servicoPrincipal}}"},"conditions":[],"$id":"01013015-93f6-4a4e-9829-04acea3e4116"}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-93c8d2fd-21fd-4c67-9a7a-ecf9acae1b6d","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"fba7b34e-5fdb-4389-a3cd-c603aedeb9a9","root":false,"$title":"Redireciona para Opcao voltar","$position":{"top":"158px","left":"3375px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"584e6c88-8a10-4d1c-8c6f-6247385ae02c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f4fa6154-eb07-4bb3-8be8-034d9903e618","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c9d7799a-4793-4479-b785-583e8afcd8a5","$typeOfContent":"","type":"SetVariable","$title":"redirectMessage","$invalid":false,"settings":{"variable":"redirectMessage","value":"#voltar"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c34d021-99d6-4f30-9a66-5c9b7715171f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bec13bfa-14a0-4bf0-aa49-7ee035972cae","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"584e6c88-8a10-4d1c-8c6f-6247385ae02c","root":false,"$title":"Redireciona Menu anterior #RET.1.1.1","$position":{"top":"781px","left":"1024px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5c34d021-99d6-4f30-9a66-5c9b7715171f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f8bf43a9-a44e-425b-a31a-41076a45e52a","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"Redirect","$title":"Redirect to principal","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{config.servicoPrincipal}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-5d6fd97e-c325-4f56-a14f-df7e7202f250","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5c34d021-99d6-4f30-9a66-5c9b7715171f","$position":{"top":"15px","left":"1195.67px"},"$title":"Redireciona para o principal (redirectMessage)","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}